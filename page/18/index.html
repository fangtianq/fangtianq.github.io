<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fangtianq.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"changyan","storage":false,"lazyload":false,"nav":null,"activeClass":"changyan"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="有志者事竟成">
<meta property="og:type" content="website">
<meta property="og:title" content="越努力，越幸运！">
<meta property="og:url" content="https://fangtianq.github.io/page/18/index.html">
<meta property="og:site_name" content="越努力，越幸运！">
<meta property="og:description" content="有志者事竟成">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ftq">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fangtianq.github.io/page/18/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/18/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>越努力，越幸运！</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">越努力，越幸运！</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Where there is a will, there is a way!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">56</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">21</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">314</span></a></li><li class="menu-item menu-item-留言版"><a href="/guestbook/" rel="section"><i class="comments fa-fw"></i>留言版</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-friendlink"><a href="/friendlink/" rel="section"><i class="link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ftq"
      src="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
  <p class="site-author-name" itemprop="name">ftq</p>
  <div class="site-description" itemprop="description">有志者事竟成</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">314</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fangtianq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/fangtianq" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.github.io/" title="GitHub.io → https:&#x2F;&#x2F;fangtianq.github.io&#x2F;"><i class="github fa-fw"></i>GitHub.io</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.gitee.io/" title="Gitee.io → https:&#x2F;&#x2F;fangtianq.gitee.io&#x2F;" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee.io</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://leetcode-cn.com/" title="https:&#x2F;&#x2F;leetcode-cn.com&#x2F;" rel="noopener" target="_blank">力扣网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://rap2.taobao.org/" title="http:&#x2F;&#x2F;rap2.taobao.org&#x2F;" rel="noopener" target="_blank">RAP2接口管理平台</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/09/02/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E8%B6%85%E8%BF%87%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/09/02/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E8%B6%85%E8%BF%87%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA/" class="post-title-link" itemprop="url">如何超过大多数人</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-03 00:00:00" itemprop="dateCreated datePublished" datetime="2019-09-03T00:00:00+08:00">2019-09-03</time>
    </span>


  
    <span id="/2019/09/02/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E8%B6%85%E8%BF%87%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA/" class="post-meta-item leancloud_visitors" data-flag-title="如何超过大多数人" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="如何超过大多数人" href="/2019/09/02/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E8%B6%85%E8%BF%87%E5%A4%A7%E5%A4%9A%E6%95%B0%E4%BA%BA/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::306d6592ba3d60d3498d7ee386d59a65" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="如何超过大多数人"><a href="#如何超过大多数人" class="headerlink" title="如何超过大多数人"></a>如何超过大多数人</h1><blockquote>
<p>转自 <a target="_blank" rel="noopener" href="https://coolshell.cn/articles/19464.html">https://coolshell.cn/articles/19464.html</a><br>对国内互联网的批判真的是相当尖锐啊 (ノ￣ ω ￣)ノ</p>
</blockquote>
<p>当你看到这篇文章的标题，你一定对这篇文章产生了巨大的兴趣，因为你的潜意识在告诉你，这是一本人生的 “武林秘籍”，而且还是左耳朵写的，一定有干货满满，只要读完，一定可以练就神功并找到超过大多数人的快车道和捷径…… 然而…… 当你看到我这样开篇时，你一定会觉得我马上就要有个转折，告诉你这是不可能的，一切都需要付出和努力…… 然而，你错了，这篇文章还真就是一篇 “秘籍”，只要你把这些 “秘籍” 用起来，你就一定可以超过大多数人。而且，这篇文章只有我这个 “人生导师” 可以写得好。毕竟，我的生命过到了十六进制 2B 的年纪，踏入这个社会已超过 20 年，舍我其谁呢？！</p>
<p>P.S. 这篇文章借鉴于《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/4758.html">如何写出无法维护的代码</a>》一文的风格…… 嘿嘿</p>
<h2 id="相关技巧和最佳实践"><a href="#相关技巧和最佳实践" class="headerlink" title="相关技巧和最佳实践"></a>相关技巧和最佳实践</h2><p>要超过别人其实还是比较简单的，尤其在今天的中国，更是简单。因为，你只看看中国的互联网，你就会发现，他们基本上全部都是在消费大众，让大众变得更为地愚蠢和傻瓜。<strong>所以，在今天的中国，你基本上不用做什么，只需要不使用中国互联网，你就很自然地超过大多数人了</strong>。当然，如果你还想跟他们彻底拉开，甩他们几个身位，把别人打到底层，下面的这些 “技巧” 你要多多了解一下。</p>
<p>在信息获取上，你要不断地向大众鼓吹下面的这些事：</p>
<ul>
<li>让大家都用百度搜索引擎查找信息，订阅微信公众号或是到知乎上学习知识…… 要做到这一步，你就需要把 “百度一下” 挂在嘴边，然后要经常在群或朋友圈中转发微信公众号的文章，并且转发知乎里的各种 “如何看待……” 这样的文章，让他们爱上八卦，爱上转发，爱上碎片。</li>
<li>让大家到微博或是知识星球上粉一些大咖，密切关注他们的言论和动向…… 是的，告诉大家，大咖的任何想法一言一行都可以在微博、朋友圈或是知识星球上获得，让大家相信，你的成长和大咖的见闻和闲扯非常有关系，你跟牛人在一个圈子里你也会变牛。</li>
<li>把今日头条和抖音这样的 APP 推荐给大家…… 你只需要让你有朋友成功地安装这两个 APP，他们就会花大量的时间在上面，而不能自拔，要让他们安装其实还是很容易的，你要不信你就装一个试玩一会看看（嘿嘿嘿）。</li>
<li>让大家热爱八卦，八卦并不一定是明星的八卦，还可以是你身边的人，比如，公司的同事，自己的同学，职场见闻，社会热点，争议话题，…… 这些东西总有一些东西会让人心态有很多微妙的变化，甚至花大量的时间去搜索和阅读大量的观点，以及花大量时间与人辩论争论，这个过程会让人上瘾，让人欲罢不能，然而这些事却和自己没有半毛钱关系。你要做的事就是转发其中一些 SB 或是很极端的观点，造成大家的一睦讨论后，就早早离场……</li>
<li>利用爱国主义，让大家觉得不用学英文，不要出国，不要翻墙，咱们已经是强国了…… 这点其实还是很容易做到的，因为学习是比较逆人性的，所以，只要你鼓吹那些英文无用论，出国活得更惨，国家和民族都变得很强大，就算自己过得很底层，也有大国人民的感觉。</li>
</ul>
<p>然后，在知识学习和技能训练上，让他们不得要领并产生幻觉</p>
<ul>
<li>让他们混淆认识和知识，以为开阔认知就是学习，让他们有学习和成长的幻觉……</li>
<li>培养他们要学会使用碎片时间学习。等他们习惯利用碎片时间吃快餐后，他们就会失去精读一本书的耐性……</li>
<li>不断地给他们各种各样 “有价值的学习资料”，让他们抓不住重点，成为一个微信公众号或电子书 “收藏家”……</li>
<li>让他们看一些枯燥无味的基础知识和硬核知识，这样让他们只会用 “死记硬背” 的方式来学习，甚至直接让他们失去信心，直接放弃……</li>
<li>玩具手枪是易用的，重武器是难以操控的，多给他们一些玩具，这样他们就会对玩具玩地得心应手，觉得玩玩具就是自己的专业……</li>
<li>让他们喜欢直接得到答案的工作和学习方式，成为一个伸手党，从此学习再也不思考……</li>
<li>告诉他们东西做出来就好了，不要追求做漂亮，做优雅，这样他们就会慢慢地变成劳动密集型……</li>
<li>让他们觉得自己已经很努力了，剩下的就是运气，并说服他们去‘及时行乐’，然后再也找不到高阶和高效率学习的感觉……</li>
<li>让他们觉得 “读完书”、“读过书” 就行了，不需要对书中的东西进行思考，进行总结，或是实践，只要囫囵吞枣尽快读完就等同于学好了……</li>
</ul>
<p>最后，在认知和格局上，彻底打垮他们，让他们变成韭菜。</p>
<ul>
<li>让他们不要看到大的形势，只看到眼前的一亩三分地，做好一个井底之蛙。其实这很简单，比如，你不要让他们看到整个计算机互联网技术改变人类社会的趋势，你要多让他看到，从事这一行业的人有多苦逼，然后再说一下其它行业或职业有多好……</li>
<li>宣扬一夜暴富以及快速挣钱的案例，最好让他们进入 “赌博类” 或是 “传销类” 的地方，比如：股市、数字货币…… 要让他们相信各种财富神话，相信他们就是那个幸运儿，他们也可以成为巴菲特，可以成为马云……</li>
<li>告诉他们，一些看上去很难的事都是有捷径的，比如：21 天就能学会机器学习，用区块链就能颠覆以及重构整个世界等等……</li>
<li>多跟他们讲一些小人物的励志的故事，这样让他们相信，不需要学习高级知识，不需要掌握高级技能，只需要用低等的知识和低级的技能，再加上持续不断拼命重复现有的工作，终有一天就会成功……</li>
<li>多让他们跟别人比较，人比人不会气死人，但是会让人变得浮躁，变得心急，变得焦虑，当一个人没有办法控制自己的情绪，没有办法让自己静下心来，人会失去耐性和坚持，开始好大喜欢功，开始装逼，开始歪门邪道剑走偏锋……</li>
<li>让他们到体制内的一些非常稳定的地方工作，这样他们拥有不思进取、怕承担责任、害怕犯错、喜欢偷懒、得过且过的素质……</li>
<li>让他们到体制外的那些喜欢拼命喜欢加班的地方工作，告诉他们爱拼才会赢，努力加班是一种福报，青春就是用来拼的，让他们喜欢上使蛮力的感觉……</li>
<li>告诉他们你的行业太累太辛苦，干不到 30 岁。让他们早点转行，不要耽误人生和青春……</li>
<li>当他们要做决定的时候，一定要让他们更多的关注自己会失去的东西，而不是会得到的东西。培养他们患得患失心态，让他们认识不到事物真正的价值，失去判断能力……（比如：让他们觉得跟对人拍领导的马屁忠于公司比自我的成长更有价值）</li>
<li>告诉他们，你现有的技能和知识不用更新，就能过好一辈子，新出来的东西没有生命力的…… 这样他们就会像我们再也不学习的父辈一样很快就会被时代所抛弃……</li>
<li>每个人都喜欢在一些自己做不到的事上找理由，这种能力不教就会，比如，事情太多没有时间，因为工作上没有用到，等等，你要做的就是帮他们为他们做不到的事找各种非常合理的理由，比如：没事的，一切都是最好的安排；你得不到的那个事没什么意思；你没有面好主要原因是那个面试官问的问题都是可以上网查得到的知识，而不没有问到你真正的能力上；这些东西学了不用很快会忘了，等有了环境再学也不迟……</li>
</ul>
<p><strong>最后友情提示一下，上述的这些 “最佳实践” 你要小心，是所谓，贩毒的人从来不吸毒，开赌场的人从来不赌博！所以，你要小心别自己也掉进去了！这就是 “欲练神功，必先自宫” 的道理。</strong></p>
<h2 id="相关原理和思维模型"><a href="#相关原理和思维模型" class="headerlink" title="相关原理和思维模型"></a>相关原理和思维模型</h2><p>对于上面的这些技巧还有很多很多，你自己也可以发明或是找到很多。所以，我来讲讲这其中的一些原理。</p>
<p>一般来说，超过别人一般来说就是两个维度：</p>
<ol>
<li><strong>在认知、知识和技能上</strong>。这是一个人赖以立足社会的能力（参看《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/4235.html">程序员的荒谬之言还是至理名言？</a>》和《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/2250.html">21 天教你学会 C++</a>》）</li>
<li><strong>在领导力上</strong>。所谓领导力就是你跑在别人前面，你得要有比别人更好的能力更高的标准（参看《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/17583.html">技术人员发展之路</a>》）</li>
</ol>
<p>首先，我们要明白，人的技能是从认识开始，然后通过学校、培训或是书本把 “零碎的认知” 转换成 “系统的知识”，而有要把知识转换成技能，就需要训练和实践，这样才能完成从：认识 -&gt; 知识 -&gt; 技能 的转换。这个转换过程是需要耗费很多时间和精力的，而且其中还需要有强大的学习能力和动手能力，这条路径上有很多的 “关卡”，每道关卡都会过滤掉一大部分人。比如：对于一些比较枯燥的硬核知识来说，90% 的人基本上就倒下来，不是因为他们没有智商，而是他们没有耐心。</p>
<h3 id="认知"><a href="#认知" class="headerlink" title="认知"></a>认知</h3><p>要在认知上超过别人，就要在下面几个方面上做足功夫：</p>
<ol>
<li><p><strong>信息渠道</strong>。试想如果别人的信息源没有你的好，那么，这些看不见信息源的人，只能接触得到二手信息甚至三手信息，只能获得被别人解读过的信息，这些信息被三传两递后必定会有错误和失真，甚至会被传递信息的中间人 hack 其中的信息（也就是 “中间人攻击”），而这些找不出信息源的人，只能 “被人喂养”，于是，他们最终会被困在信息的底层，永世不得翻身。（比如：学习 C 语言，放着原作者 K&amp;R 的不用，硬要用错误百出谭浩强的书，能有什么好呢？）</p>
</li>
<li><p><strong>信息质量</strong>。信息质量主要表现在两个方面，一个是信息中的燥音，另一个是信息中的质量等级，我们都知道，在大数据处理中有一句名言，叫 garbage in garbage out，你天天看的都是垃圾，你的思想和认识也只有垃圾。所以，如果你的信息质量并不好的话，你的认知也不会好，而且你还要花大量的时间来进行有价值信息的挖掘和处理。</p>
</li>
<li><p><strong>信息密度</strong>。优质的信息，密度一般都很大，因为这种信息会逼着你去干这么几件事，a）搜索并学习其关联的知识，b）沉思和反省，c）亲手去推理、验证和实践…… 一般来说，经验性的文章会比知识性的文章会更有这样的功效。比如，类似于像 Effiective C++&#x2F;Java，设计模式，Unix 编程艺术，算法导论等等这样的书就是属于这种密度很大的书，而像 <a target="_blank" rel="noopener" href="https://medium.com/netflix-techblog">Netflix 的官方 blog</a> 和 <a target="_blank" rel="noopener" href="https://www.allthingsdistributed.com/">AWS CTO 的 blog</a> 等等地方也会经常有一些这样的文章。</p>
</li>
</ol>
<h3 id="知识"><a href="#知识" class="headerlink" title="知识"></a>知识</h3><p>要在知识上超过别人，你就需要在下面几个方面上做足功夫：</p>
<ol>
<li><p><strong>知识树（图）</strong>。任何知识，只在点上学习不够的，需要在面上学习，这叫系统地学习，这需要我们去总结并归纳知识树或知识图，一个知识面会有多个知识板块组成，一个板块又有各种知识点，一个知识点会导出另外的知识点，各种知识点又会交叉和依赖起来，学习就是要系统地学习整个知识树（图）。而我们都知道，<strong>对于一棵树来说，“根基” 是非常重要的，所以，学好基础知识也是非常重要的，对于一个陌生的地方，有一份地图是非常重要的，没有地图的你只会乱窜，只会迷路、练路、走冤枉路！</strong></p>
</li>
<li><p><strong>知识缘由</strong>。任何知识都是有缘由的，了解一个知识的来龙去脉和前世今生，会让你对这个知识有非常强的掌握，而不再只是靠记忆去学习。靠记忆去学习是一件非常糟糕的事。而对于一些操作性的知识（不需要了解由来的），我把其叫操作知识，就像一些函数库一样，这样的知识只要学会查文档就好了。<strong>能够知其然，知其所以然的人自然会比识知识到表皮的人段位要高很多。</strong></p>
</li>
<li><p><strong>方法套路</strong>。学习不是为了找到答案，而是找到方法。就像数学一样，你学的是方法，是解题思路，是套路，会用方程式解题的和不会用方程式解题的在解题效率上不可比较，而在微积分面前，其它的解题方法都变成了渣渣。<strong>你可以看到，掌握高级方法的人比别人的优势有多大，学习的目的就是为了掌握更为高级的方法和解题思路</strong>。</p>
</li>
</ol>
<h3 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h3><p>要在技能上超过别人，你就需要在下面几个方面做足功夫：</p>
<ol>
<li><p><strong>精益求精</strong>。如果你想拥有专业的技能，你要做不仅仅是拼命地重复一遍又一遍的训练，而是在每一次重复训练时你都要找到更好的方法，总结经验，让新的一遍能够更好，更漂亮，更有效率，否则，用相同的方法重复，那你只不过在搬砖罢了。</p>
</li>
<li><p><strong>让自己犯错</strong>。犯错是有利于成长的，这是因为出错会让人反思，反思更好的方法，反思更完美的方案，总结教训，寻求更好更完美的过程，是技能升级的最好的方式。尤其是当你在出错后，被人鄙视，被人嘲笑后，你会有更大的动力提升自己，这样的动力才是进步的源动力。当然，千万不要同一个错误重复地犯！</p>
</li>
<li><p><strong>找高手切磋</strong>。下过棋，打个球的人都知道，你要想提升自己的技艺，你必需找高手切磋，在和高手切磋的过程中你会感受到高手的技能和方法，有时候你会情不自禁地哇地一下，我靠，还可以这么玩！</p>
</li>
</ol>
<h3 id="领导力"><a href="#领导力" class="headerlink" title="领导力"></a>领导力</h3><p>最后一个是领导力，要有领导力或是影响力这个事并不容易，这跟你的野心有多大，好胜心有多强 ，你愿意付出多少很有关系，因为一个人的领导力跟他的标准很有关系，因为有领导力的人的标准比绝大多数人都要高。</p>
<ol>
<li><p><strong>识别自己的特长和天赋</strong>。首先，每个人 DNA 都可能或多或少都会有一些比大多数人 NB 的东西（当然，也可能没有），如果你有了，那么在你过去的人生中就一定会表现出来了，就是那种大家遇到这个事会来请教你的寻求你帮助的现象。那种，别人要非常努力，而且毫不费劲的事。一旦你有了这样的特长或天赋，那你就要大力地扩大你的领先优势，千万不要进到那些会限制你优势的地方。你是一条鱼，你就一定要把别人拉到水里来玩，绝对不要去陆地上跟别人拼，不断地在自己的特长和天赋上扩大自己的领先优势，彻底一骑绝尘。</p>
</li>
<li><p><strong>识别自己的兴趣和事业</strong>。没有天赋也没有问题，还有兴趣点，都说兴趣是最好的老师，当年，Linus 就是在学校里对 minx 着迷了，于是整出个 Linux 来，这就是兴趣驱动出的东西，一般来说，兴趣驱动的事总是会比那些被动驱动的更好。但是，这里我想说明一下什么叫 “真 ∙ 兴趣”，真正的兴趣不是那种三天热度的东西，而是那种，你愿意为之付出一辈子的事，是那种无论有多大困难有多难受你都要死磕的事，这才是 “真 ∙ 兴趣”，这也就是你的 “野心” 和 “好胜心” 所在，其实上升到了你的事业。相信我，绝大多数人只有职业而没有事业的。</p>
</li>
<li><p><strong>建立高级的习惯和方法</strong>。没有天赋没有野心，也还是可以跟别人拼习惯拼方法的，只要你有一些比较好的习惯和方法，那么你一样可以超过大多数人。对此，在习惯上你要做到比较大多数人更自律，更有计划性，更有目标性，比如，每年学习一门新的语言或技术，并可以参与相关的顶级开源项目，每个月训练一个类算法，掌握一种算法，每周阅读一篇英文论文，并把阅读笔记整理出来…… 自律的是非常可怕的。除此之外，你还需要在方法上超过别人，你需要满世界的找各种高级的方法，其中包括，思考的方法，学习的方法、时间管理的方法、沟通的方法这类软实力的，还有，解决问题的方法（trouble shooting 和 problem solving），设计的方法，工程的方法，代码的方法等等硬实力的，一开始照猫画虎，时间长了就可能会自己发明或推导新的方法。</p>
</li>
<li><p>**勤奋努力执着坚持 **。如果上面三件事你都没有也没有能力，那还有最后一件事了，那就是勤奋努力了，就是所谓的 “一万小时定律” 了（参看《<a target="_blank" rel="noopener" href="https://coolshell.cn/articles/2250.html">21 天教你学会 C++</a>》中的十年学编程一节），我见过很多不聪明的人，悟性也不够（比如我就是一个），别人学一个东西，一个月就好了，而我需要 1 年甚至更长，但是很多东西都是死的，只要肯花时间就有一天你会搞懂的，耐不住我坚持十年二十年，聪明的人发明个飞机飞过去了，笨一点的人愚公移山也过得去，因为更多的人是懒人，我不用拼过聪明人，我只用拼过那些懒人就好了。</p>
</li>
</ol>
<p>好了，就这么多，如果哪天你变得消极和不自信，你要来读读我的这篇文章，子曰：温故而知新。</p>
<p>（全文完）</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/08/24/others/rxliuliBlog/dev/%E7%BA%B8%E8%B4%A8%E4%B9%A6%E7%B1%8D%E8%BF%98%E6%98%AF%E7%BD%91%E7%BB%9C%E6%95%99%E7%A8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%AD%A6%E4%B9%A0%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/24/others/rxliuliBlog/dev/%E7%BA%B8%E8%B4%A8%E4%B9%A6%E7%B1%8D%E8%BF%98%E6%98%AF%E7%BD%91%E7%BB%9C%E6%95%99%E7%A8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%AD%A6%E4%B9%A0%EF%BC%9F/" class="post-title-link" itemprop="url">纸质书籍还是网络教程，我们要如何选择学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-24 22:10:20" itemprop="dateCreated datePublished" datetime="2019-08-24T22:10:20+08:00">2019-08-24</time>
    </span>


  
    <span id="/2019/08/24/others/rxliuliBlog/dev/%E7%BA%B8%E8%B4%A8%E4%B9%A6%E7%B1%8D%E8%BF%98%E6%98%AF%E7%BD%91%E7%BB%9C%E6%95%99%E7%A8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%AD%A6%E4%B9%A0%EF%BC%9F/" class="post-meta-item leancloud_visitors" data-flag-title="纸质书籍还是网络教程，我们要如何选择学习" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="纸质书籍还是网络教程，我们要如何选择学习" href="/2019/08/24/others/rxliuliBlog/dev/%E7%BA%B8%E8%B4%A8%E4%B9%A6%E7%B1%8D%E8%BF%98%E6%98%AF%E7%BD%91%E7%BB%9C%E6%95%99%E7%A8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E5%AD%A6%E4%B9%A0%EF%BC%9F/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::4b60aaf0751b717212c405614fb5eb2c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>334</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="纸质书籍还是网络教程，我们要如何选择学习"><a href="#纸质书籍还是网络教程，我们要如何选择学习" class="headerlink" title="纸质书籍还是网络教程，我们要如何选择学习"></a>纸质书籍还是网络教程，我们要如何选择学习</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>其实你完全可以这样想，在这一个问题上，我们两个选了两条相反的路，虽然不知道对错，总有一条更接近真理，这是值得开心一件事。</p>
</blockquote>
<p>书籍是落后技术的代名词，因为书籍的编写&#x2F;出版往往以年进行计算，所以在出版之后就已经不是最新的内容了。而网络教程可以随时更新，不受纸质书籍版本的限制。然而，网络教程也有其固有缺点：不成体系，任意发挥。</p>
<h2 id="纸质书籍"><a href="#纸质书籍" class="headerlink" title="纸质书籍"></a>纸质书籍</h2><blockquote>
<p>注：以下声明都指的是比较优秀的书籍，而非一些由国人写的滥竽充数、凑点字数就出版的垃圾。。。</p>
</blockquote>
<ul>
<li>系统化的知识体系</li>
<li>比起电子书更好的阅读体验</li>
<li>书籍出版比较严苛，所以内容整体质量会更好（例如错别字问题）</li>
</ul>
<h2 id="网络教程"><a href="#网络教程" class="headerlink" title="网络教程"></a>网络教程</h2><ul>
<li>可以随时更新，可以永远都是最新的知识</li>
<li>可以附上 <code>code</code> 及 <a target="_blank" rel="noopener" href="https://codepen.io/">即时预览</a></li>
<li>方便对内容进行收藏、标注和整理</li>
</ul>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/08/22/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E6%B5%AA%E6%BD%AE%E4%B9%8B%E5%B7%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/22/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E6%B5%AA%E6%BD%AE%E4%B9%8B%E5%B7%85/" class="post-title-link" itemprop="url">读书 [浪潮之巅]</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-23 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-23T00:00:00+08:00">2019-08-23</time>
    </span>


  
    <span id="/2019/08/22/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E6%B5%AA%E6%BD%AE%E4%B9%8B%E5%B7%85/" class="post-meta-item leancloud_visitors" data-flag-title="读书 [浪潮之巅]" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="读书 [浪潮之巅]" href="/2019/08/22/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E6%B5%AA%E6%BD%AE%E4%B9%8B%E5%B7%85/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::cfd9c6864ab2edc9f830bc905c9951f9" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="读书-浪潮之巅"><a href="#读书-浪潮之巅" class="headerlink" title="读书 [浪潮之巅]"></a>读书 [浪潮之巅]</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>前些时日，吾辈读完了 [浪潮之巅] 这本书。</p>
<p><img src="https://img.rxliuli.com/20190823011623.png" alt="封面"></p>
<p>它是 Google 开发者吴军所写的 IT 行业各个重要公司的兴衰历史，并进一步探讨了其中的原因。那些曾经无比耀眼的新星，压在每个公司头上的庞然大物，是如何一步步变成这样的。</p>
<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>最初是在一位朋友的推荐下了解到这本书的，当然，那位推荐了不少有趣的书籍: 黑客与画家、浪潮之巅、人月神话等。</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><ol>
<li><p>书中最有趣的一个观点是: 公司是由基因决定的，转基因大多都失败了。</p>
<p><img src="https://img.rxliuli.com/20190823013804.png" alt="基因"></p>
<blockquote>
<p>两年前，我和李开复博士等人多次谈论科技公司的兴衰，我们一致认为一个公司的基因常常决定它今后的命运，比如 IBM 很难成为一个微机公司一样。摩托罗拉也是一样，它的基因决定了它在数字移动通信中很难维持它原来在模拟手机上的市场占有率。摩托罗拉并不是没有看出数字手机将来必将代替模拟手机，而是很不情愿看到这件事发生。作为第一代移动通信的最大收益者，摩托罗拉要尽可能地延长模拟手机的生命期，推迟数字手机的普及，因为它总不希望自己掘自己的墓。如果过早地放弃模拟手机，就等于放弃已经开采出来的金矿，而自降身价和诺基亚的公司一同从零开始。尤其在刚开始时，数字手机的语音质量还远不如摩托罗拉砖头大小的大哥大，更使摩托罗拉高估了模拟手机的生命期。和所有大公司一样，在摩托罗拉也是最挣钱的部门嗓门最大，开发数字手机的部门当然不容易盖过正在挣钱的模拟手机部门，因此，摩托罗拉虽然在数字手机研发上并不落后，但是，进展缓慢。一旦各个竞争对手推出各种各样小巧的数字手机时，摩托罗拉才发现自己慢了半拍。</p>
</blockquote>
<p>当然，和所有的观点一样，也有人不同意基因决定论: <a target="_blank" rel="noopener" href="https://www.chainnews.com/articles/460655320271.htm">吴军的公司基因论极其肤浅可笑</a></p>
</li>
<li><p>曾经，只知道比尔盖茨是世界首富，很强很厉害。具体如何很厉害，吾辈也说不上原因。曾经微软在开源领域骂名昭著，现如今却又大力拥抱开源，不仅开发了开源的 VSCode，甚至在去年收购了开源领域的圣地 – <a target="_blank" rel="noopener" href="http://github.com/">GitHub</a>。甚至于，微软可以说是一直都四面皆敌，然而比尔盖茨还是领导着它一路走了过来，并且，除了近年来的 Google，没有公司真正挑战过微软 – 包括很多人喜欢苹果。</p>
<p><img src="https://img.rxliuli.com/20190823022335.png" alt="微软标志"></p>
<blockquote>
<p>乔布斯和盖茨都意识到了微机及其相关工业将是一个大产业，事实证明这确实是一个万亿美元的大产业。我们在前面已经分析过，计算机工业比任何行业都容易出现垄断公司。乔布斯和盖茨都想做垄断者，但是他们的方式不同。前者是想做原来 IBM 那样的垄断者，从硬件到软件全部垄断，这后来证明是行不通的。而盖茨天才之处在于，它在微机工业刚刚开始的时候，就意识到只要垄断了操作系统，就间接垄断了整个行业，因为操作系统和别的软件不同，是在买计算机时预装好了的，一般用户没有选择权。而其它的软件用户则有选择权。<br>如果说乔布斯是锋芒毕露，聪明写在脸上；盖茨就是一个平衡木冠军，聪明藏在肚子里。无疑，后者比前者更可怕。</p>
</blockquote>
</li>
<li><p>近来的几十年，对于 IT 行业来说真的是波澜壮阔的时代，<strong>无线通信 &#x3D;&gt; 大型机 &#x3D;&gt; 微机 &#x3D;&gt; 互联网 &#x3D;&gt; 智能手机</strong>，每一次的变化都导致了世界上许多人的命运被改变。</p>
<ul>
<li>无线通信: ATT 的贝尔实验室访华成员甚至受到了国家主席的接见</li>
<li>大型机: IBM 成功变成了 <strong>蓝大象</strong>，并统治了企业级市场</li>
<li>微机: 微软和苹果成功统治了操作系统，英特尔则统治了微机的心脏 – CPU</li>
<li>互联网: 雅虎，Google 成功崛起，实际上挑战了微软系统作为用户入口的统治地位</li>
<li>智能手机: Google Android 再获成功，再次对微机入口的统治地位造成威胁</li>
</ul>
<blockquote>
<p>如果说基因决定性多少有些宿命论，那么人为的因素也加速了摩托罗拉的衰落。我们在介绍英特尔一章中介绍过，在科技工业发展最快的八九十年代，摩托罗拉的第三代家族领导人卡尔文三世没有能力在这个大时代中纵横捭阖，开拓疆土。摩托罗拉本来在手机、计算机处理器和数字处理器（DSP）三个领域均处于领先地位，前景不可限量。但是卡尔文实在没有能力将三个庞大的部门十几万人管理好，虽然他没有犯什么大的错误，但是他平平庸庸。也许，在五十年前，一个只需要守成的年代他可以坐稳他的位置，但是在上个世纪末那个一个英雄辈出、拒绝平庸的年代，盖茨、乔布斯、郭士纳、格罗夫、钱伯斯和通用电气的杰克·韦尔奇等人都在同场角逐，任何公司都在逆水行舟，不进则退。除了卡尔文，摩托罗拉的整个管理层也有责任，他们低估了摩尔定理的作用。虽然数字手机在一开始还比不上模拟手机，但这并不能说它要很长时间才能威胁模拟手机的地位。事实上，由于半导体技术按指数的速度发展，手机数字化比摩托罗拉高管们想象的时间表来得早得多，使得摩托罗拉几十年来积累的模拟技术变得无关紧要，市场的优势顿失。</p>
</blockquote>
</li>
<li><p>IT 行业的发展速度非常之快，传统行业需要几十上百年才能垄断一个产业，在这个领域创造一个产业从形成到垄断只需要短短几年就可以完成。最终形成前面一两家公司占大头吃肉，后面的小公司跟在后面喝汤，例如桌面操作系统中的 Windows(80+%)，MacOS(10+%) 和 Linux (1+%)。</p>
<p><img src="https://img.rxliuli.com/20190823023553.png" alt="操作系统比率图"></p>
<blockquote>
<p>虽然微软在操作系统市场的优势和高通在 3G 市场的垄断是极端的例子，但是，即使在一般情况下，在一个成熟的市场上占有主导地位的公司仍然能独占 60-70% 的市场。在处理器市场上，英特尔一年有近 400 亿的销售额，而第二名 AMD 仅有 60 亿。在网络设备市场上，思科销售额高达 400 亿，是它的对手华为（ 100 亿）和 Juniper （ 40 亿）总和的三倍。<br>附: 以下是吾辈的个人观点<br>虽说很多人鼓吹 Linux，甚至说世界上最快的电脑大多运行 Linux 或类 Unix，但实际上在桌面微机领域 Linux 的份额少得可怜，即便是近年来 Ubuntu，Fedora 这些开箱即用发行版的流行，也并不能改变整个领域已被微软垄断的事实。<br>一个支撑的证据就是: Linux 下大多数工具没有选择，而 Windows 下同一个功能的程序会有很多类似的，如果不好用，用户可以换另外一种。</p>
</blockquote>
</li>
<li><p>国内的很多公司似乎被很多 IT 技术人员看不起，但这其实也是一种偏见。平心而论，在开源方面，国内公司确实相当糟糕。矮个子里拔高个，要数阿里的开源项目是最好的了。即便如此，仍然会发生很恶心的事情，例如去年圣诞节沸沸扬扬的圣诞彩蛋事件。然而，在商业和技术方面，阿里都是相当领先的。</p>
<p><img src="https://img.rxliuli.com/20190823024140.png" alt="圣诞彩蛋事件"></p>
<blockquote>
<p>中国的电子商务比实体商务更难做一－没有信用体系，真正意义上的信用卡不普及，没有在线支付手段，没有物流保障。大部分试水电子商务的公司，包括著名的 eBay 公司，都无法逾越这些障碍，很多公司不得不知难而退，很多商家和投资人甚至认定中国的电子商务发展必须再等很长的时间。而阿里巴巴的过人之处就是在于它以积极的态度，解决了大多数人认为无解的难题。没有信用系统，阿里巴巴就自己建立了一个；没有支付手段， 它就利用此契机开发了支付宝，这不仅解决了在阿里巴巴上交易的支付问题，而且扩展到解决中国整个在线甚至离线支付的问题；中小商家管理混乱，阿里巴巴就在它的 B2B 部门开发了面向企业的应用软件；至于物流，它起初并没有进入这个高投资、低回报的部门，而是利用它巨大的交易量，通过与第三方的合作，在保障商家和用户的基础上，规范了整个物流行业的经营 σ 可以毫不夸张地讲，在全世界没有哪家公司，包括 eBay 和亚马逊，像阿里巴巴那样做到了控制住整个电子商务产业链中的所有关键性环节。因此，我可以毫不夸张地预言， 阿里巴巴会在很短的时间里，超过 eBay 和亚马逊的总和，成为全球仅次于 Google 的第二大互联网公司。我甚至还可以进一步预言，如果中国政府对它不加限制，它可以成为中国市值最大的公司。</p>
</blockquote>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后一句名言作为结尾: <strong>这是最好的时代，也是最坏的时代</strong>，而我们，正处于这个时代之中。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/08/21/others/rxliuliBlog/dev/%E5%90%BE%E8%BE%88%E7%9A%84%E4%B8%AA%E4%BA%BA%E4%B9%A6%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/21/others/rxliuliBlog/dev/%E5%90%BE%E8%BE%88%E7%9A%84%E4%B8%AA%E4%BA%BA%E4%B9%A6%E5%8D%95/" class="post-title-link" itemprop="url">吾辈的个人书单</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-21 10:28:24" itemprop="dateCreated datePublished" datetime="2019-08-21T10:28:24+08:00">2019-08-21</time>
    </span>


  
    <span id="/2019/08/21/others/rxliuliBlog/dev/%E5%90%BE%E8%BE%88%E7%9A%84%E4%B8%AA%E4%BA%BA%E4%B9%A6%E5%8D%95/" class="post-meta-item leancloud_visitors" data-flag-title="吾辈的个人书单" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="吾辈的个人书单" href="/2019/08/21/others/rxliuliBlog/dev/%E5%90%BE%E8%BE%88%E7%9A%84%E4%B8%AA%E4%BA%BA%E4%B9%A6%E5%8D%95/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::0ba792b67a29aef3960de230a7ce5118" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>80</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="吾辈的个人书单"><a href="#吾辈的个人书单" class="headerlink" title="吾辈的个人书单"></a>吾辈的个人书单</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h2 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h2><h3 id="软开"><a href="#软开" class="headerlink" title="软开"></a>软开</h3><ul>
<li>黑客与画家</li>
<li>浪潮之巅</li>
<li>精通 CSS 高级 Web 标准解决方案</li>
<li>人类简史系列<ul>
<li>人类简史</li>
<li>未来简史</li>
<li>今日简史</li>
</ul>
</li>
<li>1984</li>
</ul>
<h3 id="文学"><a href="#文学" class="headerlink" title="文学"></a>文学</h3><ul>
<li>天才在左 疯子在右</li>
<li>拉普拉斯的魔女</li>
<li>阿尼玛</li>
</ul>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/08/21/others/rxliuliBlog/Tool/VSCode/VSCode-%E4%B8%8E-WebStorm-%E6%A8%AA%E5%90%91%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/21/others/rxliuliBlog/Tool/VSCode/VSCode-%E4%B8%8E-WebStorm-%E6%A8%AA%E5%90%91%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">VSCode 与 WebStorm 横向对比</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-21 10:25:58" itemprop="dateCreated datePublished" datetime="2019-08-21T10:25:58+08:00">2019-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-07-17 00:00:00" itemprop="dateModified" datetime="2020-07-17T00:00:00+08:00">2020-07-17</time>
    </span>


  
    <span id="/2019/08/21/others/rxliuliBlog/Tool/VSCode/VSCode-%E4%B8%8E-WebStorm-%E6%A8%AA%E5%90%91%E5%AF%B9%E6%AF%94/" class="post-meta-item leancloud_visitors" data-flag-title="VSCode 与 WebStorm 横向对比" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="VSCode 与 WebStorm 横向对比" href="/2019/08/21/others/rxliuliBlog/Tool/VSCode/VSCode-%E4%B8%8E-WebStorm-%E6%A8%AA%E5%90%91%E5%AF%B9%E6%AF%94/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::d89517b71922e79ad17f34e339e05768" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="VSCode-与-WebStorm-横向对比"><a href="#VSCode-与-WebStorm-横向对比" class="headerlink" title="VSCode 与 WebStorm 横向对比"></a>VSCode 与 WebStorm 横向对比</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>不能认清自己，怎能看清别人？</p>
</blockquote>
<p>最近很长一段时间，VSCode 似乎成为了前端口中的标准开发编辑器，前端圈到处都在推荐 VSCode，劝说其他人放弃 Sublime, WebStorm, Atom 之流，仿佛真的是<strong>信巨硬，得永生</strong>一般。而吾辈作为一个长时间使用 JetBrains 系 IDE 的全沾开发者，这里就来对比一下 WebStorm 与后起之秀 VSCode 之前的异同点吧</p>
<h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><h3 id="插件生态"><a href="#插件生态" class="headerlink" title="插件生态"></a>插件生态</h3><p>VSCode 的生态无疑非常好，基于 Web 技术构建的编辑器同样可以使用 Web 技术开发插件，而 Web 开发人员的数量也确实非常庞大。且由于其轻量跨平台的特性，受到很多开发者的喜爱，将之作为主力文件编辑器或者将其打造成 IDE 使用。它们的插件市场首页分别如下</p>
<p>VSCode<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830232931.png" alt="VSCode 插件市场"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830232701.png" alt="WebStorm 插件市场"></p>
<p>WebStorm 官方给出的插件总数是 1607，而 VSCode 吾辈并未找到插件的总数量，但显而易见，VSCode 的插件数量应该远远高于这个数字。而且你可以看到 WebStorm 下载量第一的插件仅仅只下载过 <strong>5,558,762</strong> 次，而 VSCode 的热门插件的下载数量是以 M 来计算的。我们来搜索一下前端流行打包工具 <code>webpack</code>，对比一下结果。</p>
<p>VSCode<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830233610.png" alt="webpack for vscode"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830233724.png" alt="webpack for WebStorm"></p>
<p>是的，VSCode 搜索到了 16 个插件，而 WebStorm 的搜索结果是。。。<strong>0</strong>？不了解 WebStorm 的小伙伴可能会有疑问，难道 WebStorm 不支持 webpack 嘛？那要它何用，还是拉出去砍了吧！<br>泥萌先别急着掀桌子，个中缘由且听吾辈细细说来。之所以出现这种情况，主要是因为二者的策略不同造成的。WebStorm 的目标是让用户拥有开箱即用的生产力工具，下载安装完成后就可以立即进行项目开发了，所以它将很多功能内置了 IDE 之中，或者是由官方开发插件出来，然后直接集成到 IDE 中，给个人开发者开发插件的机会不多。<br>而 VSCode 由于官方的开发团队没那么强大，而且又是免费的开源产品，所以理所当然只能发动广大人民群众的力量了，所以有很多插件就只能交给第三方开发者进行开发和维护。而这点也造成了安装完 VSCode 之后并不能立即使用，还需要下载插件、进行配置等一系列操作。<br>以上两种模式的孰优孰劣早有人分析过，这里吾辈只说自己的使用体验。WebStorm 的开箱即用做的确实比 VSCode 更好，但问题在于如果官方不支持的话就会很难受，因为其实并没有太多人同时精通前端和 Java（是的，必须使用 Java 开发插件）。这也是吾辈目前仍然使用 VSCode 作为主力文本编辑器编辑配置文件，以及使用它写 Markdown 文章的原因，包括这篇文章亦是通过 VSCode 写出来的。<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830235425.png" alt="Markdown 写作截图"></p>
<blockquote>
<p>附: 插件开放让第三方实现与官方自己实现并集成的优劣之分参考知乎的一篇文章: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/35303567">Visual Studio Code 有哪些工程方面的亮点</a>。<br>通过插件来扩展功能的做法已经是司空见惯了，但如何保证插件和原生功能一样优秀呢？历史告诉我们：不能保证。大家可以参考 Eclipse，插件模型可以说是做得非常彻底了，功能层面也是无所不能，但存在几个烦人的问题：不稳定、难用、慢，所以不少用户转投 IntelliJ 的怀抱。可谓成也插件，败也插件。问题的本质在于信息不对称，它导致不同团队写出来的代码，无论是思路还是质量，都不一致。最终，用户得到了一个又乱又卡的产品。所以要让插件在稳定性、速度和体验的层面都做到和原生功能统一，只能是一个美好的愿望。<br>来看看其他 IDE 是怎么做的，Visual Studio 自己搞定所有功能，并且做到优秀，让别人无事可做，这也成就了其 “宇宙第一 IDE” 的美名；IntelliJ 与之相仿，开箱即用，插件可有可无。这么看起来，自己搞定所有的事情是个好办法，但大家是否知道，Visual Studio 背后有上千人的工程团队，显然，这不是 VS Code 这二十几号人能搞定的。他们选择了让大家来做插件，那怎么解决 Eclipse 所遇到的问题呢？<br>这里分享一个小知识 ——Eclipse 核心部分的开发者就是早期的 VS Code 团队。嗯，所以他们没有两次踏入同一条河流。与 Eclipse 不同，VS Code 选择了把插件关进盒子里。<br>这样做首先解决的问题就是稳定性，这个问题对于 VS Code 来说尤为重要。都知道 VS Code 基于 Electron，实质上是个 node.js 环境，单线程，任何代码崩了都是灾难性后果。所以 VS Code 干脆不信任任何人，把插件们放到单独的进程里，任你折腾，主程序妥妥的。<br>VS Code 团队的这一决策不是没有原因的，正如前面提到的，团队里很多人其实是 Eclipse 的旧部，自然对 Eclipse 的插件模型有深入的思考。Eclipse 的设计目标之一就是把组件化推向极致，所以很多核心功能都是用插件的形式来实现的。遗憾的是，Eclipse 的插件运行在主进程中，任何插件性能不佳或者不稳定，都直接影响到 Eclipse，最终结果是大家抱怨 Eclipse 臃肿、慢、不稳定。VS Code 基于进程做到了物理级别的隔离，成功解决了该问题。实际上进程级别的隔离也带出了另一个话题，那就是界面与业务逻辑的隔离。</p>
</blockquote>
<h3 id="智能提示"><a href="#智能提示" class="headerlink" title="智能提示"></a>智能提示</h3><p>作为写代码的工具，代码提示已经司空见惯了。但是，就算同样是代码提示，有的代码提示只是简单的代码片段（<code>snippets</code>），而有的却是基于代码语法树分析进行的，甚至于编辑器会学习使用者的习惯，将最常用的提示放在最前面。WebStorm 从始至终一直都是第三种，而 VSCode 最近官方才开发了基于 AI 自动学习的智能提示插件 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=VisualStudioExptTeam.vscodeintellicode">Visual Studio IntelliCode</a>。</p>
<p>VSCode<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831030339.gif" alt="VSCode 智能提示"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831030506.gif" alt="WebStorm 智能提示"></p>
<h3 id="自动修复"><a href="#自动修复" class="headerlink" title="自动修复"></a>自动修复</h3><p>我们在日常开发中经常会遇到一些低级问题，而编辑器其实是有可能帮我们自动修复的。这里便对吾辈了解的一些问题进行对比，问题详细信息请参考文章 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/6e442bc3/">JavaScript 规范整理</a></p>
<blockquote>
<p>注: VSCode 没有原生的自动修复功能，必须使用插件才行。</p>
</blockquote>
<table>
<thead>
<tr>
<th>分类</th>
<th>对比项</th>
<th>VSCode</th>
<th>WebStorm</th>
</tr>
</thead>
<tbody><tr>
<td>命名规范</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>不要使用拼音命名</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>函数中的变量</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>内部变量</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>不要使用无意义的前缀命名</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>ES6</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>优先使用 const&#x2F;let</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>使用新的函数声明方式</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>优先使用箭头函数而非 function</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>不要使用 if 判断再赋予默认值</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>优先使用 Map 做键值对映射而非传统的对象</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>优先使用模板字符串拼接多个字符串变量</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>当独立参数超过 3 个时使用对象参数并解构</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>不要写多余的 await</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>不要使用 &#x3D;&#x3D; 进行比较</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>使用计算属性名替代使用方括号表示法赋值</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td>逻辑代码</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>不要判断一个 Boolean 值并以此返回 Boolean 值</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>不要使用多余的变量</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>不要使用嵌套 if</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>不要先声明空对象然后一个个追加属性</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>不要使用无意义的函数包裹</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>不要使用三元运算符进行复杂的计算</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>如果变量有所关联则使用对象而非多个单独的变量</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>应该尽量解决编辑器警告</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>使用类型定义参数对象</td>
<td>不支持</td>
<td>不支持</td>
</tr>
<tr>
<td></td>
<td>尽量扁平化代码</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>自执行函数前面必须加分号</td>
<td>不支持</td>
<td>不支持</td>
</tr>
</tbody></table>
<p>下面是一张 WebStorm 官方使用自动修复的动图<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831030641.gif" alt="WebStorm 自动修复"></p>
<h3 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h3><p>说起重构的话，VSCode 可以简单的说是做的太<strong>少</strong>，而 WebStorm 则是相反做的太<strong>多</strong>，下面继续以表格的形式进行对比。</p>
<blockquote>
<p>WebStorm 较新版本已经修复了 2018.02 重命名会自动索引字符串的问题（变成可选项了）。</p>
</blockquote>
<table>
<thead>
<tr>
<th>分类</th>
<th>操作</th>
<th>VSCode</th>
<th>WebStorm</th>
</tr>
</thead>
<tbody><tr>
<td>重命名</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>变量重名名</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>复杂变量重命名</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>全局重命名</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>正则重命名</td>
<td>存在 bug</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>文件重命名</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>提取</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>提取表达式为变量</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>提取代码段为函数</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>提取函数到新文件</td>
<td>支持</td>
<td>支持</td>
</tr>
</tbody></table>
<p>WebStorm 重命名文件<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831031020.gif" alt="WebStorm 重命名文件"></p>
<h3 id="Git-x2F-GitHub-集成"><a href="#Git-x2F-GitHub-集成" class="headerlink" title="Git&#x2F;GitHub 集成"></a>Git&#x2F;GitHub 集成</h3><p>VSCode 的 Git 支持一直不太行，就算加了插件 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens">GitLens</a> 也无法比得上 WebStorm。</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>操作</th>
<th>VSCode</th>
<th>WebStorm</th>
</tr>
</thead>
<tbody><tr>
<td>Git</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>commit 提交</td>
<td>难用</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>push 推送</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>pull 拉取</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>merge 合并</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>历史记录</td>
<td>难用</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>reset 回退</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>revert 回退</td>
<td>难用</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>stash 暂存</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>branch 分支操作</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>GitHub</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>分享到 GitHub</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>从 GitHub 选择拉取</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td></td>
<td>分享到 Gist</td>
<td>支持</td>
<td>支持</td>
</tr>
</tbody></table>
<p>放两张图对比一下</p>
<p>VSCode GitLens<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831022549.png" alt="GitLens"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831022643.png" alt="WebStorm Git"></p>
<h3 id="前端支持"><a href="#前端支持" class="headerlink" title="前端支持"></a>前端支持</h3><p>前面提过，VSCode 生态很好，基本上很多语言&#x2F;框架都有支持，而且官方也有一些非常优秀的插件。但是，有一些地方很重要，VSCode 对于 HTML&#x2F;CSS&#x2F;JavaScript 这些 Web 基本元素的支持相比于 WebStorm 确实可以说的上是糟糕。</p>
<p>先来测试前端三剑客: <code>HTML/CSS/JavaScript</code>。</p>
<p>VSCode<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831004550.gif" alt="VSCode"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831003352.gif" alt="WebStorm"></p>
<p>可以看到，对于 HTML&#x2F;CSS 之间的代码提示、跳转这些基本功能，VSCode 其实并没有做好。现代前端说是不再写 HTML 了，但实际上终究还是要写（即便是 JSX 还是要符合写 HTML 的直觉的），VSCode 代码提示在这里明显不太够看。还有一点也很有趣，VSCode 在打完 <code>document.querySelector(&#39;#hello&#39;)</code> 之后彻底没了动静，而 WebStorm 在 <code>style</code> 输入完成之后，立刻就有了各种 CSS 属性提示了。</p>
<blockquote>
<p>附: VSCode 中通过输入 <code>h1.hello#hello</code> Tab 之后就得到代码是一种前端 HTML 代码编写方式，被称为 <a target="_blank" rel="noopener" href="https://www.qianduan.net/zen-coding-a-new-way-to-write-html-code/">Zen Coding</a>。但实际上，这种编写方式在代码提示方面存在劣势，所以使用 WebStorm 时并未演示。<br>附: VSCode 引用文件路径提示需要插件 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense">Path Intellisense</a></p>
</blockquote>
<p>对于库的开发者而言最难受的地方是 VSCode 实质上依赖于 TypeScript 才能做到代码提示，如果你也像吾辈是一位 JavaScript SDK 的开发者，那么也会遇到这件令人郁闷的事情: 如果想要使用你的 JavaScript SDK 的 VSCode 用户有正常的代码提示的话，你就必须接触 TypeScript。要么使用 TypeScript 重构整个 SDK，要么写 <em>.d.ts</em> 专门为 VSCode 维护一份注释文档，详情可以参考文章 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/eeb7bc5/">JavaScript &#x3D;&gt; TypeScript 迁移体验</a>。</p>
<h3 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h3><p>不知你是否曾遇到过，正在编辑着一个文件，突然断电，或者是因为其他什么原因，导致文件内容被清空了。或者是误删了代码之后之前的代码还没提交，又不能撤回那么多次，导致代码重写的经历呢？吾辈就曾经经历过，所以对本地历史记录这个功能相当重视，然而很遗憾，VSCode 依旧需要第三方插件 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=xyz.local-history">Local History</a> 才能支持。</p>
<p>VSCode Local History<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831024208.png" alt="VSCode Local History"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831024420.png" alt="WebStorm"></p>
<p>两者相比主要有以下不同</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>VSCode</th>
<th>WebStorm</th>
</tr>
</thead>
<tbody><tr>
<td>原始文件是否为人类可读</td>
<td>是</td>
<td>否（XML 不列入人类可读格式中）</td>
</tr>
<tr>
<td>是否可以添加标签</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>是否可以对比</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>是否可以合并</td>
<td>否</td>
<td>是</td>
</tr>
</tbody></table>
<h3 id="主题配色"><a href="#主题配色" class="headerlink" title="主题配色"></a>主题配色</h3><p>两者都支持黑暗主题，而且都是默认设置，也同样支持使用插件定制界面。下面是两者的截图</p>
<p>VSCode<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830231558.png" alt="VSCode 主界面"></p>
<p>WebStorm<br><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190830231815.png" alt="WebStorm 主界面"></p>
<p>事实上，上面两者都使用了主题。VSCode 是 Monokai，WebStorm 是 Material。但其实 WebStorm 的 <a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/8006">Material 主题</a> 还是存在一些 Bug 的，例如有些地方图标莫名的错位之类，VSCode 目前吾辈还未曾遇到过这类问题。</p>
<h3 id="使用性能"><a href="#使用性能" class="headerlink" title="使用性能"></a>使用性能</h3><p>WebStorm 确实很吃内存，尤其是项目刚刚打开的时候，索引会疯狂地吃 CPU&#x2F;内存&#x2F;硬盘，如果电脑性能不行的话这个过程所需时间可能泡面都够了。但基于 Chrome 内核的 VSCode 在使用各种插件打造成前端 IDE 之后吃的内存也并不少。吾辈打开了项目 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/rx-util">rx-util</a>，可以看到 VSCode 每个插件确实都放在了单独的进程里（Chrome 系的习惯 #笑），相比之下 WebStorm 只有两个进程，其中一个还是启动的 nodejs，整体对比下来其实相差不大。</p>
<p><img src="https://cdn.jsdelivr.net/gh/rxliuli/img-bed/20190831000118.png" alt="任务管理器"></p>
<h3 id="命令行倾向"><a href="#命令行倾向" class="headerlink" title="命令行倾向"></a>命令行倾向</h3><p>JetBrains IDE 倾向于一切都以可视化界面点击完成操作，而 VSCode 则有所不同，它有很多功能需要使用命令行&#x2F;配置文件的形式完成。吾辈最开始使用 VSCode 时它甚至还没有配置界面，也只能使用 <code>launch.json</code> 启动 debugger（最新版似乎已经不是了），真是被吓到了。</p>
<p>以下是对比</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>VSCode</th>
<th>WebStorm</th>
</tr>
</thead>
<tbody><tr>
<td>是否可以运行&#x2F;调试 npm script</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>是否可以点击运行测试</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>是否集成 git 支持</td>
<td>否（默认的很糟糕，几乎没法用）</td>
<td>是</td>
</tr>
<tr>
<td>是否支持 TypeScript 编译</td>
<td>否</td>
<td>是</td>
</tr>
</tbody></table>
<blockquote>
<p>有可能通过插件支持，但使用 VSCode 的人似乎更倾向于使用命令行（懒得找）。</p>
</blockquote>
<h3 id="东家"><a href="#东家" class="headerlink" title="东家"></a>东家</h3><p>VSCode 背后站着微软，俗成 **M$**，开发了宇宙最强 IDE Visual Studio。而 WebStorm 则是基于 JetBrains 平台专门为前端进行特殊处理优化的 IDE，背后则是业界最智能的 IDE 的开发公司 JetBrains（捷克公司）。两者在 IDE&#x2F;编辑的开发上都相当有经验，然而，有一点本质的不同：IDE 对于 JetBrains 而言几乎是全部，而 VSCode 对于 M$ 则只是开发的一部分 – 编辑器。</p>
<p><code>VSCode =&gt; VSCode Remote =&gt; GitHub =&gt; GitHub Actions =&gt; Azure</code>，从 M$ 的一系列变化来看，这对开发者是真的相当上心，从本地开发、远程协作、版本控制、自动化流程控制 CI&#x2F;CD 到部署到云端，完全是一站式的体验。相比于国内的云服务商，MS 显然更加开放、更加为开发者着想。<br>而 JetBrains，虽然现在也有了编程语言 <code>Kotlin</code>、项目管理工具 <code>Space</code>（包含 CI&#x2F;CD 工具 <code>TeamCity</code>），但本质上在其领域内，除了 IDE，其他的东西都没能形成特别大的优势（Kotlin 只能用于开发 Android 平台，而 Web 技术甚至能开发全端；<code>TeamCity</code> 虽然很漂亮，但似乎人们更喜欢开源的 <code>Jenkins</code>）。<br>未来 VSCode 一统天下似乎是必然之势，但目前而言，其尚且年幼，唯有 WebStorm 正值壮年。</p>
<blockquote>
<p>附：例如某只企鹅，开发的大多数云服务都是私有服务，使用上比开源的还难用而且还强制绑定到自家云服务上，使人不得不用全家桶（问题是体验又烂，文档死难找）<br>附: 居然连 “文档和 Demo 有可能过期，但代码一定是最新的” 这种话都能说出来，与 MS 花大力气创造开源的 <code>VSCode</code> 简直是天壤之别。<br>附: 没有对比就没有伤害！</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实在 Atom&#x2F;VSCode 出现之前，WebStorm 因为在这个领域没有对手而发展缓慢，它们的出现使得 WebStorm 有了压力，良性竞争，这当然是好事。即便如此，就目前而言，VSCode 作为一个 IDE 来讲仍然比不上 JetBrains 全家桶系列。<br>说了上面这么多，总的来说: 如果你需要一个文本编辑器，那么推荐你用 VSCode，因为它既漂亮又生态丰富，想写点什么很方便。但是，如果你需要真正开发项目，则 WebStorm 更加合适，完全开箱即用的体验，不需要安装&#x2F;配置任何插件就能立刻开始项目，强大的编辑器可以让你写代码更舒服一点。（其实是没钱就用免费的 VSCode，有钱就上 WebStorm 啦！）</p>
<blockquote>
<p>ref link: <a target="_blank" rel="noopener" href="https://dev.to/mokkapps/why-i-switched-from-visual-studio-code-to-jetbrains-webstorm-939">Why I Switched From Visual Studio Code To JetBrains WebStorm</a><br>吾辈个人非常同意作者及相关评论的观点：为 WebStorm 付费能减少折腾 VSCode 的时间，VSCode 的真正优势是启动时间，使用内存和免费。</p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/08/11/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E7%AF%87%E5%A5%BD%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/11/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E7%AF%87%E5%A5%BD%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" class="post-title-link" itemprop="url">如何编写一篇好的技术文章</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-11 18:27:53" itemprop="dateCreated datePublished" datetime="2019-08-11T18:27:53+08:00">2019-08-11</time>
    </span>


  
    <span id="/2019/08/11/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E7%AF%87%E5%A5%BD%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/" class="post-meta-item leancloud_visitors" data-flag-title="如何编写一篇好的技术文章" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="如何编写一篇好的技术文章" href="/2019/08/11/others/rxliuliBlog/Essay/%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E4%B8%80%E7%AF%87%E5%A5%BD%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::528887ef64779a5351f211a530ea157a" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="如何编写一篇好的技术文章"><a href="#如何编写一篇好的技术文章" class="headerlink" title="如何编写一篇好的技术文章"></a>如何编写一篇好的技术文章</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>人的目标总是追求「优越性」，是要摆脱自卑感以求得到优越感。</p>
</blockquote>
<p>现在网络上已经有很多写作平台了，让我们数数: 静态&#x2F;动态博客（Hexo&#x2F;WordPress），SegmentFault 专栏，简书，掘金，CSDN 博客。然而写作平台很多，愿意写作的人也很多，那么是否意味着我们就更容易获取知识了呢？其实并不是，原因在于很多人写作只是跟风，觉得很<strong>酷</strong>，所以用 <code>hexo/hugo + github pages</code> 建了静态站点发了一篇 <strong>hello world</strong> 之后就没有下文了。这种暂且按下不表，吾辈主要想说的是另一种：为了写作（<del>积分</del>）而写作，完全不用心，只是简单的把概念复制了一下，甚至直接<strong>抄袭</strong>别人的文章，不注明来源，而且没有尝试过文章做法的人。</p>
<blockquote>
<p>这里强烈批评一下 CSDN 博客，虽然也有一些优质的博客，但更多的是直接<strong>抄袭</strong>的文章，而且大多数都存在问题，实在令人深痛恶绝。甚至于，有人专门写了油猴脚本 <a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/375279">google 百度搜索屏蔽 CSDN</a> 用来屏蔽它，糟糕程度可见一斑。</p>
</blockquote>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>那么，真的想要开始写作，想要把自己的知识、感触和经验分享给其他人的话，有没有什么写作的技巧，或者说遵循的规则呢？下面是吾辈写作至今以来的一些经验，希望能帮到真心想要写作的人。</p>
<p>重点</p>
<ul>
<li>是什么？</li>
<li>怎么做？</li>
<li>在哪里用？</li>
</ul>
<p>细节</p>
<ul>
<li>排版样式</li>
<li>插图</li>
<li>错别字</li>
<li>转发文章</li>
</ul>
<h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h2><p>如果要写一个技术文档，那么有三点是必须要注意的。</p>
<ul>
<li>是什么？<br>可以是技术的一些简单介绍，或是在什么场景下会遇到这种问题，也可以是为什么要写这篇文章。就像吾辈，基本上每篇文章的正文都会有一个<strong>场景</strong>段落，用来介绍吾辈为什么写这篇文章，以及对涉及问题的介绍（吐槽 #打）。</li>
<li>怎么做？<br>正确的描述具体如何使用，或是如何使用代码<strong>实现功能&#x2F;修复错误</strong>。例如介绍 JavaScript Array 的文章，那就需要告诉读者如何使用常见的 API，例如 <code>forEach, filter, map, reduce</code> 这些函数，如何的使用它们，给出一些具体可运行的示例，如果有你觉得读者会难以理解的部分，更应该详细解释，并配上代码示例。</li>
<li>在哪里用？<br>写作最有可能漏掉的部分，但却是最重要的。如果文章只是单纯罗列了一堆概念和代码，却不告诉读者在什么场景下才会用到，那么这只会是相当糟糕的文章，还不如去看官方文档（大部分文档都是告诉怎么做而不告诉在哪里用，尤其是某些 HTML&#x2F;CSS 书籍，简直是把 MDN 的文档抄了一遍），至少还准确一些。</li>
</ul>
<h2 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h2><ul>
<li>排版样式<br>读者进入网页之后，第一眼看到的绝对不是具体的内容，而是网页的排版大致是什么样子的，这点在读者阅读时能够清晰的感受出来。就像人的外貌，在开口前读者便能藉此看出大概（所谓以貌取人）。即便可能在读者继续阅读内容而扭转形象，但更有可能是读者直接点 X 关闭网页，并且留下了不好的印象。<br>所以排版真的很重要，下面提供吾辈的几条经验:<ul>
<li>不要是纯 TXT 文本格式（<strong>大忌</strong>）</li>
<li>使用代码块包裹代码片段，不要直接和普通文本一样，没有语法高亮看代码会死人的。</li>
<li>合理使用标题。标题应该是逐级减小，而不应该出现一级标题，然后立刻就是三级标题，中间一定且必须有一个二级标题。</li>
<li>文章中的链接应该是可点击的，并且最好引用一些比较官方的内容（MDN，Wiki）。</li>
<li>错误示例: <a target="_blank" rel="noopener" href="https://blog.csdn.net/xlxxcc/article/details/52083543">https://blog.csdn.net/xlxxcc/article/details/52083543</a></li>
</ul>
</li>
<li>插图<br>如果说排版样式是外貌，那图片就像人的衣服一样，能为文章锦上添花。更何况还有 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%80%E7%95%AB%E5%8B%9D%E5%8D%83%E8%A8%80">一图胜千言</a> 的说法，可以避免读者在阅读时感到无聊。像是如果有流程图&#x2F;原理图&#x2F;时序图这些，将会显著的提高文章的层次。<blockquote>
<p>附: 画图真的很花时间，如果有图片的话，说明作者是真的用心在写文章。（一般是大佬才会做，吾辈不是大佬，所以一般不会画图 #笑哭）</p>
</blockquote>
</li>
<li>错别字<br>但凡写作，如果有人说自己没写过错别字，吾辈是第一个不信的。人非圣贤，孰能无过。写作时出现错别字是很正常的，但由于人类本身的原因（参考 <a target="_blank" rel="noopener" href="https://www.guokr.com/article/439010/">查出自己的错别字，为什么这么难？</a>），所以想要检查是比较困难的 – 但并不是毫无办法，我们在文章发布后，在网络上再次查看文章，会比在编辑器中更容易察觉到文章中的问题，这其中当然包含错别字。</li>
<li>转发文章<br>当我们在网络上看到别人的文章，觉得写得很好，于是转发了文章想让更多人看到。但在转发之前，最好先询问一下原作者的意愿（一般是允许署名转载的），而且必须要在显眼的位置（文章顶部或尾部，一般最好是顶部）放置原文的链接，以使读者能够找到原作者。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面说了这么多，还有最后一句话要送给大家: <strong>保持作者这个称呼的基本水平和对读者的基本尊重</strong>。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/07/12/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/12/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6/" class="post-title-link" itemprop="url">读书 [黑客与画家]</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-12 23:05:25" itemprop="dateCreated datePublished" datetime="2019-07-12T23:05:25+08:00">2019-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-07-13 00:00:00" itemprop="dateModified" datetime="2019-07-13T00:00:00+08:00">2019-07-13</time>
    </span>


  
    <span id="/2019/07/12/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6/" class="post-meta-item leancloud_visitors" data-flag-title="读书 [黑客与画家]" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="读书 [黑客与画家]" href="/2019/07/12/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::7168122d8a5ba94ee7c30613d5d771a7" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="读书-黑客与画家"><a href="#读书-黑客与画家" class="headerlink" title="读书 [黑客与画家]"></a>读书 [黑客与画家]</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p>黑客新想法的最佳来源，并非那些名字里有［计算机］三个字的理论领域，而是来自于其他创作领域。</p>
</blockquote>
<p>这是一篇读书感悟的文章，来源于最近阅读的书籍 <a target="_blank" rel="noopener" href="https://book.douban.com/subject/6021440/">黑客与画家</a>。</p>
<blockquote>
<p>摘抄自豆瓣<br><strong>书籍简介</strong>：<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;本书是硅谷创业之父 Paul Graham 的文集，主要介绍黑客即优秀程序员的爱好和动机，讨论黑客成长、黑客对世界的贡献以及编程语言和黑客工作方法等所有对计算机时代感兴趣的人的一些话题。书中的内容不但有助于了解计算机编程的本质、互联网行业的规则，还会帮助读者了解我们这个时代，迫使读者独立思考。<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;本书适合所有程序员和互联网创业者，也适合一切对计算机行业感兴趣的读者。<br><strong>作者简介</strong>:<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;保罗・格雷厄姆，《黑客与画家》一书的作者，硅谷创业之父。1964 年，出生于匹兹堡郊区的一个中产阶级家庭。父亲是设计核反应堆的物理学家，母亲在家照看他和他的妹妹。青少年时代，格雷厄姆就开始编程。但是，他还喜欢许多与计算机无关的东西，这在编程高手之中是很少见的。<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;保罗・格雷厄姆在康奈尔大学读完本科，然后在哈佛大学获得计算机科学博士学位。1995 年，他创办了 Viaweb，帮助个人用户在网上开店，这是世界上第一个互联网应用程序。1998 年夏天，Yahoo! 公司收购了 Viaweb，收购价约为 5000 万美元。<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;此后，他架起了个人网站 paulgraham.com，在上面撰写了许许多多关于软件和创业的文章，以深刻的见解和清晰的表达而著称，迅速引起了轰动。2005 年，他身体力行，创建了风险投资公司 Y Combinator，将自己的理论转化为实践，目前已经资助了 80 多家创业公司。现在，他是公认的互联网创业权威。</p>
</blockquote>
<p><img src="https://img.rxliuli.com/20190713024824.png" alt="书籍照片"></p>
<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>之前吾辈也曾经坚信电子书籍（<strong>Epub&#x2F;PDF</strong>）要比纸质书籍更好，方便携带，随时都能阅读。直到遇到了一位 dalao 的指点 – <strong>只要买了书，放在那里，总有机会去看看的。</strong> 之后，吾辈便尝试买了一些实体书，晚上回来闲暇片刻便会看看。</p>
<p><img src="https://img.rxliuli.com/20190713024216.jpg" alt="书架图片"></p>
<p>最近一周，吾辈便把黑客与画家看完了。当然，之前已经看过电子版的了。作者真的很厉害，既是第一个互联网程序的开发者，也是一个画家，更是一个顶级<strong>黑客</strong>（非<strong>骇客</strong>）。然后，他写完这本书之后，还变成了作者。当然，译者也同样是位知名人物 – <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/">阮一峰</a>。</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>读这本书的时候，才发现<strong>真-大佬</strong>的想法真的很厉害，尤其是关于创造财富那一章，有许多思想值得吾辈深思。<br>下面摘抄一些内容并谈谈吾辈的想法</p>
<blockquote>
<p>书呆子不受欢迎的真正原因，是他们脑子里都在想着别的事情，他们的注意力都放在读书或者观察世界上面，而不是穿衣打扮、开晚会上面。</p>
</blockquote>
<p>嗯，吾辈想这大抵是作者的亲身体会：作为一个聪明人却不受欢迎 #笑 不过就吾辈经历而言，读书好的人一般也不会太受排挤，或许这是因为国情不同的原因吧 – 国内不论如何都把成绩作为第一位，而据作者所说美国的中学生并不会特别对待学习，至少，不会拼命去学，也不会因此自杀。</p>
<blockquote>
<p>黑客与画家的共同之处，在于他们都是创作者。与作曲家、建筑师、作家一样，黑客和画家都是试图创作出优秀的作品。他们本质上都不是在做研究，虽然在创作过程中，他们可能会发现一些新技术（那样当然更好）。</p>
</blockquote>
<p>想想国内的大环境，吾辈瞬间心酸得落下了眼泪。说是创作者，但实际上，开发者被称为<strong>码农</strong>不是没有道理的 – 只是实现经理所要求的功能，而不是决定功能应该如何设计 – 这被交给了其他人！当然，拥有&#x2F;参与开源项目可以减少这个问题，因为可以决定功能如何设计而非实现。但本质上还是在代码的圈子里打转，并没有创造出人们真正需要用到的东西。</p>
<blockquote>
<p>程序写出来是给人看的，附带能在机器上运行。</p>
</blockquote>
<p>这不是吾辈第一次看见这句话了，但在工作过程中，吾辈发现实际上这句话并没有多少开发者真的在意过 – 包括一些 dalao。为了性能死扣算法，没错吾辈就是在吐槽一些公司任何职位都要面试算法，简直成 <a target="_blank" rel="noopener" href="https://leetcode.com/">leetcode</a> 算法面试公司了。大部分场景实际上并不需要开发者手写算法进行优化，因为现在的计算机已经足够快了。手写算法再加上耦合业务，只会让代码变得无比丑陋，难以维护 – 仅仅是为了在某个地方稍微快一点。</p>
<blockquote>
<p>在某些地方，自行其道，完全不替读者着想，被看成是高水平、高智商的表现，甚至都发展成了一种风尚。</p>
</blockquote>
<p>是的，有些人就是为了炫技而写出来各种<em>奇葩</em>的代码，导致其他人再看代码时，纷纷惊呼：“<strong>这是什么神仙代码？！</strong>”。在他们看来，写出来的代码让别人看不懂，自己说的话让别人听不懂，是一种<em>高水准</em>的表现，甚至于说：“<strong>这降低了 SB 来烦我的概率</strong>”。甚至于刻意不写注释，然后辩解说：“<strong>类型系统就是最好的注释</strong>”<br>关于这点，作者也在后面进一步评论了。</p>
<blockquote>
<p>但是，我不觉得 “换位思考” 与智商之间存在任何联系。在数学和自然科学领域，你用学习怎么向别人表达自己，也能却得很好的成就。而那些领域的人普遍很聪明，所以人们很自然地就把 “聪明” 与 “不懂得换位思考” 联系了起来。但是，世界上还有许许多多很笨的人，也同样不懂得 “换位思考”。</p>
</blockquote>
<p>最后一句真是说出了大实话 – <strong>伪-大佬</strong>。</p>
<blockquote>
<p>我家附近，一辆汽车的保险杠贴着一张粘纸，上面写着 “太麻烦，不如死”（death before inconvenience）。大多数人，在大多数时候，总是选择最省事的做法。如果互联网软件能够击败桌面软件，一定是赢在更方便这一优势上。无论从用户的角度还是从开发者的角度来看都是如此。</p>
</blockquote>
<p>是的，现在浏览器已经击败了客户端软件，甚至在原本必须要使用客户端的地方使用 Web 技术进行了入侵（<a target="_blank" rel="noopener" href="https://electronjs.org/">Electron</a>，<a target="_blank" rel="noopener" href="https://facebook.github.io/react-native/">React Native</a>）。但这并不意味人们知道这件事就会真的对用户更友好，尤其是对于免费的开源程序而言。用户不再是首位要素，动辄要求使用者去看源码，吐槽就会被说 “<strong>爱用用不用滚，You can you do？</strong>”。你敢相信？但这就是国内开源现状。</p>
<blockquote>
<p>开发软件需要的程序员人数减少，不仅意味着省下更多的钱。正如《人月神话》一书中所指出的，向一个项目增加人手，往往会拖慢项目进程。随着参与人数的增加，人与人之间需要的沟通呈现指数式增长。人数越来越多，开会讨论各个部分如何协同工作所需要的时间越来越长，无法预见的互相影响越多越大，产生的 bug 也越来越多。幸运的是，这个过程的逆向也成立：人数越来越少，软件开发的效率将指数式增长。</p>
</blockquote>
<p>所以说这就是小公司能生存下来的原因么？#笑 想到之前项目实际上只有 3 个人全职开发就发现，其实也不是那么奇怪呢</p>
<blockquote>
<p>桌面软甲迫使用户变成系统管理员，互联网软件则是迫使程序员变成系统管理员：用户的压力变小了，程序员的压力变大了。</p>
</blockquote>
<p>唉，小公司别说系统管理员了，就连前端，后端，运维，测试都要会一点才行，必须是 <strong>多面手&#x2F;万金油</strong> 才能生存下去。</p>
<blockquote>
<p>许多人从小就认定世界上的财富总额是固定不变的，这样想的人数多的惊人。<br>小时候我就对这一点深信不疑：如果夫人拿走了所有的钱，那么其他人就变得更穷了。许多成年人至今都是类似看法的信徒。每当有人提到 <em>x%</em> 的人口占有了 <em>y%</em> 的财富，他的言下之意往往就包含了这种错误的观点。</p>
</blockquote>
<p>嘛，吾辈也曾经是这样想的人之一（一个普通的不能再普通的人）。但这个观点在看完本书后刷新了，财富在净增长 – 代价是地球本身。</p>
<blockquote>
<p>确实有一些 CEO 的收入太高，不合理，但是有没有 CEO 的收入不足以体现他所创造的财富的呢？乔布斯就是这样的例子。他拯救了濒临崩溃的苹果公司，扭转了危机，削减了成本，成功决策了下一代产品。他的收入就低于他的工作所创造的价值。</p>
</blockquote>
<p>是的，这点确实很厉害，尤其是吾辈正在看的 <a target="_blank" rel="noopener" href="https://book.douban.com/subject/26792439/">浪潮之巅</a> 一书也谈及了他，确实是个 <strong>真-大佬</strong>。</p>
<blockquote>
<p>在垃圾邮件业中，如果发送销售类垃圾邮件受到限制，那么整个行业将不可避免地受到重创。“行业”这个词是很准确的，发送垃圾邮件的人其实都是商人，他们这么做只是因为这招很有效。虽然垃圾邮件的回应率低到不能再低了（不超过百万分之 15，相比之下，传统的邮寄商品目录的回应率是百万分之 3000），但是发送垃圾邮件的成本实际上为零，所以它还是有效的。但是对于收到垃圾邮件的人来说，成本却很高昂，假定有 100 万人分别收到一封垃圾邮件，每人花一秒钟删除，累计起来就相当于一个人 5 个星期的工作量，而发送人连一分钱也不用付出。<br>不过，虽然接近于零，发送垃圾邮件还是有成本的^。所以，只要我们把垃圾邮件的回应率降得很低（不管手段是直接过滤，还是让垃圾邮件被迫掩盖它们的销售意图），商家就会发现，发送垃圾邮件是一件经济上不值得的事情。</p>
</blockquote>
<p>这让吾辈想到了现在的广告过滤行业，嗯，没错是行业 – <a target="_blank" rel="noopener" href="https://adblockplus.org/">Adblock Plus</a> 把这事做成了生意。广告屏蔽插件流行了起来之后，广告受益者就会烦恼，会提示让用户关闭广告过滤以支持网站，或者，直接关闭页面拒绝使用 – 直到关闭了广告过滤为止。后来，开始出现了屏蔽那些网页上检测广告的脚本 – 反屏蔽广告脚本。这个斗争其实可以一直进行下去，终究是收益与代价的权衡罢了。</p>
<blockquote>
<p>好设计是简单的设计。从数学领域到绘画领域，你都可以听到这种说法。在数学中，它表示简短的证明往往是更好的证明。特别是对于数学公理来说，少即是多。在编程中，这种说法也基本适用。</p>
</blockquote>
<p><strong>少即是多</strong>，能满足这一点的库&#x2F;框架并不多，<a target="_blank" rel="noopener" href="https://www.lodashjs.com/">Lodash</a> 是一个正例，<a target="_blank" rel="noopener" href="https://reactjs.org/">React</a> 某种程度上来说是个反例。不管是程序（<a target="_blank" rel="noopener" href="https://web.sanguosha.com/">三国杀</a>），还是库（<a target="_blank" rel="noopener" href="https://github.com/rxliuli/rx-util">rx-util</a>），开发者总是喜欢增加功能，逐渐提高复杂度，最后让人难以接受。这里吐槽一下国产程序，只会逐渐增加功能，永远学不会什么叫<strong>减法</strong>。</p>
<blockquote>
<p>高级语言比汇编语言更接近人类语言，而某些高级语言又比其他语言更进一步。举例来说，C 语言是一种低层次语言，很接近硬件，几乎堪称可移植的汇编语言，而 Lisp 语言的层次则是相当高。</p>
</blockquote>
<p><code>Lisp</code> 之前一直有听闻过，但吾辈还从未真正使用过。在编程语言领域，吾辈接触过 <code>Java</code>, <code>JavaScript</code>, <code>Scala</code>, <code>C#</code>，然而他们都不能支持 <code>Lisp</code> 中一些非常高级的功能（宏）。</p>
<p>下面作者列出了 Lisp 的创新功能</p>
<ol>
<li>条件结构（即 if-then-else 结构）。现在大家都觉得这是理所当然的，但是 FortranI 就没有这个结构，它只有基于底层机器指令的 goto 结构。</li>
<li>函数也是一种数据类型。在 Lisp 语言中，函数与整数或字符串一样，也属于数据类型的一种。它有自己的字面表示形式（literal representation），能够存储在变量中，也能当作参数传递。一种数据类型应该有的功能，它都有。</li>
<li>递归。Lisp 是第一种支持递归函数的高级语言^。<br>^「Lisp 语言的许多特性（比如，把程序写成列表形式以及实现某种形式的递归）都在 20 世纪 50 年代的 IPL-V 语言中出现过。但是，IPL-V 更像是汇编语言，它的程序中充满了操作码&#x2F;地址对。参见 Alien Newell 等人编著的《IPL-V 语言操作手册》（Information Processing Language-V Manual），Prentice-Hail，1961 年出版。」</li>
<li>变量的动态类型。在 Lisp 语言中，所有变量实际上都是指针，所指向的值有类<br>型之分，而变量本身没有。复制变量就相当于复制指针，而不是复制它们指向的数据。</li>
<li>垃圾回收机制。</li>
<li>程序由表达式组成。Lisp 程序是一些表达式树的集合，每个表达式都返回一个值。这与 Fortran 和大多数后来的语言都截然不同，它们的程序由表达式和语句组成。区分表达式和语句在 Fortran I 中是很自然的，因为它不支持语句嵌套。所以，如果你需要用数学式子计算一个值，那就只有用表达式返回这个值，没有其他语法结构可用，否则就无法处理这个值。<br>后来，新的编程语言支持块结构，这种限制当然也就不存在了。但是为时已晚，表达式和语句的区分已经根深蒂固。它从 Fortran 扩散到 Algol 语言，接着又扩散到它们两者的后继语言。</li>
<li>符号类型。符号实际上是一种指针，指向存储在散列表中的字符串。所以，比较<br>两个符号是否相等，只要看它们的指针是否一样就行了，不用逐个字符地比较。</li>
<li>代码使用符号和常量组成的树形表示法。</li>
<li>无论什么时候，整个语言都是可用的。Lisp 并不真正区分读取期、编译期和运行期。你可以在读取期编译或运行代码，也可以在编译期读取或运行代码，还可以在运行期读取或者编译代码。</li>
</ol>
<p>Lisp 确实开创了许多功能，成功引起了吾辈的兴趣，以后有机会会去看一下作者写的 Lisp 的书籍吧</p>
<blockquote>
<p>大多数程序员也许无法分辨语言的好坏。但是，这不代表优秀的编程语言会被埋没，专家级黑客一眼就能认出它们，并且会拿来使用。虽然他们人数很少，但就是这样一小群人写出了人类所有优秀软件。他们有着巨大的影响力，他们使用什么语言，其他程序员往往就会跟着使用。老实说，很多时候这种影响力更像是一种命令，对于其他程序员来说，专家级黑客就像自己的老板或导师，他们说哪种语言好用，自己就会乖乖地跟进。<br>编程语言的最高境界一直在发展之中。虽然语言的核心功能就像大海的深处，很少有变化，但是函数库和开发环境之类的东西就像大海的表面，一直在汹涌澎湃。</p>
</blockquote>
<p>是啊，所以现在流行 react，流行 webpack，流行 typescript，甚至曾经有人吐槽 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/78dc231c/">2016 年里做前端是怎样一种体验</a>。各种各样的框架和库，说不定过不了一段时间就死掉了（前车之鉴），这些都是浪潮的表面。不过总有人喜欢折腾代码，而不是完成一个真正可以给其他人用的东西。疯狂造一堆<del>没人用的</del>轮子，美其名曰不做调参工程师。当然，尝试实现便于了解深层原理，然而如果不加节制什么东西都觉得自己造才好就是典型的浪费时间。</p>
<blockquote>
<p>先做出原型，再逐步加工做出成品，这种方式有利于鼓舞士气，因为它使得你随时都可以看到工作的成效。开发软件的时候，我有一条规则：任何时候，代码都必须能够运行。如果你正在写的代码一个小时之后就可以看到运行结果，这好比让你看到不远处就是唾手可得的奖励，你因此会受到激励和鼓舞。<br>跟你说实话吧，画家之间甚至流传着一句谚语：“画作永远没有完工的一天，你只是不再画下去而已。”这种情况对于第一线的程序员真是再熟悉不过了。</p>
</blockquote>
<p>是啊，能看到效果的原型很重要，看不到效果的开发是艰苦而烦躁的。而且出现错误了都无法进行调试，实在是不能更糟糕了。有些开源项目目标很大，花费的时间过长，长期做不出来一个可用版本，久而久之，就半路放弃了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总而言之，上面是一些看书的想法以及吐槽，这本书籍吾辈强烈推荐 – 即便不是 IT 行业。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/06/25/others/rxliuliBlog/JavaScript/JavaScript-%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E6%95%B0%E7%BB%84%E7%9A%84%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/25/others/rxliuliBlog/JavaScript/JavaScript-%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E6%95%B0%E7%BB%84%E7%9A%84%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">JavaScript 实现更多数组的高阶函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-25 17:55:01" itemprop="dateCreated datePublished" datetime="2019-06-25T17:55:01+08:00">2019-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-07-06 00:00:00" itemprop="dateModified" datetime="2019-07-06T00:00:00+08:00">2019-07-06</time>
    </span>


  
    <span id="/2019/06/25/others/rxliuliBlog/JavaScript/JavaScript-%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E6%95%B0%E7%BB%84%E7%9A%84%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/" class="post-meta-item leancloud_visitors" data-flag-title="JavaScript 实现更多数组的高阶函数" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="JavaScript 实现更多数组的高阶函数" href="/2019/06/25/others/rxliuliBlog/JavaScript/JavaScript-%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%E6%95%B0%E7%BB%84%E7%9A%84%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::fdd1810b1b77a93577b0aab3fb04f508" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JavaScript-实现更多数组的高阶函数"><a href="#JavaScript-实现更多数组的高阶函数" class="headerlink" title="JavaScript 实现更多数组的高阶函数"></a>JavaScript 实现更多数组的高阶函数</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>虽说人人平等，但有些人更加平等。</p>
</blockquote>
<p>为什么有了 Lodash 这种通用函数工具库，吾辈要写这篇文章呢？吾辈在 SegmentFault 上经常看到关于 JavaScript 数组的相关疑问，甚至于，相同类型的问题，只是数据变化了一些，就直接提出了一个新的问题（实际上，对自身并无帮助）。简单<a target="_blank" rel="noopener" href="https://segmentfault.com/search?q=Array&type=question">搜索了一下 Array</a>，居然有 2360+ 条的结果，足可见这类问题的频率之高。若是有一篇适合 JavaScript 萌新阅读的自己实现数组更多操作的文章，情况或许会发生一些变化。</p>
<p>下面吾辈便来实现以下几种常见的操作</p>
<ul>
<li><code>uniqueBy</code>: 去重</li>
<li><code>sortBy</code>: 排序</li>
<li><code>filterItems</code>: 过滤掉一些元素</li>
<li><code>diffBy</code>: 差异</li>
<li><code>groupBy</code>: 分组</li>
<li><code>arrayToMap</code>: Array 转换为 Map</li>
<li>递归操作</li>
</ul>
<blockquote>
<p>前言:<br>你至少需要了解 ES6 的一些特性你才能愉快的阅读</p>
</blockquote>
<h2 id="uniqueBy-去重"><a href="#uniqueBy-去重" class="headerlink" title="uniqueBy: 去重"></a><code>uniqueBy</code>: 去重</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000002674331">javascript 怎么实现多种数据类型的数组去重？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000010936175">JS 有没有比较高效的数组去重的方法？</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 的数组去重方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 要进行去重的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> kFn 唯一标识元素的方法，默认使用 &#123;<span class="doctag">@link</span> returnItself&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 进行去重操作之后得到的新的数组 (原数组并未改变)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">uniqueBy</span>(<span class="params">arr, kFn = val =&gt; val</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, ...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k = <span class="title function_">kFn</span>(v, ...args)</span><br><span class="line">    <span class="keyword">if</span> (set.<span class="title function_">has</span>(k)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    set.<span class="title function_">add</span>(k)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">uniqueBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>])) <span class="comment">// [ 1, 2, 3, &#x27;1&#x27;, &#x27;2&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">uniqueBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>], <span class="function"><span class="params">i</span> =&gt;</span> i + <span class="string">&#x27;&#x27;</span>)) <span class="comment">// [ 1, 2, 3 ]</span></span><br></pre></td></tr></table></figure>

<h2 id="sortBy-排序"><a href="#sortBy-排序" class="headerlink" title="sortBy: 排序"></a><code>sortBy</code>: 排序</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000014304039">js 中如何对含有特殊字符的数组进行排序？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000017141566">以下数组怎么按名称排序</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 快速根据指定函数对数组进行排序</span></span><br><span class="line"><span class="comment"> * 注: 使用递归实现，对于超大数组（其实前端的数组不可能特别大吧？#笑）可能造成堆栈溢出</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 需要排序的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> kFn 对数组中每个元素都产生可比较的值的函数，默认返回自身进行比较</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 排序后的新数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sortBy</span>(<span class="params">arr, kFn = v =&gt; v</span>) &#123;</span><br><span class="line">  <span class="comment">// TODO 此处为了让 typedoc 能生成文档而不得不加上类型</span></span><br><span class="line">  <span class="keyword">const</span> newArr = arr.<span class="title function_">map</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> [v, i])</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">_sort</span>(<span class="params">arr, fn</span>) &#123;</span><br><span class="line">    <span class="comment">// 边界条件，如果传入数组的值</span></span><br><span class="line">    <span class="keyword">if</span> (arr.<span class="property">length</span> &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据中间值对数组分治为两个数组</span></span><br><span class="line">    <span class="keyword">const</span> medianIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(arr.<span class="property">length</span> / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">const</span> medianValue = arr[medianIndex]</span><br><span class="line">    <span class="keyword">const</span> left = []</span><br><span class="line">    <span class="keyword">const</span> right = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i === medianIndex) &#123;</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> v = arr[i]</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">fn</span>(v, medianValue) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        left.<span class="title function_">push</span>(v)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        right.<span class="title function_">push</span>(v)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">_sort</span>(left, fn)</span><br><span class="line">      .<span class="title function_">concat</span>([medianValue])</span><br><span class="line">      .<span class="title function_">concat</span>(<span class="title function_">_sort</span>(right, fn))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_sort</span>(newArr, <span class="function">(<span class="params">[t1, i1], [t2, i2]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k1 = <span class="title function_">kFn</span>(t1, i1, arr)</span><br><span class="line">    <span class="keyword">const</span> k2 = <span class="title function_">kFn</span>(t2, i2, arr)</span><br><span class="line">    <span class="keyword">if</span> (k1 === k2) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (k1 &lt; k2) &#123;</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">[_v, i]</span>) =&gt;</span> arr[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sortBy</span>([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>])) <span class="comment">// [ 1, 2, 3, 4, 5 ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sortBy</span>([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;4&#x27;</span>])) <span class="comment">// [ 1, &#x27;2&#x27;, 3, &#x27;4&#x27;, 5 ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sortBy</span>([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;4&#x27;</span>], <span class="function"><span class="params">i</span> =&gt;</span> -i)) <span class="comment">// [ 5, &#x27;4&#x27;, 3, &#x27;2&#x27;, 1 ]</span></span><br></pre></td></tr></table></figure>

<h2 id="filterItems-过滤掉一些元素"><a href="#filterItems-过滤掉一些元素" class="headerlink" title="filterItems: 过滤掉一些元素"></a><code>filterItems</code>: 过滤掉一些元素</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000009045163">过滤数组子集</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000017464256">对比两组对象数组 根据元素内某一属性是否相等过滤数组</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从数组中移除指定的元素</span></span><br><span class="line"><span class="comment"> * 注: 时间复杂度为 1~3On</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 需要被过滤的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deleteItems 要过滤的元素数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> kFn 每个元素的唯一键函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">filterItems</span>(<span class="params">arr, deleteItems, kFn = v =&gt; v</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> kSet = <span class="keyword">new</span> <span class="title class_">Set</span>(deleteItems.<span class="title function_">map</span>(kFn))</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, i, arr</span>) =&gt;</span> !kSet.<span class="title function_">has</span>(<span class="title function_">kFn</span>(v, i, arr)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">filterItems</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>])) <span class="comment">// [ 3, 4, 5 ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">filterItems</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>], <span class="function"><span class="params">i</span> =&gt;</span> i + <span class="string">&#x27;&#x27;</span>)) <span class="comment">// [ 3, 4, 5 ]</span></span><br></pre></td></tr></table></figure>

<h2 id="diffBy-差异"><a href="#diffBy-差异" class="headerlink" title="diffBy: 差异"></a><code>diffBy</code>: 差异</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019019878">JS 求两个对象数组的差集</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000008825206">JavaScript 数组系列问题：数组差集</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 比较两个数组的差异</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left 第一个数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right 第二个数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> kFn 每个元素的唯一标识产生函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 比较的差异结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">diffBy</span>(<span class="params">left, right, kFn = v =&gt; v</span>) &#123;</span><br><span class="line">  <span class="comment">// 首先得到两个 kSet 集合用于过滤</span></span><br><span class="line">  <span class="keyword">const</span> kThanSet = <span class="keyword">new</span> <span class="title class_">Set</span>(left.<span class="title function_">map</span>(kFn))</span><br><span class="line">  <span class="keyword">const</span> kThatSet = <span class="keyword">new</span> <span class="title class_">Set</span>(right.<span class="title function_">map</span>(kFn))</span><br><span class="line">  <span class="keyword">const</span> leftUnique = left.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, ...args</span>) =&gt;</span> !kThatSet.<span class="title function_">has</span>(<span class="title function_">kFn</span>(v, ...args)))</span><br><span class="line">  <span class="keyword">const</span> rightUnique = right.<span class="title function_">filter</span>(</span><br><span class="line">    <span class="function">(<span class="params">v, ...args</span>) =&gt;</span> !kThanSet.<span class="title function_">has</span>(<span class="title function_">kFn</span>(v, ...args)),</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">const</span> kLeftSet = <span class="keyword">new</span> <span class="title class_">Set</span>(leftUnique.<span class="title function_">map</span>(kFn))</span><br><span class="line">  <span class="keyword">const</span> common = left.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, ...args</span>) =&gt;</span> !kLeftSet.<span class="title function_">has</span>(<span class="title function_">kFn</span>(v, ...args)))</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">left</span>: leftUnique, <span class="attr">right</span>: rightUnique, common &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">diffBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])) <span class="comment">// &#123; left: [ 1 ], right: [ 4 ], common: [ 2, 3 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">diffBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">&#x27;2&#x27;</span>, <span class="number">3</span>, <span class="number">4</span>])) <span class="comment">// &#123; left: [ 1, 2 ], right: [ &#x27;2&#x27;, 4 ], common: [ 3 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">diffBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="string">&#x27;2&#x27;</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="function"><span class="params">i</span> =&gt;</span> i + <span class="string">&#x27;&#x27;</span>)) <span class="comment">// &#123; left: [ 1 ], right: [ 4 ], common: [ 2, 3 ] &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="groupBy-分组"><a href="#groupBy-分组" class="headerlink" title="groupBy: 分组"></a><code>groupBy</code>: 分组</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000004944432">求一个数组按属性分组的方法</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000008789413">js 数组分组？</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 数组按照某个条件进行分组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 要进行分组的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> kFn 元素分组的唯一标识函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> vFn 元素分组的值处理的函数。第一个参数是累计值，第二个参数是当前正在迭代的元素，如果你使用过 &#123;<span class="doctag">@link</span> Array#reduce&#125; 函数的话应该对此很熟悉</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> init 每个分组的产生初始值的函数。类似于 reduce 的初始值，但它是一个函数，避免初始值在所有分组中进行累加。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 元素标识 =&gt; 数组映射 Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">groupBy</span>(<span class="params"></span></span><br><span class="line"><span class="params">  arr,</span></span><br><span class="line"><span class="params">  kFn = v =&gt; v,</span></span><br><span class="line"><span class="params">  <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="params">   * 默认的值处理函数</span></span></span><br><span class="line"><span class="comment"><span class="params">   * <span class="doctag">@param</span> res 最终 V 集合</span></span></span><br><span class="line"><span class="comment"><span class="params">   * <span class="doctag">@param</span> item 当前迭代的元素</span></span></span><br><span class="line"><span class="comment"><span class="params">   * <span class="doctag">@returns</span> 将当前元素合并后的最终 V 集合</span></span></span><br><span class="line"><span class="comment"><span class="params">   */</span></span></span><br><span class="line"><span class="params">  vFn = (res, item) =&gt; &#123;</span></span><br><span class="line"><span class="params">    res.push(item)</span></span><br><span class="line"><span class="params">    <span class="keyword">return</span> res</span></span><br><span class="line"><span class="params">  &#125;,</span></span><br><span class="line"><span class="params">  init = () =&gt; [],</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 将元素按照分组条件进行分组得到一个 条件 -&gt; 数组 的对象</span></span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">res, item, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k = <span class="title function_">kFn</span>(item, index, arr)</span><br><span class="line">    <span class="comment">// 如果已经有这个键了就直接追加, 否则先将之初始化再追加元素</span></span><br><span class="line">    <span class="keyword">if</span> (!res.<span class="title function_">has</span>(k)) &#123;</span><br><span class="line">      res.<span class="title function_">set</span>(k, <span class="title function_">init</span>())</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">set</span>(k, <span class="title function_">vFn</span>(res.<span class="title function_">get</span>(k), item, index, arr))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;, <span class="keyword">new</span> <span class="title class_">Map</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">groupBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="function"><span class="params">i</span> =&gt;</span> i)) <span class="comment">// Map &#123; 1 =&gt; [ 1 ],  2 =&gt; [ 2, 2, 2 ],  4 =&gt; [ 4, 4 ],  5 =&gt; [ 5, 5 ],  6 =&gt; [ 6 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">groupBy</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="function"><span class="params">i</span> =&gt;</span> i % <span class="number">2</span> === <span class="number">0</span>)) <span class="comment">// Map &#123; false =&gt; [ 1, 5, 5 ], true =&gt; [ 2, 2, 2, 4, 4, 6 ] &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="title function_">groupBy</span>(</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">    <span class="function"><span class="params">i</span> =&gt;</span> i % <span class="number">2</span> === <span class="number">0</span>,</span><br><span class="line">    <span class="function">(<span class="params">res, i</span>) =&gt;</span> res.<span class="title function_">add</span>(i),</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">Set</span>(),</span><br><span class="line">  ),</span><br><span class="line">) <span class="comment">// Map &#123; false =&gt; Set &#123; 1, 5 &#125;, true =&gt; Set &#123; 2, 4, 6 &#125; &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="arrayToMap-转换为-Map"><a href="#arrayToMap-转换为-Map" class="headerlink" title="arrayToMap: 转换为 Map"></a><code>arrayToMap</code>: 转换为 Map</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019537004">js 怎么把数组下面的对象里面的两个字段取出来组成一个新的对象，key:value 形式</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数组映射为 Map</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> k 产生 Map 元素唯一标识的函数，或者对象元素中的一个属性名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> v 产生 Map 值的函数，默认为返回数组的元素，或者对象元素中的一个属性名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 映射产生的 map 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">arrayToMap</span>(<span class="params">arr, k, v = val =&gt; val</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> kFn = k <span class="keyword">instanceof</span> <span class="title class_">Function</span> ? k : <span class="function"><span class="params">item</span> =&gt;</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(item, k)</span><br><span class="line">  <span class="keyword">const</span> vFn = v <span class="keyword">instanceof</span> <span class="title class_">Function</span> ? v : <span class="function"><span class="params">item</span> =&gt;</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(item, v)</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(</span><br><span class="line">    <span class="function">(<span class="params">res, item, index, arr</span>) =&gt;</span></span><br><span class="line">      res.<span class="title function_">set</span>(<span class="title function_">kFn</span>(item, index, arr), <span class="title function_">vFn</span>(item, index, arr)),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Map</span>(),</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> county_list = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;110101&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;东城区&#x27;</span>,</span><br><span class="line">    <span class="attr">citycode</span>: <span class="string">&#x27;110100&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;110102&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;西城区&#x27;</span>,</span><br><span class="line">    <span class="attr">citycode</span>: <span class="string">&#x27;110100&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">code</span>: <span class="string">&#x27;110103&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;崇文区&#x27;</span>,</span><br><span class="line">    <span class="attr">citycode</span>: <span class="string">&#x27;110100&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">arrayToMap</span>(county_list, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)) <span class="comment">// Map &#123; &#x27;110101&#x27; =&gt; &#x27;东城区&#x27;, &#x27;110102&#x27; =&gt; &#x27;西城区&#x27;, &#x27;110103&#x27; =&gt; &#x27;崇文区&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">arrayToMap</span>(county_list, <span class="function">(<span class="params">&#123; code &#125;</span>) =&gt;</span> code, <span class="function">(<span class="params">&#123; name &#125;</span>) =&gt;</span> name)) <span class="comment">// Map &#123; &#x27;110101&#x27; =&gt; &#x27;东城区&#x27;, &#x27;110102&#x27; =&gt; &#x27;西城区&#x27;, &#x27;110103&#x27; =&gt; &#x27;崇文区&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><p>相关问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018502694">复杂数组去重</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000000444289">JavaScript 数组中包含数组如何去重？</a></li>
</ul>
<p>以上种种操作皆是对一层数组进行操作，如果我们想对嵌套数组进行操作呢？例如上面这两个问题？其实问题是类似的，只是递归遍历数组而已。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js 的数组递归去重方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 要进行去重的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> kFn 唯一标识元素的方法，默认使用 &#123;<span class="doctag">@link</span> returnItself&#125;，只对非数组元素生效</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 进行去重操作之后得到的新的数组 (原数组并未改变)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepUniqueBy</span>(<span class="params">arr, kFn = val =&gt; val</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">res, v, i, arr</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(v)) &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(<span class="title function_">deepUniqueBy</span>(v))</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> k = <span class="title function_">kFn</span>(v, i, arr)</span><br><span class="line">    <span class="keyword">if</span> (!set.<span class="title function_">has</span>(k)) &#123;</span><br><span class="line">      set.<span class="title function_">add</span>(k)</span><br><span class="line">      res.<span class="title function_">push</span>(v)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;, [])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> testArr = [</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  <span class="number">3</span>,</span><br><span class="line">  <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, [<span class="number">5</span>, <span class="number">5</span>, [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;r&#x27;</span>]]],</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="number">4</span>,</span><br><span class="line">  [<span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">deepUniqueBy</span>(testArr)) <span class="comment">// [ 1,  3,  &#x27;hello&#x27;,  [ 3, 4, &#x27;hello&#x27;, &#x27;5&#x27;, [ 5, [Object] ] ],  &#123; key: &#x27;test&#x27; &#125;,  4,  [ 3, 0, 2 ] ]</span></span><br></pre></td></tr></table></figure>

<h2 id="反例"><a href="#反例" class="headerlink" title="反例"></a>反例</h2><p>事实上，目前 SegmentFault 上存在着大量低质量且重复的问题及回答，关于这点确实比不上 StackOverflow。下面是两个例子，可以看一下能否发现什么问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019537004">js 怎么把数组下面的对象里面的两个字段取出来组成一个新的对象，key:value 形式</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000017490985">JS 中处理 JSON 数据重复问题，取出里面 name 字段数值相同的作为一个数组；不相同的作为一个数组？</a></li>
</ul>
<p>事实上，不管是问题还是答案，都没有突出核心 – <strong>Array 映射为 Map&#x2F;Array 分组</strong>，而且这种问题和答案还层出不穷。如果对 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array">Array 的 API</a> 都没有看过一遍就来询问的话，对于帮助者来说却是太失礼了！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>JavaScript 对函数式编程支持很好，所以习惯高阶函数于我们而言是一件好事，将问题的本质抽离出来，而不是每次都局限于某个具体的问题上。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/06/22/others/rxliuliBlog/dev/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%BE%E8%BE%88%E4%B8%8D%E5%96%9C%E6%AC%A2-TypeScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/22/others/rxliuliBlog/dev/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%BE%E8%BE%88%E4%B8%8D%E5%96%9C%E6%AC%A2-TypeScript/" class="post-title-link" itemprop="url">为什么吾辈不喜欢 TypeScript</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-22 16:15:25" itemprop="dateCreated datePublished" datetime="2019-06-22T16:15:25+08:00">2019-06-22</time>
    </span>


  
    <span id="/2019/06/22/others/rxliuliBlog/dev/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%BE%E8%BE%88%E4%B8%8D%E5%96%9C%E6%AC%A2-TypeScript/" class="post-meta-item leancloud_visitors" data-flag-title="为什么吾辈不喜欢 TypeScript" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="为什么吾辈不喜欢 TypeScript" href="/2019/06/22/others/rxliuliBlog/dev/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%BE%E8%BE%88%E4%B8%8D%E5%96%9C%E6%AC%A2-TypeScript/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::8efd5e45f1d80446fa55b711e26e0bb9" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么吾辈不喜欢-TypeScript"><a href="#为什么吾辈不喜欢-TypeScript" class="headerlink" title="为什么吾辈不喜欢 TypeScript"></a>为什么吾辈不喜欢 TypeScript</h1><blockquote>
<p>注：吾辈现在很喜欢 TypeScript，所有能上 TypeScript 的项目都上了 TypeScript！</p>
</blockquote>
<h2 id="使用只是为了支持-VSCode"><a href="#使用只是为了支持-VSCode" class="headerlink" title="使用只是为了支持 VSCode"></a>使用只是为了支持 VSCode</h2><p>众所周知，VSCode 基于 TypeScript 实现的代码提示，所以很多 js 库都有写 <code>.d.ts</code> 以支持它。甚至于，该需求强烈到人们创建了一个 <a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> 项目，用以专门维护那些流行 js 库的类型。当然，本质上该项目是为了让 ts 使用者在安装 js 库之后写代码时仍然能够正确的访问类型，但 VSCode 却将之绑定了起来。</p>
<blockquote>
<p>本质上 MS 这样做的原因一方面是为了推广 TS，但同时也对库的开发人员要求更高。这其实是一件好事，因为 NPM 的生态是在太大也太糟糕了－－虚幻的繁荣！</p>
</blockquote>
<h2 id="类型系统过于复杂"><a href="#类型系统过于复杂" class="headerlink" title="类型系统过于复杂"></a>类型系统过于复杂</h2><p>想要写出来正确的类型，其实并非易事。例如常见的函数 <code>assign</code>，用于将多个对象的属性合并到一个对象上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">assign</span>(<span class="params">target, ...objects</span>) &#123;</span><br><span class="line">  objects.<span class="title function_">forEach</span>(<span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">entries</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[k, v]</span>) =&gt;</span> (target[k] = v))</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> assign&lt;T, A&gt;(<span class="attr">target</span>: T, <span class="attr">a</span>: A): T &amp; A</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> assign&lt;T, A, B&gt;(<span class="attr">target</span>: T, <span class="attr">a</span>: A, <span class="attr">b</span>: B): T &amp; A &amp; B</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> assign&lt;T, A, B, C&gt;(<span class="attr">target</span>: T, <span class="attr">a</span>: A, <span class="attr">b</span>: B, <span class="attr">c</span>: C): T &amp; A &amp; B &amp; C</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> assign&lt;T, A, B, C, D&gt;(</span><br><span class="line">  <span class="attr">target</span>: T,</span><br><span class="line">  <span class="attr">a</span>: A,</span><br><span class="line">  <span class="attr">b</span>: B,</span><br><span class="line">  <span class="attr">c</span>: C,</span><br><span class="line">  <span class="attr">d</span>: D,</span><br><span class="line">): T &amp; A &amp; B &amp; C &amp; D</span><br><span class="line"><span class="keyword">function</span> assign&lt;T&gt;(<span class="attr">target</span>: T, ...<span class="attr">objects</span>: <span class="built_in">any</span>[]): <span class="built_in">any</span> &#123;</span><br><span class="line">  objects.<span class="title function_">forEach</span>(<span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">entries</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[k, v]</span>) =&gt;</span> (target[k] = v))</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：此处的复杂性主要会在你做写基建的时候出现，如果平时只是写点业务代码，那么是无法体会到 ts 的类型复杂性的。</p>
</blockquote>
<h2 id="周边生态不是很好"><a href="#周边生态不是很好" class="headerlink" title="周边生态不是很好"></a>周边生态不是很好</h2><h3 id="API-文档工具"><a href="#API-文档工具" class="headerlink" title="API 文档工具"></a>API 文档工具</h3><p>目前 ts 领域最好的 API 文档工具 <a target="_blank" rel="noopener" href="https://typedoc.org/">TypeDoc</a> 和 js 中流行的 API 文档工具 <a target="_blank" rel="noopener" href="https://esdoc.org/">ESDoc</a> 比起来，使用体验上仍然远远不及。</p>
<p>页面对比</p>
<table>
<thead>
<tr>
<th>TypeDoc</th>
<th>ESDoc</th>
</tr>
</thead>
<tbody><tr>
<td><img src="https://img.rxliuli.com/20190918123430.png" alt="TypeDoc"></td>
<td><img src="https://img.rxliuli.com/20190918123929.png" alt="ESDoc 截图"></td>
</tr>
</tbody></table>
<blockquote>
<p>注: 著名 ts 前端库 <a target="_blank" rel="noopener" href="https://cn.rx.js.org/">rxjs</a> 的文档生成工具使用的是 ESDoc。<br>ESDoc 太过复杂的话可以考虑使用 TypeDoc + eleDoc 主题，生成的文档虽然细节之处仍有些许不足，不过已然足够使用了。</p>
</blockquote>
<h3 id="Linter-工具"><a href="#Linter-工具" class="headerlink" title="Linter 工具"></a>Linter 工具</h3><p>ts 目前最流行的 linter 工具是 <a target="_blank" rel="noopener" href="https://palantir.github.io/tslint/">tslint</a>，完全放弃 <a target="_blank" rel="noopener" href="https://eslint.org/">eslint</a> 的积累而另立门户，导致为 eslint 编写 linter 规则并不能在 tslint 中使用，所以规则数量远远少于 eslint。虽然现在也有了 <a target="_blank" rel="noopener" href="https://typescript-eslint.io/">typescript-eslint</a> 致力于让 eslint 能够检测 ts 代码，但目前该项目还远远没有成熟，距离能够在生产中使用尚有一段距离（2019 年大抵是用不上的，却是要等到明年了）。</p>
<p>完整规则列表</p>
<p><a target="_blank" rel="noopener" href="https://palantir.github.io/tslint/rules/">TSLint</a><br><a target="_blank" rel="noopener" href="https://cn.eslint.org/docs/rules/">ESLint</a></p>
<h2 id="强制要求所有的库都必须使用-ts"><a href="#强制要求所有的库都必须使用-ts" class="headerlink" title="强制要求所有的库都必须使用 ts"></a>强制要求所有的库都必须使用 ts</h2><p>在使用 ts 时，项目中如果需要引入什么包，那么这个包必须是 ts 写的，或者有 types 定义，完全放弃了分析 js 进行代码提示。</p>
<blockquote>
<p>现在稍微大型的包 DefinitelyTyped 都有定义好的 types，甚至有些库迁移到了 ts 实现（<code>vuejs, immerjs</code>），如果没有的话写一个简单的类型定义也并不困难。</p>
</blockquote>
<h2 id="仍存在一些非常讨厌的地方"><a href="#仍存在一些非常讨厌的地方" class="headerlink" title="仍存在一些非常讨厌的地方"></a>仍存在一些非常讨厌的地方</h2><h3 id="不提供-excludeTypes-选项"><a href="#不提供-excludeTypes-选项" class="headerlink" title="不提供 excludeTypes 选项"></a>不提供 <code>excludeTypes</code> 选项</h3><p>这导致项目依赖中错误包含 <code>node</code> 的 types 之后无法排除，只能选择忽略或使用 <code>types</code> 包含所有需要类型定义的库。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;typescript&quot;</span><span class="punctuation">,</span> <span class="string">&quot;jest&quot;</span><span class="punctuation">,</span> <span class="string">&quot;jest-extended&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这点没有太好的解决方案。。。</p>
</blockquote>
<h3 id="自定义-types-很麻烦"><a href="#自定义-types-很麻烦" class="headerlink" title="自定义 types 很麻烦"></a>自定义 types 很麻烦</h3><p>当遇到没有提供 types 的库时，如果在 @types 项目找不到，那么只能自己手动定义了，但如何让类型定义正确生效并不是一件简单的事情。</p>
<ul>
<li>必须在 <code>@types</code> 目录下</li>
<li>使用 <code>declare module * &#123;&#125;</code> 这种形式定义包，并且 <code>*</code> 需要与需要类型的包同名</li>
</ul>
<p>下面是一个例子</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jquery.d.ts</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;jquery&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> $ &#123;</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">selector: <span class="built_in">string</span></span>): <span class="title class_">JQueryStatic</span></span><br><span class="line">    <span class="keyword">function</span>(<span class="params">func: <span class="built_in">Function</span></span>): <span class="built_in">void</span></span><br><span class="line">    <span class="attr">ajax</span>: <span class="function">(<span class="params">config: <span class="built_in">object</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>定义 types 还好吧，本质上就是复制粘贴函数定义，然后添加类型即可</p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/06/21/others/rxliuliBlog/JavaScript/JavaScript-%E5%BC%82%E6%AD%A5%E6%95%B0%E7%BB%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/21/others/rxliuliBlog/JavaScript/JavaScript-%E5%BC%82%E6%AD%A5%E6%95%B0%E7%BB%84/" class="post-title-link" itemprop="url">JavaScript 异步数组</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-21 12:56:21" itemprop="dateCreated datePublished" datetime="2019-06-21T12:56:21+08:00">2019-06-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-07-02 00:00:00" itemprop="dateModified" datetime="2019-07-02T00:00:00+08:00">2019-07-02</time>
    </span>


  
    <span id="/2019/06/21/others/rxliuliBlog/JavaScript/JavaScript-%E5%BC%82%E6%AD%A5%E6%95%B0%E7%BB%84/" class="post-meta-item leancloud_visitors" data-flag-title="JavaScript 异步数组" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="JavaScript 异步数组" href="/2019/06/21/others/rxliuliBlog/JavaScript/JavaScript-%E5%BC%82%E6%AD%A5%E6%95%B0%E7%BB%84/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::036ef564d2665271c6be5ba74e1fba25" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JavaScript-异步数组"><a href="#JavaScript-异步数组" class="headerlink" title="JavaScript 异步数组"></a>JavaScript 异步数组</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>吾辈是一只在飞向太阳的萤火虫</p>
</blockquote>
<p>JavaScript 中的数组是一个相当泛用性的数据结构，能当数组，元组，队列，栈进行操作，更好的是 JavaScript 提供了很多原生的高阶函数，便于我们对数组整体操作。<br>然而，JavaScript 中的高阶函数仍有缺陷 – 异步！当你把它们放在一起使用时，就会感觉到这种问题的所在。</p>
<p>例如现在，有一组 id，我们要根据 id 获取到远端服务器 id 对应的值，然后将之打印出来。那么，我们要怎么做呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">wait</span> = ms =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms))</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里只是为了模拟每个请求的时间可能是不定的</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">wait</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * id * <span class="number">100</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;内容: &#x27;</span> + id.<span class="title function_">toString</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ids = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>

<p>你或许会下意识地写出下面的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ids.<span class="title function_">forEach</span>(<span class="keyword">async</span> id =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> <span class="title function_">get</span>(id)))</span><br></pre></td></tr></table></figure>

<p>事实上，控制台输出是无序的，而并非想象中的 1, 2, 3, 4 依次输出</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">内容: 2 ​​​​​</span><br><span class="line">内容: 3 ​​​​​</span><br><span class="line">内容: 1 ​​​​​</span><br><span class="line">内容: 4</span><br></pre></td></tr></table></figure>

<p>这是为什么呢？原因便是 JavaScript 中数组的高阶函数并不会等待异步函数的返回！当你在网络上搜索时，会发现很多人会说可以使用 <code>for-of</code>, <code>for-in</code> 解决这个问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> id <span class="keyword">of</span> ids) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> <span class="title function_">get</span>(id))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>或者，使用 <code>Promise.all</code> 也是一种解决方案</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  ;(<span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(ids.<span class="title function_">map</span>(get))).<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(v))</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>然而，第一种方式相当于丢弃了 Array 的所有高阶函数，再次重返远古 <code>for</code> 循环时代了。第二种则一定会执行所有的异步函数，即便你需要使用的是 <code>find/findIndex/some/every</code> 这些高阶函数。那么，有没有更好的解决方案呢？</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>既然原生的 Array 不支持完善的异步操作，那么，为什么不由我们来实现一个呢？</p>
<p>实现思路:</p>
<ol>
<li>创建异步数组类型 <code>AsyncArray</code></li>
<li>内置一个数组保存当前异步操作数组的值</li>
<li>实现数组的高阶函数并实现支持异步函数顺序执行</li>
<li>获取到内置的数组</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(args)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids).<span class="title function_">forEach</span>(<span class="keyword">async</span> id =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> <span class="title function_">get</span>(id)))</span><br></pre></td></tr></table></figure>

<p>打印结果确实有顺序了，看似一切很美好？</p>
<p>然而，当我们再实现一个 <code>map</code> 试一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(args)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(<span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids).<span class="title function_">map</span>(get).<span class="title function_">forEach</span>(<span class="keyword">async</span> res =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line"><span class="comment">// 抛出错误</span></span><br><span class="line"><span class="comment">// (intermediate value).map(...).forEach is not a function</span></span><br></pre></td></tr></table></figure>

<p>然而会有问题，实际上 <code>map</code> 返回的是 <code>Promise</code>，所以我们还必须使用 <code>await</code> 进行等待</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  ;(<span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids).<span class="title function_">map</span>(get)).<span class="title function_">forEach</span>(<span class="keyword">async</span> res =&gt;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res),</span><br><span class="line">  )</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>是不是感觉超级蠢？吾辈也是这样认为的！</p>
<h2 id="链式调用加延迟执行"><a href="#链式调用加延迟执行" class="headerlink" title="链式调用加延迟执行"></a>链式调用加延迟执行</h2><p>我们可以尝试使用链式调用加延迟执行修改这个 <code>AsyncArray</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存高阶函数传入的异步操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Action</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">type, args</span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 异步操作的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">string</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 异步操作的参数数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Function</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">args</span> = args</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有的操作类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Action</span>.<span class="property">Type</span> = &#123;</span><br><span class="line">  <span class="attr">forEach</span>: <span class="string">&#x27;forEach&#x27;</span>,</span><br><span class="line">  <span class="attr">map</span>: <span class="string">&#x27;map&#x27;</span>,</span><br><span class="line">  <span class="attr">filter</span>: <span class="string">&#x27;filter&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 真正实现的异步数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InnerAsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = arr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(<span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = res</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>)) &#123;</span><br><span class="line">        res.<span class="title function_">push</span>(arr[i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = res</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(args)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 保存异步任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Action[]</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Action</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">forEach</span>, [fn]))</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Action</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">map</span>, [fn]))</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Action</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">filter</span>, [fn]))</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 终结整个链式操作并返回结果</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">value</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      result = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  .<span class="title function_">filter</span>(<span class="keyword">async</span> i =&gt; i % <span class="number">2</span> === <span class="number">0</span>)</span><br><span class="line">  .<span class="title function_">map</span>(get)</span><br><span class="line">  .<span class="title function_">forEach</span>(<span class="keyword">async</span> res =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line">  .<span class="title function_">value</span>()</span><br></pre></td></tr></table></figure>

<p>可以看到，确实符合预期了，然而每次都要调用 <code>value()</code>，终归有些麻烦。</p>
<h2 id="使用-then-以支持-await-自动结束"><a href="#使用-then-以支持-await-自动结束" class="headerlink" title="使用 then 以支持 await 自动结束"></a>使用 then 以支持 await 自动结束</h2><p>这里使用 <code>then()</code> 替代它以使得可以使用 <code>await</code> <strong>自动</strong>计算结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="comment">// 上面的其他内容...</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 终结整个链式操作并返回结果</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      result = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里使用 resolve(result) 是为了兼容 await 的调用方式</span></span><br><span class="line">    <span class="title function_">resolve</span>(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，可以使用 <code>await</code> 结束这次链式调用了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids).<span class="title function_">map</span>(get).<span class="title function_">forEach</span>(<span class="keyword">async</span> res =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br></pre></td></tr></table></figure>

<p>突然之间，我们发现了一个问题，为什么会这么慢？一个个去进行异步操作太慢了，难道就不能一次性全部发送出去，然后有序的处理结果就好了嘛？</p>
<h2 id="并发异步操作"><a href="#并发异步操作" class="headerlink" title="并发异步操作"></a>并发异步操作</h2><p>我们可以使用 <code>Promise.all</code> 并发执行异步操作，然后对它们的结果进行有序地处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 并发实现的异步数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InnerAsyncArrayParallel</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = arr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">_all</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>.<span class="title function_">map</span>(fn))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">_all</span>(fn)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">_all</span>(fn)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">_all</span>(fn)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="variable language_">this</span>.<span class="property">_arr</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> arr[i])</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后修改 <code>AsyncArray</code>，使用 <code>_AsyncArrayParallel</code> 即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="comment">// 上面的其他内容...</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 终结整个链式操作并返回结果</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="keyword">new</span> <span class="title class_">InnerAsyncArrayParallel</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      result = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里使用 resolve(result) 是为了兼容 await 的调用方式</span></span><br><span class="line">    <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用方式不变。当然，由于使用 <code>Promise.all</code> 实现，也同样受到它的限制 – 异步操作实际上全部执行了。</p>
<h2 id="串行-x2F-并行相互转换"><a href="#串行-x2F-并行相互转换" class="headerlink" title="串行&#x2F;并行相互转换"></a>串行&#x2F;并行相互转换</h2><p>现在我们的 <code>_AsyncArray</code> 和 <code>_AsyncArrayParallel</code> 两个类只能二选一，所以，我们需要添加两个函数用于互相转换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(args)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 保存异步任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">AsyncArrayAction[]</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否并行化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 其他内容...</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">parallel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">serial</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">      ? <span class="keyword">new</span> <span class="title class_">InnerAsyncArrayParallel</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">      : <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      result = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们可以在真正执行之前在任意位置对其进行转换了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  .<span class="title function_">parallel</span>()</span><br><span class="line">  .<span class="title function_">filter</span>(<span class="keyword">async</span> i =&gt; i % <span class="number">2</span> === <span class="number">0</span>)</span><br><span class="line">  .<span class="title function_">map</span>(get)</span><br><span class="line">  .<span class="title function_">forEach</span>(<span class="keyword">async</span> res =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br></pre></td></tr></table></figure>

<h2 id="并发执行多个异步操作"><a href="#并发执行多个异步操作" class="headerlink" title="并发执行多个异步操作"></a>并发执行多个异步操作</h2><p>然而，上面的代码有一些隐藏的问题</p>
<ol>
<li><p><code>await</code> 之后返回值不是一个数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray.<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i * <span class="number">2</span>)) <span class="comment">// InnerAsyncArray &#123; _arr: [ 2, 4, 6, 8 ] &#125;</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
</li>
<li><p>上面的 <code>map</code>, <code>filter</code> 调用在 <code>await</code> 之后仍会影响到下面的调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray.<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i * <span class="number">2</span>)) <span class="comment">// InnerAsyncArray &#123; _arr: [ 2, 4, 6, 8 ] &#125;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// InnerAsyncArray &#123; _arr: [ 2, 4, 6, 8 ] &#125;</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
</li>
<li><p>并发调用的顺序不能确定，会影响到内部数组，导致结果不能确定</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  ;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">      <span class="keyword">await</span> asyncArray.<span class="title function_">filter</span>(<span class="keyword">async</span> i =&gt; i % <span class="number">2</span> === <span class="number">1</span>).<span class="title function_">map</span>(<span class="keyword">async</span> i =&gt; i * <span class="number">2</span>),</span><br><span class="line">    ) <span class="comment">// InnerAsyncArray &#123; _arr: [ 2, 6 ] &#125;</span></span><br><span class="line">  &#125;)()</span><br><span class="line">  ;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// InnerAsyncArray &#123; _arr: [ 2, 6 ] &#125;</span></span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>先解决第一个问题，这里只需要判断一下是否为终结操作（<code>forEach</code>），是的话就直接返回结果，否则继续下一次循环</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="comment">// 其他内容...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">      ? <span class="keyword">new</span> <span class="title class_">InnerAsyncArrayParallel</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">      : <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArray</span> ||</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArrayParallel</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        result = temp.<span class="property">_arr</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果已经是终结操作就返回数组的值</span></span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(temp)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，第一个问题简单解决</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray.<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i * <span class="number">2</span>)) <span class="comment">// [ 2, 4, 6, 8 ]</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>第二、第三个问题看起来似乎是同一个问题？其实我们可以按照常规思维解决第一个问题。既然 <code>await</code> 之后仍然会影响到下面的调用，那就在 <code>then</code> 中把 <code>_task</code> 清空好了，修改 <code>then</code> 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="comment">// 其他内容...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">      ? <span class="keyword">new</span> <span class="title class_">InnerAsyncArrayParallel</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">      : <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArray</span> ||</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArrayParallel</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        result = temp.<span class="property">_arr</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果已经是终结操作就返回数组的值</span></span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(temp)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，第一个问题解决了，但第二个问题不会解决。究其原因，还是异步事件队列的问题，虽然 <code>async-await</code> 能够让我们以同步的方式写异步的代码，但千万不可忘记它们本质上还是<strong>异步</strong>的！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="keyword">await</span> asyncArray.<span class="title function_">filter</span>(<span class="keyword">async</span> i =&gt; i % <span class="number">2</span> === <span class="number">1</span>).<span class="title function_">map</span>(<span class="keyword">async</span> i =&gt; i * <span class="number">2</span>),</span><br><span class="line">      ) <span class="comment">// [ 2, 6 ]</span></span><br><span class="line">    &#125;)(),</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 2, 6 ]</span></span><br><span class="line">    &#125;)(),</span><br><span class="line">  ])</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 1, 2, 3, 4 ]</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>可以看到，在使用 <code>await</code> 进行等待之后就如同预期的 <code>_task</code> 被清空了。然而，并发执行的没有等待的 <code>await asyncArray</code> 却有奇怪的问题，因为它是在 <code>_task</code> 清空之前执行的。</p>
<p>并且，这带来一个副作用: 无法缓存操作了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids).<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i * <span class="number">2</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 2, 4, 6, 8 ]</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 1, 2, 3, 4 ]</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h2 id="使用不可变数据"><a href="#使用不可变数据" class="headerlink" title="使用不可变数据"></a>使用不可变数据</h2><p>为了解决直接修改内部数组造成的问题，我们可以使用不可变数据解决这个问题。试想：如果我们每次操作都返回一个新的 <code>AsyncArray</code>，他们之间没有关联，这样又如何呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(args)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 保存异步任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Action[]</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否并行化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_addTask</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">forEach</span>, [fn])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_addTask</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">map</span>, [fn])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_addTask</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">filter</span>, [fn])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">parallel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">serial</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_addTask</span>(<span class="params">type, args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    result.<span class="property">_task</span> = [...<span class="variable language_">this</span>.<span class="property">_task</span>, <span class="keyword">new</span> <span class="title class_">Action</span>(type, args)]</span><br><span class="line">    result.<span class="property">_parallel</span> = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 终结整个链式操作并返回结果</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">      ? <span class="keyword">new</span> <span class="title class_">InnerAsyncArrayParallel</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">      : <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArray</span> ||</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArrayParallel</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        result = temp.<span class="property">_arr</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果已经是终结操作就返回数组的值</span></span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(temp)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次测试上面的那第三个问题，发现已经一切正常了呢</p>
<ul>
<li>并发调用的顺序不能确定，但不会影响内部数组了，结果是确定的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids)</span><br><span class="line">  <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="keyword">await</span> asyncArray.<span class="title function_">filter</span>(<span class="keyword">async</span> i =&gt; i % <span class="number">2</span> === <span class="number">1</span>).<span class="title function_">map</span>(<span class="keyword">async</span> i =&gt; i * <span class="number">2</span>),</span><br><span class="line">      ) <span class="comment">// [ 2, 6 ]</span></span><br><span class="line">    &#125;)(),</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 1, 2, 3, 4 ]</span></span><br><span class="line">    &#125;)(),</span><br><span class="line">  ])</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 1, 2, 3, 4 ]</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<ul>
<li>操作可以被缓存</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> asyncArray = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...ids).<span class="title function_">map</span>(<span class="function"><span class="params">i</span> =&gt;</span> i * <span class="number">2</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 2, 4, 6, 8 ]</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> asyncArray) <span class="comment">// [ 2, 4, 6, 8 ]</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>下面吾辈把完整的代码贴出来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存高阶函数传入的异步操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Action</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">type, args</span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 异步操作的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">string</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 异步操作的参数数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Function</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">args</span> = args</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 所有的操作类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Action</span>.<span class="property">Type</span> = &#123;</span><br><span class="line">  <span class="attr">forEach</span>: <span class="string">&#x27;forEach&#x27;</span>,</span><br><span class="line">  <span class="attr">map</span>: <span class="string">&#x27;map&#x27;</span>,</span><br><span class="line">  <span class="attr">filter</span>: <span class="string">&#x27;filter&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 真正实现的异步数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InnerAsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = arr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(<span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = res</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">const</span> res = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">await</span> <span class="title function_">fn</span>(arr[i], i, <span class="variable language_">this</span>)) &#123;</span><br><span class="line">        res.<span class="title function_">push</span>(arr[i])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = res</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InnerAsyncArrayParallel</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = arr</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">_all</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>.<span class="title function_">map</span>(fn))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">_all</span>(fn)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">_all</span>(fn)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">_all</span>(fn)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="variable language_">this</span>.<span class="property">_arr</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> arr[i])</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncArray</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_arr</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(args)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@field</span> 保存异步任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Action[]</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_task</span> = []</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否并行化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">forEach</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_addTask</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">forEach</span>, [fn])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">map</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_addTask</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">map</span>, [fn])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">filter</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">_addTask</span>(<span class="title class_">Action</span>.<span class="property">Type</span>.<span class="property">filter</span>, [fn])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">parallel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">serial</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_parallel</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_addTask</span>(<span class="params">type, args</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">new</span> <span class="title class_">AsyncArray</span>(...<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    result.<span class="property">_task</span> = [...<span class="variable language_">this</span>.<span class="property">_task</span>, <span class="keyword">new</span> <span class="title class_">Action</span>(type, args)]</span><br><span class="line">    result.<span class="property">_parallel</span> = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 终结整个链式操作并返回结果</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">then</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">_parallel</span></span><br><span class="line">      ? <span class="keyword">new</span> <span class="title class_">InnerAsyncArrayParallel</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">      : <span class="keyword">new</span> <span class="title class_">InnerAsyncArray</span>(<span class="variable language_">this</span>.<span class="property">_arr</span>)</span><br><span class="line">    <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="property">_arr</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> task <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">_task</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = <span class="keyword">await</span> arr[task.<span class="property">type</span>](...task.<span class="property">args</span>)</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArray</span> ||</span><br><span class="line">        temp <span class="keyword">instanceof</span> <span class="title class_">InnerAsyncArrayParallel</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        result = temp.<span class="property">_arr</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果已经是终结操作就返回数组的值</span></span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(temp)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>那么，关于 JavaScript 中如何封装一个可以使用异步操作高阶函数的数组就先到这里了，完整的 JavaScript 异步数组请参考吾辈的 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/rx-util/blob/master/src/module/array/AsyncArray.ts">AsyncArray</a>（使用 TypeScript 编写）。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/17/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/19/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ftq</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:55</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"6NuBzi5VSiFfQE2sYbymtv9t-gzGzoHsz","app_key":"stH9SzRt55d1wnwQD7LcoaQR","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyw21b1ST","appkey":"045a89927c13c0e33a82c736b468fe51"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
