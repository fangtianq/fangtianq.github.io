<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fangtianq.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"changyan","storage":false,"lazyload":false,"nav":null,"activeClass":"changyan"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="有志者事竟成">
<meta property="og:type" content="website">
<meta property="og:title" content="越努力，越幸运！">
<meta property="og:url" content="https://fangtianq.github.io/page/16/index.html">
<meta property="og:site_name" content="越努力，越幸运！">
<meta property="og:description" content="有志者事竟成">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ftq">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fangtianq.github.io/page/16/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/16/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>越努力，越幸运！</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">越努力，越幸运！</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Where there is a will, there is a way!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">56</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">21</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">314</span></a></li><li class="menu-item menu-item-留言版"><a href="/guestbook/" rel="section"><i class="comments fa-fw"></i>留言版</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-friendlink"><a href="/friendlink/" rel="section"><i class="link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ftq"
      src="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
  <p class="site-author-name" itemprop="name">ftq</p>
  <div class="site-description" itemprop="description">有志者事竟成</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">314</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fangtianq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/fangtianq" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.github.io/" title="GitHub.io → https:&#x2F;&#x2F;fangtianq.github.io&#x2F;"><i class="github fa-fw"></i>GitHub.io</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.gitee.io/" title="Gitee.io → https:&#x2F;&#x2F;fangtianq.gitee.io&#x2F;" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee.io</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://leetcode-cn.com/" title="https:&#x2F;&#x2F;leetcode-cn.com&#x2F;" rel="noopener" target="_blank">力扣网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://rap2.taobao.org/" title="http:&#x2F;&#x2F;rap2.taobao.org&#x2F;" rel="noopener" target="_blank">RAP2接口管理平台</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">TypeScript 函数根据第一个参数推导后面参数的类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-02 18:53:44" itemprop="dateCreated datePublished" datetime="2020-04-02T18:53:44+08:00">2020-04-02</time>
    </span>


  
    <span id="/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="TypeScript 函数根据第一个参数推导后面参数的类型" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="TypeScript 函数根据第一个参数推导后面参数的类型" href="/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::3c6847842e9b43b2a314cf601480b251" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在编写一个重载函数时，吾辈发现了 ts 的方法签名问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">TypeEnum</span> &#123;</span><br><span class="line">  A,</span><br><span class="line">  B,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//region 普通参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.A, obj: A</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.B, obj: B</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"><span class="keyword">type</span>: TypeEnum, obj: A | B</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<p>上面是一个简单的重载函数，吾辈希望在输入第一个参数 <code>type</code> 之后，ts 就能匹配到正确的参数，然而事实上，ts 并没能完全做到。</p>
<p><img src="https://img.rxliuli.com/20200402140820.png" alt="ts 类型提示"></p>
<p>当然，如果真的这样写 ts 的类型检查仍然能正确地抛出错误消息，然而未能推导终究是有点问题的。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2769: No overload matches this call.   Overload 1 of 2, &#x27;(type: TypeEnum.A, obj: A): void&#x27;, gave the following error.     Argument of type &#x27;&#123; a: string; b: number; &#125;&#x27; is not assignable to parameter of type &#x27;A&#x27;.       Object literal may only specify known properties, and &#x27;b&#x27; does not exist in type &#x27;A&#x27;.   Overload 2 of 2, &#x27;(type: TypeEnum.B, obj: B): void&#x27;, gave the following error.     Argument of type &#x27;TypeEnum.A&#x27; is not assignable to parameter of type &#x27;TypeEnum.B&#x27;</span></span><br><span class="line"><span class="title function_">fn1</span>(<span class="title class_">TypeEnum</span>.<span class="property">A</span>, &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后，吾辈想到了几种方式可以尝试解决。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>尝试使用继承限制字段的类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 对象参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params">arg: &#123; <span class="keyword">type</span>: TypeEnum.A; obj: A &#125;</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params">arg: &#123; <span class="keyword">type</span>: TypeEnum.B; obj: B &#125;</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params">arg: &#123; <span class="keyword">type</span>: TypeEnum; obj: A | B &#125;</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn2</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">TypeEnum</span>.<span class="property">A</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<p>很遗憾的是，这是行不通的，即便是下面的这种变体，仍然是不可行的。</p>
<p><img src="https://img.rxliuli.com/20200402145908.png" alt="继承"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Base</span>&lt;T <span class="keyword">extends</span> <span class="title class_">TypeEnum</span>&gt; &#123;</span><br><span class="line">  <span class="attr">type</span>: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IA <span class="keyword">extends</span> <span class="title class_">Base</span>&lt;<span class="title class_">TypeEnum</span>.A&gt; &#123;</span><br><span class="line">  <span class="attr">obj</span>: A</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> IB <span class="keyword">extends</span> <span class="title class_">Base</span>&lt;<span class="title class_">TypeEnum</span>.B&gt; &#123;</span><br><span class="line">  <span class="attr">obj</span>: B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params">arg: IA | IB</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>事实上，使用泛型确实可以做到让 ts 的类型更加 <strong>正确</strong>。</p>
<p><img src="https://img.rxliuli.com/20200402145745.png" alt="泛型"></p>
<p>缺点：</p>
<ul>
<li>不能使用 ts 的重载</li>
<li>需要函数的作者改变思维</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 泛型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EnumTypeMapGen</span>&lt;T <span class="keyword">extends</span> <span class="built_in">string</span>[], M <span class="keyword">extends</span> &#123; [P <span class="keyword">in</span> <span class="title class_">TypeEnum</span>]: <span class="built_in">any</span> &#125;&gt; = []</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TypeMap</span> = &#123;</span><br><span class="line">  [<span class="title class_">TypeEnum</span>.<span class="property">A</span>]: A</span><br><span class="line">  [<span class="title class_">TypeEnum</span>.<span class="property">B</span>]: B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> fn3&lt;T <span class="keyword">extends</span> <span class="title class_">TypeEnum</span>, <span class="title class_">Arg</span> <span class="keyword">extends</span> <span class="title class_">TypeMap</span>[T]&gt;(<span class="attr">type</span>: T, <span class="attr">obj</span>: <span class="title class_">Arg</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn3</span>(<span class="title class_">TypeEnum</span>.<span class="property">A</span>, &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>最后，高阶函数可以简单的解决这个问题，它将一次调用更改为两次调用，第一次调用返回的函数便已经确认了类型。</p>
<p><img src="https://img.rxliuli.com/20200402145633.png" alt="高阶函数"></p>
<p>缺点：</p>
<ul>
<li>需要使用者接收这种 <strong>函数式</strong> 的调用方式</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 高阶函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.A</span>): <span class="function">(<span class="params">obj: A</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params"><span class="keyword">type</span>: TypeEnum.B</span>): <span class="function">(<span class="params">obj: B</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params"><span class="keyword">type</span>: TypeEnum</span>): <span class="built_in">any</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn4</span>(<span class="title class_">TypeEnum</span>.<span class="property">A</span>)(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的而言，泛型和高阶函数都能解决这个问题，吾辈个人倾向于泛型，因为它并未改变调用者的使用方式，而是让作者去改变，避免改变函数的接口本身。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">liuli-cli: TS/JS SDK CLI 工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-23 15:51:06" itemprop="dateCreated datePublished" datetime="2020-02-23T15:51:06+08:00">2020-02-23</time>
    </span>


  
    <span id="/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/" class="post-meta-item leancloud_visitors" data-flag-title="liuli-cli: TS/JS SDK CLI 工具" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="liuli-cli: TS/JS SDK CLI 工具" href="/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::a5dcb0f9e8934b84712503c8c4cd4219" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>吾辈最初尝试写 JS SDK 发布到 NPM 上，过程中遇到了很多问题，也因此消耗了大量的时间。<br>包括但不限于以下这些</p>
<ul>
<li>折腾 Rollup 打包</li>
<li>折腾 JS 的模块（umd&#x2F;esm）</li>
<li>折腾单元测试</li>
<li>折腾 ES6 怎么通过 Babel 编译</li>
<li>使用 JS 编写，没有提供类型定义</li>
<li>没有进行打包</li>
<li>没有编译成 ES5</li>
<li>没有单元测试</li>
<li>没有 API 文档</li>
<li>没有 Linter 和 Prettier 统一格式化</li>
</ul>
<blockquote>
<p>具体的过程可以参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/c30dd206/">使用 rollup 打包 JavaScript SDK</a></p>
</blockquote>
<p>吾辈在过程中遇到的一些问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018386874/">使用 Rollup + Babel 打包出错</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018914964">npm 发布后的包安装后无法引用？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019587945">为什么上传到 GitHub Pages 的静态资源会 404 了呢？有人遇到过么？</a></li>
</ul>
<p>吾辈目前所在的公司中的 NPM 库也存在这些问题，内部的 npm 库几乎不能称为一个合格的库，以上的问题基本都存在。所以为了重构公司的 npm 包（主要是为了提供类型定义），就想是否能够把这部分单独抽离成一个脚手架，因而便开发了 SDK cli 供公司的前端 dev 创建一个标准（包含打包、编译、测试、文档、发布）的 SDK，并希望以此抹平不同 NPM 库配置的不一致性。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>所以吾辈后来创造了 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/liuli-cli">liuli-cli</a>，用于简化和统一创建 JS&#x2F;TS SDK 的步骤。</p>
<p>目前实现的功能如下</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 基本打包支持</li>
<li><input checked="" disabled="" type="checkbox"> 模块化 umd&#x2F;es</li>
<li><input checked="" disabled="" type="checkbox"> jest 单元测试支持</li>
<li><input checked="" disabled="" type="checkbox"> 代码压缩支持</li>
<li><input checked="" disabled="" type="checkbox"> babel 支持</li>
<li><input checked="" disabled="" type="checkbox"> ts 支持</li>
<li><input checked="" disabled="" type="checkbox"> linter 支持</li>
<li><input checked="" disabled="" type="checkbox"> prettier 格式化支持</li>
<li><input checked="" disabled="" type="checkbox"> git 钩子支持</li>
<li><input checked="" disabled="" type="checkbox"> esdoc</li>
<li><input checked="" disabled="" type="checkbox"> typedoc</li>
<li><input checked="" disabled="" type="checkbox"> 许可证选择支持</li>
</ul>
<p>使用的话也很简单</p>
<p>全局安装 liuli-cli</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g liuli-cli</span><br></pre></td></tr></table></figure>

<p>然后便可以使用命令 <code>li</code> 创建项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">li create &lt;project-name&gt;</span><br></pre></td></tr></table></figure>

<p>目前支持以下三种类型（强烈推荐库的作者使用 TypeScript）</p>
<ul>
<li><code>JavaScript 模板</code></li>
<li><code>TypeScript 模板</code></li>
<li><code>命令行工具模板</code></li>
</ul>
<p>之后根据引导即可创建一个开箱即用的项目了</p>
<h2 id="反例"><a href="#反例" class="headerlink" title="反例"></a>反例</h2><p>让我们看看那些大公司云服务的 JS SDK 是怎样的。</p>
<p>腾讯：提供的 SDK 大多是一个 JS 文件，需要在项目里手动引入，甚至有些是依赖了开源依赖，导致开源依赖使用 npm 管理，而私有服务的 SDK 仍然使用 JS 的方式引入。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436">对象存储</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/266">腾讯云点播</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/269">即时通信 IM</a></li>
</ul>
<p>讯飞：web 版 demo 明明有 package.json 这种版本控制工具，但却仍然是在一个 HTML 里直接 script 脚本引入，而非使用 npm&#x2F;yarn 进行依赖管理，而 package.json 里面只是一个 http-server 用以开启一个静态服务器看 demo 罢了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/voicedictation/API.html">语音听写</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/lfasr/API.html">语音转写</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/rtasr/API.html">实时语音转写</a></li>
</ul>
<p>或许在大公司的这些 SDK 的开发者看来，会使用他们这些服务的公司都是小公司，以及一些没有接触过现代前端的开发者，所以都以这种方式提供 SDK。更不要说文档与类型定义，这两项几乎是 JS SDK 标准的需求，他们都没有做好。而且，明明他们的 SDK 也有版本号，甚至给出的 JS SDK 本身便是 umd 的，但实际上却未发布在 npm 或是其他公开的仓库中（作为库的使用者吾辈没有找到）。这些开发者宁愿用户提工单询问，并浪费了大量的沟通时间解决问题也不愿意最开始就将这些做的好一点。</p>
<blockquote>
<p>Pass1：文档可能过时，但 Demo 一定是最新的。<br>Pass2：这行代码不知道做什么的，但没有了就会出错，先放在这里。</p>
</blockquote>
<p>当然，或许创建第三方组织可以解决部分这个问题，像是 <a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> 那个 ts 的开源项目一样，但问题仍然很多</p>
<ol>
<li>目标对象不同：DefinitelyTyped 的目标是为了没有 types 的 js 库定义类型，它的目标对象也是开源（大多数时候也是）免费的库。而像是腾讯这些内部服务的 SDK 是收费、不开源的，很难让人免费为其做贡献。</li>
<li>各家都有类似的云服务：提供这种云服务的公司并不止一家，难道要为每一家都添加创建类似的组织么？</li>
<li>安全性问题：第三方组织不能保证每一行贡献的内容一定就和官方的一模一样，就算引入了恶意代码也很难立刻发现。</li>
<li>法律风险：这样做的话是否会被官方发律师函也是未知之数。</li>
</ol>
<p>当然，也有一些个人为某些云服务创建的 NPM 库</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/xunfeisdk">https://www.npmjs.com/package/xunfeisdk</a></li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/xfy-node">https://www.npmjs.com/package/xfy-node</a></li>
</ul>
<p>但更多的服务是没有的，而且个人创建的这些库很难保证一直不过时（大多数都是某个项目用了一下罢了）。如果能简化项目的初始化流程，不知是否能让官方发布到 NPM 组织下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>关于使用 CLI 会阻碍人接触更<strong>底层</strong>的知识这点，属于仁者见仁智者见智的事情。毕竟，CLI 能够简化重复的劳动自然是会受到欢迎，前端三大框架也都有自己的 CLI 用于快速创建项目，降低框架的使用门槛，避免接触到一些琐碎的细节而专注于自己的需求开发。</p>
<blockquote>
<p>webpack&#x2F;babel 真的不能说底层，尤其是 webpack，复杂性太高、知识的时效性太短导致现在它的风评并不好。。。</p>
</blockquote>
<p>最后，这个项目才写出来没多久，欢迎任何人使用、批评和建议！</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/02/01/others/rxliuliBlog/JavaScript/%E9%9D%A2%E7%9B%B8-vue-%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84-react-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/01/others/rxliuliBlog/JavaScript/%E9%9D%A2%E7%9B%B8-vue-%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84-react-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">面相 vue 开发者的 react 入坑指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-02 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-02T00:00:00+08:00">2020-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-03-14 00:00:00" itemprop="dateModified" datetime="2020-03-14T00:00:00+08:00">2020-03-14</time>
    </span>


  
    <span id="/2020/02/01/others/rxliuliBlog/JavaScript/%E9%9D%A2%E7%9B%B8-vue-%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84-react-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/" class="post-meta-item leancloud_visitors" data-flag-title="面相 vue 开发者的 react 入坑指南" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="面相 vue 开发者的 react 入坑指南" href="/2020/02/01/others/rxliuliBlog/JavaScript/%E9%9D%A2%E7%9B%B8-vue-%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84-react-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8D%97/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::626a653d67595b7459011220dbd00587" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><ul>
<li>问：为什么吾辈要使用 React？</li>
<li>答：React 拥有更加庞大的生态，以及对 TypeScript 的更好支持。<br>前者让需求实现变得更加简单，例如目前使用 Vue 做的后台管理系统使用了 Ant Design Vue 这个 UI 库，而它的上游 Ant Design 实际上官方维护的是 React 版本，而 Vue 并不是 <strong>亲儿子</strong>，导致一些问题并不像官方那么快解决。<br>后者强大的类型系统能降低维护成本，虽然开发时代码添加类型会稍加工作量，但可以降低维护成本，便于后续的修改、重构，同时 IDE 对其支持是 JavaScript 无法相提并论的。</li>
<li>问：那 React 相比于 Vue 而言有什么区别？</li>
<li>答：更强大、复杂、酷，对于没有现代前端开发经验的人而言可能非常困难，但一旦熟悉，则会非常喜欢它。组件化（<code>React Component/JSX</code>）、函数式（<code>React Hooks</code>）、不可变（<code>immutable</code>）都是非常有趣的思想，理解之后确实都能发现具体使用场景。<blockquote>
<p>Vue 作者说 <strong>React + Mobx 就是更复杂的 Vue</strong>，这句话确实有道理，下面在 <a href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86">状态管理</a> 那里也进行了说明，但同时，相比于 <code>Vue + Vuex</code>，避免引入 Redux 的 <code>React + Mobx</code> 将是更简单的。</p>
</blockquote>
</li>
<li>问：有大公司在用么？</li>
<li>答：作为能够支撑 Facebook 这种级别公司的 Web 产品的基础，显然它拥有相当多的生产环境实践。</li>
</ul>
<h2 id="工程与周边生态"><a href="#工程与周边生态" class="headerlink" title="工程与周边生态"></a>工程与周边生态</h2><p>以下皆基于 <code>cra(create-react-app)</code> 创建的 <code>ts + react + mobx + react-router + immer</code> 技术栈进行说明，虽然完全不了解以上内容亦可，但最好了解一下它们是做什么的，下面第一次提及时也会简单说明一下。</p>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>使用 create-react-app 创建 react 项目，但和 vue-cli 有一点明显区别：不提供很多配置，只是简单的项目生成。</p>
<h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><p>此处使用 mobx 对标，mobx 是一个状态管理库，以响应式、可变、简单方便为最大卖点。本质上可以认为为每个页面（页面内的所有组件）提供了一个全局对象，并实现了 vue 中的 <code>computed</code> 和 <code>watch</code>，所以 vue 的作者说 vue 是更简单的 react + mobx 确实有些道理，实际上这两个加起来能做到的事情不比原生 vue 多多少。</p>
<p>但它们之间也有几点不同</p>
<ul>
<li>vue 基于组件级别实现的 <code>computed</code> 和 <code>watch</code>，而 mobx 则是全局的</li>
<li>vue 是基于组件级别自动初始化和销毁，而 mobx 则是手动的</li>
<li>vue 基于组件但也受限于组件级别，全局状态仍要使用 vuex 这种 <strong>大炮</strong>，而 mobx 此时则是统一的</li>
<li>不使用 vuex 的情况下一些组件很难进行拆分，因为拆分后各组件的一些数据仍然需要共享和修改，这种时候单用 vue 的 <code>data/props</code> 就显得有些力不从心</li>
</ul>
<p>是否需要支持 es5？</p>
<ul>
<li>是：高阶函数</li>
<li>否：装饰器</li>
</ul>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><ul>
<li>递归菜单栏</li>
<li>使用高阶组件包装路由组件 <code>withRouter()</code></li>
<li>获取当前路由信息：<code>this.props.match</code></li>
<li>使用编程式的路由导航：<code>this.props.history</code><ul>
<li>注意 props 的类型变化</li>
</ul>
</li>
</ul>
<p>异步组件和 vue 稍微有点差别，虽然也是需要 <code>import()</code> 语法，但却需要使用高阶组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AsyncRoute</span>(<span class="params"></span></span><br><span class="line"><span class="params">  importComponent: () =&gt; PromiseLike&lt;&#123; <span class="keyword">default</span>: any &#125;&gt; | &#123; <span class="keyword">default</span>: any &#125;,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">AsyncComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;any, any&gt; &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props: any</span>) &#123;</span><br><span class="line">      <span class="variable language_">super</span>(props)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        <span class="attr">component</span>: <span class="literal">null</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">default</span>: component &#125; = <span class="keyword">await</span> <span class="title function_">importComponent</span>()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">component</span>: component,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> C = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">component</span></span><br><span class="line">      <span class="keyword">return</span> C ? <span class="language-xml"><span class="tag">&lt;<span class="name">C</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span> : <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">AsyncComponent</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">AsyncRoute</span></span><br></pre></td></tr></table></figure>

<p>然后使用高阶组件包装即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Route</span></span><br><span class="line">  path=&#123;<span class="string">&#x27;/system/task&#x27;</span>&#125;</span><br><span class="line">  component=&#123;<span class="title class_">AsyncRoute</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;../../index/HelloWorld&#x27;</span>))&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：高阶组件和高阶函数类似，指的是接收一个组件&#x2F;返回一个组件的组件。</p>
</blockquote>
<h3 id="代码组织"><a href="#代码组织" class="headerlink" title="代码组织"></a>代码组织</h3><ul>
<li>导出：tsx&#x2F;jsx 使用默认导出，避免需要高阶函数包装的场景</li>
<li>优先使用函数式组件</li>
<li>src<ul>
<li>pages：页面级的组件<ul>
<li>component：页面级组件</li>
</ul>
</li>
<li>components：非页面相关的通用组件</li>
<li>assets：静态资源</li>
</ul>
</li>
</ul>
<h3 id="命名规范"><a href="#命名规范" class="headerlink" title="命名规范"></a>命名规范</h3><ul>
<li>React<ul>
<li>组件：必须使用大写驼峰，包括使用组件亦然</li>
<li>store<ul>
<li>必须使用 .store 后缀以区分普通 ts 文件</li>
<li>组件级 store 必须与组件名保持一致，例如 <code>Login</code> 组件对应的即为 <code>Login.store.ts</code></li>
</ul>
</li>
</ul>
</li>
<li>CSS<ul>
<li>css 中的 class 必须使用小写驼峰命名法，避免 css module 找不到（cra 不会自动处理转换）</li>
<li>优先使用 <code>.module.css</code> 而非 <code>.css</code>，避免全局样式污染</li>
<li>页面级 css 必须与组件名保持一致，例如 <code>Login</code> 组件对应的即为 <code>Login.module.css</code></li>
<li>非 css module 的代码必须使用 <code>&quot;&quot;</code> 而非 <code>&#123;&#39;&#39;&#125;</code></li>
</ul>
</li>
</ul>
<h3 id="修改默认配置"><a href="#修改默认配置" class="headerlink" title="修改默认配置"></a>修改默认配置</h3><p>cra 默认提供了脚本命令 <code>reject</code>，用于将 cra 封装的配置全部解压出来 – 当然，此操作是不可逆的！但除了这种破坏性的方式之外，也有人找到了和 vue-cli 中类似的方式，不过需要第三方包 <code>react-app-rewired</code> 的支持。</p>
<p>并在根目录添加配置文件 <code>config-overrides.js</code>，里面暴露出一个函数，即可修改 cra 的默认配置了。</p>
<p>下面是一个简单的示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">WorkerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;worker-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* config-overrides.js */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> <span class="title function_">override</span>(<span class="params">config, env</span>) &#123;</span><br><span class="line">  <span class="comment">//region WebWorker 配置</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//do stuff with the webpack config...</span></span><br><span class="line">  config.<span class="property">output</span>.<span class="property">globalObject</span> = <span class="string">&#x27;this&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (!config.<span class="property">plugins</span>) &#123;</span><br><span class="line">    config.<span class="property">plugins</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  config.<span class="property">plugins</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">WorkerPlugin</span>())</span><br><span class="line"></span><br><span class="line">  <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h2><h3 id="this-的值"><a href="#this-的值" class="headerlink" title="this 的值"></a>this 的值</h3><p>在 <code>class</code> 中使用箭头函数以直接绑定当前组件的实例，尽量不要使用 <code>function</code>，否则 <code>this</code> 可能是不明确的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorld</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  logMsg = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;msg&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.logMsg&#125;</span>&gt;</span>打印<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">HelloWorld</span></span><br></pre></td></tr></table></figure>

<h3 id="CSS-样式隔离"><a href="#CSS-样式隔离" class="headerlink" title="CSS 样式隔离"></a>CSS 样式隔离</h3><p>cra 创建的项目默认支持 css module，是 react 项目流行的一种 CSS 隔离方案。</p>
<p>使用步骤</p>
<ol>
<li>为需要的 css 文件使用 <code>.module.css</code> 后缀名</li>
<li>通过 <code>import styles from &#39;*.module.css&#39;</code> 在 <code>tsx</code> 中引入</li>
<li>在 <code>className=&#123;styles.*&#125;</code> 使用 class 样式</li>
</ol>
<p>示例</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.helloWorld</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;HelloWorld.module.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">HelloWorld</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.helloWorld&#125;</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：</p>
<ul>
<li>此处的 <code>import styles from &#39;*.module.css&#39;</code> 不支持命名导入</li>
<li>此处实现的逻辑和 Vue 是一致的，只要使用了其中一个样式 <code>class</code>，则整个文件都会引入</li>
<li>CSS 只要被引入了，就不会被删除，即便组件被销毁了亦然，所以页面内的 CSS 只会增加，不会减少</li>
</ul>
<p>如何添加多个，默认使用 cra 创建的项目支持使用模板字符串</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">className=&#123;<span class="string">`<span class="subst">$&#123;styles.className1&#125;</span> <span class="subst">$&#123;styles.className2&#125;</span>`</span>&#125;</span><br></pre></td></tr></table></figure>

<p>看起来很丑？可以试试 <a target="_blank" rel="noopener" href="https://github.com/JedWatson/classnames">classnames</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"></span><br><span class="line">className=&#123;<span class="title function_">classNames</span>(globalStyles.<span class="property">global</span>, globalStyles.<span class="property">margin</span>)&#125;</span><br></pre></td></tr></table></figure>

<p>但仍然很丑，正如 Sindre Sorhus 所说：<a target="_blank" rel="noopener" href="https://twitter.com/sindresorhus/status/1001355913930858502">React 把简单的事情变复杂，复杂的事情变简单</a></p>
<p>另一种个 API 是 <code>classNames.bind</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> classNames <span class="keyword">from</span> <span class="string">&#x27;classnames&#x27;</span></span><br><span class="line"><span class="keyword">const</span> cx=&#123;classNames.<span class="title function_">bind</span>(globalStyles)&#125;</span><br><span class="line">className=&#123;<span class="title function_">cx</span>(<span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;margin&#x27;</span>)&#125;</span><br></pre></td></tr></table></figure>

<p>但这会让 WebStorm 损失所有的 CSS 关联，影响了包括代码提示&#x2F;跳转&#x2F;重构等功能，考虑到维护成本实在得不偿失。</p>
<p>还有人提出了 typed css module，为所有的 <code>.module.css</code> 生成 <code>.d.ts</code> 类型定义，但这会和 css in js 一样丧失 css 预处理器的优势 —- 并且，所有的工具链都需要重新支持这种关联，将之认为是 css。</p>
<blockquote>
<p>参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.javascriptstuff.com/css-modules-by-example/">Css Modules by Example</a></li>
<li><a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/adding-a-css-modules-stylesheet/">添加 CSS 模块样式表</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gajus/babel-plugin-react-css-modules">babel-plugin-react-css-modules</a></li>
</ul>
</blockquote>
<h3 id="引入图片"><a href="#引入图片" class="headerlink" title="引入图片"></a>引入图片</h3><p>在任何一个项目中，都少不了引入图片的需求。而 React 中，并未像 Vue 对 <code>img, audio, video</code> 这些标签进行特殊处理，以支持直接使用路径即可将对应的媒体文件打包进来，React 需要使用 <code>import img from &#39;*&#39;</code> 的<strong>原始</strong>形式让 webpack <strong>知道</strong>这是一个需要打包的资源。</p>
<p>例如</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> img <span class="keyword">from</span> <span class="string">&#x27;img.png&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">reutrn</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;img&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;img&quot;</span> /&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而对于 SVG 类型的图片，React 支持使用组件的形式引入。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ReactComponent</span> <span class="keyword">as</span> <span class="title class_">IconAudio</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../assets/icon/icon-audio.svg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">reutrn</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">IconAudio</span> /&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h3><p>两种方案</p>
<ol>
<li>使用 <code>&#123;props.children&#125;</code>，和 vue 的 <code>slot:default</code> 几乎一样，只是不能通过子组件传递参数。</li>
<li>如果需要传递多个命名 <code>slot</code>，则可以直接为 <code>props</code> 属性赋值为组件。例如 <code>title=&#123;&lt;div&gt;hello world&lt;/div&gt;&#125;</code></li>
<li>如果需要使用子组件传参的话需要使用函数式组件的形式。例如 <code>title=&#123;value =&gt; &lt;div&gt;&#123;value&#125;&lt;/div&gt;&#125;</code></li>
</ol>
<blockquote>
<p>吐槽：函数式已经是政治正确了。</p>
</blockquote>
<p>使用函数式的 <code>slot</code> 时必须检查函数是否存在，如果不存在则不要调用，不像是 vue 中的 <code>slot</code> 是自动处理这一步的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">tableOperate</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">tableOperate</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">innerValue</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="watch-监听-props"><a href="#watch-监听-props" class="headerlink" title="watch 监听 props"></a>watch 监听 props</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidUpdate</span>(<span class="params">prevProps: PropsType</span>) &#123;</span><br><span class="line">  <span class="comment">// 典型用法（不要忘记比较 props）：</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">value</span> !== prevProps.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">innerValue</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>相比于 Vue 的生命周期，React 显然更加<strong>复杂</strong>与<strong>混乱</strong>，而且，老实说有时候真的很难用。</p>
<p>例如非常常见的生命周期 <code>componentWillUpdate</code>，它承担的责任实在是太多了，不仅 <code>watch</code> <code>state/props</code> 中的数据要用这个，连 React Router 的路由变化同样依赖于此。</p>
<p>下面列出最常用的一些生命周期以及典型用例</p>
<ul>
<li><p><code>render</code>：只要 state 变化就会触发重新渲染，等价于 vue 中渲染模板 HTML 中的内容</p>
</li>
<li><p><code>shouldComponentUpdate</code>：state 或者 props <strong>变化前</strong>就会执行，时机上早于 <code>render</code>。等价于 vue <code>beforeUpdate</code>，但可以在这个方法内 <code>return false</code> 阻止视图更新。</p>
</li>
<li><p><code>componentDidUpdate</code>：state 或者 props <strong>变化后</strong>就会执行，时机上晚于 <code>render</code>。等价于 vue <code>updated</code>。<br>多用于监听一些数据变化执行一些副作用操作，但包含的种类可能会非常多。</p>
<blockquote>
<p>注：此处 vue 中将之分为 <code>updated/watch/beforeRouteUpdate</code>，而在 React 中，全部由 <code>componentDidMount</code> 承担这个责任。</p>
</blockquote>
</li>
<li><p><code>componentDidMount</code>：当组件渲染<strong>完成后</strong>就会执行，时机上晚于 <code>render</code>，等价于 vue <code>mounted</code>。<br>多用于执行一些初始化操作，除非逻辑特别简单，否则不要在这个函数里放具体执行逻辑代码，而是专门写初始化函数在这里调用。</p>
</li>
<li><p><code>UNSAFE_componentWillMount</code>：在组件渲染<strong>完成前</strong>就会执行，等价于 vue <code>beforeMount</code>，但被废弃了，替代解决方案参考 <a href="#%E6%80%8E%E4%B9%88%E5%9C%A8%E6%B2%A1%E6%9C%89-created-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%BF%9D%E8%AF%81%E7%94%A8%E6%88%B7%E7%9C%8B%E4%B8%8D%E5%88%B0%E9%BB%98%E8%AE%A4%E7%A9%BA%E6%95%B0%E6%8D%AE">怎么在没有 <code>created</code> 生命周期的情况下初始化数据并保证用户看不到默认空数据</a>。</p>
</li>
<li><p><code>componentWillUnmount</code>: 组件即将被销毁前调用，等价于 vue <code>beforeDestroy</code>。</p>
</li>
</ul>
<h3 id="简化-state-修改"><a href="#简化-state-修改" class="headerlink" title="简化 state 修改"></a>简化 state 修改</h3><p>使用 <code>setState</code> 很烦的一点是当你需要深度为某个属性赋值的时候，要为该属性上面所有的对象全部使用 <code>...</code> 或者其他方式拷贝一遍。</p>
<p>例如</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">  <span class="attr">user</span>: &#123;</span><br><span class="line">    ...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">user</span>,</span><br><span class="line">    <span class="attr">address</span>: &#123;</span><br><span class="line">      ...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">user</span>.<span class="property">address</span>,</span><br><span class="line">      <span class="attr">city</span>: newCity,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>当有多个属性需要赋值时就尤其的繁琐，而 <a target="_blank" rel="noopener" href="https://github.com/immerjs/immer">immerjs</a> 正好可以解决这种痛点</p>
<p>使用 immer 重构之后</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="title function_">produce</span>(<span class="variable language_">this</span>.<span class="property">state</span>, <span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">user</span>.<span class="property">address</span>.<span class="property">city</span> = newCity</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>代码变得很简单了，虽然看起来是直接赋值，不过 immer 使用了 <code>Proxy</code> 和 <code>Object.freeze</code> 实现了对使用者友好的不可变数据修改，具体参考 。</p>
<h3 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h3><p>React Hooks 是在 React 16.8 之后添加的一项新特性，一如既往，很多人又是吹的天花乱坠。老实说最开始 React Hooks 流行并且在各个社群被大肆宣传时，吾辈非常讨厌它，因为它又向函数式靠近了一步—-函数式政治正确真的很讨厌！所以，自正式学习 React 以来，吾辈都没有接触过 React Hooks，都是用 Class Component 实现组件。<br>但现在，架不住好奇心和一些朋友的推荐，吾辈稍微看了一下这个新特性。</p>
<p>它提供了两个主要的 API：</p>
<ul>
<li><code>useState</code>：声明一些可变状态</li>
<li><code>useEffect</code>：声明一些副作用代码</li>
</ul>
<p>使用看起来很简单</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloHooks</span>: <span class="title class_">React</span>.<span class="property">FC</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//region 计数器</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;string[]&gt;([])</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">countAdd</span> = (<span class="params"></span>) =&gt; <span class="title function_">setCount</span>(count + <span class="number">1</span>)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count changed: &#x27;</span>, count)</span><br><span class="line">    <span class="title function_">setList</span>(</span><br><span class="line">      <span class="title class_">Array</span>(count)</span><br><span class="line">        .<span class="title function_">fill</span>(<span class="number">0</span>)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> <span class="string">`第 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span> 个元素`</span>),</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//监听 count 变化</span></span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//region 自动聚焦输入框</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef&lt;<span class="title class_">HTMLInputElement</span>&gt;(<span class="literal">null</span> <span class="keyword">as</span> any)</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>()</span><br><span class="line">    <span class="comment">//不监听任何值变化，只在第一次渲染运行</span></span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;count&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> setCount(parseInt(e.target.value))&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;countAdd&#125;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;list.map((v, i) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span>&#123;v&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">HelloHooks</span></span><br></pre></td></tr></table></figure>

<p>可以看到，上面用 <code>useState/useEffect</code> 两个函数实现了一些常见的功能：<code>state, componentDidMount, componentDidUpdate</code>，<code>useEffect</code> 甚至默认支持类似 vue <code>watch</code> 的使用方式。</p>
<p>同时，使用 Hooks 可以轻易地封装出 <code>useModel</code>, vue 中的 <code>watch/computed</code> 甚至原生自带了！</p>
<ul>
<li><code>useMemo</code>：当依赖变化时计算属性</li>
<li><code>useCallback</code>：当依赖变化时执行回调</li>
</ul>
<p>然而，Hooks 终究不是万能。</p>
<ul>
<li>使用 Hooks 封装控制 DOM 相关的代码做不到，例如使用高阶组件实现的根据某些条件控制组件是否加载。</li>
<li>使用 Hooks 无法实现全部的生命周期，例如 <code>shouldComponentUpdate</code>。</li>
<li>Hooks <code>useEffect</code> 中调用的外部函数，无法即时获取到所有最新的 <code>state</code>，即便它们与 <code>useEffect</code> 同级，必须在 <code>useEffect</code> 声明正确的依赖才行，即便调用的函数在外部依赖的亦然如此（老实说这点并不简单）。示例：</li>
<li>Hooks 中 <code>useState/useReducer</code> 修改并不能即时反应出来。例如 <code>const [count, setCount] = useState(0)</code> 声明一个状态，使用 <code>setCount(count + 1)</code> 之后立刻取 <code>count</code> 的值仍然是 0，需要等到下次渲染才会生效。而 <code>useRef</code> 声明的可变状态，虽然是即时修改的，但组件却不会因为它的变化重新渲染。示例：<a target="_blank" rel="noopener" href="https://codesandbox.io/s/react-hooks-usestate-async-change-5hlz0">https://codesandbox.io/s/react-hooks-usestate-async-change-5hlz0</a></li>
<li>使用 Hooks 会让函数变得很大，对开发人员的要求比之前更高（与 vue 3 的函数式 API 一样，都是由开发者自己完全控制代码块的分割）</li>
</ul>
<blockquote>
<p>更多有关 React Hooks 的介绍，请参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hooks-intro.html">Hooks 简介</a></li>
<li><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies">在依赖列表中省略函数是否安全？</a></li>
</ul>
</blockquote>
<!-- ### React Props

React props 基本上能传递任何东西，所以承担了 vue 中的多个特性。

- `props` 传递参数
- `$emit` 传递事件
- `slot` 传递组件

从这点来看，React 真是 **少即是多** 的范例。 -->

<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="React-有什么缺点"><a href="#React-有什么缺点" class="headerlink" title="React 有什么缺点"></a>React 有什么缺点</h3><ul>
<li>CSS 局部化有很多方案，但没有一统天下的</li>
<li>vue 在组件创建&#x2F;销毁时会自动初始化&#x2F;销毁状态及监听器，而 mobx 会一直保留需要手动初始化&#x2F;清理<ul>
<li>注: 这点还未找到解决方案</li>
<li>更新：可以使用 context 部分解决这个问题</li>
</ul>
</li>
<li>使用 AntD 时可能遇到样式覆盖不了的问题，需要混合使用 <code>className, style</code> 两个属性。</li>
<li>react 会在开发阶段报错比较多，主要是一些低级错误，尤其是加上 ts 之后尤其如此</li>
</ul>
<h3 id="怎么在没有-created-生命周期的情况下初始化数据并保证用户看不到默认空数据"><a href="#怎么在没有-created-生命周期的情况下初始化数据并保证用户看不到默认空数据" class="headerlink" title="怎么在没有 created 生命周期的情况下初始化数据并保证用户看不到默认空数据"></a>怎么在没有 <code>created</code> 生命周期的情况下初始化数据并保证用户看不到默认空数据</h3><p>在 vue 中，吾辈经常在 created 生命周期中加载数据，避免用户看到默认的空数据，然而，React 中却没有这个生命周期，所以需要额外的处理。</p>
<blockquote>
<p>注：其实 vue 中用户也有可能看到空数据，但因为 Ajax 请求数据的速度也比较快，所以默认可以不用处理。</p>
</blockquote>
<p>一个可能解决方案是在指定元素外面包一层，在页面数据未加载之前，在元素上方添加一个 Loading 遮罩层提示<strong>正在加载中</strong>，等到数据加载完成后删除浮层。</p>
<p>下面是一个简单的实现</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ComponentLoading.module.css */</span></span><br><span class="line"><span class="selector-class">.componentLoadingDialog</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">10</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ComponentLoading.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Spin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">&#x27;./ComponentLoading.module.css&#x27;</span></span><br><span class="line"></span><br><span class="line">type <span class="title class_">PropsType</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 是否显示 loading?</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">isLoading</span>: boolean</span><br><span class="line">  tip?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 控制 Ajax 请求未完成前某个区域不展示默认数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">props</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@constructor</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ComponentLoading</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">PropsType</span>&gt; = <span class="keyword">function</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; isLoading, tip = <span class="string">&#x27;正在加载中。。。&#x27;</span> &#125; = props</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">position:</span> &#x27;<span class="attr">relative</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isLoading &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;styles.componentLoadingDialog&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Spin</span> <span class="attr">tip</span>=<span class="string">&#123;tip&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/*注：默认会渲染 children 组件*/&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ComponentLoading</span></span><br></pre></td></tr></table></figure>

<h3 id="React-和-vue-3-的对比"><a href="#React-和-vue-3-的对比" class="headerlink" title="React 和 vue 3 的对比"></a>React 和 vue 3 的对比</h3><p>vue 3 新增了 <code>Function-base</code> 的组件，看起来很像 React Hooks，但目前仍然无法在生产中实用。</p>
<p>目前看来有以下缺点</p>
<ol>
<li>IDE 支持不好</li>
<li>TS 不能解决 Vue 中的一些问题，尤其是对于模板层面简直无能为力</li>
<li>Vue 3 函数式组件没有覆盖之前所有的功能</li>
<li>周边生态目前没有早期支持的迹象</li>
</ol>
<p>关于第二和第三点，吾辈认为这是 Vue 使用模板带来的一些天然的问题，几乎不可能解决。而 React 和 TS 结合比 Vue 要完善很多，包括类型校验完全使用 TS 而非自定义运行时校验机制。</p>
<p>下面是 vue 作者谈及 vue 3 与其他框架的对比</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bOdfo5SmQc8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<blockquote>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://vue-composition-api-rfc.netlify.com/#comparison-with-react-hooks">Vue composition api comparison with React Hooks</a></li>
<li><a target="_blank" rel="noopener" href="https://aweiu.com/%E8%B0%81%E8%83%BD%E5%A4%A7%E8%87%B4%E8%AF%B4%E4%B8%8Bvue%E5%92%8Creact%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8C%BA%E5%88%AB%E4%B9%8B%E5%A4%84%EF%BC%9F/">谁能大致说下 vue 和 react 的最大区别之处？</a></li>
</ul>
</blockquote>
<h3 id="开发环境代理"><a href="#开发环境代理" class="headerlink" title="开发环境代理"></a>开发环境代理</h3><p>开发环境配置代理几乎是必用功能，相比于 vue-cli 将全部配置统一在 <code>vue.config.js</code> 中，cra 看起来仍是分散式的。</p>
<p>步骤</p>
<ol>
<li><p>安装中间件 <code>yarn add -D http-proxy-middleware @types/</code></p>
</li>
<li><p>创建文件 <code>src/setupProxy.ts</code></p>
</li>
<li><p>编写配置</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> proxy <span class="keyword">from</span> <span class="string">&#x27;http-proxy-middleware&#x27;</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs-extra&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开发环境代理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">app</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">string|*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">app: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">proxyConfig</span>: proxy.<span class="property">Config</span> = &#123;</span><br><span class="line">    <span class="attr">target</span>: <span class="string">&#x27;https://localhost:8000&#x27;</span>,</span><br><span class="line">    <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">secure</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">ws</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">pathRewrite</span>(<span class="params">api: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> mockApiList = fs.<span class="title function_">readJSONSync</span>(</span><br><span class="line">        path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./config/mockApiList.json&#x27;</span>),</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        api +</span><br><span class="line">        (mockApiList.<span class="title function_">some</span>(<span class="function">(<span class="params">mockApi: <span class="built_in">string</span></span>) =&gt;</span> api.<span class="title function_">includes</span>(mockApi))</span><br><span class="line">          ? <span class="string">&#x27;?mock=default&amp;errCode=200&#x27;</span></span><br><span class="line">          : <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">use</span>(<span class="title function_">proxy</span>(<span class="string">&#x27;/api&#x27;</span>, proxyConfig))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/proxying-api-requests-in-development/">Proxying API Requests in Development</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/chimurai/http-proxy-middleware">http-proxy-middleware</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5bd13c5ce51d457a203cebf4">一篇读懂 http-proxy-middleware</a></li>
</ul>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">浅谈 Vue SPA 网站 URL 保存数据实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-04 23:53:22" itemprop="dateCreated datePublished" datetime="2020-01-04T23:53:22+08:00">2020-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-01-20 00:00:00" itemprop="dateModified" datetime="2020-01-20T00:00:00+08:00">2020-01-20</time>
    </span>


  
    <span id="/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/" class="post-meta-item leancloud_visitors" data-flag-title="浅谈 Vue SPA 网站 URL 保存数据实践" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="浅谈 Vue SPA 网站 URL 保存数据实践" href="/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::67e36aa7bdbb6f16b6cedd0239a0084d" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>该功能吾辈已经封装成 NPM 库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vue-url-persist">vue-url-persist</a></p>
</blockquote>
<p>在使用 Vue SPA 开发面向普通用户的网站时，吾辈也遇到了一些之前未被重视，但却实实在在存在的问题，这次便浅谈一下 SPA 网站将所有数据都存储到内存中导致数据很容易丢失以及吾辈思考并尝试的解决方案。</p>
<blockquote>
<p>参考：SPA 全称 <code>single page application</code>，意为 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8">单页应用</a>，不是泥萌想的那样！#笑哭</p>
</blockquote>
<p>思维导图</p>
<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:525px; height:245px;" src="https://www.processon.com/embed/5e1e5d93e4b0c3908f881d64"></iframe>

<p>首先列出为什么遇到这个问题，具体场景及解决的问题是什么？</p>
<p>想要解决的一些问题</p>
<ol>
<li>刷新页面数据不丢失：因为数据都保存在内存中，所以刷新之后自然不存在了</li>
<li>URL 复制给其他人数据不丢失：因为数据没有持久化到 URL 上，也没有根据 URL 上的数据进行初始化，所以复制给别人的 URL 当然会丢失数据（搜索条件之类）</li>
<li>页面返回数据不丢失：因为数据都保存在内存中，所以跳转到其他路由再跳转回来数据当然不会存在了</li>
</ol>
<p>那么，先谈一下每个问题的解决方案</p>
<ol>
<li>刷新页面数据不丢失<ul>
<li>将数据序列化到本地，例如 <code>localStorage</code> 中，然后在刷新后获取一次<ul>
<li>注：这方面已经有先行者了，例如 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vuex-persist">vuex-persist</a> 和 <a target="_blank" rel="noopener" href="https://github.com/robinvdvleuten/vuex-persistedstate">vuex-persistedstate</a></li>
</ul>
</li>
<li>将数据序列化到 URL 上，每次加载都从 URL 上获取数据</li>
</ul>
</li>
<li>URL 复制给其他人数据不丢失<ul>
<li>只能将数据序列化到 URL 上</li>
</ul>
</li>
<li>页面返回数据不丢失<ul>
<li>将数据放到 vuex 中，并且在 URL 上使用 <code>key</code> 进行标识<ul>
<li>注：这方面已经有先行者了，例如 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vue-navigation">vue-navigation</a> 和 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vuex-router-sync">vuex-router-sync</a></li>
</ul>
</li>
<li>将数据序列化到 URL 上，并且不新增路由记录</li>
<li>使用 vue-router 的缓存 <code>keep-alive</code></li>
</ul>
</li>
</ol>
<p>在了解了这么多的解决方案之后，吾辈最终选择了兼容性最好的 URL 保存数据，它能同时解决 3 个问题。然而，很遗憾的是，这似乎并没有很多人讨论这个问题，或许，这个问题本应该是默认就需要解决的，亦或是 SPA 网站真的很少关心这些了。</p>
<blockquote>
<p>虽说如此，吾辈还是找到了一些讨论的 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42226479">StackOverflow: How to hold URL query params in Vue with Vue-Router</a></p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>一个基本的思路是能够确定的</p>
<ol>
<li>在组件创建时，从 URL 获取数据并为需要的数据进行初始化</li>
<li>在这些数据变化时，及时将数据序列化到 URL 上</li>
</ol>
<p><img src="https://img.rxliuli.com/20200105012847.png" alt="思路图"></p>
<p>然后，再次出现了一个分歧点，到底要不要绑定 Vue？</p>
<ol>
<li>不绑定 vue 手动监听对象变化并将对象的变化响应到 URL 上<br><img src="https://img.rxliuli.com/20200105012848.png" alt="不绑定 vue"></li>
<li>绑定 vue 并使用它的生命周期 <code>created, beforeRouteUpdate</code> 与监听器 <code>watch</code><br><img src="https://img.rxliuli.com/20200105012846.png" alt="绑定 vue"></li>
</ol>
<p>那么，两者有什么区别呢？</p>
<table>
<thead>
<tr>
<th>思路</th>
<th>不绑定 vue</th>
<th>绑定 vue</th>
</tr>
</thead>
<tbody><tr>
<td>优点</td>
<td>非框架强相关，理论上可以通用 <code>Vue/React</code></td>
<td>不需要手动实现 URL 的几种序列化模式，可以预见至少有两种：<code>HTML 5 History/Hash</code></td>
</tr>
<tr>
<td></td>
<td>没有 vue&#x2F;vue-router 的历史包袱</td>
<td>不需要手动实现数据监听&#x2F;响应（虽然现在已然不算难了）</td>
</tr>
<tr>
<td></td>
<td>可以不管 vue-router 实现 URL 动态设置，可以自动优雅降级</td>
<td>灵活性很强，实现比较好的封装之后使用成本很低</td>
</tr>
<tr>
<td>缺点</td>
<td>没有包袱，但同时没有基础，序列化&#x2F;数据监听都需要手动实现</td>
<td>存在历史包袱，vue&#x2F;vue-router 的怪癖一点都绕不过去</td>
</tr>
<tr>
<td></td>
<td>灵活性不足，只能初始化一次，需要&#x2F;不需要序列化的数据分割也相当有挑战</td>
<td>依赖 vue&#x2F;vue-router，在其更新之时也必须跟着更新</td>
</tr>
<tr>
<td></td>
<td>不绑定 vue 意味着与 vue 不可能完美契合</td>
<td>无法通用，在任何一个其他框架（React）上还要再写一套</td>
</tr>
</tbody></table>
<p>最终，在这个十字路口反复踌躇之后，吾辈选择了更加灵活、成本更低的第二种解决方案。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="已解决"><a href="#已解决" class="headerlink" title="已解决"></a>已解决</h3><ul>
<li>序列化数据到 URL 上导致路由记录会随着改变增加</li>
<li>即时序列化数据到 URL 上不现实<blockquote>
<p>这里吾辈对 <a target="_blank" rel="noopener" href="https://yarnpkg.com/">yarn</a> 进行了考察发现其也是异步更新 URL</p>
</blockquote>
</li>
<li>序列化到 URL 上时导致的死循环，<code>序列化数据到 URL 上 =&gt; 路由更新触发 =&gt; 初始化数据到 URL 上 =&gt; 触发数据改变 =&gt; 序列化数据到 URL 上。。。</code></li>
<li>同一个路由携带不同的查询参数的 URL 直接在地址栏输入回车一次不会触发页面数据更新</li>
<li>URL 最大保存数据 IE 最多支持 <code>2083</code> 长度的 URL，换算为中文即为 <code>231</code> 个，所以不能作为一种通用方式进行</li>
<li>Vue 插件不能动态混入，而是在各个生命周期中判断是否要处理的</li>
</ul>
<h3 id="仍遗留"><a href="#仍遗留" class="headerlink" title="仍遗留"></a>仍遗留</h3><ul>
<li>JSON 序列化的数据长度较 query param 更大</li>
</ul>
<blockquote>
<p>下面是具体实现及代码，不喜欢的话可以直接跳到最下面的 <a href="#%E6%80%BB%E7%BB%93">总结</a>。</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rxliuli/example/tree/linter_vue_example/vue_url_persist_vue_example">GitHub</a></p>
</blockquote>
<h3 id="基本尝试"><a href="#基本尝试" class="headerlink" title="基本尝试"></a>基本尝试</h3><p>首先，尝试不使用任何封装，直接在 <code>created</code> 生命周期中初始化并绑定 <code>$watch</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span>搜索名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.keyword&quot;</span> <span class="attr">id</span>=<span class="string">&quot;keyword&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-model</span>=<span class="string">&quot;form.hobbyList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">id</span>=<span class="string">&quot;anime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&quot;anime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;anime&quot;</span>&gt;</span>动画<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.hobbyList&quot;</span> <span class="attr">id</span>=<span class="string">&quot;game&quot;</span> <span class="attr">value</span>=<span class="string">&quot;game&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;game&quot;</span>&gt;</span>游戏<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-model</span>=<span class="string">&quot;form.hobbyList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">id</span>=<span class="string">&quot;movie&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&quot;movie&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;movie&quot;</span>&gt;</span>电影<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;&#123; form &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;Form1&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">form</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">hobbyList</span>: [],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>.<span class="property">form</span>, urlData.<span class="property">form</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.$watch(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;form&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        urlData.<span class="property">form</span> = val</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">query</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">deep</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="分离通用性函数"><a href="#分离通用性函数" class="headerlink" title="分离通用性函数"></a>分离通用性函数</h3><p>然后，便是将之分离为单独的函数，方便在所有组件中进行复用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>[exp], urlData[exp])</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用起来需要在 <code>created</code> 生命中调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    initUrlData.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="string">&#x27;form&#x27;</span>])</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理深层监听"><a href="#处理深层监听" class="headerlink" title="处理深层监听"></a>处理深层监听</h3><p>如果需要监听的值不是 data 下的顶级字段，而是深层字段的话，便不能直接使用 <code>[]</code> 进行取值和赋值了，而是需要实现支持深层取值&#x2F;赋值的 <code>get/set</code>。而且，深层监听也意味着一般不会是对象，所以也不能采用 <code>Object.assign</code> 进行合并。</p>
<p>例如需要监听 <code>page</code> 对象中的 <code>offset, size</code> 两字段</p>
<p>首先，需要编写通用的 <code>get/set</code> 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析字段字符串为数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str 字段字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 字符串数组，数组的 `[]` 取法会被解析为数组的一个元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseFieldStr</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">    .<span class="title function_">split</span>(<span class="regexp">/[\\.\\[]/</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">k</span> =&gt;</span> (<span class="regexp">/\]$/</span>.<span class="title function_">test</span>(k) ? k.<span class="title function_">slice</span>(<span class="number">0</span>, k.<span class="property">length</span> - <span class="number">1</span>) : k))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 安全的深度获取对象的字段</span></span><br><span class="line"><span class="comment"> * 注: 只要获取字段的值为 &#123;<span class="doctag">@type</span> null|undefined&#125;，就会直接返回 &#123;<span class="doctag">@param</span> defVal&#125;</span></span><br><span class="line"><span class="comment"> * 类似于 ES2019 的可选调用链特性: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> obj 获取的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fields 字段字符串或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> [defVal] 取不到值时的默认值，默认为 null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">obj, fields, defVal = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fields === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    fields = <span class="title function_">parseFieldStr</span>(fields)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = obj</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> field <span class="keyword">of</span> fields) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(res, field)</span><br><span class="line">      <span class="keyword">if</span> (res === <span class="literal">undefined</span> || res === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> defVal</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> defVal</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 安全的深度设置对象的字段</span></span><br><span class="line"><span class="comment"> * 注: 只要设置字段的值为 &#123;<span class="doctag">@type</span> null|undefined&#125;，就会直接返回 &#123;<span class="doctag">@param</span> defVal&#125;</span></span><br><span class="line"><span class="comment"> * 类似于 ES2019 的可选调用链特性: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> obj 设置的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fields 字段字符串或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> [val] 设置字段的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">obj, fields, val</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fields === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    fields = <span class="title function_">parseFieldStr</span>(fields)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = obj</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = fields.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> field = fields[i]</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i, res, field, res[field])</span><br><span class="line">    <span class="keyword">if</span> (i === len - <span class="number">1</span>) &#123;</span><br><span class="line">      res[field] = val</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = res[field]</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res: &#x27;</span>, res)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> res !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，是替换赋值操作，将之修改为一个专门的函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为 vue 实例上的字段进行深度赋值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setInitData</span>(<span class="params">vm, exp, urlData</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> oldVal = <span class="title function_">get</span>(vm, exp, <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> newVal = urlData[exp]</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&#x27;object&#x27;</span> &amp;&amp; newVal !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">get</span>(vm, exp), newVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">set</span>(vm, exp, newVal)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，便能单独监听对象中的某个字段了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initUrlData.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="string">&#x27;form.keyword&#x27;</span>])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：lodash 的函数 <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#get">get</a>&#x2F;<a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#set">set</a></p>
</blockquote>
<h3 id="使用防抖避免触发过快"><a href="#使用防抖避免触发过快" class="headerlink" title="使用防抖避免触发过快"></a>使用防抖避免触发过快</h3><p>但目前而言每次同步都是即时的，在数据量较大时，可能会存在一些问题，所以使用防抖避免每次数据更新都即时同步到 URL 上。</p>
<p>首先，实现一个简单的防抖函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函数去抖</span></span><br><span class="line"><span class="comment"> * 去抖 (debounce) 去抖就是对于一定时间段的连续的函数调用，只让其执行一次</span></span><br><span class="line"><span class="comment"> * 注: 包装后的函数如果两次操作间隔小于 delay 则不会被执行, 如果一直在操作就会一直不执行, 直到操作停止的时间大于 delay 最小间隔时间才会执行一次, 不管任何时间调用都需要停止操作等待最小延迟时间</span></span><br><span class="line"><span class="comment"> * 应用场景主要在那些连续的操作, 例如页面滚动监听, 包装后的函数只会执行最后一次</span></span><br><span class="line"><span class="comment"> * 注: 该函数第一次调用一定不会执行，第一次一定拿不到缓存值，后面的连续调用都会拿到上一次的缓存值。如果需要在第一次调用获取到的缓存值，则需要传入第三个参数 &#123;<span class="doctag">@param</span> init&#125;，默认为 &#123;<span class="doctag">@code</span> undefined&#125; 的可选参数</span></span><br><span class="line"><span class="comment"> * 注: 返回函数结果的高阶函数需要使用 &#123;<span class="doctag">@see</span> Proxy&#125; 实现，以避免原函数原型链上的信息丢失</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> action 真正需要执行的操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> delay 最小延迟时间，单位为 ms</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> init 初始的缓存值，不填默认为 &#123;<span class="doctag">@see</span> undefined&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> function(...[*]=): Promise&lt;any&gt; &#123;<span class="doctag">@see</span> action&#125; 是否异步没有太大关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">action, delay, init = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> flag</span><br><span class="line">  <span class="keyword">let</span> result = init</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag)</span><br><span class="line">      flag = <span class="built_in">setTimeout</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="title function_">resolve</span>((result = action.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args))),</span><br><span class="line">        delay,</span><br><span class="line">      )</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(result), delay)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将 <code>$watch</code> 中的函数用 <code>debounce</code> 进行包装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="number">1000</span>),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>引用：<a target="_blank" rel="noopener" href="https://juejin.im/post/5b8de829f265da43623c4261">掘金：7 分钟理解 JS 的节流、防抖及使用场景</a><br>参考：lodash 的函数 <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#debounce">debounce</a></p>
</blockquote>
<h3 id="处理路由不变但-query-修改的问题"><a href="#处理路由不变但-query-修改的问题" class="headerlink" title="处理路由不变但 query 修改的问题"></a>处理路由不变但 query 修改的问题</h3><p>接下来，就需要处理一种小众，但确实存在的场景了。</p>
<ul>
<li>同一个组件被多个路由复用，这些路由仅仅只是一个 path param 改变了。例如 <a target="_blank" rel="noopener" href="https://ant.design/components/tabs-cn/">标签页</a></li>
<li>用户复制 URL 之后，发现其中的查询关键字错了，于是修改了关键字之后又复制了一次，而粘贴两次路由相同 query param 不同的 URL 是不会重新创建组件的</li>
</ul>
<p>首先确定基本的思路：在路由改变但组件没有重新创建时将 URL 上的数据为需要的数据进行初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> route 将要改变的路由对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlDataByRouteUpdate</span>(<span class="params">exps, route</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(route.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 vue 实例的生命周期 <code>beforeRouteUpdate, beforeRouteEnter</code> 重新初始化 <code>data</code> 中的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    initUrlDataByRouteUpdate.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="string">&#x27;form&#x27;</span>], to)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="function"><span class="params">vm</span> =&gt;</span> initUrlDataByRouteUpdate.<span class="title function_">call</span>(vm, [<span class="string">&#x27;form&#x27;</span>], to))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真的以为问题都解决了么？并不然，打开控制台你会发现一些 vue router 的警告</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-router.esm.js?8c4f:2051 Uncaught (<span class="keyword">in</span> promise) NavigationDuplicated &#123;_name: <span class="string">&quot;NavigationDuplicated&quot;</span>, name: <span class="string">&quot;NavigationDuplicated&quot;</span>, message: <span class="string">&quot;Navigating to current location (&quot;</span>/form1/?qb=%7B%22…,%22movie%22,%22game%22%5D%7D%7D<span class="string">&quot;) is not allowed&quot;</span>, stack: <span class="string">&quot;Error↵    at new NavigationDuplicated (webpack-int…/views/Form1.vue?vue&amp;type=script&amp;lang=js&amp;:222:40)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>其实是因为循环触发导致的：<code>序列化数据到 URL 上 =&gt; 路由更新触发 =&gt; 初始化数据到 URL 上 =&gt; 触发数据改变 =&gt; 序列化数据到 URL 上。。。</code>，目前可行的解决方案是在 <code>$watch</code> 中判断数据是否与原来的相同，相同就不进行赋值，避免再次触发 vue-router 的 <code>beforeRouteUpdate</code> 生命周期。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData)) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="number">1000</span>),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，控制台不会再有警告了。</p>
<h3 id="封装起来"><a href="#封装起来" class="headerlink" title="封装起来"></a>封装起来</h3><h4 id="使用-Vue-插件"><a href="#使用-Vue-插件" class="headerlink" title="使用 Vue 插件"></a>使用 Vue 插件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, get, set &#125; <span class="keyword">from</span> <span class="string">&#x27;./common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VueUrlPersist</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一些选项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expListName</span> = <span class="string">&#x27;exps&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">urlPersistName</span> = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将 URL 上的数据初始化到 data 上</span></span><br><span class="line"><span class="comment">   * 此处存在一个谬误</span></span><br><span class="line"><span class="comment">   * 1. 如果对象不使用合并而是赋值，则处理 [干净] 的 URL 就会很棘手，因为无法感知到初始值是什么</span></span><br><span class="line"><span class="comment">   * 2. 如果对象使用合并，则手动输入的相同路由不同参数的 URL 就无法处理</span></span><br><span class="line"><span class="comment">   *    注：该问题已经通过在 watch 中判断值是否变化而解决，但总感觉还有莫名其妙的坑在前面等着。。。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">vm</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">expOrFn</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">urlData</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initVueData</span>(<span class="params">vm, expOrFn, urlData</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> oldVal = <span class="title function_">get</span>(vm, expOrFn, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> newVal = urlData[expOrFn]</span><br><span class="line">    <span class="keyword">if</span> (oldVal === <span class="literal">undefined</span> || oldVal === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">set</span>(vm, expOrFn, newVal)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&#x27;object&#x27;</span> &amp;&amp; newVal !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">get</span>(vm, expOrFn), newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">vm</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">expOrFnList</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">route</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initNextUrlData</span>(<span class="params">vm, expOrFnList, route</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(route.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">urlPersistName</span>] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;urlData: &#x27;</span>, urlData)</span><br><span class="line">    expOrFnList.<span class="title function_">forEach</span>(<span class="function"><span class="params">expOrFn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initVueData</span>(vm, expOrFn, urlData)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue 创建后初始化数据并监听之，在发生变化时自动序列化到 URL 上</span></span><br><span class="line"><span class="comment">   * 注：需要序列化到 URL 上的数据必须能被 JSON.stringfy 序列化</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">vm</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">expOrFnList</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initUrlData</span>(<span class="params">vm, expOrFnList</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(vm.<span class="property">$route</span>.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">urlPersistName</span>] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    expOrFnList.<span class="title function_">forEach</span>(<span class="function"><span class="params">expOrFn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initVueData</span>(vm, expOrFn, urlData)</span><br><span class="line"></span><br><span class="line">      vm.$watch(</span><br><span class="line">        expOrFn,</span><br><span class="line">        <span class="title function_">debounce</span>(<span class="number">1000</span>, <span class="keyword">async</span> val =&gt; &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val 变化了: &#x27;</span>, val)</span><br><span class="line">          urlData[expOrFn] = val</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            vm.<span class="property">$route</span>.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">urlPersistName</span>] === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData)</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">await</span> vm.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: &#123;</span><br><span class="line">              ...vm.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">              [<span class="variable language_">this</span>.<span class="property">urlPersistName</span>]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">Vue, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">expListName</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">expListName</span> = options.<span class="property">expListName</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">urlPersistName</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">urlPersistName</span> = options.<span class="property">urlPersistName</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$urlPersist</span> = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">initDataByRouteUpdate</span>(<span class="params">to</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> expList = <span class="variable language_">this</span>[_this.<span class="property">expListName</span>]</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(expList)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$urlPersist</span>.<span class="title function_">initNextUrlData</span>(<span class="variable language_">this</span>, expList, to)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> expList = <span class="variable language_">this</span>[_this.<span class="property">expListName</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(expList)) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$urlPersist</span>.<span class="title function_">initUrlData</span>(<span class="variable language_">this</span>, expList)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        initDataByRouteUpdate.<span class="title function_">call</span>(<span class="variable language_">this</span>, to)</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="function"><span class="params">vm</span> =&gt;</span> initDataByRouteUpdate.<span class="title function_">call</span>(vm, to))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VueUrlPersist</span></span><br></pre></td></tr></table></figure>

<p>使用起来和其他的插件没什么差别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueUrlPersist</span> <span class="keyword">from</span> <span class="string">&#x27;./views/js/VueUrlPersist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vueUrlPersist = <span class="keyword">new</span> <span class="title class_">VueUrlPersist</span>()</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(vueUrlPersist)</span><br></pre></td></tr></table></figure>

<p>在需要使用的组件中只要声明这个属性就好了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Form2Tab&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">sex</span>: <span class="number">0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">exps</span>: [<span class="string">&#x27;form&#x27;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而，使用 vue 插件有个致命的缺陷：无论是否需要，都会为每个组件中都混入三个生命周期函数，吾辈没有找到一种可以根据实例中是否包含某个值而决定是否混入的方式。</p>
<h4 id="使用高阶函数"><a href="#使用高阶函数" class="headerlink" title="使用高阶函数"></a>使用高阶函数</h4><p>所以，我们使用 <code>高阶函数</code> + <code>mixin</code> 的形式看看。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, get, set &#125; <span class="keyword">from</span> <span class="string">&#x27;./common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VueUrlPersist</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一些选项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">&#123; key = <span class="string">&#x27;qb&#x27;</span> &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 为 vue 实例上的字段进行深度赋值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">setInitData</span>(<span class="params">vm, exp, urlData</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> oldVal = <span class="title function_">get</span>(vm, exp, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> newVal = urlData[exp]</span><br><span class="line">    <span class="comment">//如果原值是对象且新值也是对象，则进行浅合并</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      oldVal === <span class="literal">undefined</span> ||</span><br><span class="line">      oldVal === <span class="literal">null</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> oldVal === <span class="string">&#x27;string&#x27;</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> oldVal === <span class="string">&#x27;number&#x27;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="title function_">set</span>(vm, exp, newVal)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> newVal === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">get</span>(vm, exp), newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> vm vue 实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initUrlDataByCreated</span>(<span class="params">vm, exps</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="variable language_">this</span>.<span class="property">key</span></span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(vm.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setInitData</span>(vm, exp, urlData)</span><br><span class="line">      vm.$watch(</span><br><span class="line">        exp,</span><br><span class="line">        <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">          urlData[exp] = val</span><br><span class="line">          <span class="keyword">if</span> (vm.<span class="property">$route</span>.<span class="property">query</span>[key] === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData)) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          vm.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: &#123;</span><br><span class="line">              ...vm.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">              [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, <span class="number">1000</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> vm vue 实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> route 将要改变的路由对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initUrlDataByRouteUpdate</span>(<span class="params">vm, exps, route</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(route.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">key</span>] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">setInitData</span>(vm, exp, urlData))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生成可以 mixin 到 vue 实例的对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">&#123;created(): void, beforeRouteEnter(*=, *, *): void, beforeRouteUpdate(*=, *, *): void</span>&#125;&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">generateInitUrlData</span>(<span class="params">...exps</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        _this.<span class="title function_">initUrlDataByCreated</span>(<span class="variable language_">this</span>, exps)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        _this.<span class="title function_">initUrlDataByRouteUpdate</span>(<span class="variable language_">this</span>, exps, to)</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeRouteEnter&#x27;</span>)</span><br><span class="line">        <span class="title function_">next</span>(<span class="function"><span class="params">vm</span> =&gt;</span> _this.<span class="title function_">initUrlDataByRouteUpdate</span>(vm, exps, to))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 修改一些配置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> options 配置项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">config</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>, options)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> vueUrlPersist = <span class="keyword">new</span> <span class="title class_">VueUrlPersist</span>()</span><br><span class="line"><span class="keyword">const</span> generateInitUrlData = vueUrlPersist.<span class="property">generateInitUrlData</span>.<span class="title function_">bind</span>(</span><br><span class="line">  vueUrlPersist,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; vueUrlPersist, generateInitUrlData, <span class="title class_">VueUrlPersist</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vueUrlPersist</span><br></pre></td></tr></table></figure>

<p>使用起来几乎一样简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; generateInitUrlData &#125; <span class="keyword">from</span> <span class="string">&#x27;./js/VueUrlPersist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Form1&#x27;</span>,</span><br><span class="line">  <span class="attr">mixins</span>: [<span class="title function_">generateInitUrlData</span>(<span class="string">&#x27;form&#x27;</span>)],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">hobbyList</span>: [],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来，使用高阶函数也没有比 Vue 插件麻烦太多。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，虽然路途坎坷，不过这个问题还是很有趣的，而且确实能解决实际的问题，所以还是有研究价值的。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/" class="post-title-link" itemprop="url">漫谈 反乌托邦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-01 20:09:08" itemprop="dateCreated datePublished" datetime="2020-01-01T20:09:08+08:00">2020-01-01</time>
    </span>


  
    <span id="/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/" class="post-meta-item leancloud_visitors" data-flag-title="漫谈 反乌托邦" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="漫谈 反乌托邦" href="/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::699f055be26cc37b1e03867307b12df4" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1984"><a href="#1984" class="headerlink" title="1984"></a>1984</h2><p>最近看完了 <strong>1984</strong> 这本小说，在之后也补了一下电影</p>
<p>Youtube 正版电影</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/S0WSCZx6R6M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>一些设定令人惊奇</p>
<ul>
<li>真理部：负责新闻、娱乐、教育、艺术</li>
<li>和平部：负责战争</li>
<li>有爱不：负责维持法律和秩序</li>
<li>富裕部：负责经济事务</li>
</ul>
<p>一些名言令人印象深刻</p>
<ul>
<li>过去被禁止，控制过去的人控制未来，控制现在的人控制过去。</li>
<li>除了对集体的爱，没有其他的爱，与之竞争的都要被摧毁。</li>
<li>无产阶级就像牲口一样，什么办法都没有。</li>
<li>现代战争的本质，就是毁灭产品和人类的劳动，保持社会处于饥饿的边缘，一个分等级的社会只可能建立在贫穷和无知的基础上。</li>
<li>栗树荫下，我出卖你，你出卖我。</li>
</ul>
<p>里面小孩举报父母，被洗脑而不自知，或许，亦是因为一张白纸更容易染上颜色吧。</p>
<ul>
<li>低效的前进，高效的内斗</li>
</ul>
<p>现实场景</p>
<ul>
<li>这本书可以很容易买到</li>
<li>中文网络上没有国人影评&#x2F;同人小说</li>
<li>1984 在微博已经成为非法内容了</li>
<li>举报父母已有现实案例（所谓的大义灭亲）</li>
</ul>
<h2 id="美丽新世界"><a href="#美丽新世界" class="headerlink" title="美丽新世界"></a>美丽新世界</h2><ul>
<li>人工胚胎，设置命运：感觉是个恐怖的极权世界</li>
<li>从小开始的 SEX 游戏与索麻，消费&#x2F;享乐主义至上：或许是个天堂？</li>
<li>野人区：旧时代的信仰、肮脏的生活与 <strong>美丽新世界</strong> 对比，让人真不知道哪个是天堂？</li>
<li>野人疯了：发现自己苦苦追寻的事物、坚信的认知却一文不值时，疯掉了，<strong>天堂</strong> 对他而言也是地狱了</li>
<li><code>9/10</code> 的人口供养着 <code>1/10</code> 的人口是 <strong>阿尔法</strong>，无论是水上还是水下都会感到快乐，不提高产量的最大原因是为了避免闲暇时间造成资源的浪费</li>
</ul>
<p>那种 <strong>美丽新世界</strong> 和 <strong>野人区</strong> 真的很难说哪个更好，活到 60 岁，但一生都能保持年轻，并且 <strong>每个人属于每个人</strong> 的理念确实很厉害。</p>
<ul>
<li>要求 <strong>不快乐</strong> 的权力</li>
</ul>
<h2 id="疫情"><a href="#疫情" class="headerlink" title="疫情"></a>疫情</h2><p>花了几年营造出来的中国梦，在一个春节就破碎的不成样子了。</p>
<ul>
<li>双重思想在现实中确实存在，而且很常见。<ul>
<li><a target="_blank" rel="noopener" href="https://twitter.com/LiYing_2015/status/1227363930504196096">所以为歌颂伟大牺牲的时候，就防护服不足，以至于医护人员都不够用，为辟反动谣言的时候，就殡葬人员都必须有防护服。动动脑子想一想的结果就是如此的辩证</a></li>
<li>“我们要自由。我们反对香港游行、台湾独立。”，说这两句话的是同一批人。<ul>
<li>或许未曾意识到，香港、台湾他们也是为了自由，甚至于，或许只是跟风发泄一下情绪，并不明白自由是什么。。。</li>
</ul>
</li>
</ul>
</li>
<li>没有说 <code>1 + 1 = 2</code> 的权利<ul>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%9D%8E%E6%96%87%E4%BA%AE">李文亮</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AD%A6%E6%BC%A2%E9%80%A0%E8%AC%A0%E5%85%AB%E5%90%9B%E5%AD%90">武汉「造谣」八君子</a></li>
</ul>
</li>
<li>未曾想过现实中真的有 <strong>新语</strong> 一说<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/bS_8xCR2bxpwWKcoAeo4pw">为什么日本人显得比中国人更懂中国文化</a><ul>
<li>“山川异域，风月同天。” 居然比不上 <strong>新语</strong> 的 “武汉加油”。</li>
<li>新世纪笑话：<blockquote>
<p>我举一个例子，比如你是给武汉捐助救灾物资的一位执行者，你在包装箱上写了八个字：山川异域，风月同天。领导看见了，会直接骂你：“你特么神经病吗？写这个干嘛？应该写武汉加油，还要加一个大感叹号。”<br>为什么不能用这八个字？因为这八个字不在那一套新话系统里面。这就超出了一位领导干部的思维边界。超出思维边界的事物，都是危险的、不可控的，是不可以使用的。<br>领导还要问你：你听明白了吗？能不能做到？<br>所以，你只能写个 “武汉加油”。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">局域网内 Windows/Android 传输文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-29 22:31:56" itemprop="dateCreated datePublished" datetime="2019-12-29T22:31:56+08:00">2019-12-29</time>
    </span>


  
    <span id="/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/" class="post-meta-item leancloud_visitors" data-flag-title="局域网内 Windows/Android 传输文件" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="局域网内 Windows/Android 传输文件" href="/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::63f4ab40a26fd2ae17d50f095d6c7f44" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>435</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在写杂谈 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/6cde603c/">手游 [ウチの姫] 回坑感想</a> 时，吾辈在手机上进行了多次截图，但苦于数量太多不方便使用 Telegram&#x2F;QQ 之类的 IM 进行传输。在尝试了包括 FTP、Infinit、Feem、飞鸽传书这些软件之后，最终发现吾辈还是一如既往的绕远路 – Windows 本身就包含这个功能。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h2 id="Windows-设置共享文件夹"><a href="#Windows-设置共享文件夹" class="headerlink" title="Windows 设置共享文件夹"></a>Windows 设置共享文件夹</h2><p>Windows 在 <em>文件管理器 &#x3D;&gt; 在文件夹上右键 &#x3D;&gt; 属性</em> 中可以看到共享，接下来，设置该文件夹为共享文件夹，那么手机便能下载&#x2F;上传文件到该目录中了。</p>
<ol>
<li>点击共享</li>
<li>选择共享的用户</li>
<li>确认共享</li>
</ol>
<p><img src="https://img.rxliuli.com/20191229233129.gif" alt="GIF 示意图"></p>
<h2 id="手机上访问局域网"><a href="#手机上访问局域网" class="headerlink" title="手机上访问局域网"></a>手机上访问局域网</h2><p>这里使用 <a target="_blank" rel="noopener" href="https://www.coolapk.com/apk/com.estrongs.android.pop">ES 文件浏览器</a> 作为客户端 App 访问 Windows 的共享文件夹。</p>
<ol>
<li>找到 <em>网络 &#x3D;&gt; 局域网</em></li>
<li>点击 <strong>扫描</strong><br><img src="https://img.rxliuli.com/20191229232158.png" alt="扫描到的目录"></li>
<li>点击扫描到的共享计算机</li>
<li>输入上面选择的共享用户的 <code>Username/Password</code></li>
<li>然后就能看到共享文件夹，并且能够复制&#x2F;粘贴文件了<br><img src="https://img.rxliuli.com/20191229232200.png" alt="目录"><br><img src="https://img.rxliuli.com/20191229232159.png" alt="粘贴"></li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Windows 真的有很多相当好用的功能，只是由于功能太多导致吾辈未曾发现呢</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/" class="post-title-link" itemprop="url">手游 [ウチの姫] 回坑感想</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-29 20:19:46" itemprop="dateCreated datePublished" datetime="2019-12-29T20:19:46+08:00">2019-12-29</time>
    </span>


  
    <span id="/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/" class="post-meta-item leancloud_visitors" data-flag-title="手游 [ウチの姫] 回坑感想" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="手游 [ウチの姫] 回坑感想" href="/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::48d36a0a3e6e8a0e27b6a8b473c59b9f" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>多图预警</p>
</blockquote>
<h2 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h2><p>在月初的周末，吾辈因为最近的 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/63bdcead/">一些烦心事</a>，毫无动力的躺在床上做一条无所事事的咸鱼。偶然想起来 4 年前玩过的一个游戏：<a target="_blank" rel="noopener" href="https://pf.goone.tw/">我家公主最可爱</a>，也是吾辈至今唯一玩过的手游，念及于此，便忍不住找了一下，果不其然，国服坟头草已然几丈高了，台服亦然，唯有日服坚持下来了，到了明年便是这个游戏的第 6 个年头了。<br>日服 App 名字的全称是 <strong>ウチの姫さまがいちばんカワイイ　- ひっぱりアクション RPGx 美少女ゲームアプリ</strong>（虽然名字意思仍然和中文一样，但看起来却没那么羞耻了呢，或许是因为看不懂日语的缘故吧），简称 <strong>ウチの姫</strong>。<br>下面是 <a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=jp.co.cyberagent.uh">Google Play 页面</a></p>
<p><img src="https://img.rxliuli.com/20191229210115.png" alt="Google Play 首页截图"></p>
<p>看起来很可爱，所以吾辈想着闲着也是闲着，便轻松加愉快的重新尝试了这个游戏。</p>
<h2 id="玩法"><a href="#玩法" class="headerlink" title="玩法"></a>玩法</h2><p>刚进入游戏首页，便有两个妹纸在抱着一只，嗯，青蛙一样的生物看着我们，而这只青蛙，自然是这个游戏的男主角啦 #笑</p>
<p><img src="https://img.rxliuli.com/20191229210505.png" alt="游戏首页"></p>
<p>进入游戏，之后的首页是这样的</p>
<p><img src="https://img.rxliuli.com/20191229210833.png" alt="进入游戏后的主页面"></p>
<p>游戏的基本玩法很简单，就是收集公主，然后让（青蛙）王子在公主的帮助下击败魔王的弹珠游戏（然而又是一个无稽之谈 #笑）</p>
<p><img src="https://img.rxliuli.com/20191229211410.png" alt="普通回合"></p>
<p><img src="https://img.rxliuli.com/20191229211447.png" alt="Boss 回合"></p>
<p>然后，在打通关卡后，可以获得经验与一些公主，不过大多数都是特殊属性的公主，可以用来强化、进化以及觉醒的一些素材，统称为 <strong>狗粮</strong>（为什么公主被作为狗粮了 #惊哭）</p>
<p><img src="https://img.rxliuli.com/20191229211911.png" alt="获得经验"></p>
<p><img src="https://img.rxliuli.com/20191229212030.png" alt="获得公主"></p>
<p>下面是一个公主的属性面板（<code>Status</code> 还是 <code>Properties</code> 呢 #笑）</p>
<p><img src="https://img.rxliuli.com/20191229212322.png" alt="属性面板"></p>
<p>可以看到的属性就有</p>
<ul>
<li>所属元素：存在克制关系 <code>光 &lt;=&gt; 暗</code>，<code>火 =&gt; 风 =&gt; 水 =&gt; 火...</code></li>
<li>名字：公主的名字</li>
<li>稀有度：目前真正能用的稀有度依次是 <code>UR/UR+/UR++ =&gt; PUR/PUR+/PUR++ =&gt; XUR</code>，一般而言稀有度越高这张卡的强度可能性就越高</li>
<li>公主自身等级：影响 HP&#x2F;攻击力</li>
<li>HP：体力值，在副本时计算的是队伍（4 位公主与 1 位外援）的总和，不过没有攻击力对强度影响大</li>
<li>攻击力：攻击力，在副本时仅计算当前活跃公主的攻击力，对强度影响较大，因为 Boss 普遍体力非常高</li>
<li>强度：这张卡在官方眼中的强度，强度高可能不强，但低了一定不强</li>
<li>爱情度：影响 HP&#x2F;攻击力&#x2F;技能冷却回合</li>
<li>公主队长技能：作为队长时实用的技能</li>
<li>公主技能：能够持续几回合并有冷却时间的技能</li>
<li>绊技能：在爱情度达到 <code>300</code> 后解锁，一半只能到 <code>200</code></li>
<li>附加能力属性：影响能够强化的附加能力</li>
<li>自带防御：能够防御场上某种类型的陷阱</li>
<li>追加属性：影响 HP&#x2F;攻击力&#x2F;攻击时的效果，锁住的话需要使用 <strong>才开</strong> 开锁，<strong>才与</strong> 赋值</li>
<li>爱情度封印：影响附加能力位，爱情度 <code>200/300</code> 会锁住两个附加能力位，必须在爱情度到达之后次啊会解锁</li>
</ul>
<p>是不是感觉太复杂了，吾辈刚进入游戏的时候也是这样想的，所以就去加了一个国内的 QQ 讨论群（居然还有一些人再玩这个游戏呢），以次绕过了新手时期的困惑（虽然不是新手，但已然太久没玩，而且变化也很多）</p>
<h2 id="图鉴"><a href="#图鉴" class="headerlink" title="图鉴"></a>图鉴</h2><p>本质上，这是一个集卡（舔卡 #大雾）游戏</p>
<p>下面是进入游戏必然获得几位公主：<strong>亲女儿（爱姬） + 御三家（红苍翠）</strong></p>
<p><img src="https://img.rxliuli.com/20191229220923.png" alt="亲女儿"><br><img src="https://img.rxliuli.com/20191229220947.png" alt="红"><br><img src="https://img.rxliuli.com/20191229220959.png" alt="蓝"><br><img src="https://img.rxliuli.com/20191229221008.png" alt="绿"></p>
<p>然而，还有各种 <strong>卡哇伊</strong> 的公主需要通过活动副本（#肝）&#x2F;抽奖机制（#氪）获得</p>
<p><img src="https://img.rxliuli.com/20191229221354.png" alt="公主 1"><br><img src="https://img.rxliuli.com/20191229221435.png" alt="公主 2"><br><img src="https://img.rxliuli.com/20191229221434.png" alt="公主 3"><br><img src="https://img.rxliuli.com/20191229221433.png" alt="公主 4"><br><img src="https://img.rxliuli.com/20191229221432.png" alt="公主 5"><br><img src="https://img.rxliuli.com/20191229221436.png" alt="公主 6"><br><img src="https://img.rxliuli.com/20191229221431.png" alt="公主 7"></p>
<h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><p>当然，作为一个手游，那么自然是有体力与扭蛋（抽奖）这两种机制了，下面由吾辈来一一说明</p>
<p>体力值：上限与等级直接挂钩，长久来看，大致是等级的 <code>1/3</code> 左右，每次进入副本消耗体力值，会随着时间逐渐恢复（不会超过体力上限），但也可以用 <strong>月石</strong> 可以增加体力上限的体力值（有可能超过上限）</p>
<p><img src="https://img.rxliuli.com/20191229214543.png" alt="副本"></p>
<p>至于为什么吾辈的体力这么多（<code>5972/141</code>），原因便是吾辈连续升级了几十次，每次升级就会增加以此体力上限的体力值，故而才这么多的！当然，这种重复性的工作吾辈作为一个开发者自然是写了一个 AutoJS 脚本自动刷活动，连续两天几乎没停，但也只升了 50 级左右，可见升级的困难了。</p>
<p><img src="https://img.rxliuli.com/20191229215050.png" alt="AutoJS 脚本"></p>
<p>而扭蛋，非洲人什么话都不想说 QAQ，虽然还不到一个月，但游戏里已然氪了接近 3000 的软妹币了，更别说花费的时间与精力了，然而即便如此生存依旧苦难。<br>下面是目前正开着的池子的一些数据</p>
<p><img src="https://img.rxliuli.com/20191229215444.png" alt="池子的 XUR 公主"><br><img src="https://img.rxliuli.com/20191229215604.png" alt="详情 1"><br><img src="https://img.rxliuli.com/20191229215617.png" alt="详情 2"><br><img src="https://img.rxliuli.com/20191229215624.png" alt="详情 3"></p>
<p>可以看到，除了第一次，后面每次的抽奖都要 <code>1w</code> 星星，而抽到 XUR 公主的概率。。。不过是 <code>0.01%</code>。那么，1w 星星到底相当于多少软妹币呢？</p>
<p><img src="https://img.rxliuli.com/20191229215910.png" alt="官方商店"></p>
<p>可以看到，即便现在有着额外送 30% 的活动，1w 星星仍然需要接近 1w 日元左右，让我们来计算一下星星的单价吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11000</span> / <span class="number">15431</span> / <span class="number">15.64</span> === <span class="number">0.045578692773257934</span></span><br></pre></td></tr></table></figure>

<p>看起来似乎并不多，我们计算一下总价</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.045578692773257934</span> * (<span class="number">10000</span> * <span class="number">5</span> + <span class="number">5000</span>) === <span class="number">2506.8281025291863</span></span><br></pre></td></tr></table></figure>

<p>那么抽 6 次得到 XUR 的概率是？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> + <span class="number">5</span> * <span class="number">4</span> + <span class="number">10</span> === <span class="number">33</span></span><br></pre></td></tr></table></figure>

<p>哦，看起来有点不妙了，仅仅为了一张卡抽 6 次池子，便如此大动干戈，即便如此，获得 XUR 的概率也只有 <code>33%</code>，这。。。(╯‵□′)╯︵┻━┻</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>唉，不管怎样，都无法找到曾经为了游戏肝了几天时间，甚至为此压缩睡眠，看到获得了自己想要的公主之后便很快乐的感觉 – 一切都无法回到从前了！</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/" class="post-title-link" itemprop="url">2019 回忆及 2020 目标</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-23 13:06:10" itemprop="dateCreated datePublished" datetime="2019-12-23T13:06:10+08:00">2019-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-12-24 00:00:00" itemprop="dateModified" datetime="2019-12-24T00:00:00+08:00">2019-12-24</time>
    </span>


  
    <span id="/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/" class="post-meta-item leancloud_visitors" data-flag-title="2019 回忆及 2020 目标" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="2019 回忆及 2020 目标" href="/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::2df17ffad93505d12ffe17b24cc69d80" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="往事凌乱"><a href="#往事凌乱" class="headerlink" title="往事凌乱"></a>往事凌乱</h2><p>对于吾辈而言，今年发生的几件事情</p>
<ul>
<li>转型成为前端</li>
<li>淡出 Twitter 中文圈，逐渐回归 Telegram&#x2F;QQ</li>
<li>博客写作频率逐渐降低，但 GitHub 使用逐渐变多</li>
<li>扎起头发，便是在家中亦然</li>
<li>换了一家 2C 的互联网公司</li>
</ul>
<p>年前想要做的事情，如今却也不大记得了。暂且记得，曾经觉得前端日新月异的想象，现实之中却不尽然。2C 的网站甚至到了目前仍然必须支持 <code>IE</code>，而且前端混乱的生态也让人头疼不已，不仅是 UI 在不同框架的实现不一致，甚至连很多纯 JS 库也是直接依赖于框架了，成为了某个框架的一部分。例如 <code>Redux</code>，号称是通用的状态管理库，然而除了 <code>React</code>，没有框架真正在使用它，<code>Vue</code> 有自己的 <code>Vuex</code>，<code>Angular</code> 也有 <code>RxJS</code>。</p>
<blockquote>
<p>前端框架之间的割裂与没有使用框架之前的割裂真是天壤之别。</p>
</blockquote>
<p>下半年，吾辈进入了一家 2C 的互联网公司，真的是各种加班，具体详情参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/63bdcead/">一些烦心事</a>。精力消耗殆尽，感觉有时间，但又不想学什么东西，陷入了某种怪圈之中。</p>
<h2 id="未来渺茫"><a href="#未来渺茫" class="headerlink" title="未来渺茫"></a>未来渺茫</h2><p>明年，吾辈最想要接触的是 Web 桌面开发，以及机器学习。</p>
<ul>
<li><input disabled="" type="checkbox"> NodeJS 后端开发</li>
<li><input disabled="" type="checkbox"> Web 桌面开发 Electron</li>
<li><input disabled="" type="checkbox"> 机器学习 TensorFlow</li>
<li><input disabled="" type="checkbox"> 继续维护 Blog</li>
<li><input disabled="" type="checkbox"> 继续坚持读书</li>
<li><input disabled="" type="checkbox"> 尝试网络小说写作</li>
<li><input disabled="" type="checkbox"> 尝试 Youtube 视频创作</li>
</ul>
<hr>
<p>Pass 1: 感觉上，人工智能必然取代各种各样的工作，程序员或许也无法幸免于难，而最不容易被替代的，大概就是创作型的工作吧！</p>
<hr>
<p>Pass 2：下面是一段吾辈想要写作的小说的设定集</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 设定集</span></span><br><span class="line"></span><br><span class="line">围绕时间基点进行跳跃，逐渐向着基点流动，但却永远不会真的到达。</span><br><span class="line"></span><br><span class="line">明线是琉璃和瑞雪的感情，暗线是探索世界的真实与否。</span><br><span class="line"></span><br><span class="line">第一卷 现实</span><br><span class="line"></span><br><span class="line">从琉璃在生日之前回溯了一天开始，后又回溯到出生点之时，再次开始了新的人生，直到，某个绝望的事实笼罩了她之后，心灰意冷的再次懵懵懂懂的回到了小时候。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 百合线</span></span><br><span class="line"></span><br><span class="line">第二卷 黑暗</span><br><span class="line"></span><br><span class="line">因为上一世受到了严重的心理阴影，看着所有的努力化作泡影，琉璃再也没有做任何事情的动力了。在学校中，她变成了七大不可思议的传说之一。随心所欲，和家人的关系破裂，虽靠着两世的经验尚未有大问题，但心却早已经死了。直到，高中快要结束之时，她，参加了瑞雪的葬礼。然而，瑞雪在临终前的话语终究让死掉的心产生了悸动。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 黑暗线</span></span><br><span class="line"></span><br><span class="line">第三卷 无限</span><br><span class="line"></span><br><span class="line">她说：无论多少次，吾辈一定会拯救你的。少女立下了拯救另一个少女的誓言，但一切真能如其所愿么？</span><br><span class="line"></span><br><span class="line">不断重复，不断轮回，一个人终究无法推动整个世界到达能够医治瑞雪的方式。甚至在某次暴露了这个秘密，直接了被切片研究，并最终导致世界大战爆发。</span><br><span class="line"></span><br><span class="line">第四卷 未来</span><br><span class="line"></span><br><span class="line">再次重生的少女，不，现在已经是老婆婆的琉璃，发现世界已经到了 2060 年了。是的，她没有再次回到过去，而是活到了未来。但是，她发现了一个怪异之处：时间，似乎在倒流？但是思维却并没有，为什么其他人却很习惯的样子呢？</span><br><span class="line"></span><br><span class="line">她，想了解这个世界。为什么时间逆流，产生了 绝对的宿命论！</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 科幻线</span></span><br><span class="line"></span><br><span class="line">第四卷 幻想</span><br><span class="line"></span><br><span class="line">结果，再次在生日之后的前一刻，琉璃的时间再次跳跃到不知名的位置，没能回到原来的世界。而且，她也变成了一块石头，女娲石。后来，琉璃几经辗转，来到了红楼梦之中。神（张恒），降临了，但他却绝望的发现这是个虚假的世界。并且，发现了她。</span><br><span class="line"></span><br><span class="line">自此，琉璃被困在了各种 GalGame 和里番之中，虽是虚拟的世界，但却完全感同身受。</span><br><span class="line"></span><br><span class="line">最终，琉璃的灵魂想要转移到刚出生的琉璃身上，却被张恒阻止了。最终，到了琉璃的生日，世界，破碎了。张恒这才明白了什么，但也无法阻止。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 幻想线</span></span><br><span class="line"></span><br><span class="line">第五卷 死亡</span><br><span class="line"></span><br><span class="line">论琉璃的 999 种死法。</span><br><span class="line"></span><br><span class="line">突然有一天，琉璃发现自己很容易遭到意外了。一开始只是出门时碰到了一只黑猫，再之后是在高楼下差点被花盆砸中，后来甚至在一个十字路口碰到了车祸现场，最后，她在洗澡时莫名其妙的死掉了。</span><br><span class="line"></span><br><span class="line">第六卷 真相</span><br><span class="line"></span><br><span class="line">世界只是一个实验，为了培育超级 ai 所用。然而实验结束了，准备销毁她。在将要封存一切时，张恒留下的东西让她「消失」了。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 楚门的世界</span></span><br><span class="line"></span><br><span class="line">一切都是假的，都是人造的，是某个实验计划的一部分，而她，便是这个世界中的「楚门」，但她最后，却没有选择去留的权利，唯有死亡一途。</span><br></pre></td></tr></table></figure>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/" class="post-title-link" itemprop="url">Notion 使用体验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-04 22:34:39" itemprop="dateCreated datePublished" datetime="2019-12-04T22:34:39+08:00">2019-12-04</time>
    </span>


  
    <span id="/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/" class="post-meta-item leancloud_visitors" data-flag-title="Notion 使用体验" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Notion 使用体验" href="/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::cffa7fe0c59551f4858311e760b03361" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Notion-使用体验"><a href="#Notion-使用体验" class="headerlink" title="Notion 使用体验"></a>Notion 使用体验</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://notion.so/">官网</a></p>
</blockquote>
<p>Notion 是一个基于 Web 的跨平台笔记工具，在了解过印象笔记、OneNote、为知笔记和有道云笔记之后，吾辈选择了 Notion。</p>
<p>之所以没有选择上面列出的几个，都有一些原因</p>
<ul>
<li>印象笔记<ul>
<li>不直接支持 Markdown</li>
<li>编辑器体验并不好</li>
<li>不能以目录分割笔记</li>
</ul>
</li>
<li>OneNote<ul>
<li>完全不支持 Markdown</li>
</ul>
</li>
<li>为知笔记<ul>
<li>国产软件，肯定会上报数据</li>
</ul>
</li>
<li>为知笔记<ul>
<li>同上</li>
</ul>
</li>
</ul>
<p>吾辈的对笔记工具的要求也很简单</p>
<ul>
<li><input disabled="" type="checkbox"> 允许在线&#x2F;本地编辑</li>
<li><input disabled="" type="checkbox"> 本地编辑器体验必须要好</li>
<li><input disabled="" type="checkbox"> 支持 Markdown 语法</li>
<li><input disabled="" type="checkbox"> 搜索速度要快并且支持中文</li>
</ul>
<p>很遗憾，虽然吾辈选择了 Notion，并不代表它满足了所有需求，只是目前存在的选择中，最适合吾辈的罢了（搜索速度和中文支持真的很硬伤）。</p>
<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul>
<li><code>C-B</code>：将选定文字加粗，或者结束加粗模式</li>
<li><code>C-I</code>：将选定文字变成斜体，或者结束斜体模式</li>
<li><code>C-E</code>：将选定区域为行内代码，或者结束行内代码模式</li>
<li><code>S-鼠标滚轮</code>：水平滚动</li>
<li><code>CS-L</code>：切换夜间模式</li>
<li><code>C-V + Link</code>：选中文字粘贴链接，会直接将文字变成可点击链接</li>
<li><code>CS-Up/Down</code>：将当前行上移&#x2F;下移</li>
<li><code>S-Enter</code>：不完成当前区块的情况下换行。类似于 QQ 的回车发送消息，<code>Shift-Enter</code> 换行一样。</li>
<li><code>Tab</code>：缩进一个 Tab</li>
<li><code>S-Tab</code>：反向缩进一个 Tab</li>
<li><code>/</code>：可以搜索并使用命令</li>
</ul>
<h2 id="快捷-Block-片段"><a href="#快捷-Block-片段" class="headerlink" title="快捷 Block 片段"></a>快捷 Block 片段</h2><p>输入后按空格即可生成的特定 Block 的字符</p>
<ul>
<li><code>-</code>：无序列表</li>
<li><code>Number</code>：有序列表</li>
<li><code>[]</code>：待办事项列表</li>
<li><code>&gt;</code>：可折叠层级列表（和 markdown 语义不同了）</li>
<li><code>&quot;</code>：引用（这才是 markdown 中 <code>&gt;</code> 在 notion 中的关键字）</li>
<li><code>``</code>：行内代码块<ul>
<li>必须在输入第一个 <code>之后，输入代码，再输入第二个</code> 才有效</li>
<li>生成行内代码片段后，必须紧跟一个空格，如果输入之后又删除掉，再次输入就会被当成行内代码，这时候使用 <code>C-E</code> 可将下一个字符指定为行内代码之外的文本。</li>
</ul>
</li>
<li><code>```</code>：区域代码块<ul>
<li>无法直接指定语言，必须在选择框内选择语言（鼠标）</li>
</ul>
</li>
</ul>
<h2 id="夜间模式"><a href="#夜间模式" class="headerlink" title="夜间模式"></a>夜间模式</h2><p>通过 <code>CS-L</code> 进行切换，也可以在 <code>Settings &amp; Members</code> 中找到 <code>Dark Mode</code> 这个切换。</p>
<p><img src="https://img.rxliuli.com/20191201224609.png" alt="Notion 夜间模式"></p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li><p>编辑真的很卡！</p>
</li>
<li><p>性能不好</p>
<ul>
<li>大文件</li>
<li>包含图片</li>
<li>导入 markdown</li>
</ul>
</li>
<li><p>粘贴富文本链接存在问题</p>
</li>
<li><p>没有列编辑</p>
</li>
<li><p>没有 <strong>标签</strong> 的概念，导致分类只能依赖于目录，不能跨目录进行某种关联。例如 <strong>未完成</strong></p>
</li>
<li><p>就单纯的编辑体验上还说不上非常好，至少比起 VSCode 还有一段距离</p>
</li>
<li><p>无法深度导出 PDF（需要企业版），导致想要打印资料会很不方便</p>
</li>
<li><p>bug</p>
<ul>
<li><p>从编辑器之外点击编辑器，第一次并不会获取到焦点，需要点第二次才行（只出现在 Windows 自动分屏）</p>
</li>
<li><p>代码块中同时存在中文和英文时粘贴后只剩中文部分，英文代码不见了</p>
</li>
<li><p>从 VSCode 的 markdown 预览区复制的区域代码块最后总是会多出空行</p>
</li>
<li><p>代码高亮渲染问题，目前 <code>TypeScript/HTML</code> 是存在问题的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个用于解构 Promise 中的泛型类</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PromiseDeconstruct</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&gt; = T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;infer R&gt;</span><br><span class="line">  ? R</span><br><span class="line">  : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="attr">i</span>: <span class="title class_">PromiseDeconstruct</span>&lt;<span class="keyword">typeof</span> res&gt; = <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><p>笔记适合作为整理资料的方式，而作为写作工具的话体验却是还差了点。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/" class="post-title-link" itemprop="url">[命名规范] 介词</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-03 12:52:38" itemprop="dateCreated datePublished" datetime="2019-12-03T12:52:38+08:00">2019-12-03</time>
    </span>


  
    <span id="/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/" class="post-meta-item leancloud_visitors" data-flag-title="[命名规范] 介词" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="[命名规范] 介词" href="/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::22ec16feaa8f25509ec3794eadaab7e1" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>319</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="命名规范-介词"><a href="#命名规范-介词" class="headerlink" title="[命名规范] 介词"></a>[命名规范] 介词</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在为变量命名时，经常需要，在某些单词之间添加介词。例如 <code>searchByName</code>，根据名字搜索数据。下面就介绍一下开发中所用到的介词以及相关的使用场景及示例。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li><code>by</code>: **根据…做…**，表示根据或者使用的条件，例如 <code>searchByName</code></li>
<li><code>with</code>: **根据…与…做…**，与上面 <code>by</code> 的区别在于需要同时操作两个对象<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://lodash.com/">lodash</a> 中 <code>...By</code> 与 <code>...With</code> 的区别</li>
</ul>
</li>
<li><code>to</code>: **从…到…**，表示状态或数据结构的变化，例如 <code>arrayToMap</code></li>
<li><code>of</code>： <strong>…的</strong>，例如 <code>indexOf</code>, <code>typeof</code>, <code>instanceof</code></li>
<li><code>for</code></li>
<li><code>on</code>: <strong>在…之上</strong></li>
<li><code>in</code>: <strong>在…之中</strong></li>
<li><code>at</code></li>
</ul>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/149000464.html">介词 to、for、of、in、on、at、with、by、about 的用法</a></p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/">32</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ftq</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:55</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"6NuBzi5VSiFfQE2sYbymtv9t-gzGzoHsz","app_key":"stH9SzRt55d1wnwQD7LcoaQR","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyw21b1ST","appkey":"045a89927c13c0e33a82c736b468fe51"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
