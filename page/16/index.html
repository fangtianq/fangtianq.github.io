<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fangtianq.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"changyan","storage":false,"lazyload":false,"nav":null,"activeClass":"changyan"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="有志者事竟成">
<meta property="og:type" content="website">
<meta property="og:title" content="越努力，越幸运！">
<meta property="og:url" content="https://fangtianq.github.io/page/16/index.html">
<meta property="og:site_name" content="越努力，越幸运！">
<meta property="og:description" content="有志者事竟成">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ftq">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fangtianq.github.io/page/16/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/16/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>越努力，越幸运！</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">越努力，越幸运！</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Where there is a will, there is a way!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">55</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">21</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">322</span></a></li><li class="menu-item menu-item-留言版"><a href="/guestbook/" rel="section"><i class="comments fa-fw"></i>留言版</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-friendlink"><a href="/friendlink/" rel="section"><i class="link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ftq"
      src="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
  <p class="site-author-name" itemprop="name">ftq</p>
  <div class="site-description" itemprop="description">有志者事竟成</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">322</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fangtianq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/fangtianq" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.github.io/" title="GitHub.io → https:&#x2F;&#x2F;fangtianq.github.io&#x2F;"><i class="github fa-fw"></i>GitHub.io</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.gitee.io/" title="Gitee.io → https:&#x2F;&#x2F;fangtianq.gitee.io&#x2F;" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee.io</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://leetcode-cn.com/" title="https:&#x2F;&#x2F;leetcode-cn.com&#x2F;" rel="noopener" target="_blank">力扣网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://rap2.taobao.org/" title="http:&#x2F;&#x2F;rap2.taobao.org&#x2F;" rel="noopener" target="_blank">RAP2接口管理平台</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/05/03/java/guava/guava%E5%B8%B8%E7%94%A8%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/03/java/guava/guava%E5%B8%B8%E7%94%A8%E7%B1%BB/" class="post-title-link" itemprop="url">guava常用类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-03 11:39:00" itemprop="dateCreated datePublished" datetime="2020-05-03T11:39:00+08:00">2020-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/guava/" itemprop="url" rel="index"><span itemprop="name">guava</span></a>
        </span>
    </span>


  
    <span id="/2020/05/03/java/guava/guava%E5%B8%B8%E7%94%A8%E7%B1%BB/" class="post-meta-item leancloud_visitors" data-flag-title="guava常用类" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="guava常用类" href="/2020/05/03/java/guava/guava%E5%B8%B8%E7%94%A8%E7%B1%BB/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::c83e7c3572a69faea428f42b8acb05b1" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>请添加个描述吧</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/03/java/guava/guava%E5%B8%B8%E7%94%A8%E7%B1%BB/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/05/03/java/guava/guava%E7%BC%93%E5%AD%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/03/java/guava/guava%E7%BC%93%E5%AD%98/" class="post-title-link" itemprop="url">guava缓存</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-03 11:36:00" itemprop="dateCreated datePublished" datetime="2020-05-03T11:36:00+08:00">2020-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/guava/" itemprop="url" rel="index"><span itemprop="name">guava</span></a>
        </span>
    </span>


  
    <span id="/2020/05/03/java/guava/guava%E7%BC%93%E5%AD%98/" class="post-meta-item leancloud_visitors" data-flag-title="guava缓存" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="guava缓存" href="/2020/05/03/java/guava/guava%E7%BC%93%E5%AD%98/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::47129cad588db0132dfafa66f2fb869e" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>请添加个描述吧</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/03/java/guava/guava%E7%BC%93%E5%AD%98/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/05/03/gist/%E4%BD%BF%E7%94%A8yugong%E5%B0%86Orcale%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0Mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/03/gist/%E4%BD%BF%E7%94%A8yugong%E5%B0%86Orcale%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0Mysql/" class="post-title-link" itemprop="url">使用yugong将Orcale数据迁移到Mysql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-03 10:17:54" itemprop="dateCreated datePublished" datetime="2020-05-03T10:17:54+08:00">2020-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/gist/" itemprop="url" rel="index"><span itemprop="name">gist</span></a>
        </span>
    </span>


  
    <span id="/2020/05/03/gist/%E4%BD%BF%E7%94%A8yugong%E5%B0%86Orcale%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0Mysql/" class="post-meta-item leancloud_visitors" data-flag-title="使用yugong将Orcale数据迁移到Mysql" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="使用yugong将Orcale数据迁移到Mysql" href="/2020/05/03/gist/%E4%BD%BF%E7%94%A8yugong%E5%B0%86Orcale%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0Mysql/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::a87ef49a3905f1a1bd1bf054f128bb8d" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>0</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>描述</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/03/gist/%E4%BD%BF%E7%94%A8yugong%E5%B0%86Orcale%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0Mysql/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/05/03/javascript/easyui%E5%8F%AF%E7%BC%96%E8%BE%91%E8%A1%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/03/javascript/easyui%E5%8F%AF%E7%BC%96%E8%BE%91%E8%A1%A8/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-03 10:17:54" itemprop="dateCreated datePublished" datetime="2020-05-03T10:17:54+08:00">2020-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/js/" itemprop="url" rel="index"><span itemprop="name">js</span></a>
        </span>
    </span>


  
    <span id="/2020/05/03/javascript/easyui%E5%8F%AF%E7%BC%96%E8%BE%91%E8%A1%A8/" class="post-meta-item leancloud_visitors" data-flag-title="" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="" href="/2020/05/03/javascript/easyui%E5%8F%AF%E7%BC%96%E8%BE%91%E8%A1%A8/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::f1e6689bea32ec69603ebaba2f8ddf76" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>描述</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/03/javascript/easyui%E5%8F%AF%E7%BC%96%E8%BE%91%E8%A1%A8/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/05/01/others/rxliuliBlog/Tool/Android/Android-%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8-Kiwi-browser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/01/others/rxliuliBlog/Tool/Android/Android-%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8-Kiwi-browser/" class="post-title-link" itemprop="url">Android 上最好的浏览器 Kiwi browser</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-01 14:38:34" itemprop="dateCreated datePublished" datetime="2020-05-01T14:38:34+08:00">2020-05-01</time>
    </span>


  
    <span id="/2020/05/01/others/rxliuliBlog/Tool/Android/Android-%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8-Kiwi-browser/" class="post-meta-item leancloud_visitors" data-flag-title="Android 上最好的浏览器 Kiwi browser" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Android 上最好的浏览器 Kiwi browser" href="/2020/05/01/others/rxliuliBlog/Tool/Android/Android-%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8-Kiwi-browser/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::a45f6aecefecdab3eb7cea315ce09f3c" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://kiwibrowser.com/">官网</a></p>
</blockquote>
<p>或许对于现在很多人来说，浏览器是一个很少使用的 App，因为所有功能都可以在 App 做，不需要使用浏览器。一方面，是由于国内的大环境就是把用户当成傻瓜（事实上，即便是吾辈目前所在的公司，在 UI&#x2F;UX 设计方面也倾向于将用户当成傻瓜），导致用户真的是越来越傻瓜，甚至遇到了除了微信其他的都不怎么会用的地步，更何况浏览器这种“<strong>高端</strong>”的 App 呢？<br>然而对于某些特定人群来说，尤其是不喜欢安装太多 App 的人来说，浏览器几乎是 App 上数一数二的应用了，甚至称之为互联网的入口都不为过（现在一般的傻瓜式用户大概认为微信才是吧，缅怀曾经互联网都是通过浏览器使用的时代）。<br>在使用过 <em>UC &#x3D;&gt; Chrome &#x3D;&gt; FireFox &#x3D;&gt; Kiwi browser</em> 之后，吾辈可以确定的说，Kiwi browser 是目前 Android 上最好的浏览器，其中尤以支持 Chrome PC 版的 Plugin 最为有名。</p>
<h2 id="使用过的浏览器"><a href="#使用过的浏览器" class="headerlink" title="使用过的浏览器"></a>使用过的浏览器</h2><h3 id="UC-浏览器（国内版）"><a href="#UC-浏览器（国内版）" class="headerlink" title="UC 浏览器（国内版）"></a>UC 浏览器（国内版）</h3><p>在早期吾辈使用的浏览器中，UC 绝对是当年（2016 年之前）使用体验非常好的浏览器，直到后来被阿里系收购，导致它逐渐充斥着各种广告，甚至首先开辟出了<a target="_blank" rel="noopener" href="http://kf.uc.cn/self_service/web/faqdetails-8311412_9210815_20559164_5.html">浏览器收费</a>这一跨世纪倒车壮举。</p>
<p><img src="https://img.rxliuli.com/20200501141319.jpg" alt="UC 国内版首页"><br><img src="https://img.rxliuli.com/20200501141320.png" alt="UC 国内版搜索"></p>
<blockquote>
<p>附：这里的跨世纪倒车壮举指的是自从浏览器始祖 Netscape 被 MS 的 IE 使用系统捆绑 + 免费的策略干掉以后，后来流行起来的浏览器还从未出现过收费的（或许是吾辈孤陋寡闻了？）<br>附：所有的国内浏览器都有内置的黑名单，例如 GitHub 上的 996 icu 就被国内浏览器屏蔽了，不仅仅是墙，就连浏览器都是墙的帮凶。参考：<a target="_blank" rel="noopener" href="http://kf.uc.cn/self_service/web/faqdetails-9212655_9212659_20389994_6.html">国外网站无法访问？</a></p>
</blockquote>
<h3 id="UC-浏览器（国际版）"><a href="#UC-浏览器（国际版）" class="headerlink" title="UC 浏览器（国际版）"></a>UC 浏览器（国际版）</h3><p>UC 国际版，这是一个比较有趣的版本，没有国内版那么多花俏无用的功能，但同时不支持简体中文（当然支持繁体中文），同时保留了 UC 的核心功能——怪不得手机上 UC 的使用占有率很高呢！<br>它默认支持的主要功能如下</p>
<ul>
<li>广告过滤</li>
<li>黑暗模式</li>
<li>手势方面几近完美</li>
<li>下载功能</li>
<li>自带 QR</li>
</ul>
<p><img src="https://img.rxliuli.com/20200501141317.png" alt="UC 国际版首页"><br><img src="https://img.rxliuli.com/20200501141318.png" alt="UC 国际版搜索"></p>
<p>看起来没什么太大的问题，然而，它却在隐私方面做的一如既往的烂，参考：<a target="_blank" rel="noopener" href="https://web.archive.org/web/20180228041423/http://news.163.com/16/0330/10/BJDBF3TT00014AEE.html">美媒:中国人上网须防泄露隐私 浏览器存安全隐患</a></p>
<h3 id="Chrome-for-Android"><a href="#Chrome-for-Android" class="headerlink" title="Chrome for Android"></a>Chrome for Android</h3><p>后来，吾辈在 PC 上先后遇到了 FireFox 和 Chrome，简直比国内的各种浏览器干净整洁了一百倍。在实际使用过相当长的一段时间后，吾辈最终在 PC 上选择了 Chrome，手机上也安装了 Chrome 进行网页浏览，它的速度非常理想，使用体验也还算不错，尤其是翻译功能更是被完整地保留了下来。唯有一点，插件功能被整个砍掉了。</p>
<p><img src="https://img.rxliuli.com/20200501141709.png" alt="Chrome 首页"><br><img src="https://img.rxliuli.com/20200501141404.png" alt="Chrome 搜索"><br><img src="https://img.rxliuli.com/20200501141403.png" alt="Google 翻译功能"></p>
<blockquote>
<p>为什么 Chrome For Android 不支持插件？虽然官方说是为了使之能够在较旧的浏览器上也能正常运行，但实际上应该有两个原因</p>
<ol>
<li>Android 是 Google 自己的，而 Google 对于 App 的控制力要超过网页，所以为了让用户使用 App，Google 不原因让用户更多的浏览网页。</li>
<li>大约 70％的 chrome 用户在 android 和 ios 端，只有 30％的 chrome 用户在台式机和 mac 上。谷歌知道，如果他们在智能手机上引入扩展功能，那么由于广告拦截器的存在，他们将损失很多钱，而且大多数互联网用户由于舒适性，大部分时间都倾向于将智能手机用于互联网。Google 在这里玩一个聪明的游戏。参考：<a target="_blank" rel="noopener" href="https://www.quora.com/Why-arent-there-any-extensions-for-Google-Chrome-on-Android">https://www.quora.com/Why-arent-there-any-extensions-for-Google-Chrome-on-Android</a></li>
</ol>
</blockquote>
<h3 id="FireFox-for-Android"><a href="#FireFox-for-Android" class="headerlink" title="FireFox for Android"></a>FireFox for Android</h3><p>所以，在知道 FireFox 在 Android 上亦支持插件后，吾辈感觉它就是吾辈理想中的手机浏览器，吾辈在手机上也开始尝试使用 FireFox 了。但事与愿违，它真的太慢了。。。在使用体验上和 Chrome 无法相提并论,而且翻译插件的支持不完善导致有时候想在移动端阅读大量英文网页时还需要切到 Chrome.</p>
<blockquote>
<p>注：FireFox 的桌面版插件支持存在一些问题，同时插件官方一直未曾修复，这也是吾辈放弃 FireFox 的重要原因之一。</p>
</blockquote>
<p><img src="https://img.rxliuli.com/20200501141432.png" alt="FireFox 首页"><br><img src="https://img.rxliuli.com/20200501141433.png" alt="FireFox 搜索"></p>
<h3 id="Kiwi-browser"><a href="#Kiwi-browser" class="headerlink" title="Kiwi browser"></a>Kiwi browser</h3><p>最终，吾辈遇到了 Kiwi browser，诚然，它也不是十全十美的，也有很多缺点。</p>
<ul>
<li>默认主页的新闻资讯很讨厌，而且还无法关闭。</li>
<li>翻译功能没有 Chrome 强大，没有<strong>就地</strong>全文翻译的功能</li>
<li>不是一个非常流行的浏览器，没有桌面版本，没有同步功能</li>
</ul>
<p>但有一个及其突出的优点，足以掩盖以上的所有缺点 – 支持 Chrome 桌面版插件。</p>
<p><img src="https://img.rxliuli.com/20200501141349.png" alt="Kiwi 首页"><br><img src="https://img.rxliuli.com/20200501141348.png" alt="Kiwi 翻译"></p>
<h3 id="微型浏览器"><a href="#微型浏览器" class="headerlink" title="微型浏览器"></a>微型浏览器</h3><p>事实上，吾辈也曾断断续续地使用过一些微型浏览器，在功能上做的比较简洁（但并不意味着不够用），但内核却薄弱不堪（其实就是用系统默认浏览器的内核）。<br>包括但不限于以下列表</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=mark.via.gp&hl=en_US">via 浏览器</a></li>
<li><a target="_blank" rel="noopener" href="https://www.coolapk.com/apk/org.noear.h5">h5 浏览器</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xbext.com/">X 浏览器</a></li>
</ul>
<p>其他吾辈没有使用过的浏览器可以参考：<a target="_blank" rel="noopener" href="https://m.xianjichina.com/news/details_145337.html">手机浏览器有哪些？安卓平台良心浏览器推荐</a></p>
<p>虽然这些微型浏览器理念很好：<strong>少即是多，简单就是美！</strong>，但实际上，这些没有内核的浏览器很多地方，尤其是性能方面，仍然受限于系统默认浏览器。大多数自带的插件系统，往往只是实现了一套加载 <code>*.user.js</code> 的机制罢了，而且生态之小与 Chrome&#x2F;FireFox 这些主流其相比往往是天壤之别。</p>
<h2 id="Kiwi-browser-相关"><a href="#Kiwi-browser-相关" class="headerlink" title="Kiwi browser 相关"></a>Kiwi browser 相关</h2><h3 id="Kiwi-browser-推荐的插件"><a href="#Kiwi-browser-推荐的插件" class="headerlink" title="Kiwi browser 推荐的插件"></a>Kiwi browser 推荐的插件</h3><ul>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm">uBlock Origin</a>：广告过滤</li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/dark-reader/eimadpbcbfnmbkopoojfekhnkhdbieeh">Dark Reader</a>：为所有网站加上黑色主题，大部分情况下都还不错</li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/tabliss-a-beautiful-new-t/hipekcciheckooncpjeljhnekcoolahp">Tabliss</a>：美丽的新标签页</li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/lastpass-free-password-ma/hdokiejnpimakedhajhdlcegeplioahd">LastPass</a>：全平台密码管理器</li>
<li><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=zh-CN">Tampermonkey</a>：油猴脚本管理器</li>
</ul>
<blockquote>
<p>桌面的 Chrome 使用建议可以参考：<a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/54be2845/">优化 Google Chrome 的使用体验</a></p>
</blockquote>
<h3 id="二维码扫描"><a href="#二维码扫描" class="headerlink" title="二维码扫描"></a>二维码扫描</h3><p>有时候需要使用二维码扫描使用手机去打开某个网站，而 Kiwi 并没有自带这个功能，所以需要配合 App <a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=mark.qrcode">二维码扫描</a> 食用。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/04/28/others/rxliuliBlog/JavaScript/%E5%81%B6%E9%81%87-HTML-%E4%B8%AD%E7%9A%84%E5%A5%87%E5%A6%99%E5%AD%97%E7%AC%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/28/others/rxliuliBlog/JavaScript/%E5%81%B6%E9%81%87-HTML-%E4%B8%AD%E7%9A%84%E5%A5%87%E5%A6%99%E5%AD%97%E7%AC%A6/" class="post-title-link" itemprop="url">偶遇 HTML 中的奇妙字符</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-28 23:48:27" itemprop="dateCreated datePublished" datetime="2020-04-28T23:48:27+08:00">2020-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-05-05 00:00:00" itemprop="dateModified" datetime="2020-05-05T00:00:00+08:00">2020-05-05</time>
    </span>


  
    <span id="/2020/04/28/others/rxliuliBlog/JavaScript/%E5%81%B6%E9%81%87-HTML-%E4%B8%AD%E7%9A%84%E5%A5%87%E5%A6%99%E5%AD%97%E7%AC%A6/" class="post-meta-item leancloud_visitors" data-flag-title="偶遇 HTML 中的奇妙字符" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="偶遇 HTML 中的奇妙字符" href="/2020/04/28/others/rxliuliBlog/JavaScript/%E5%81%B6%E9%81%87-HTML-%E4%B8%AD%E7%9A%84%E5%A5%87%E5%A6%99%E5%AD%97%E7%AC%A6/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::8c080e808f1b34cc6ae4fc6578076341" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>虽然名字听起来就像是<strong>一本正经的胡说八道</strong>，但吾辈确实遇到了一个奇怪的问题，于此分享给大家。</p>
<p>事情的起始如下</p>
<p><em>下班回家 &#x3D;&gt; 想要看动画 &#x3D;&gt; 去动漫花园下载 BT 种子 &#x3D;&gt; 动漫花园一片空白 &#x3D;&gt; Why？</em></p>
<p><img src="https://raw.githubusercontent.com/rxliuli/img-bed/master/20200429010151.png" alt="默认 uBlock 屏蔽页面"></p>
<p>于是吾辈<strong>偷偷的</strong>的打开了控制台看了一下，发现是页面中的内容元素不见了。经过深思熟虑（好吧其实也就是稍微想了一下）首先把 uBlock 禁用，毕竟这个最容易被网站检测出来并且<strong>对抗</strong>嘛！果不其然，页面恢复了正常，但。。。同时广告也出现在了页面上。</p>
<p><img src="https://img.rxliuli.com/20200429010420.png" alt="默认 uBlock 不屏蔽页面"></p>
<p>这可不行，重新启用了 uBlock 看了一下分析，很显然，内容不存在大概率是被 uBlock 的<strong>元素过滤</strong>功能隐藏掉了，查看被隐藏的内容元素，发现 id 为 <code>1280_adv</code>，但同时又包含了广告与主体内容，所以只要关掉 uBlock 的<strong>元素过滤</strong>就可以避免正常内容被误杀了。</p>
<blockquote>
<p>之所以不在该网站整个禁用掉 uBlock 的原因在于 uBlock 并不只有<strong>元素过滤</strong>，它还阻止了一些广告资源的加载，仅在动漫花园就包括但不限于 _baidu.com, bebi.com, histats.com_。显而易见，禁用它们还能提高加载速度。</p>
</blockquote>
<p><img src="https://img.rxliuli.com/20200429010547.png" alt="uBlock 屏蔽的脚本"></p>
<p>既然无法使用 uBlock 的元素屏蔽了，那么吾辈便需要使用一个新的方式去阻止广告了，幸运的是吾辈安装了 Stylus 和 Tampermonkey 插件。</p>
<blockquote>
<p>Stylus 能够使用被称为 <code>user.css</code> 的技术，能够在本地修改任意网站的样式 – 即自定义 UI 显示。<br>而 Tampermonkey 则更强大，支持 <code>user.js</code> – 可以在本地打开任意网站时载入自定义的 JavaScript 脚本，不再局限于修改 UI，几乎与插件无异（事实上它也确实被认为是更轻量的插件）。</p>
</blockquote>
<p>原以为就几句 css 的事情，找到了广告的 id，于是吾辈写下了下面这些 css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*屏蔽动漫花园的广告*/</span></span><br><span class="line"><span class="selector-class">.ad</span>,</span><br><span class="line"><span class="selector-id">#1280_adv</span>,</span><br><span class="line"><span class="selector-id">#1280_ad</span> &gt; <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-id">#bebiv3_ad</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但结果却是。。。只生效了一半！</p>
<p><img src="https://img.rxliuli.com/20200429010717.png" alt="屏蔽一半"></p>
<p>可以看到，上面两个广告确实被隐藏了，但下面一个却并没有，而且吾辈在控制台直接使用 <code>document.querySelector(&#39;#1280_adv&#39;)</code> 也获取 dom 会抛出错误 <code>SyntaxError: Document.querySelector: &#39;#1280_adv&#39; is not a valid selector</code>。吾辈是直接复制的 id，<strong>理论上</strong>来说不会有错才是。</p>
<p>仔细想想，吾辈或许是漏掉了什么。。。于是，吾辈使用 <strong>Copy &#x3D;&gt; Copy Selector</strong> 功能，有趣的东西出现了，复制出来的内容竟然是 <code>&#39;\31 280_adv&#39;</code>，wtf？</p>
<p>嗯，或许吾辈需要冷静一下，尝试使用 <code>document.querySelector(&quot;#\\31 280_adv&quot;)</code> 获取一下</p>
<blockquote>
<p>注意：这里 JS 里面去查询 DOM Selector 的字符串又进行了转义。</p>
</blockquote>
<p><img src="https://img.rxliuli.com/20200429010811.png" alt="Console 获取"></p>
<p>OK，确实能够正常拿到。由于这些奇怪的字符在 css 中存在语法错误，那么接下来便用 <code>user.js</code> 去屏蔽掉它们吧！</p>
<p>基本实现如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;[</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#\\31 280_adv&#x27;</span>),</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.ad&#x27;</span>),</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#\\31 280_ad &gt; a&#x27;</span>),</span><br><span class="line">].<span class="title function_">forEach</span>(<span class="function">(<span class="params">ad</span>) =&gt;</span> ad.<span class="title function_">remove</span>())</span><br></pre></td></tr></table></figure>

<p>甚至吾辈都发到了 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/userjs/tree/master/src/dmhy">GitHub</a> 与 <a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/402206">GreasyFork</a> 上了。</p>
<p>然后，有个（万能的）网友就提出，可以转换思路，既然 <code>#\\31 280_adv</code> 在 css 中存在语法错误，那么使用属性选择器过滤 id 将值包裹在 <code>&#39;&#39;</code> 之中不就好了么？此话真是九言劝醒迷途仕，一语惊醒梦中人，吾辈瞬间 GET 到了这个点。</p>
<p>于是吾辈编写出了下面这段 <code>user.css</code> 样式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*屏蔽动漫花园的广告*/</span></span><br><span class="line"><span class="selector-class">.ad</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-attr">[id=<span class="string">&#x27;\31 280_adv&#x27;</span>]</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-attr">[id=<span class="string">&#x27;\31 280_ad&#x27;</span>]</span> &gt; <span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-attr">[id=<span class="string">&#x27;bebiv3_ad&#x27;</span>]</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用后效果如下</p>
<p><img src="https://img.rxliuli.com/20200429010852.png" alt="屏蔽后干净的网页"></p>
<p>现在，初始目的达成了，吾辈开始有点好奇它是怎么实现这个功能，于是下载了它的源码，id 那里并未发现什么奇怪的东西，但吾辈却也无法复现一个 demo！</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#test&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;\\31 280_adv&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>demo 效果</p>
<p><img src="https://img.rxliuli.com/20200429011004.png" alt="demo 效果"></p>
<p>如果有人知道原因的话，请务必不吝赐教！</p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ASCII">ASCII Wiki</a></p>
</blockquote>
<hr>
<blockquote>
<p>后续，万能的网友 <a target="_blank" rel="noopener" href="https://disqus.com/by/niamori/">NiaMori</a> 又来说明啦，实际上是 id 以数字开头的原因，具体问题参考：<br>是 id 以数字开头的原因，简单的 <code>&lt;div id=&quot;1&quot;&gt;test&lt;div&gt;</code> 就能复现这个效果。<br><code>document.getElementById(&#39;1&#39;)</code> 能够选中，但 <code>document.querySelector(&#39;#1&#39;)</code> 不能，因为 HTML5 允许 id 以数字开头而 CSS 不允许<br>0x31 是 ‘1’ 的 Unicode 编码值，Copy selector 的时候 Chrome 做了一个智能的 escape<br>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://disq.us/url?url=https://stackoverflow.com/questions/20306204/using-queryselector-with-ids-that-are-numbers:ywx_Ldt8DYLp36vWCEZDC-CT6pM&cuid=5534903">Using querySelector with IDs that are numbers</a></li>
<li><a target="_blank" rel="noopener" href="https://disq.us/url?url=https://www.w3.org/TR/CSS21/syndata.html%23characters:YR69gjoR28vxgXneZXGYH3k8gFM&cuid=5534903">Css Spec</a></li>
<li><a target="_blank" rel="noopener" href="https://disq.us/url?url=https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape:5uLuEmiEmKi4BAwjvTU8OFFY6OQ&cuid=5534903">CSS.escape</a></li>
</ul>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/04/27/others/rxliuliBlog/JavaScript/JavaScript-%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/27/others/rxliuliBlog/JavaScript/JavaScript-%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87/" class="post-title-link" itemprop="url">JavaScript 禁止用户保存图片</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-27 23:41:38" itemprop="dateCreated datePublished" datetime="2020-04-27T23:41:38+08:00">2020-04-27</time>
    </span>


  
    <span id="/2020/04/27/others/rxliuliBlog/JavaScript/JavaScript-%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87/" class="post-meta-item leancloud_visitors" data-flag-title="JavaScript 禁止用户保存图片" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="JavaScript 禁止用户保存图片" href="/2020/04/27/others/rxliuliBlog/JavaScript/JavaScript-%E7%A6%81%E6%AD%A2%E7%94%A8%E6%88%B7%E4%BF%9D%E5%AD%98%E5%9B%BE%E7%89%87/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::f95e40a2ca8f5f0c3c7b89a2440a8018" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在业务需求中不希望用户保存图片，因为是一些供内部使用的图片。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul>
<li>添加事件禁止选择、拖拽、右键（简单的禁止用户保存图片，但无法阻止用户打开控制台查看，或是直接抓包）</li>
<li>将之转换为 canvas（让浏览器认为不是图片以此禁止用户对之进行图片的操作，但无法阻止抓包）</li>
<li>禁止用户使用控制台查看源码（阻止浏览器打开控制台，但无法阻止抓包）</li>
<li>传输图片使用自定义格式（可以阻止抓包，但需要后台配合）</li>
</ul>
<blockquote>
<p>注：以下内容使用 react+ts 实现</p>
</blockquote>
<h2 id="添加事件禁止选择、拖拽、右键"><a href="#添加事件禁止选择、拖拽、右键" class="headerlink" title="添加事件禁止选择、拖拽、右键"></a>添加事件禁止选择、拖拽、右键</h2><p>简而言之，这是一种简单有效的方式，能够在用户不打开控制台的情况下阻止用户保存图片。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">preventDefaultListener</span>(<span class="params">e: any</span>) &#123;</span><br><span class="line">  e.<span class="title function_">preventDefault</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">;<span class="language-xml"><span class="tag">&lt;<span class="name">img</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">src</span>=<span class="string">&#123;props.url&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    //<span class="attr">禁止用户选择</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">userSelect:</span> &#x27;<span class="attr">none</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    //<span class="attr">禁止所有鼠标事件</span>，<span class="attr">过于强大</span>，<span class="attr">图片仅用于展示可用</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    // <span class="attr">pointerEvents:</span> &#x27;<span class="attr">none</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">onTouchStart</span>=<span class="string">&#123;preventDefaultListener&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">onContextMenu</span>=<span class="string">&#123;preventDefaultListener&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">onDragStart</span>=<span class="string">&#123;preventDefaultListener&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dxzg/p/9930559.html">https://www.cnblogs.com/dxzg/p/9930559.html</a></p>
</blockquote>
<h2 id="将之转换为-canvas"><a href="#将之转换为-canvas" class="headerlink" title="将之转换为 canvas"></a>将之转换为 canvas</h2><p>另一种思路是将图片转换为 canvas 避免用户使用 <code>img</code> 相关的操作。</p>
<ol>
<li><p>将图片转成 canvas</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">imageToCanvas</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span>, <span class="attr">canvas</span>: <span class="title class_">HTMLCanvasElement</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//新建Image对象，引入当前目录下的图片</span></span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">    img.<span class="property">src</span> = url</span><br><span class="line">    <span class="keyword">const</span> c = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)!</span><br><span class="line"></span><br><span class="line">    <span class="comment">//图片初始化完成后调用</span></span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//将canvas的宽高设置为图像的宽高</span></span><br><span class="line">      canvas.<span class="property">width</span> = img.<span class="property">width</span></span><br><span class="line">      canvas.<span class="property">height</span> = img.<span class="property">height</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//canvas画图片</span></span><br><span class="line">      c.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, img.<span class="property">width</span>, img.<span class="property">height</span>)</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    img.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>(e)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>禁用 canvas 事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">throwFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">    <span class="string">&quot;Uncaught DOMException: Failed to execute &#x27;toDataURL&#x27; on &#x27;HTMLCanvasElement&#x27;: Tainted canvases may not be exported.&quot;</span>,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> $canvasRef = useRef&lt;<span class="title class_">HTMLCanvasElement</span>&gt;(<span class="literal">null</span>)</span><br><span class="line"> <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">     ;(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">         <span class="keyword">await</span> <span class="title function_">imageToCanvas</span>(props.<span class="property">url</span>, $canvasRef.<span class="property">current</span>!)</span><br><span class="line">         $canvasRef.<span class="property">current</span>!.<span class="property">toBlob</span> = throwFn</span><br><span class="line">         $canvasRef.<span class="property">current</span>!.<span class="property">toDataURL</span> = throwFn</span><br><span class="line">     &#125;)()</span><br><span class="line"> &#125;, [])</span><br><span class="line"> <span class="keyword">return</span> (</span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">canvas</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">ref</span>=<span class="string">&#123;$canvasRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">onTouchStart</span>=<span class="string">&#123;preventDefaultListener&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">         <span class="attr">onContextMenu</span>=<span class="string">&#123;preventDefaultListener&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">     /&gt;</span></span></span><br><span class="line"> )</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="禁止用户使用控制台查看源码"><a href="#禁止用户使用控制台查看源码" class="headerlink" title="禁止用户使用控制台查看源码"></a>禁止用户使用控制台查看源码</h2><p>如果能禁止用户操作控制台，那么自然能够避免用户查看源码了，下面是一个简单的实现。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 兼容异步函数的返回值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> res 返回值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> callback 同步/异步结果的回调函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@typeparam</span> T 处理参数的类型，如果是 Promise 类型，则取出其泛型类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@typeparam</span> Param 处理参数具体的类型，如果是 Promise 类型，则指定为原类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@typeparam</span> R 返回值具体的类型，如果是 Promise 类型，则指定为 Promise 类型，否则为原类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 处理后的结果，如果是同步的，则返回结果是同步的，否则为异步的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> compatibleAsync&lt;T = <span class="built_in">any</span>, <span class="title class_">Param</span> = T | <span class="title class_">Promise</span>&lt;T&gt;, R = T&gt;(</span><br><span class="line">  <span class="attr">res</span>: <span class="title class_">Param</span>,</span><br><span class="line">  <span class="attr">callback</span>: <span class="function">(<span class="params"><span class="attr">r</span>: T</span>) =&gt;</span> R,</span><br><span class="line">): <span class="title class_">Param</span> <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;T&gt; ? <span class="title class_">Promise</span>&lt;R&gt; : R &#123;</span><br><span class="line">  <span class="keyword">return</span> (res <span class="keyword">instanceof</span> <span class="title class_">Promise</span></span><br><span class="line">    ? res.<span class="title function_">then</span>(callback)</span><br><span class="line">    : <span class="title function_">callback</span>(res <span class="keyword">as</span> <span class="built_in">any</span>)) <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试函数的执行时间</span></span><br><span class="line"><span class="comment"> * 注：如果函数返回 Promise，则该函数也会返回 Promise，否则直接返回执行时间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fn 需要测试的函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 执行的毫秒数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> timing&lt;R&gt;(</span><br><span class="line">  <span class="attr">fn</span>: <span class="function">(<span class="params">...<span class="attr">args</span>: <span class="built_in">any</span>[]</span>) =&gt;</span> R,</span><br><span class="line">  <span class="comment">// 函数返回类型是 Promise 的话，则返回 Promise&lt;number&gt;，否则返回 number</span></span><br><span class="line">): R <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; ? <span class="title class_">Promise</span>&lt;<span class="built_in">number</span>&gt; : <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> begin = performance.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">const</span> res = <span class="title function_">fn</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">compatibleAsync</span>(res, <span class="function">() =&gt;</span> performance.<span class="title function_">now</span>() - begin)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 禁止他人调试网站相关方法的集合对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AntiDebug</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 不停循环 debugger 防止有人调试代码</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 取消函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">cyclingDebugger</span>(): <span class="title class_">Function</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">debugger</span></span><br><span class="line">    &#125;, <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(res)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 检查是否正在 debugger 并调用回调函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> fn 回调函数，默认为重载页面</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> 取消函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">checkDebug</span>(</span><br><span class="line">    <span class="attr">fn</span>: <span class="title class_">Function</span> = <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(),</span><br><span class="line">  ): <span class="title class_">Function</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> diff = <span class="title function_">timing</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (diff &gt; <span class="number">500</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(diff)</span><br><span class="line">        <span class="title function_">fn</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> cancel1 = <span class="title class_">AntiDebug</span>.<span class="title function_">cyclingDebugger</span>() <span class="keyword">as</span> any</span><br><span class="line">  <span class="keyword">const</span> cancel2 = <span class="title class_">AntiDebug</span>.<span class="title function_">checkDebug</span>(<span class="function">() =&gt;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请不要打开调试&#x27;</span>),</span><br><span class="line">  ) <span class="keyword">as</span> any</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cancel1</span>()</span><br><span class="line">    <span class="title function_">cancel2</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;url&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="传输图片使用自定义格式"><a href="#传输图片使用自定义格式" class="headerlink" title="传输图片使用自定义格式"></a>传输图片使用自定义格式</h2><p>该功能需要服务端配合，故而此处赞不实现，可以参考 <a target="_blank" rel="noopener" href="https://weread.qq.com/">微信读书</a>，就是将文本转为 canvas，数据传输也进行了加密，可以在很大程度上防止普通用户想要复制&#x2F;下载的行为了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如同所有的前端限制用户的技术一样，这是一个没有终点的斗争。。。</p>
<blockquote>
<p>参考广告屏蔽和屏蔽复制粘贴的发展。。。</p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/04/18/others/rxliuliBlog/JavaScript/%E5%9C%A8%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Worker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/18/others/rxliuliBlog/JavaScript/%E5%9C%A8%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Worker/" class="post-title-link" itemprop="url">在现代前端项目中使用 Worker</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-18 22:19:57" itemprop="dateCreated datePublished" datetime="2020-04-18T22:19:57+08:00">2020-04-18</time>
    </span>


  
    <span id="/2020/04/18/others/rxliuliBlog/JavaScript/%E5%9C%A8%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Worker/" class="post-meta-item leancloud_visitors" data-flag-title="在现代前端项目中使用 Worker" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="在现代前端项目中使用 Worker" href="/2020/04/18/others/rxliuliBlog/JavaScript/%E5%9C%A8%E7%8E%B0%E4%BB%A3%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-Worker/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::dcfea84e70c0b206e23078e1e2525825" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>由于需要在 Browser 进行大量的（音频转解码）计算，所以吾辈开始尝试使用 webworker 分离 CPU 密集型的计算操作，最终找到了 comlink 这个库，但之前在 vue 中使用时发生了错误，目前看起来已经得到了解决，所以在此记录一下。</p>
<h2 id="调研方案"><a href="#调研方案" class="headerlink" title="调研方案"></a>调研方案</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/satya164/web-worker-proxy">web-worker-proxy</a>：结合了 proxy&#x2F;promise&#x2F;webworker 的强大工具库，但如何在 ts 中使用却是个问题</li>
<li><a target="_blank" rel="noopener" href="https://github.com/miozzz/sandbox/tree/master/orc">Orc.js</a>：一个简单的 worker 封装</li>
<li><a target="_blank" rel="noopener" href="https://github.com/israelss/vue-worker">VueWorker</a>：结合 vue 的 worker 封装，无法理解，难道真的会有人在 vue 组件中进行大量计算么？</li>
<li>comlink：Chrome 的一个基于 proxy&#x2F;promise&#x2F;webworker 的封装库</li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleChromeLabs/worker-plugin">worker-plugin</a>：和上面的同属 chrome 实验室的一个 webpack 插件</li>
</ul>
<p>最后决定使用 comlink 结合 worker-plugin 实现简单的 worker 使用。</p>
<h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><blockquote>
<p>在 GitHub 上有 <a target="_blank" rel="noopener" href="https://github.com/rxliuli/example/tree/master/react_worker_example">可运行示例 demo</a><br>相关问题：<a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000022359546">comlink-loader 工作不正常</a></p>
</blockquote>
<h3 id="添加相关依赖"><a href="#添加相关依赖" class="headerlink" title="添加相关依赖"></a>添加相关依赖</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add comlink</span><br><span class="line">yarn add -D worker-plugin</span><br></pre></td></tr></table></figure>

<h3 id="在-webpack-配置中添加插件"><a href="#在-webpack-配置中添加插件" class="headerlink" title="在 webpack 配置中添加插件"></a>在 webpack 配置中添加插件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">WorkerPlugin</span>()]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里一般不需要特殊参数配置，如果需要，可以参考：<a target="_blank" rel="noopener" href="https://github.com/GoogleChromeLabs/worker-plugin">worker-plugin</a></p>
</blockquote>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="基本示例"><a href="#基本示例" class="headerlink" title="基本示例"></a>基本示例</h3><p>添加一个简单的 <em>hello.worker.ts</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; expose &#125; <span class="keyword">from</span> <span class="string">&#x27;comlink&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="title function_">inc</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">counter</span>++</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">expose</span>(obj)</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts</code> 中使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="title function_">wrap</span>(<span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&#x27;./hello.worker.ts&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span> &#125;)) <span class="keyword">as</span> <span class="built_in">any</span></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>)</span><br><span class="line"><span class="keyword">await</span> obj.<span class="title function_">inc</span>()</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<p>但这里并不是类型安全的，所以我们可以实现正确的类型。</p>
<p>添加一个 <em>hello.worker.ts</em> 暴露出来的类型 <code>HelloWorkerType</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">HelloWorkerType</span> &#123;</span><br><span class="line">  <span class="attr">counter</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="title function_">inc</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时为了支持在 <em>main.ts</em> 中使用正确的类型，需要使用泛型</p>
<p><em>main.ts</em> 修改如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = wrap&lt;<span class="title class_">HelloWorkerType</span>&gt;(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&#x27;./hello.worker.ts&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span> &#125;),</span><br><span class="line">)</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>)</span><br><span class="line"><span class="keyword">await</span> obj.<span class="title function_">inc</span>()</span><br><span class="line"><span class="title function_">alert</span>(<span class="string">`Counter: <span class="subst">$&#123;<span class="keyword">await</span> obj.counter&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<h3 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h3><p>声明函数的类型 <em>HelloCallback.worker.type.d.ts</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">ListItem</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="title function_">extends</span> (infer U)[] ? U : <span class="built_in">never</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">MapWorkerType</span> = &lt;<span class="title class_">List</span> <span class="keyword">extends</span> <span class="built_in">any</span>[], U&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">arr</span>: <span class="title class_">List</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">cb</span>: (val: ListItem&lt;List&gt;) =&gt; U | <span class="title class_">Promise</span>&lt;U&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">Promise</span>&lt;U[]&gt;</span><br></pre></td></tr></table></figure>

<p>声明一个纯函数 <em>HelloCallback.worker.ts</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MapWorkerType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./HelloCallback.worker.type&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; expose &#125; <span class="keyword">from</span> <span class="string">&#x27;comlink&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">map</span>: <span class="title class_">MapWorkerType</span> = <span class="function">(<span class="params">arr, cb</span>) =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(arr.<span class="title function_">map</span>(cb))</span><br><span class="line"></span><br><span class="line"><span class="title function_">expose</span>(map)</span><br></pre></td></tr></table></figure>

<p>注：此处最好使用变量的形式，主要是为了方便将函数类型剥离出去。</p>
<p>在 <em>main.ts</em> 中使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = wrap&lt;<span class="title class_">MapWorkerType</span>&gt;(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&#x27;./HelloCallback.worker.ts&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> list = <span class="keyword">await</span> <span class="title function_">map</span>(</span><br><span class="line">  [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">  <span class="title function_">proxy</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> i * <span class="number">2</span>),</span><br><span class="line">)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;list: &#x27;</span>, list)</span><br></pre></td></tr></table></figure>

<h3 id="使用-class-的形式"><a href="#使用-class-的形式" class="headerlink" title="使用 class 的形式"></a>使用 class 的形式</h3><p>声明接口 <em>HelloClass.worker.type.d.ts</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">HelloClassWorker</span> &#123;</span><br><span class="line">  <span class="title function_">sum</span>(...<span class="attr">args</span>: <span class="built_in">number</span>[]): <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>worker 文件 <em>HelloClass.worker.ts</em></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HelloClassWorker</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./HelloClass.worker.type&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; expose &#125; <span class="keyword">from</span> <span class="string">&#x27;comlink&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloClassWorkerImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloClassWorker</span> &#123;</span><br><span class="line">  <span class="title function_">sum</span>(...<span class="attr">args</span>: <span class="built_in">number</span>[]): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">res, i</span>) =&gt;</span> res + i, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">expose</span>(<span class="title class_">HelloClassWorkerImpl</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于此处 <code>implements class</code> 的问题，吾辈偶然一试之下没报错也很奇怪，所以找到了相关问题 <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/26961710">Typescript: How to extend two classes?</a>，官方文档也同样说明了这个特性 <a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/mixins.html">Mixins</a>。</p>
</blockquote>
<p>在 <em>main.ts</em> 中使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HelloClassWorkerClazz</span> = wrap&lt;<span class="keyword">typeof</span> <span class="title class_">HelloClassWorker</span>&gt;(</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&#x27;./HelloClass.worker.ts&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">)</span><br><span class="line"><span class="keyword">const</span> instance = <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">HelloClassWorkerClazz</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> instance.<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，使用 worker 的基本分三步</p>
<ol>
<li>编写需要放在 worker 里内容的类型定义</li>
<li>根据类型定义实现它</li>
<li>在主进程的代码中使用它</li>
</ol>
<blockquote>
<p>注：当然，如果是复杂的东西，可以直接在单独的文件中实现，然后声明一个 <em>.worker.ts</em> 暴露出去，不在 <em>.worker.ts</em> 中包含任何</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.logrocket.com/integrating-web-workers-in-a-react-app-with-comlink/">Integrating web workers in a React app with Comlink</a></li>
<li><a target="_blank" rel="noopener" href="https://lorefnon.tech/2019/03/24/using-comlink-with-typescript-and-worker-loader/">Using comlink with typescript and worker-loader</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/lacolaco-blog/an-issue-around-angular-cli-comlink-workerplugin-585be1c8d087">An issue around Angular CLI + Comlink + WorkerPlugin</a></li>
</ul>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">TypeScript 函数根据第一个参数推导后面参数的类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-02 18:53:44" itemprop="dateCreated datePublished" datetime="2020-04-02T18:53:44+08:00">2020-04-02</time>
    </span>


  
    <span id="/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/" class="post-meta-item leancloud_visitors" data-flag-title="TypeScript 函数根据第一个参数推导后面参数的类型" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="TypeScript 函数根据第一个参数推导后面参数的类型" href="/2020/04/02/others/rxliuliBlog/JavaScript/TypeScript-%E5%87%BD%E6%95%B0%E6%A0%B9%E6%8D%AE%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%8E%A8%E5%AF%BC%E5%90%8E%E9%9D%A2%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::3c6847842e9b43b2a314cf601480b251" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在编写一个重载函数时，吾辈发现了 ts 的方法签名问题。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">TypeEnum</span> &#123;</span><br><span class="line">  A,</span><br><span class="line">  B,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> A = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> B = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//region 普通参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">TypeEnum</span>.A, <span class="attr">obj</span>: A</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">TypeEnum</span>.B, <span class="attr">obj</span>: B</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">TypeEnum</span>, <span class="attr">obj</span>: A | B</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<p>上面是一个简单的重载函数，吾辈希望在输入第一个参数 <code>type</code> 之后，ts 就能匹配到正确的参数，然而事实上，ts 并没能完全做到。</p>
<p><img src="https://img.rxliuli.com/20200402140820.png" alt="ts 类型提示"></p>
<p>当然，如果真的这样写 ts 的类型检查仍然能正确地抛出错误消息，然而未能推导终究是有点问题的。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2769: No overload matches this call.   Overload 1 of 2, &#x27;(type: TypeEnum.A, obj: A): void&#x27;, gave the following error.     Argument of type &#x27;&#123; a: string; b: number; &#125;&#x27; is not assignable to parameter of type &#x27;A&#x27;.       Object literal may only specify known properties, and &#x27;b&#x27; does not exist in type &#x27;A&#x27;.   Overload 2 of 2, &#x27;(type: TypeEnum.B, obj: B): void&#x27;, gave the following error.     Argument of type &#x27;TypeEnum.A&#x27; is not assignable to parameter of type &#x27;TypeEnum.B&#x27;</span></span><br><span class="line"><span class="title function_">fn1</span>(<span class="title class_">TypeEnum</span>.<span class="property">A</span>, &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后，吾辈想到了几种方式可以尝试解决。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>尝试使用继承限制字段的类型。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 对象参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"><span class="attr">arg</span>: &#123; <span class="keyword">type</span>: TypeEnum.A; obj: A &#125;</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"><span class="attr">arg</span>: &#123; <span class="keyword">type</span>: TypeEnum.B; obj: B &#125;</span>): <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"><span class="attr">arg</span>: &#123; <span class="keyword">type</span>: TypeEnum; obj: A | B &#125;</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn2</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="title class_">TypeEnum</span>.<span class="property">A</span>,</span><br><span class="line">  <span class="attr">obj</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<p>很遗憾的是，这是行不通的，即便是下面的这种变体，仍然是不可行的。</p>
<p><img src="https://img.rxliuli.com/20200402145908.png" alt="继承"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Base</span>&lt;T <span class="keyword">extends</span> <span class="title class_">TypeEnum</span>&gt; &#123;</span><br><span class="line">  <span class="attr">type</span>: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> IA <span class="keyword">extends</span> <span class="title class_">Base</span>&lt;<span class="title class_">TypeEnum</span>.A&gt; &#123;</span><br><span class="line">  <span class="attr">obj</span>: A</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> IB <span class="keyword">extends</span> <span class="title class_">Base</span>&lt;<span class="title class_">TypeEnum</span>.B&gt; &#123;</span><br><span class="line">  <span class="attr">obj</span>: B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"><span class="attr">arg</span>: IA | IB</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><p>事实上，使用泛型确实可以做到让 ts 的类型更加 <strong>正确</strong>。</p>
<p><img src="https://img.rxliuli.com/20200402145745.png" alt="泛型"></p>
<p>缺点：</p>
<ul>
<li>不能使用 ts 的重载</li>
<li>需要函数的作者改变思维</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 泛型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">EnumTypeMapGen</span>&lt;T <span class="keyword">extends</span> <span class="built_in">string</span>[], M <span class="keyword">extends</span> &#123; [P <span class="keyword">in</span> <span class="title class_">TypeEnum</span>]: <span class="built_in">any</span> &#125;&gt; = []</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">TypeMap</span> = &#123;</span><br><span class="line">  [<span class="title class_">TypeEnum</span>.<span class="property">A</span>]: A</span><br><span class="line">  [<span class="title class_">TypeEnum</span>.<span class="property">B</span>]: B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> fn3&lt;T <span class="keyword">extends</span> <span class="title class_">TypeEnum</span>, <span class="title class_">Arg</span> <span class="keyword">extends</span> <span class="title class_">TypeMap</span>[T]&gt;(<span class="attr">type</span>: T, <span class="attr">obj</span>: <span class="title class_">Arg</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn3</span>(<span class="title class_">TypeEnum</span>.<span class="property">A</span>, &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>最后，高阶函数可以简单的解决这个问题，它将一次调用更改为两次调用，第一次调用返回的函数便已经确认了类型。</p>
<p><img src="https://img.rxliuli.com/20200402145633.png" alt="高阶函数"></p>
<p>缺点：</p>
<ul>
<li>需要使用者接收这种 <strong>函数式</strong> 的调用方式</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//region 高阶函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">TypeEnum</span>.A</span>): <span class="function">(<span class="params"><span class="attr">obj</span>: A</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">TypeEnum</span>.B</span>): <span class="function">(<span class="params"><span class="attr">obj</span>: B</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn4</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">TypeEnum</span></span>): <span class="built_in">any</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn4</span>(<span class="title class_">TypeEnum</span>.<span class="property">A</span>)(&#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//endregion</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的而言，泛型和高阶函数都能解决这个问题，吾辈个人倾向于泛型，因为它并未改变调用者的使用方式，而是让作者去改变，避免改变函数的接口本身。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">liuli-cli: TS/JS SDK CLI 工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-23 15:51:06" itemprop="dateCreated datePublished" datetime="2020-02-23T15:51:06+08:00">2020-02-23</time>
    </span>


  
    <span id="/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/" class="post-meta-item leancloud_visitors" data-flag-title="liuli-cli: TS/JS SDK CLI 工具" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="liuli-cli: TS/JS SDK CLI 工具" href="/2020/02/23/others/rxliuliBlog/JavaScript/liuli-cli-TS-JS-SDK-CLI-%E5%B7%A5%E5%85%B7/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::a5dcb0f9e8934b84712503c8c4cd4219" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>吾辈最初尝试写 JS SDK 发布到 NPM 上，过程中遇到了很多问题，也因此消耗了大量的时间。<br>包括但不限于以下这些</p>
<ul>
<li>折腾 Rollup 打包</li>
<li>折腾 JS 的模块（umd&#x2F;esm）</li>
<li>折腾单元测试</li>
<li>折腾 ES6 怎么通过 Babel 编译</li>
<li>使用 JS 编写，没有提供类型定义</li>
<li>没有进行打包</li>
<li>没有编译成 ES5</li>
<li>没有单元测试</li>
<li>没有 API 文档</li>
<li>没有 Linter 和 Prettier 统一格式化</li>
</ul>
<blockquote>
<p>具体的过程可以参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/c30dd206/">使用 rollup 打包 JavaScript SDK</a></p>
</blockquote>
<p>吾辈在过程中遇到的一些问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018386874/">使用 Rollup + Babel 打包出错</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000018914964">npm 发布后的包安装后无法引用？</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000019587945">为什么上传到 GitHub Pages 的静态资源会 404 了呢？有人遇到过么？</a></li>
</ul>
<p>吾辈目前所在的公司中的 NPM 库也存在这些问题，内部的 npm 库几乎不能称为一个合格的库，以上的问题基本都存在。所以为了重构公司的 npm 包（主要是为了提供类型定义），就想是否能够把这部分单独抽离成一个脚手架，因而便开发了 SDK cli 供公司的前端 dev 创建一个标准（包含打包、编译、测试、文档、发布）的 SDK，并希望以此抹平不同 NPM 库配置的不一致性。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>所以吾辈后来创造了 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/liuli-cli">liuli-cli</a>，用于简化和统一创建 JS&#x2F;TS SDK 的步骤。</p>
<p>目前实现的功能如下</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 基本打包支持</li>
<li><input checked="" disabled="" type="checkbox"> 模块化 umd&#x2F;es</li>
<li><input checked="" disabled="" type="checkbox"> jest 单元测试支持</li>
<li><input checked="" disabled="" type="checkbox"> 代码压缩支持</li>
<li><input checked="" disabled="" type="checkbox"> babel 支持</li>
<li><input checked="" disabled="" type="checkbox"> ts 支持</li>
<li><input checked="" disabled="" type="checkbox"> linter 支持</li>
<li><input checked="" disabled="" type="checkbox"> prettier 格式化支持</li>
<li><input checked="" disabled="" type="checkbox"> git 钩子支持</li>
<li><input checked="" disabled="" type="checkbox"> esdoc</li>
<li><input checked="" disabled="" type="checkbox"> typedoc</li>
<li><input checked="" disabled="" type="checkbox"> 许可证选择支持</li>
</ul>
<p>使用的话也很简单</p>
<p>全局安装 liuli-cli</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g liuli-cli</span><br></pre></td></tr></table></figure>

<p>然后便可以使用命令 <code>li</code> 创建项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">li create &lt;project-name&gt;</span><br></pre></td></tr></table></figure>

<p>目前支持以下三种类型（强烈推荐库的作者使用 TypeScript）</p>
<ul>
<li><code>JavaScript 模板</code></li>
<li><code>TypeScript 模板</code></li>
<li><code>命令行工具模板</code></li>
</ul>
<p>之后根据引导即可创建一个开箱即用的项目了</p>
<h2 id="反例"><a href="#反例" class="headerlink" title="反例"></a>反例</h2><p>让我们看看那些大公司云服务的 JS SDK 是怎样的。</p>
<p>腾讯：提供的 SDK 大多是一个 JS 文件，需要在项目里手动引入，甚至有些是依赖了开源依赖，导致开源依赖使用 npm 管理，而私有服务的 SDK 仍然使用 JS 的方式引入。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436">对象存储</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/266">腾讯云点播</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/269">即时通信 IM</a></li>
</ul>
<p>讯飞：web 版 demo 明明有 package.json 这种版本控制工具，但却仍然是在一个 HTML 里直接 script 脚本引入，而非使用 npm&#x2F;yarn 进行依赖管理，而 package.json 里面只是一个 http-server 用以开启一个静态服务器看 demo 罢了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/voicedictation/API.html">语音听写</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/lfasr/API.html">语音转写</a></li>
<li><a target="_blank" rel="noopener" href="https://www.xfyun.cn/doc/asr/rtasr/API.html">实时语音转写</a></li>
</ul>
<p>或许在大公司的这些 SDK 的开发者看来，会使用他们这些服务的公司都是小公司，以及一些没有接触过现代前端的开发者，所以都以这种方式提供 SDK。更不要说文档与类型定义，这两项几乎是 JS SDK 标准的需求，他们都没有做好。而且，明明他们的 SDK 也有版本号，甚至给出的 JS SDK 本身便是 umd 的，但实际上却未发布在 npm 或是其他公开的仓库中（作为库的使用者吾辈没有找到）。这些开发者宁愿用户提工单询问，并浪费了大量的沟通时间解决问题也不愿意最开始就将这些做的好一点。</p>
<blockquote>
<p>Pass1：文档可能过时，但 Demo 一定是最新的。<br>Pass2：这行代码不知道做什么的，但没有了就会出错，先放在这里。</p>
</blockquote>
<p>当然，或许创建第三方组织可以解决部分这个问题，像是 <a target="_blank" rel="noopener" href="https://github.com/DefinitelyTyped/DefinitelyTyped">DefinitelyTyped</a> 那个 ts 的开源项目一样，但问题仍然很多</p>
<ol>
<li>目标对象不同：DefinitelyTyped 的目标是为了没有 types 的 js 库定义类型，它的目标对象也是开源（大多数时候也是）免费的库。而像是腾讯这些内部服务的 SDK 是收费、不开源的，很难让人免费为其做贡献。</li>
<li>各家都有类似的云服务：提供这种云服务的公司并不止一家，难道要为每一家都添加创建类似的组织么？</li>
<li>安全性问题：第三方组织不能保证每一行贡献的内容一定就和官方的一模一样，就算引入了恶意代码也很难立刻发现。</li>
<li>法律风险：这样做的话是否会被官方发律师函也是未知之数。</li>
</ol>
<p>当然，也有一些个人为某些云服务创建的 NPM 库</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/xunfeisdk">https://www.npmjs.com/package/xunfeisdk</a></li>
<li><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/xfy-node">https://www.npmjs.com/package/xfy-node</a></li>
</ul>
<p>但更多的服务是没有的，而且个人创建的这些库很难保证一直不过时（大多数都是某个项目用了一下罢了）。如果能简化项目的初始化流程，不知是否能让官方发布到 NPM 组织下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>关于使用 CLI 会阻碍人接触更<strong>底层</strong>的知识这点，属于仁者见仁智者见智的事情。毕竟，CLI 能够简化重复的劳动自然是会受到欢迎，前端三大框架也都有自己的 CLI 用于快速创建项目，降低框架的使用门槛，避免接触到一些琐碎的细节而专注于自己的需求开发。</p>
<blockquote>
<p>webpack&#x2F;babel 真的不能说底层，尤其是 webpack，复杂性太高、知识的时效性太短导致现在它的风评并不好。。。</p>
</blockquote>
<p>最后，这个项目才写出来没多久，欢迎任何人使用、批评和建议！</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ftq</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:57</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




<script src="/js/third-party/sakuraPlus.js"></script>
<script src="/js/third-party/fireworks.js"></script>
<script src="/js/third-party/mouse_slide.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"6NuBzi5VSiFfQE2sYbymtv9t-gzGzoHsz","app_key":"stH9SzRt55d1wnwQD7LcoaQR","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyw21b1ST","appkey":"045a89927c13c0e33a82c736b468fe51"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
