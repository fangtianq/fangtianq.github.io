<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"fangtianq.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"changyan","storage":false,"lazyload":false,"nav":null,"activeClass":"changyan"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="有志者事竟成">
<meta property="og:type" content="website">
<meta property="og:title" content="越努力，越幸运！">
<meta property="og:url" content="https://fangtianq.github.io/page/17/index.html">
<meta property="og:site_name" content="越努力，越幸运！">
<meta property="og:description" content="有志者事竟成">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ftq">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://fangtianq.github.io/page/17/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/17/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>越努力，越幸运！</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">越努力，越幸运！</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Where there is a will, there is a way!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签<span class="badge">55</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类<span class="badge">21</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档<span class="badge">321</span></a></li><li class="menu-item menu-item-留言版"><a href="/guestbook/" rel="section"><i class="comments fa-fw"></i>留言版</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-friendlink"><a href="/friendlink/" rel="section"><i class="link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ftq"
      src="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
  <p class="site-author-name" itemprop="name">ftq</p>
  <div class="site-description" itemprop="description">有志者事竟成</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">321</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fangtianq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/fangtianq" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;fangtianq" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.github.io/" title="GitHub.io → https:&#x2F;&#x2F;fangtianq.github.io&#x2F;"><i class="github fa-fw"></i>GitHub.io</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fangtianq.gitee.io/" title="Gitee.io → https:&#x2F;&#x2F;fangtianq.gitee.io&#x2F;" rel="noopener" target="_blank"><i class="github fa-fw"></i>Gitee.io</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://leetcode-cn.com/" title="https:&#x2F;&#x2F;leetcode-cn.com&#x2F;" rel="noopener" target="_blank">力扣网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://rap2.taobao.org/" title="http:&#x2F;&#x2F;rap2.taobao.org&#x2F;" rel="noopener" target="_blank">RAP2接口管理平台</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">浅谈 Vue SPA 网站 URL 保存数据实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-04 23:53:22" itemprop="dateCreated datePublished" datetime="2020-01-04T23:53:22+08:00">2020-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-01-20 00:00:00" itemprop="dateModified" datetime="2020-01-20T00:00:00+08:00">2020-01-20</time>
    </span>


  
    <span id="/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/" class="post-meta-item leancloud_visitors" data-flag-title="浅谈 Vue SPA 网站 URL 保存数据实践" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="浅谈 Vue SPA 网站 URL 保存数据实践" href="/2020/01/04/others/rxliuliBlog/JavaScript/%E6%B5%85%E8%B0%88-Vue-SPA-%E7%BD%91%E7%AB%99-URL-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AE%9E%E8%B7%B5/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::67e36aa7bdbb6f16b6cedd0239a0084d" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>该功能吾辈已经封装成 NPM 库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vue-url-persist">vue-url-persist</a></p>
</blockquote>
<p>在使用 Vue SPA 开发面向普通用户的网站时，吾辈也遇到了一些之前未被重视，但却实实在在存在的问题，这次便浅谈一下 SPA 网站将所有数据都存储到内存中导致数据很容易丢失以及吾辈思考并尝试的解决方案。</p>
<blockquote>
<p>参考：SPA 全称 <code>single page application</code>，意为 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8">单页应用</a>，不是泥萌想的那样！#笑哭</p>
</blockquote>
<p>思维导图</p>
<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:525px; height:245px;" src="https://www.processon.com/embed/5e1e5d93e4b0c3908f881d64"></iframe>

<p>首先列出为什么遇到这个问题，具体场景及解决的问题是什么？</p>
<p>想要解决的一些问题</p>
<ol>
<li>刷新页面数据不丢失：因为数据都保存在内存中，所以刷新之后自然不存在了</li>
<li>URL 复制给其他人数据不丢失：因为数据没有持久化到 URL 上，也没有根据 URL 上的数据进行初始化，所以复制给别人的 URL 当然会丢失数据（搜索条件之类）</li>
<li>页面返回数据不丢失：因为数据都保存在内存中，所以跳转到其他路由再跳转回来数据当然不会存在了</li>
</ol>
<p>那么，先谈一下每个问题的解决方案</p>
<ol>
<li>刷新页面数据不丢失<ul>
<li>将数据序列化到本地，例如 <code>localStorage</code> 中，然后在刷新后获取一次<ul>
<li>注：这方面已经有先行者了，例如 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vuex-persist">vuex-persist</a> 和 <a target="_blank" rel="noopener" href="https://github.com/robinvdvleuten/vuex-persistedstate">vuex-persistedstate</a></li>
</ul>
</li>
<li>将数据序列化到 URL 上，每次加载都从 URL 上获取数据</li>
</ul>
</li>
<li>URL 复制给其他人数据不丢失<ul>
<li>只能将数据序列化到 URL 上</li>
</ul>
</li>
<li>页面返回数据不丢失<ul>
<li>将数据放到 vuex 中，并且在 URL 上使用 <code>key</code> 进行标识<ul>
<li>注：这方面已经有先行者了，例如 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/vue-navigation">vue-navigation</a> 和 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vuex-router-sync">vuex-router-sync</a></li>
</ul>
</li>
<li>将数据序列化到 URL 上，并且不新增路由记录</li>
<li>使用 vue-router 的缓存 <code>keep-alive</code></li>
</ul>
</li>
</ol>
<p>在了解了这么多的解决方案之后，吾辈最终选择了兼容性最好的 URL 保存数据，它能同时解决 3 个问题。然而，很遗憾的是，这似乎并没有很多人讨论这个问题，或许，这个问题本应该是默认就需要解决的，亦或是 SPA 网站真的很少关心这些了。</p>
<blockquote>
<p>虽说如此，吾辈还是找到了一些讨论的 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42226479">StackOverflow: How to hold URL query params in Vue with Vue-Router</a></p>
</blockquote>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>一个基本的思路是能够确定的</p>
<ol>
<li>在组件创建时，从 URL 获取数据并为需要的数据进行初始化</li>
<li>在这些数据变化时，及时将数据序列化到 URL 上</li>
</ol>
<p><img src="https://img.rxliuli.com/20200105012847.png" alt="思路图"></p>
<p>然后，再次出现了一个分歧点，到底要不要绑定 Vue？</p>
<ol>
<li>不绑定 vue 手动监听对象变化并将对象的变化响应到 URL 上<br><img src="https://img.rxliuli.com/20200105012848.png" alt="不绑定 vue"></li>
<li>绑定 vue 并使用它的生命周期 <code>created, beforeRouteUpdate</code> 与监听器 <code>watch</code><br><img src="https://img.rxliuli.com/20200105012846.png" alt="绑定 vue"></li>
</ol>
<p>那么，两者有什么区别呢？</p>
<table>
<thead>
<tr>
<th>思路</th>
<th>不绑定 vue</th>
<th>绑定 vue</th>
</tr>
</thead>
<tbody><tr>
<td>优点</td>
<td>非框架强相关，理论上可以通用 <code>Vue/React</code></td>
<td>不需要手动实现 URL 的几种序列化模式，可以预见至少有两种：<code>HTML 5 History/Hash</code></td>
</tr>
<tr>
<td></td>
<td>没有 vue&#x2F;vue-router 的历史包袱</td>
<td>不需要手动实现数据监听&#x2F;响应（虽然现在已然不算难了）</td>
</tr>
<tr>
<td></td>
<td>可以不管 vue-router 实现 URL 动态设置，可以自动优雅降级</td>
<td>灵活性很强，实现比较好的封装之后使用成本很低</td>
</tr>
<tr>
<td>缺点</td>
<td>没有包袱，但同时没有基础，序列化&#x2F;数据监听都需要手动实现</td>
<td>存在历史包袱，vue&#x2F;vue-router 的怪癖一点都绕不过去</td>
</tr>
<tr>
<td></td>
<td>灵活性不足，只能初始化一次，需要&#x2F;不需要序列化的数据分割也相当有挑战</td>
<td>依赖 vue&#x2F;vue-router，在其更新之时也必须跟着更新</td>
</tr>
<tr>
<td></td>
<td>不绑定 vue 意味着与 vue 不可能完美契合</td>
<td>无法通用，在任何一个其他框架（React）上还要再写一套</td>
</tr>
</tbody></table>
<p>最终，在这个十字路口反复踌躇之后，吾辈选择了更加灵活、成本更低的第二种解决方案。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="已解决"><a href="#已解决" class="headerlink" title="已解决"></a>已解决</h3><ul>
<li>序列化数据到 URL 上导致路由记录会随着改变增加</li>
<li>即时序列化数据到 URL 上不现实<blockquote>
<p>这里吾辈对 <a target="_blank" rel="noopener" href="https://yarnpkg.com/">yarn</a> 进行了考察发现其也是异步更新 URL</p>
</blockquote>
</li>
<li>序列化到 URL 上时导致的死循环，<code>序列化数据到 URL 上 =&gt; 路由更新触发 =&gt; 初始化数据到 URL 上 =&gt; 触发数据改变 =&gt; 序列化数据到 URL 上。。。</code></li>
<li>同一个路由携带不同的查询参数的 URL 直接在地址栏输入回车一次不会触发页面数据更新</li>
<li>URL 最大保存数据 IE 最多支持 <code>2083</code> 长度的 URL，换算为中文即为 <code>231</code> 个，所以不能作为一种通用方式进行</li>
<li>Vue 插件不能动态混入，而是在各个生命周期中判断是否要处理的</li>
</ul>
<h3 id="仍遗留"><a href="#仍遗留" class="headerlink" title="仍遗留"></a>仍遗留</h3><ul>
<li>JSON 序列化的数据长度较 query param 更大</li>
</ul>
<blockquote>
<p>下面是具体实现及代码，不喜欢的话可以直接跳到最下面的 <a href="#%E6%80%BB%E7%BB%93">总结</a>。</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rxliuli/example/tree/linter_vue_example/vue_url_persist_vue_example">GitHub</a></p>
</blockquote>
<h3 id="基本尝试"><a href="#基本尝试" class="headerlink" title="基本尝试"></a>基本尝试</h3><p>首先，尝试不使用任何封装，直接在 <code>created</code> 生命周期中初始化并绑定 <code>$watch</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;keyword&quot;</span>&gt;</span>搜索名:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.keyword&quot;</span> <span class="attr">id</span>=<span class="string">&quot;keyword&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-model</span>=<span class="string">&quot;form.hobbyList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">id</span>=<span class="string">&quot;anime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&quot;anime&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;anime&quot;</span>&gt;</span>动画<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;form.hobbyList&quot;</span> <span class="attr">id</span>=<span class="string">&quot;game&quot;</span> <span class="attr">value</span>=<span class="string">&quot;game&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;game&quot;</span>&gt;</span>游戏<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">v-model</span>=<span class="string">&quot;form.hobbyList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">id</span>=<span class="string">&quot;movie&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">value</span>=<span class="string">&quot;movie&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;movie&quot;</span>&gt;</span>电影<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;&#123; form &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;Form1&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">form</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">hobbyList</span>: [],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>.<span class="property">form</span>, urlData.<span class="property">form</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.$watch(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;form&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        urlData.<span class="property">form</span> = val</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">query</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">deep</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="分离通用性函数"><a href="#分离通用性函数" class="headerlink" title="分离通用性函数"></a>分离通用性函数</h3><p>然后，便是将之分离为单独的函数，方便在所有组件中进行复用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>[exp], urlData[exp])</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用起来需要在 <code>created</code> 生命中调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    initUrlData.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="string">&#x27;form&#x27;</span>])</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理深层监听"><a href="#处理深层监听" class="headerlink" title="处理深层监听"></a>处理深层监听</h3><p>如果需要监听的值不是 data 下的顶级字段，而是深层字段的话，便不能直接使用 <code>[]</code> 进行取值和赋值了，而是需要实现支持深层取值&#x2F;赋值的 <code>get/set</code>。而且，深层监听也意味着一般不会是对象，所以也不能采用 <code>Object.assign</code> 进行合并。</p>
<p>例如需要监听 <code>page</code> 对象中的 <code>offset, size</code> 两字段</p>
<p>首先，需要编写通用的 <code>get/set</code> 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析字段字符串为数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str 字段字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 字符串数组，数组的 `[]` 取法会被解析为数组的一个元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseFieldStr</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">    .<span class="title function_">split</span>(<span class="regexp">/[\\.\\[]/</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">k</span> =&gt;</span> (<span class="regexp">/\]$/</span>.<span class="title function_">test</span>(k) ? k.<span class="title function_">slice</span>(<span class="number">0</span>, k.<span class="property">length</span> - <span class="number">1</span>) : k))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 安全的深度获取对象的字段</span></span><br><span class="line"><span class="comment"> * 注: 只要获取字段的值为 &#123;<span class="doctag">@type</span> null|undefined&#125;，就会直接返回 &#123;<span class="doctag">@param</span> defVal&#125;</span></span><br><span class="line"><span class="comment"> * 类似于 ES2019 的可选调用链特性: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> obj 获取的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fields 字段字符串或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> [defVal] 取不到值时的默认值，默认为 null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">obj, fields, defVal = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fields === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    fields = <span class="title function_">parseFieldStr</span>(fields)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = obj</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> field <span class="keyword">of</span> fields) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(res, field)</span><br><span class="line">      <span class="keyword">if</span> (res === <span class="literal">undefined</span> || res === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> defVal</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> defVal</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 安全的深度设置对象的字段</span></span><br><span class="line"><span class="comment"> * 注: 只要设置字段的值为 &#123;<span class="doctag">@type</span> null|undefined&#125;，就会直接返回 &#123;<span class="doctag">@param</span> defVal&#125;</span></span><br><span class="line"><span class="comment"> * 类似于 ES2019 的可选调用链特性: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/%E5%8F%AF%E9%80%89%E9%93%BE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> obj 设置的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fields 字段字符串或数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> [val] 设置字段的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">obj, fields, val</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fields === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    fields = <span class="title function_">parseFieldStr</span>(fields)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> res = obj</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = fields.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> field = fields[i]</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i, res, field, res[field])</span><br><span class="line">    <span class="keyword">if</span> (i === len - <span class="number">1</span>) &#123;</span><br><span class="line">      res[field] = val</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = res[field]</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res: &#x27;</span>, res)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> res !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，是替换赋值操作，将之修改为一个专门的函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为 vue 实例上的字段进行深度赋值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setInitData</span>(<span class="params">vm, exp, urlData</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> oldVal = <span class="title function_">get</span>(vm, exp, <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> newVal = urlData[exp]</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&#x27;object&#x27;</span> &amp;&amp; newVal !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">get</span>(vm, exp), newVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">set</span>(vm, exp, newVal)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，便能单独监听对象中的某个字段了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initUrlData.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="string">&#x27;form.keyword&#x27;</span>])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：lodash 的函数 <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#get">get</a>&#x2F;<a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#set">set</a></p>
</blockquote>
<h3 id="使用防抖避免触发过快"><a href="#使用防抖避免触发过快" class="headerlink" title="使用防抖避免触发过快"></a>使用防抖避免触发过快</h3><p>但目前而言每次同步都是即时的，在数据量较大时，可能会存在一些问题，所以使用防抖避免每次数据更新都即时同步到 URL 上。</p>
<p>首先，实现一个简单的防抖函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 函数去抖</span></span><br><span class="line"><span class="comment"> * 去抖 (debounce) 去抖就是对于一定时间段的连续的函数调用，只让其执行一次</span></span><br><span class="line"><span class="comment"> * 注: 包装后的函数如果两次操作间隔小于 delay 则不会被执行, 如果一直在操作就会一直不执行, 直到操作停止的时间大于 delay 最小间隔时间才会执行一次, 不管任何时间调用都需要停止操作等待最小延迟时间</span></span><br><span class="line"><span class="comment"> * 应用场景主要在那些连续的操作, 例如页面滚动监听, 包装后的函数只会执行最后一次</span></span><br><span class="line"><span class="comment"> * 注: 该函数第一次调用一定不会执行，第一次一定拿不到缓存值，后面的连续调用都会拿到上一次的缓存值。如果需要在第一次调用获取到的缓存值，则需要传入第三个参数 &#123;<span class="doctag">@param</span> init&#125;，默认为 &#123;<span class="doctag">@code</span> undefined&#125; 的可选参数</span></span><br><span class="line"><span class="comment"> * 注: 返回函数结果的高阶函数需要使用 &#123;<span class="doctag">@see</span> Proxy&#125; 实现，以避免原函数原型链上的信息丢失</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> action 真正需要执行的操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> delay 最小延迟时间，单位为 ms</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> init 初始的缓存值，不填默认为 &#123;<span class="doctag">@see</span> undefined&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> function(...[*]=): Promise&lt;any&gt; &#123;<span class="doctag">@see</span> action&#125; 是否异步没有太大关联</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">action, delay, init = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> flag</span><br><span class="line">  <span class="keyword">let</span> result = init</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (flag) <span class="built_in">clearTimeout</span>(flag)</span><br><span class="line">      flag = <span class="built_in">setTimeout</span>(</span><br><span class="line">        <span class="function">() =&gt;</span> <span class="title function_">resolve</span>((result = action.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args))),</span><br><span class="line">        delay,</span><br><span class="line">      )</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(result), delay)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将 <code>$watch</code> 中的函数用 <code>debounce</code> 进行包装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="number">1000</span>),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>引用：<a target="_blank" rel="noopener" href="https://juejin.im/post/5b8de829f265da43623c4261">掘金：7 分钟理解 JS 的节流、防抖及使用场景</a><br>参考：lodash 的函数 <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#debounce">debounce</a></p>
</blockquote>
<h3 id="处理路由不变但-query-修改的问题"><a href="#处理路由不变但-query-修改的问题" class="headerlink" title="处理路由不变但 query 修改的问题"></a>处理路由不变但 query 修改的问题</h3><p>接下来，就需要处理一种小众，但确实存在的场景了。</p>
<ul>
<li>同一个组件被多个路由复用，这些路由仅仅只是一个 path param 改变了。例如 <a target="_blank" rel="noopener" href="https://ant.design/components/tabs-cn/">标签页</a></li>
<li>用户复制 URL 之后，发现其中的查询关键字错了，于是修改了关键字之后又复制了一次，而粘贴两次路由相同 query param 不同的 URL 是不会重新创建组件的</li>
</ul>
<p>首先确定基本的思路：在路由改变但组件没有重新创建时将 URL 上的数据为需要的数据进行初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> route 将要改变的路由对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlDataByRouteUpdate</span>(<span class="params">exps, route</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(route.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 vue 实例的生命周期 <code>beforeRouteUpdate, beforeRouteEnter</code> 重新初始化 <code>data</code> 中的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    initUrlDataByRouteUpdate.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="string">&#x27;form&#x27;</span>], to)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="function"><span class="params">vm</span> =&gt;</span> initUrlDataByRouteUpdate.<span class="title function_">call</span>(vm, [<span class="string">&#x27;form&#x27;</span>], to))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>真的以为问题都解决了么？并不然，打开控制台你会发现一些 vue router 的警告</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-router.esm.js?8c4f:2051 Uncaught (<span class="keyword">in</span> promise) NavigationDuplicated &#123;_name: <span class="string">&quot;NavigationDuplicated&quot;</span>, name: <span class="string">&quot;NavigationDuplicated&quot;</span>, message: <span class="string">&quot;Navigating to current location (&quot;</span>/form1/?qb=%7B%22…,%22movie%22,%22game%22%5D%7D%7D<span class="string">&quot;) is not allowed&quot;</span>, stack: <span class="string">&quot;Error↵    at new NavigationDuplicated (webpack-int…/views/Form1.vue?vue&amp;type=script&amp;lang=js&amp;:222:40)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>其实是因为循环触发导致的：<code>序列化数据到 URL 上 =&gt; 路由更新触发 =&gt; 初始化数据到 URL 上 =&gt; 触发数据改变 =&gt; 序列化数据到 URL 上。。。</code>，目前可行的解决方案是在 <code>$watch</code> 中判断数据是否与原来的相同，相同就不进行赋值，避免再次触发 vue-router 的 <code>beforeRouteUpdate</code> 生命周期。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initUrlData</span>(<span class="params">exps</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">  exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setInitData</span>(<span class="variable language_">this</span>, exp, urlData)</span><br><span class="line">    <span class="variable language_">this</span>.$watch(</span><br><span class="line">      exp,</span><br><span class="line">      <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        urlData[exp] = val</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>[key] === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData)) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">          <span class="attr">query</span>: &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">            [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;, <span class="number">1000</span>),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，控制台不会再有警告了。</p>
<h3 id="封装起来"><a href="#封装起来" class="headerlink" title="封装起来"></a>封装起来</h3><h4 id="使用-Vue-插件"><a href="#使用-Vue-插件" class="headerlink" title="使用 Vue 插件"></a>使用 Vue 插件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, get, set &#125; <span class="keyword">from</span> <span class="string">&#x27;./common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VueUrlPersist</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一些选项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expListName</span> = <span class="string">&#x27;exps&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">urlPersistName</span> = <span class="string">&#x27;qb&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 将 URL 上的数据初始化到 data 上</span></span><br><span class="line"><span class="comment">   * 此处存在一个谬误</span></span><br><span class="line"><span class="comment">   * 1. 如果对象不使用合并而是赋值，则处理 [干净] 的 URL 就会很棘手，因为无法感知到初始值是什么</span></span><br><span class="line"><span class="comment">   * 2. 如果对象使用合并，则手动输入的相同路由不同参数的 URL 就无法处理</span></span><br><span class="line"><span class="comment">   *    注：该问题已经通过在 watch 中判断值是否变化而解决，但总感觉还有莫名其妙的坑在前面等着。。。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">vm</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">expOrFn</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">urlData</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initVueData</span>(<span class="params">vm, expOrFn, urlData</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> oldVal = <span class="title function_">get</span>(vm, expOrFn, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> newVal = urlData[expOrFn]</span><br><span class="line">    <span class="keyword">if</span> (oldVal === <span class="literal">undefined</span> || oldVal === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">set</span>(vm, expOrFn, newVal)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&#x27;object&#x27;</span> &amp;&amp; newVal !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">get</span>(vm, expOrFn), newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">vm</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">expOrFnList</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">route</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initNextUrlData</span>(<span class="params">vm, expOrFnList, route</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(route.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">urlPersistName</span>] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;urlData: &#x27;</span>, urlData)</span><br><span class="line">    expOrFnList.<span class="title function_">forEach</span>(<span class="function"><span class="params">expOrFn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initVueData</span>(vm, expOrFn, urlData)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue 创建后初始化数据并监听之，在发生变化时自动序列化到 URL 上</span></span><br><span class="line"><span class="comment">   * 注：需要序列化到 URL 上的数据必须能被 JSON.stringfy 序列化</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">vm</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> <span class="variable">expOrFnList</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initUrlData</span>(<span class="params">vm, expOrFnList</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(vm.<span class="property">$route</span>.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">urlPersistName</span>] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    expOrFnList.<span class="title function_">forEach</span>(<span class="function"><span class="params">expOrFn</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initVueData</span>(vm, expOrFn, urlData)</span><br><span class="line"></span><br><span class="line">      vm.$watch(</span><br><span class="line">        expOrFn,</span><br><span class="line">        <span class="title function_">debounce</span>(<span class="number">1000</span>, <span class="keyword">async</span> val =&gt; &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;val 变化了: &#x27;</span>, val)</span><br><span class="line">          urlData[expOrFn] = val</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (</span><br><span class="line">            vm.<span class="property">$route</span>.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">urlPersistName</span>] === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData)</span><br><span class="line">          ) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">await</span> vm.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: &#123;</span><br><span class="line">              ...vm.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">              [<span class="variable language_">this</span>.<span class="property">urlPersistName</span>]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">Vue, options = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">expListName</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">expListName</span> = options.<span class="property">expListName</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">urlPersistName</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">urlPersistName</span> = options.<span class="property">urlPersistName</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$urlPersist</span> = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">initDataByRouteUpdate</span>(<span class="params">to</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> expList = <span class="variable language_">this</span>[_this.<span class="property">expListName</span>]</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(expList)) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$urlPersist</span>.<span class="title function_">initNextUrlData</span>(<span class="variable language_">this</span>, expList, to)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> expList = <span class="variable language_">this</span>[_this.<span class="property">expListName</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(expList)) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$urlPersist</span>.<span class="title function_">initUrlData</span>(<span class="variable language_">this</span>, expList)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        initDataByRouteUpdate.<span class="title function_">call</span>(<span class="variable language_">this</span>, to)</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="function"><span class="params">vm</span> =&gt;</span> initDataByRouteUpdate.<span class="title function_">call</span>(vm, to))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VueUrlPersist</span></span><br></pre></td></tr></table></figure>

<p>使用起来和其他的插件没什么差别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueUrlPersist</span> <span class="keyword">from</span> <span class="string">&#x27;./views/js/VueUrlPersist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vueUrlPersist = <span class="keyword">new</span> <span class="title class_">VueUrlPersist</span>()</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(vueUrlPersist)</span><br></pre></td></tr></table></figure>

<p>在需要使用的组件中只要声明这个属性就好了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Form2Tab&#x27;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">sex</span>: <span class="number">0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">exps</span>: [<span class="string">&#x27;form&#x27;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然而，使用 vue 插件有个致命的缺陷：无论是否需要，都会为每个组件中都混入三个生命周期函数，吾辈没有找到一种可以根据实例中是否包含某个值而决定是否混入的方式。</p>
<h4 id="使用高阶函数"><a href="#使用高阶函数" class="headerlink" title="使用高阶函数"></a>使用高阶函数</h4><p>所以，我们使用 <code>高阶函数</code> + <code>mixin</code> 的形式看看。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; debounce, get, set &#125; <span class="keyword">from</span> <span class="string">&#x27;./common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VueUrlPersist</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 一些选项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">&#123; key = <span class="string">&#x27;qb&#x27;</span> &#125; = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 为 vue 实例上的字段进行深度赋值</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">setInitData</span>(<span class="params">vm, exp, urlData</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> oldVal = <span class="title function_">get</span>(vm, exp, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> newVal = urlData[exp]</span><br><span class="line">    <span class="comment">//如果原值是对象且新值也是对象，则进行浅合并</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      oldVal === <span class="literal">undefined</span> ||</span><br><span class="line">      oldVal === <span class="literal">null</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> oldVal === <span class="string">&#x27;string&#x27;</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> oldVal === <span class="string">&#x27;number&#x27;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="title function_">set</span>(vm, exp, newVal)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> oldVal === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> newVal === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="title function_">get</span>(vm, exp), newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 初始化一些数据需要序列化/反序列化到 url data 上</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> vm vue 实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initUrlDataByCreated</span>(<span class="params">vm, exps</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = <span class="variable language_">this</span>.<span class="property">key</span></span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(vm.<span class="property">$route</span>.<span class="property">query</span>[key] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setInitData</span>(vm, exp, urlData)</span><br><span class="line">      vm.$watch(</span><br><span class="line">        exp,</span><br><span class="line">        <span class="title function_">debounce</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">          urlData[exp] = val</span><br><span class="line">          <span class="keyword">if</span> (vm.<span class="property">$route</span>.<span class="property">query</span>[key] === <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData)) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          vm.<span class="property">$router</span>.<span class="title function_">replace</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: &#123;</span><br><span class="line">              ...vm.<span class="property">$route</span>.<span class="property">query</span>,</span><br><span class="line">              [key]: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(urlData),</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, <span class="number">1000</span>),</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 在组件被 vue-router 路由复用时，单独进行初始化数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> vm vue 实例</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> route 将要改变的路由对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">initUrlDataByRouteUpdate</span>(<span class="params">vm, exps, route</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> urlData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(route.<span class="property">query</span>[<span class="variable language_">this</span>.<span class="property">key</span>] || <span class="string">&#x27;&#123;&#125;&#x27;</span>)</span><br><span class="line">    exps.<span class="title function_">forEach</span>(<span class="function"><span class="params">exp</span> =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">setInitData</span>(vm, exp, urlData))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生成可以 mixin 到 vue 实例的对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> exps 监视的数据的表达式数组</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">&#123;created(): void, beforeRouteEnter(*=, *, *): void, beforeRouteUpdate(*=, *, *): void</span>&#125;&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">generateInitUrlData</span>(<span class="params">...exps</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">        _this.<span class="title function_">initUrlDataByCreated</span>(<span class="variable language_">this</span>, exps)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteUpdate</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        _this.<span class="title function_">initUrlDataByRouteUpdate</span>(<span class="variable language_">this</span>, exps, to)</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">beforeRouteEnter</span>(<span class="params">to, <span class="keyword">from</span>, next</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeRouteEnter&#x27;</span>)</span><br><span class="line">        <span class="title function_">next</span>(<span class="function"><span class="params">vm</span> =&gt;</span> _this.<span class="title function_">initUrlDataByRouteUpdate</span>(vm, exps, to))</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 修改一些配置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> options 配置项</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">config</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>, options)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> vueUrlPersist = <span class="keyword">new</span> <span class="title class_">VueUrlPersist</span>()</span><br><span class="line"><span class="keyword">const</span> generateInitUrlData = vueUrlPersist.<span class="property">generateInitUrlData</span>.<span class="title function_">bind</span>(</span><br><span class="line">  vueUrlPersist,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; vueUrlPersist, generateInitUrlData, <span class="title class_">VueUrlPersist</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vueUrlPersist</span><br></pre></td></tr></table></figure>

<p>使用起来几乎一样简单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; generateInitUrlData &#125; <span class="keyword">from</span> <span class="string">&#x27;./js/VueUrlPersist&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Form1&#x27;</span>,</span><br><span class="line">  <span class="attr">mixins</span>: [<span class="title function_">generateInitUrlData</span>(<span class="string">&#x27;form&#x27;</span>)],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">form</span>: &#123;</span><br><span class="line">        <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="attr">hobbyList</span>: [],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来，使用高阶函数也没有比 Vue 插件麻烦太多。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总的来说，虽然路途坎坷，不过这个问题还是很有趣的，而且确实能解决实际的问题，所以还是有研究价值的。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/" class="post-title-link" itemprop="url">漫谈 反乌托邦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-01 20:09:08" itemprop="dateCreated datePublished" datetime="2020-01-01T20:09:08+08:00">2020-01-01</time>
    </span>


  
    <span id="/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/" class="post-meta-item leancloud_visitors" data-flag-title="漫谈 反乌托邦" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="漫谈 反乌托邦" href="/2020/01/01/others/rxliuliBlog/dev/%E6%BC%AB%E8%B0%88-%E5%8F%8D%E4%B9%8C%E6%89%98%E9%82%A6/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::699f055be26cc37b1e03867307b12df4" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1984"><a href="#1984" class="headerlink" title="1984"></a>1984</h2><p>最近看完了 <strong>1984</strong> 这本小说，在之后也补了一下电影</p>
<p>Youtube 正版电影</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/S0WSCZx6R6M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>一些设定令人惊奇</p>
<ul>
<li>真理部：负责新闻、娱乐、教育、艺术</li>
<li>和平部：负责战争</li>
<li>有爱不：负责维持法律和秩序</li>
<li>富裕部：负责经济事务</li>
</ul>
<p>一些名言令人印象深刻</p>
<ul>
<li>过去被禁止，控制过去的人控制未来，控制现在的人控制过去。</li>
<li>除了对集体的爱，没有其他的爱，与之竞争的都要被摧毁。</li>
<li>无产阶级就像牲口一样，什么办法都没有。</li>
<li>现代战争的本质，就是毁灭产品和人类的劳动，保持社会处于饥饿的边缘，一个分等级的社会只可能建立在贫穷和无知的基础上。</li>
<li>栗树荫下，我出卖你，你出卖我。</li>
</ul>
<p>里面小孩举报父母，被洗脑而不自知，或许，亦是因为一张白纸更容易染上颜色吧。</p>
<ul>
<li>低效的前进，高效的内斗</li>
</ul>
<p>现实场景</p>
<ul>
<li>这本书可以很容易买到</li>
<li>中文网络上没有国人影评&#x2F;同人小说</li>
<li>1984 在微博已经成为非法内容了</li>
<li>举报父母已有现实案例（所谓的大义灭亲）</li>
</ul>
<h2 id="美丽新世界"><a href="#美丽新世界" class="headerlink" title="美丽新世界"></a>美丽新世界</h2><ul>
<li>人工胚胎，设置命运：感觉是个恐怖的极权世界</li>
<li>从小开始的 SEX 游戏与索麻，消费&#x2F;享乐主义至上：或许是个天堂？</li>
<li>野人区：旧时代的信仰、肮脏的生活与 <strong>美丽新世界</strong> 对比，让人真不知道哪个是天堂？</li>
<li>野人疯了：发现自己苦苦追寻的事物、坚信的认知却一文不值时，疯掉了，<strong>天堂</strong> 对他而言也是地狱了</li>
<li><code>9/10</code> 的人口供养着 <code>1/10</code> 的人口是 <strong>阿尔法</strong>，无论是水上还是水下都会感到快乐，不提高产量的最大原因是为了避免闲暇时间造成资源的浪费</li>
</ul>
<p>那种 <strong>美丽新世界</strong> 和 <strong>野人区</strong> 真的很难说哪个更好，活到 60 岁，但一生都能保持年轻，并且 <strong>每个人属于每个人</strong> 的理念确实很厉害。</p>
<ul>
<li>要求 <strong>不快乐</strong> 的权力</li>
</ul>
<h2 id="疫情"><a href="#疫情" class="headerlink" title="疫情"></a>疫情</h2><p>花了几年营造出来的中国梦，在一个春节就破碎的不成样子了。</p>
<ul>
<li>双重思想在现实中确实存在，而且很常见。<ul>
<li><a target="_blank" rel="noopener" href="https://twitter.com/LiYing_2015/status/1227363930504196096">所以为歌颂伟大牺牲的时候，就防护服不足，以至于医护人员都不够用，为辟反动谣言的时候，就殡葬人员都必须有防护服。动动脑子想一想的结果就是如此的辩证</a></li>
<li>“我们要自由。我们反对香港游行、台湾独立。”，说这两句话的是同一批人。<ul>
<li>或许未曾意识到，香港、台湾他们也是为了自由，甚至于，或许只是跟风发泄一下情绪，并不明白自由是什么。。。</li>
</ul>
</li>
</ul>
</li>
<li>没有说 <code>1 + 1 = 2</code> 的权利<ul>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%9D%8E%E6%96%87%E4%BA%AE">李文亮</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AD%A6%E6%BC%A2%E9%80%A0%E8%AC%A0%E5%85%AB%E5%90%9B%E5%AD%90">武汉「造谣」八君子</a></li>
</ul>
</li>
<li>未曾想过现实中真的有 <strong>新语</strong> 一说<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/bS_8xCR2bxpwWKcoAeo4pw">为什么日本人显得比中国人更懂中国文化</a><ul>
<li>“山川异域，风月同天。” 居然比不上 <strong>新语</strong> 的 “武汉加油”。</li>
<li>新世纪笑话：<blockquote>
<p>我举一个例子，比如你是给武汉捐助救灾物资的一位执行者，你在包装箱上写了八个字：山川异域，风月同天。领导看见了，会直接骂你：“你特么神经病吗？写这个干嘛？应该写武汉加油，还要加一个大感叹号。”<br>为什么不能用这八个字？因为这八个字不在那一套新话系统里面。这就超出了一位领导干部的思维边界。超出思维边界的事物，都是危险的、不可控的，是不可以使用的。<br>领导还要问你：你听明白了吗？能不能做到？<br>所以，你只能写个 “武汉加油”。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">局域网内 Windows/Android 传输文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-29 22:31:56" itemprop="dateCreated datePublished" datetime="2019-12-29T22:31:56+08:00">2019-12-29</time>
    </span>


  
    <span id="/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/" class="post-meta-item leancloud_visitors" data-flag-title="局域网内 Windows/Android 传输文件" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="局域网内 Windows/Android 传输文件" href="/2019/12/29/others/rxliuliBlog/Tool/Windows/%E5%B1%80%E5%9F%9F%E7%BD%91%E5%86%85-Windows-Android-%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::63f4ab40a26fd2ae17d50f095d6c7f44" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>435</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在写杂谈 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/6cde603c/">手游 [ウチの姫] 回坑感想</a> 时，吾辈在手机上进行了多次截图，但苦于数量太多不方便使用 Telegram&#x2F;QQ 之类的 IM 进行传输。在尝试了包括 FTP、Infinit、Feem、飞鸽传书这些软件之后，最终发现吾辈还是一如既往的绕远路 – Windows 本身就包含这个功能。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h2 id="Windows-设置共享文件夹"><a href="#Windows-设置共享文件夹" class="headerlink" title="Windows 设置共享文件夹"></a>Windows 设置共享文件夹</h2><p>Windows 在 <em>文件管理器 &#x3D;&gt; 在文件夹上右键 &#x3D;&gt; 属性</em> 中可以看到共享，接下来，设置该文件夹为共享文件夹，那么手机便能下载&#x2F;上传文件到该目录中了。</p>
<ol>
<li>点击共享</li>
<li>选择共享的用户</li>
<li>确认共享</li>
</ol>
<p><img src="https://img.rxliuli.com/20191229233129.gif" alt="GIF 示意图"></p>
<h2 id="手机上访问局域网"><a href="#手机上访问局域网" class="headerlink" title="手机上访问局域网"></a>手机上访问局域网</h2><p>这里使用 <a target="_blank" rel="noopener" href="https://www.coolapk.com/apk/com.estrongs.android.pop">ES 文件浏览器</a> 作为客户端 App 访问 Windows 的共享文件夹。</p>
<ol>
<li>找到 <em>网络 &#x3D;&gt; 局域网</em></li>
<li>点击 <strong>扫描</strong><br><img src="https://img.rxliuli.com/20191229232158.png" alt="扫描到的目录"></li>
<li>点击扫描到的共享计算机</li>
<li>输入上面选择的共享用户的 <code>Username/Password</code></li>
<li>然后就能看到共享文件夹，并且能够复制&#x2F;粘贴文件了<br><img src="https://img.rxliuli.com/20191229232200.png" alt="目录"><br><img src="https://img.rxliuli.com/20191229232159.png" alt="粘贴"></li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Windows 真的有很多相当好用的功能，只是由于功能太多导致吾辈未曾发现呢</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/" class="post-title-link" itemprop="url">手游 [ウチの姫] 回坑感想</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-29 20:19:46" itemprop="dateCreated datePublished" datetime="2019-12-29T20:19:46+08:00">2019-12-29</time>
    </span>


  
    <span id="/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/" class="post-meta-item leancloud_visitors" data-flag-title="手游 [ウチの姫] 回坑感想" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="手游 [ウチの姫] 回坑感想" href="/2019/12/29/others/rxliuliBlog/Essay/%E6%89%8B%E6%B8%B8-%E3%82%A6%E3%83%81%E3%81%AE%E5%A7%AB-%E5%9B%9E%E5%9D%91%E6%84%9F%E6%83%B3/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::48d36a0a3e6e8a0e27b6a8b473c59b9f" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>多图预警</p>
</blockquote>
<h2 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h2><p>在月初的周末，吾辈因为最近的 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/63bdcead/">一些烦心事</a>，毫无动力的躺在床上做一条无所事事的咸鱼。偶然想起来 4 年前玩过的一个游戏：<a target="_blank" rel="noopener" href="https://pf.goone.tw/">我家公主最可爱</a>，也是吾辈至今唯一玩过的手游，念及于此，便忍不住找了一下，果不其然，国服坟头草已然几丈高了，台服亦然，唯有日服坚持下来了，到了明年便是这个游戏的第 6 个年头了。<br>日服 App 名字的全称是 <strong>ウチの姫さまがいちばんカワイイ　- ひっぱりアクション RPGx 美少女ゲームアプリ</strong>（虽然名字意思仍然和中文一样，但看起来却没那么羞耻了呢，或许是因为看不懂日语的缘故吧），简称 <strong>ウチの姫</strong>。<br>下面是 <a target="_blank" rel="noopener" href="https://play.google.com/store/apps/details?id=jp.co.cyberagent.uh">Google Play 页面</a></p>
<p><img src="https://img.rxliuli.com/20191229210115.png" alt="Google Play 首页截图"></p>
<p>看起来很可爱，所以吾辈想着闲着也是闲着，便轻松加愉快的重新尝试了这个游戏。</p>
<h2 id="玩法"><a href="#玩法" class="headerlink" title="玩法"></a>玩法</h2><p>刚进入游戏首页，便有两个妹纸在抱着一只，嗯，青蛙一样的生物看着我们，而这只青蛙，自然是这个游戏的男主角啦 #笑</p>
<p><img src="https://img.rxliuli.com/20191229210505.png" alt="游戏首页"></p>
<p>进入游戏，之后的首页是这样的</p>
<p><img src="https://img.rxliuli.com/20191229210833.png" alt="进入游戏后的主页面"></p>
<p>游戏的基本玩法很简单，就是收集公主，然后让（青蛙）王子在公主的帮助下击败魔王的弹珠游戏（然而又是一个无稽之谈 #笑）</p>
<p><img src="https://img.rxliuli.com/20191229211410.png" alt="普通回合"></p>
<p><img src="https://img.rxliuli.com/20191229211447.png" alt="Boss 回合"></p>
<p>然后，在打通关卡后，可以获得经验与一些公主，不过大多数都是特殊属性的公主，可以用来强化、进化以及觉醒的一些素材，统称为 <strong>狗粮</strong>（为什么公主被作为狗粮了 #惊哭）</p>
<p><img src="https://img.rxliuli.com/20191229211911.png" alt="获得经验"></p>
<p><img src="https://img.rxliuli.com/20191229212030.png" alt="获得公主"></p>
<p>下面是一个公主的属性面板（<code>Status</code> 还是 <code>Properties</code> 呢 #笑）</p>
<p><img src="https://img.rxliuli.com/20191229212322.png" alt="属性面板"></p>
<p>可以看到的属性就有</p>
<ul>
<li>所属元素：存在克制关系 <code>光 &lt;=&gt; 暗</code>，<code>火 =&gt; 风 =&gt; 水 =&gt; 火...</code></li>
<li>名字：公主的名字</li>
<li>稀有度：目前真正能用的稀有度依次是 <code>UR/UR+/UR++ =&gt; PUR/PUR+/PUR++ =&gt; XUR</code>，一般而言稀有度越高这张卡的强度可能性就越高</li>
<li>公主自身等级：影响 HP&#x2F;攻击力</li>
<li>HP：体力值，在副本时计算的是队伍（4 位公主与 1 位外援）的总和，不过没有攻击力对强度影响大</li>
<li>攻击力：攻击力，在副本时仅计算当前活跃公主的攻击力，对强度影响较大，因为 Boss 普遍体力非常高</li>
<li>强度：这张卡在官方眼中的强度，强度高可能不强，但低了一定不强</li>
<li>爱情度：影响 HP&#x2F;攻击力&#x2F;技能冷却回合</li>
<li>公主队长技能：作为队长时实用的技能</li>
<li>公主技能：能够持续几回合并有冷却时间的技能</li>
<li>绊技能：在爱情度达到 <code>300</code> 后解锁，一半只能到 <code>200</code></li>
<li>附加能力属性：影响能够强化的附加能力</li>
<li>自带防御：能够防御场上某种类型的陷阱</li>
<li>追加属性：影响 HP&#x2F;攻击力&#x2F;攻击时的效果，锁住的话需要使用 <strong>才开</strong> 开锁，<strong>才与</strong> 赋值</li>
<li>爱情度封印：影响附加能力位，爱情度 <code>200/300</code> 会锁住两个附加能力位，必须在爱情度到达之后次啊会解锁</li>
</ul>
<p>是不是感觉太复杂了，吾辈刚进入游戏的时候也是这样想的，所以就去加了一个国内的 QQ 讨论群（居然还有一些人再玩这个游戏呢），以次绕过了新手时期的困惑（虽然不是新手，但已然太久没玩，而且变化也很多）</p>
<h2 id="图鉴"><a href="#图鉴" class="headerlink" title="图鉴"></a>图鉴</h2><p>本质上，这是一个集卡（舔卡 #大雾）游戏</p>
<p>下面是进入游戏必然获得几位公主：<strong>亲女儿（爱姬） + 御三家（红苍翠）</strong></p>
<p><img src="https://img.rxliuli.com/20191229220923.png" alt="亲女儿"><br><img src="https://img.rxliuli.com/20191229220947.png" alt="红"><br><img src="https://img.rxliuli.com/20191229220959.png" alt="蓝"><br><img src="https://img.rxliuli.com/20191229221008.png" alt="绿"></p>
<p>然而，还有各种 <strong>卡哇伊</strong> 的公主需要通过活动副本（#肝）&#x2F;抽奖机制（#氪）获得</p>
<p><img src="https://img.rxliuli.com/20191229221354.png" alt="公主 1"><br><img src="https://img.rxliuli.com/20191229221435.png" alt="公主 2"><br><img src="https://img.rxliuli.com/20191229221434.png" alt="公主 3"><br><img src="https://img.rxliuli.com/20191229221433.png" alt="公主 4"><br><img src="https://img.rxliuli.com/20191229221432.png" alt="公主 5"><br><img src="https://img.rxliuli.com/20191229221436.png" alt="公主 6"><br><img src="https://img.rxliuli.com/20191229221431.png" alt="公主 7"></p>
<h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><p>当然，作为一个手游，那么自然是有体力与扭蛋（抽奖）这两种机制了，下面由吾辈来一一说明</p>
<p>体力值：上限与等级直接挂钩，长久来看，大致是等级的 <code>1/3</code> 左右，每次进入副本消耗体力值，会随着时间逐渐恢复（不会超过体力上限），但也可以用 <strong>月石</strong> 可以增加体力上限的体力值（有可能超过上限）</p>
<p><img src="https://img.rxliuli.com/20191229214543.png" alt="副本"></p>
<p>至于为什么吾辈的体力这么多（<code>5972/141</code>），原因便是吾辈连续升级了几十次，每次升级就会增加以此体力上限的体力值，故而才这么多的！当然，这种重复性的工作吾辈作为一个开发者自然是写了一个 AutoJS 脚本自动刷活动，连续两天几乎没停，但也只升了 50 级左右，可见升级的困难了。</p>
<p><img src="https://img.rxliuli.com/20191229215050.png" alt="AutoJS 脚本"></p>
<p>而扭蛋，非洲人什么话都不想说 QAQ，虽然还不到一个月，但游戏里已然氪了接近 3000 的软妹币了，更别说花费的时间与精力了，然而即便如此生存依旧苦难。<br>下面是目前正开着的池子的一些数据</p>
<p><img src="https://img.rxliuli.com/20191229215444.png" alt="池子的 XUR 公主"><br><img src="https://img.rxliuli.com/20191229215604.png" alt="详情 1"><br><img src="https://img.rxliuli.com/20191229215617.png" alt="详情 2"><br><img src="https://img.rxliuli.com/20191229215624.png" alt="详情 3"></p>
<p>可以看到，除了第一次，后面每次的抽奖都要 <code>1w</code> 星星，而抽到 XUR 公主的概率。。。不过是 <code>0.01%</code>。那么，1w 星星到底相当于多少软妹币呢？</p>
<p><img src="https://img.rxliuli.com/20191229215910.png" alt="官方商店"></p>
<p>可以看到，即便现在有着额外送 30% 的活动，1w 星星仍然需要接近 1w 日元左右，让我们来计算一下星星的单价吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11000</span> / <span class="number">15431</span> / <span class="number">15.64</span> === <span class="number">0.045578692773257934</span></span><br></pre></td></tr></table></figure>

<p>看起来似乎并不多，我们计算一下总价</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.045578692773257934</span> * (<span class="number">10000</span> * <span class="number">5</span> + <span class="number">5000</span>) === <span class="number">2506.8281025291863</span></span><br></pre></td></tr></table></figure>

<p>那么抽 6 次得到 XUR 的概率是？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> + <span class="number">5</span> * <span class="number">4</span> + <span class="number">10</span> === <span class="number">33</span></span><br></pre></td></tr></table></figure>

<p>哦，看起来有点不妙了，仅仅为了一张卡抽 6 次池子，便如此大动干戈，即便如此，获得 XUR 的概率也只有 <code>33%</code>，这。。。(╯‵□′)╯︵┻━┻</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>唉，不管怎样，都无法找到曾经为了游戏肝了几天时间，甚至为此压缩睡眠，看到获得了自己想要的公主之后便很快乐的感觉 – 一切都无法回到从前了！</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/" class="post-title-link" itemprop="url">2019 回忆及 2020 目标</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-23 13:06:10" itemprop="dateCreated datePublished" datetime="2019-12-23T13:06:10+08:00">2019-12-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-12-24 00:00:00" itemprop="dateModified" datetime="2019-12-24T00:00:00+08:00">2019-12-24</time>
    </span>


  
    <span id="/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/" class="post-meta-item leancloud_visitors" data-flag-title="2019 回忆及 2020 目标" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="2019 回忆及 2020 目标" href="/2019/12/23/others/rxliuliBlog/Essay/2019-%E5%9B%9E%E5%BF%86%E5%8F%8A-2020-%E7%9B%AE%E6%A0%87/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::2df17ffad93505d12ffe17b24cc69d80" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="往事凌乱"><a href="#往事凌乱" class="headerlink" title="往事凌乱"></a>往事凌乱</h2><p>对于吾辈而言，今年发生的几件事情</p>
<ul>
<li>转型成为前端</li>
<li>淡出 Twitter 中文圈，逐渐回归 Telegram&#x2F;QQ</li>
<li>博客写作频率逐渐降低，但 GitHub 使用逐渐变多</li>
<li>扎起头发，便是在家中亦然</li>
<li>换了一家 2C 的互联网公司</li>
</ul>
<p>年前想要做的事情，如今却也不大记得了。暂且记得，曾经觉得前端日新月异的想象，现实之中却不尽然。2C 的网站甚至到了目前仍然必须支持 <code>IE</code>，而且前端混乱的生态也让人头疼不已，不仅是 UI 在不同框架的实现不一致，甚至连很多纯 JS 库也是直接依赖于框架了，成为了某个框架的一部分。例如 <code>Redux</code>，号称是通用的状态管理库，然而除了 <code>React</code>，没有框架真正在使用它，<code>Vue</code> 有自己的 <code>Vuex</code>，<code>Angular</code> 也有 <code>RxJS</code>。</p>
<blockquote>
<p>前端框架之间的割裂与没有使用框架之前的割裂真是天壤之别。</p>
</blockquote>
<p>下半年，吾辈进入了一家 2C 的互联网公司，真的是各种加班，具体详情参考 <a target="_blank" rel="noopener" href="https://blog.rxliuli.com/p/63bdcead/">一些烦心事</a>。精力消耗殆尽，感觉有时间，但又不想学什么东西，陷入了某种怪圈之中。</p>
<h2 id="未来渺茫"><a href="#未来渺茫" class="headerlink" title="未来渺茫"></a>未来渺茫</h2><p>明年，吾辈最想要接触的是 Web 桌面开发，以及机器学习。</p>
<ul>
<li><input disabled="" type="checkbox"> NodeJS 后端开发</li>
<li><input disabled="" type="checkbox"> Web 桌面开发 Electron</li>
<li><input disabled="" type="checkbox"> 机器学习 TensorFlow</li>
<li><input disabled="" type="checkbox"> 继续维护 Blog</li>
<li><input disabled="" type="checkbox"> 继续坚持读书</li>
<li><input disabled="" type="checkbox"> 尝试网络小说写作</li>
<li><input disabled="" type="checkbox"> 尝试 Youtube 视频创作</li>
</ul>
<hr>
<p>Pass 1: 感觉上，人工智能必然取代各种各样的工作，程序员或许也无法幸免于难，而最不容易被替代的，大概就是创作型的工作吧！</p>
<hr>
<p>Pass 2：下面是一段吾辈想要写作的小说的设定集</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 设定集</span></span><br><span class="line"></span><br><span class="line">围绕时间基点进行跳跃，逐渐向着基点流动，但却永远不会真的到达。</span><br><span class="line"></span><br><span class="line">明线是琉璃和瑞雪的感情，暗线是探索世界的真实与否。</span><br><span class="line"></span><br><span class="line">第一卷 现实</span><br><span class="line"></span><br><span class="line">从琉璃在生日之前回溯了一天开始，后又回溯到出生点之时，再次开始了新的人生，直到，某个绝望的事实笼罩了她之后，心灰意冷的再次懵懵懂懂的回到了小时候。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 百合线</span></span><br><span class="line"></span><br><span class="line">第二卷 黑暗</span><br><span class="line"></span><br><span class="line">因为上一世受到了严重的心理阴影，看着所有的努力化作泡影，琉璃再也没有做任何事情的动力了。在学校中，她变成了七大不可思议的传说之一。随心所欲，和家人的关系破裂，虽靠着两世的经验尚未有大问题，但心却早已经死了。直到，高中快要结束之时，她，参加了瑞雪的葬礼。然而，瑞雪在临终前的话语终究让死掉的心产生了悸动。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 黑暗线</span></span><br><span class="line"></span><br><span class="line">第三卷 无限</span><br><span class="line"></span><br><span class="line">她说：无论多少次，吾辈一定会拯救你的。少女立下了拯救另一个少女的誓言，但一切真能如其所愿么？</span><br><span class="line"></span><br><span class="line">不断重复，不断轮回，一个人终究无法推动整个世界到达能够医治瑞雪的方式。甚至在某次暴露了这个秘密，直接了被切片研究，并最终导致世界大战爆发。</span><br><span class="line"></span><br><span class="line">第四卷 未来</span><br><span class="line"></span><br><span class="line">再次重生的少女，不，现在已经是老婆婆的琉璃，发现世界已经到了 2060 年了。是的，她没有再次回到过去，而是活到了未来。但是，她发现了一个怪异之处：时间，似乎在倒流？但是思维却并没有，为什么其他人却很习惯的样子呢？</span><br><span class="line"></span><br><span class="line">她，想了解这个世界。为什么时间逆流，产生了 绝对的宿命论！</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 科幻线</span></span><br><span class="line"></span><br><span class="line">第四卷 幻想</span><br><span class="line"></span><br><span class="line">结果，再次在生日之后的前一刻，琉璃的时间再次跳跃到不知名的位置，没能回到原来的世界。而且，她也变成了一块石头，女娲石。后来，琉璃几经辗转，来到了红楼梦之中。神（张恒），降临了，但他却绝望的发现这是个虚假的世界。并且，发现了她。</span><br><span class="line"></span><br><span class="line">自此，琉璃被困在了各种 GalGame 和里番之中，虽是虚拟的世界，但却完全感同身受。</span><br><span class="line"></span><br><span class="line">最终，琉璃的灵魂想要转移到刚出生的琉璃身上，却被张恒阻止了。最终，到了琉璃的生日，世界，破碎了。张恒这才明白了什么，但也无法阻止。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 幻想线</span></span><br><span class="line"></span><br><span class="line">第五卷 死亡</span><br><span class="line"></span><br><span class="line">论琉璃的 999 种死法。</span><br><span class="line"></span><br><span class="line">突然有一天，琉璃发现自己很容易遭到意外了。一开始只是出门时碰到了一只黑猫，再之后是在高楼下差点被花盆砸中，后来甚至在一个十字路口碰到了车祸现场，最后，她在洗澡时莫名其妙的死掉了。</span><br><span class="line"></span><br><span class="line">第六卷 真相</span><br><span class="line"></span><br><span class="line">世界只是一个实验，为了培育超级 ai 所用。然而实验结束了，准备销毁她。在将要封存一切时，张恒留下的东西让她「消失」了。</span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; 楚门的世界</span></span><br><span class="line"></span><br><span class="line">一切都是假的，都是人造的，是某个实验计划的一部分，而她，便是这个世界中的「楚门」，但她最后，却没有选择去留的权利，唯有死亡一途。</span><br></pre></td></tr></table></figure>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/" class="post-title-link" itemprop="url">Notion 使用体验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-04 22:34:39" itemprop="dateCreated datePublished" datetime="2019-12-04T22:34:39+08:00">2019-12-04</time>
    </span>


  
    <span id="/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/" class="post-meta-item leancloud_visitors" data-flag-title="Notion 使用体验" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Notion 使用体验" href="/2019/12/04/others/rxliuliBlog/Tool/Windows/Notion-%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::cffa7fe0c59551f4858311e760b03361" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Notion-使用体验"><a href="#Notion-使用体验" class="headerlink" title="Notion 使用体验"></a>Notion 使用体验</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://notion.so/">官网</a></p>
</blockquote>
<p>Notion 是一个基于 Web 的跨平台笔记工具，在了解过印象笔记、OneNote、为知笔记和有道云笔记之后，吾辈选择了 Notion。</p>
<p>之所以没有选择上面列出的几个，都有一些原因</p>
<ul>
<li>印象笔记<ul>
<li>不直接支持 Markdown</li>
<li>编辑器体验并不好</li>
<li>不能以目录分割笔记</li>
</ul>
</li>
<li>OneNote<ul>
<li>完全不支持 Markdown</li>
</ul>
</li>
<li>为知笔记<ul>
<li>国产软件，肯定会上报数据</li>
</ul>
</li>
<li>为知笔记<ul>
<li>同上</li>
</ul>
</li>
</ul>
<p>吾辈的对笔记工具的要求也很简单</p>
<ul>
<li><input disabled="" type="checkbox"> 允许在线&#x2F;本地编辑</li>
<li><input disabled="" type="checkbox"> 本地编辑器体验必须要好</li>
<li><input disabled="" type="checkbox"> 支持 Markdown 语法</li>
<li><input disabled="" type="checkbox"> 搜索速度要快并且支持中文</li>
</ul>
<p>很遗憾，虽然吾辈选择了 Notion，并不代表它满足了所有需求，只是目前存在的选择中，最适合吾辈的罢了（搜索速度和中文支持真的很硬伤）。</p>
<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul>
<li><code>C-B</code>：将选定文字加粗，或者结束加粗模式</li>
<li><code>C-I</code>：将选定文字变成斜体，或者结束斜体模式</li>
<li><code>C-E</code>：将选定区域为行内代码，或者结束行内代码模式</li>
<li><code>S-鼠标滚轮</code>：水平滚动</li>
<li><code>CS-L</code>：切换夜间模式</li>
<li><code>C-V + Link</code>：选中文字粘贴链接，会直接将文字变成可点击链接</li>
<li><code>CS-Up/Down</code>：将当前行上移&#x2F;下移</li>
<li><code>S-Enter</code>：不完成当前区块的情况下换行。类似于 QQ 的回车发送消息，<code>Shift-Enter</code> 换行一样。</li>
<li><code>Tab</code>：缩进一个 Tab</li>
<li><code>S-Tab</code>：反向缩进一个 Tab</li>
<li><code>/</code>：可以搜索并使用命令</li>
</ul>
<h2 id="快捷-Block-片段"><a href="#快捷-Block-片段" class="headerlink" title="快捷 Block 片段"></a>快捷 Block 片段</h2><p>输入后按空格即可生成的特定 Block 的字符</p>
<ul>
<li><code>-</code>：无序列表</li>
<li><code>Number</code>：有序列表</li>
<li><code>[]</code>：待办事项列表</li>
<li><code>&gt;</code>：可折叠层级列表（和 markdown 语义不同了）</li>
<li><code>&quot;</code>：引用（这才是 markdown 中 <code>&gt;</code> 在 notion 中的关键字）</li>
<li><code>``</code>：行内代码块<ul>
<li>必须在输入第一个 <code>之后，输入代码，再输入第二个</code> 才有效</li>
<li>生成行内代码片段后，必须紧跟一个空格，如果输入之后又删除掉，再次输入就会被当成行内代码，这时候使用 <code>C-E</code> 可将下一个字符指定为行内代码之外的文本。</li>
</ul>
</li>
<li><code>```</code>：区域代码块<ul>
<li>无法直接指定语言，必须在选择框内选择语言（鼠标）</li>
</ul>
</li>
</ul>
<h2 id="夜间模式"><a href="#夜间模式" class="headerlink" title="夜间模式"></a>夜间模式</h2><p>通过 <code>CS-L</code> 进行切换，也可以在 <code>Settings &amp; Members</code> 中找到 <code>Dark Mode</code> 这个切换。</p>
<p><img src="https://img.rxliuli.com/20191201224609.png" alt="Notion 夜间模式"></p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li><p>编辑真的很卡！</p>
</li>
<li><p>性能不好</p>
<ul>
<li>大文件</li>
<li>包含图片</li>
<li>导入 markdown</li>
</ul>
</li>
<li><p>粘贴富文本链接存在问题</p>
</li>
<li><p>没有列编辑</p>
</li>
<li><p>没有 <strong>标签</strong> 的概念，导致分类只能依赖于目录，不能跨目录进行某种关联。例如 <strong>未完成</strong></p>
</li>
<li><p>就单纯的编辑体验上还说不上非常好，至少比起 VSCode 还有一段距离</p>
</li>
<li><p>无法深度导出 PDF（需要企业版），导致想要打印资料会很不方便</p>
</li>
<li><p>bug</p>
<ul>
<li><p>从编辑器之外点击编辑器，第一次并不会获取到焦点，需要点第二次才行（只出现在 Windows 自动分屏）</p>
</li>
<li><p>代码块中同时存在中文和英文时粘贴后只剩中文部分，英文代码不见了</p>
</li>
<li><p>从 VSCode 的 markdown 预览区复制的区域代码块最后总是会多出空行</p>
</li>
<li><p>代码高亮渲染问题，目前 <code>TypeScript/HTML</code> 是存在问题的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个用于解构 Promise 中的泛型类</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">PromiseDeconstruct</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&gt; = T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;infer R&gt;</span><br><span class="line">  ? R</span><br><span class="line">  : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="attr">i</span>: <span class="title class_">PromiseDeconstruct</span>&lt;<span class="keyword">typeof</span> res&gt; = <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><p>笔记适合作为整理资料的方式，而作为写作工具的话体验却是还差了点。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/" class="post-title-link" itemprop="url">[命名规范] 介词</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-03 12:52:38" itemprop="dateCreated datePublished" datetime="2019-12-03T12:52:38+08:00">2019-12-03</time>
    </span>


  
    <span id="/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/" class="post-meta-item leancloud_visitors" data-flag-title="[命名规范] 介词" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="[命名规范] 介词" href="/2019/12/03/others/rxliuliBlog/dev/%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-%E4%BB%8B%E8%AF%8D/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::22ec16feaa8f25509ec3794eadaab7e1" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>319</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="命名规范-介词"><a href="#命名规范-介词" class="headerlink" title="[命名规范] 介词"></a>[命名规范] 介词</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在为变量命名时，经常需要，在某些单词之间添加介词。例如 <code>searchByName</code>，根据名字搜索数据。下面就介绍一下开发中所用到的介词以及相关的使用场景及示例。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li><code>by</code>: **根据…做…**，表示根据或者使用的条件，例如 <code>searchByName</code></li>
<li><code>with</code>: **根据…与…做…**，与上面 <code>by</code> 的区别在于需要同时操作两个对象<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://lodash.com/">lodash</a> 中 <code>...By</code> 与 <code>...With</code> 的区别</li>
</ul>
</li>
<li><code>to</code>: **从…到…**，表示状态或数据结构的变化，例如 <code>arrayToMap</code></li>
<li><code>of</code>： <strong>…的</strong>，例如 <code>indexOf</code>, <code>typeof</code>, <code>instanceof</code></li>
<li><code>for</code></li>
<li><code>on</code>: <strong>在…之上</strong></li>
<li><code>in</code>: <strong>在…之中</strong></li>
<li><code>at</code></li>
</ul>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/149000464.html">介词 to、for、of、in、on、at、with、by、about 的用法</a></p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/01/others/rxliuliBlog/Essay/%E4%B8%80%E4%BA%9B%E7%83%A6%E5%BF%83%E4%BA%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/01/others/rxliuliBlog/Essay/%E4%B8%80%E4%BA%9B%E7%83%A6%E5%BF%83%E4%BA%8B/" class="post-title-link" itemprop="url">一些烦心事</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-01 21:07:59" itemprop="dateCreated datePublished" datetime="2019-12-01T21:07:59+08:00">2019-12-01</time>
    </span>


  
    <span id="/2019/12/01/others/rxliuliBlog/Essay/%E4%B8%80%E4%BA%9B%E7%83%A6%E5%BF%83%E4%BA%8B/" class="post-meta-item leancloud_visitors" data-flag-title="一些烦心事" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="一些烦心事" href="/2019/12/01/others/rxliuliBlog/Essay/%E4%B8%80%E4%BA%9B%E7%83%A6%E5%BF%83%E4%BA%8B/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::e3aafa9fb6ecba885e800416a8377f95" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>842</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><blockquote>
<p>抽刀断水水更流，举杯消愁愁更愁（虽然吾辈并不喝酒就是了）</p>
</blockquote>
<p>明明说过这是一个技术博客的，然而现如今，吾辈却也需要发一些技术之外的内容了呢。。。（经受了<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/282036368">社会的毒打</a>）</p>
<h2 id="公司"><a href="#公司" class="headerlink" title="公司"></a>公司</h2><p><img src="https://img.rxliuli.com/20191201212832.png" alt="公司"></p>
<p>最近到了一家新的公司，每天早晨 6-7 点起床，然后晚上 7-8 点回来，忙忙碌碌，再无他事。</p>
<p>公司项目历史遗留的问题之多，想要改变问题面临的困境之难，都导致吾辈在公司的时间逐渐变多，自己生活的时间逐渐变少，所以最近别说博客都半个月不发一次，连 github 的维护都少有时间，每天都是早晨抽空维护半个小时罢了。</p>
<p>回到了家里，吃完晚饭，洗完澡，便已然快到了睡觉的时间。想要做点自己的事情，但又感觉没什么时间。</p>
<h2 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h2><p><img src="https://img.rxliuli.com/20191201212906.png" alt="生活"></p>
<p>而且，现在吾辈有点控制不了时间了，每天睡觉时间也难以固定。或许因为一时兴起，便去看了一部电影，然后到了凌晨 0 点或 1 点再睡觉，便是在周末刻意进行了补觉，但也不能弥补日常精力不足的事实。</p>
<p>不曾被在意，不曾被了解，没有目标，没有动力。吾辈曾经把写博客作为目标，但后来知识的增长速度越来越慢，空闲时间越来越多用来咸鱼般的躺在床上，发呆地度过周末的两天。</p>
<h2 id="家庭"><a href="#家庭" class="headerlink" title="家庭"></a>家庭</h2><p><img src="https://img.rxliuli.com/20191201212931.png" alt="家庭"></p>
<p>曾经亲密的家人，现在因为一些事情，却也有了现实的矛盾。或许，家家都有难念的经，便是吾辈，也必须经历各种现实中的苦难吧。</p>
<p>周末有时回到家里，虽然家人现在没有说什么特别的话，但从他们的语气中，对我如今的现状，包含心疼，包含不满。如今也便只是维持现状，小心翼翼的计算每个月回去一次，便不会引起太多的波澜（无论如何亲密的人，只要待在一起的时间够久，便会发现对方的缺陷，而家人，便是能够忍受这种问题的存在）。</p>
<p>吾辈的妹妹已然让父母伤透了心，吾辈不想再伤害他们一次。然而屁股决定脑袋，吾辈想要的东西和他们想要的并不一致，它们的经验并不适合吾辈。娶妻生子，掌家立业，难道便是人一辈子的追求么？</p>
<h2 id="未来"><a href="#未来" class="headerlink" title="未来"></a>未来</h2><p><img src="https://img.rxliuli.com/20191201212955.png" alt="未来"></p>
<p>不知道未来会变成怎样，不知道未来会发生什么。平凡的活着，不断遭受着社会的毒打。当垂垂老矣时，回顾一生，没有任何值得诉说的事迹，或许也是吾辈一种可能的结局吧</p>
<blockquote>
<p>卑鄙有卑鄙者的通行证，高尚有高尚者的墓志铭。</p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/12/01/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E4%BA%BA%E7%B1%BB%E7%AE%80%E5%8F%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/01/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E4%BA%BA%E7%B1%BB%E7%AE%80%E5%8F%B2/" class="post-title-link" itemprop="url">读书-人类简史</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-01 21:07:59" itemprop="dateCreated datePublished" datetime="2019-12-01T21:07:59+08:00">2019-12-01</time>
    </span>


  
    <span id="/2019/12/01/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E4%BA%BA%E7%B1%BB%E7%AE%80%E5%8F%B2/" class="post-meta-item leancloud_visitors" data-flag-title="读书-人类简史" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="读书-人类简史" href="/2019/12/01/others/rxliuliBlog/Tool/%E8%AF%BB%E4%B9%A6/%E8%AF%BB%E4%B9%A6-%E4%BA%BA%E7%B1%BB%E7%AE%80%E5%8F%B2/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::599db5952b5af80ffb71b14dd085afc6" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>断断续续，最近终于读完了<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E4%BA%BA%E7%B1%BB%E7%AE%80%E5%8F%B2">人类简史</a>。它是一个系列的书籍，一共三本「人类简史」，「未来简史」和「今日简史」，当然，系列的第一本「人类简史」是最出名的，吾辈也正是有所耳闻才去通读了该系列。</p>
<p><img src="https://img.rxliuli.com/20191201213231.png" alt="封面"></p>
<h2 id="言"><a href="#言" class="headerlink" title="言"></a>言</h2><p>书里太多内容，读过之后却又没有记忆下来。然而，吾辈记忆深刻的有以下几点</p>
<h3 id="人类之所以成为「万物之灵」是因为想象力「虚构的故事」"><a href="#人类之所以成为「万物之灵」是因为想象力「虚构的故事」" class="headerlink" title="人类之所以成为「万物之灵」是因为想象力「虚构的故事」"></a>人类之所以成为「万物之灵」是因为想象力「虚构的故事」</h3><p>国家，政府，金钱，公司，资本主义，社会主义，不过都是虚构的概念，人类相信这些「故事」，所以能够形成大规模协作，而这是其他物种所不具备的。<br>老实说这点确实有点违反吾辈一直以来的认知，甚至比曾经「官僚系统是人类史上最伟大的发明，能让无数互不相识的人互相协作」更有冲击性。<br>附：之前吾辈的对官僚系统的认知基本上是腐败和权力，而且从小接受的教育告诉吾辈人类会使用工具才是人类成为万物之灵的关键（比如能够使用「火」）。</p>
<h3 id="人工智能会代替绝大多数人的工作，引起大规模失业"><a href="#人工智能会代替绝大多数人的工作，引起大规模失业" class="headerlink" title="人工智能会代替绝大多数人的工作，引起大规模失业"></a>人工智能会代替绝大多数人的工作，引起大规模失业</h3><p>这点和吾辈一直以来的想法不谋而合，重复的工作迟早被人工智能替代，但书中所言的现实更加绝望——连创造性的工作，文学和艺术都未能幸免于难。<br>人工智能还有多久才能出现，这点谁也不好说，但能知道的是现今的 Google，MS 这些顶级的大公司都在研究人工智能，并已然初见成效（Google 搜索&#x2F;翻译&#x2F;微软小娜）。<br>虽然现在人工智能看起来还很初级，只能在某个指定领域内击败人类，而且有些还很蠢（被称为人工智障），但不得不说人工智能的发展及其迅速，甚至自动驾驶汽车已经上路很多年了。</p>
<h3 id="一个人的职业会被迫需要改变"><a href="#一个人的职业会被迫需要改变" class="headerlink" title="一个人的职业会被迫需要改变"></a>一个人的职业会被迫需要改变</h3><p>曾经，一旦确定了职业，大多都是兢兢业业做一辈子。但现在，人类的寿命增加，社会变化又如此迅速，人类讲被迫适应一次次的职业改变。毕业即失业，学习到的东西到了社会上已然过时，这便是未来的真实写照了。<br>老实说这点在吾辈父母身上已经初见端倪，父母四十几岁的人，却不得不改变了职业。当然，他们不喜欢这样，用他们的话说：你知道改变有多难么？出问题家里老小怎么办？<br>现在，父母辈的人可能几十年换一次职业，但到了我们，却未必依然。或许，不久之后，十年换一次职业都是一件正常的事情了（#无奈）。</p>
<h3 id="法西斯在自身看来并不是邪恶的"><a href="#法西斯在自身看来并不是邪恶的" class="headerlink" title="法西斯在自身看来并不是邪恶的"></a>法西斯在自身看来并不是邪恶的</h3><p>很多描述法西斯的书籍都把法西斯描述的无比邪恶，而身处其中的人却很难意识到（像是现如今的国内 #笑）。<br>政府说什么是好的什么就是好的，权利比真相更重要，家长式的权威政府，前景难免不会变成 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh/%E4%B8%80%E4%B9%9D%E5%85%AB%E5%9B%9B">1984</a> 般的反乌托邦世界。每个人都被监听，家人之间互相举报，毫无信任感可言。<br>现在，国内是世界上摄像头最多的地方，网络公司对隐私的侵犯也并不违反法律，这造成了国内公司的肆无忌惮，毫无底线的把数据收集用以收割韭菜，并且，报告给当局（参阅 <code>**IDC/ISP**</code> 数据上报规范）。</p>
<h2 id="思"><a href="#思" class="headerlink" title="思"></a>思</h2><p>人的认知无法超越时代，即便如牛顿，爱因斯坦他们，亦然如此。这本书的所言所述，也并不代表真理，更不代表其中的一切都是对的，只是作者如此认为——<strong>每个作者都有自己的偏见</strong>。</p>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://fangtianq.github.io/2019/11/03/others/rxliuliBlog/JavaScript/Yarn-link-%E9%93%BE%E6%8E%A5%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/12722882?s=460&u=60d32bd6a1b3d81f0e2dcfc9390b86c797573fbe&v=4">
      <meta itemprop="name" content="ftq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="越努力，越幸运！">
      <meta itemprop="description" content="有志者事竟成">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 越努力，越幸运！">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/11/03/others/rxliuliBlog/JavaScript/Yarn-link-%E9%93%BE%E6%8E%A5%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">Yarn link 链接本地项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-03 11:02:55" itemprop="dateCreated datePublished" datetime="2019-11-03T11:02:55+08:00">2019-11-03</time>
    </span>


  
    <span id="/2019/11/03/others/rxliuliBlog/JavaScript/Yarn-link-%E9%93%BE%E6%8E%A5%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AE/" class="post-meta-item leancloud_visitors" data-flag-title="Yarn link 链接本地项目" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Yarn link 链接本地项目" href="/2019/11/03/others/rxliuliBlog/JavaScript/Yarn-link-%E9%93%BE%E6%8E%A5%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AE/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::bd0a94b60a86114685d4e7399a5cabc7" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Yarn-link-链接本地项目"><a href="#Yarn-link-链接本地项目" class="headerlink" title="Yarn link 链接本地项目"></a>Yarn link 链接本地项目</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>作为 JavaScript SDK 的开发者一定都知道，想要在未发布前进行测试整个包可谓是困难重重。而 <code>yarn link</code> 这个命令便是为了解决这个需求而产生的，它能让包引用并测试自身，即便包并未发布或不包含在 <code>package.json</code> 中亦然。</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/rxliuli/Yarn-link-45007161bbfd43b2beffac88a0bc69b0#396f98a450c445f29e6fff69202654f0">官网链接</a></p>
</blockquote>
<h3 id="链接包"><a href="#链接包" class="headerlink" title="链接包"></a>链接包</h3><p>在命令行运行即可将当前包链接安装到这个包中，即便你在 <code>package.json</code> 并不会找到显式的依赖。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">link</span> &amp;&amp; yarn <span class="built_in">link</span> <span class="string">&quot;&lt;package.json 中的 name 字段&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：如果当前包是 <code>cli</code>，即 <code>package.json</code> 中包含 <code>bin</code> 字段，则还会被链接到 yarn 的全局脚本目录中。<br>yarn 的全局脚本目录可以通过执行 <code>yarn global bin</code> 进行查看，如果要在全局执行，则需要将该目录设置到环境变量 <code>Path</code> 中，然后就可以全局运行命令了。</p>
</blockquote>
<p>然后，便可以在项目中使用了（测试）</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &lt;pkgName&gt; from <span class="string">&#x27;pkgName&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="取消链接"><a href="#取消链接" class="headerlink" title="取消链接"></a>取消链接</h3><p>如果不需要了，则也可以轻易通过 <code>unlink</code> 移除。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">unlink</span> <span class="string">&quot;&lt;package.json 中的 name 字段&gt;&quot;</span> &amp;&amp; yarn <span class="built_in">unlink</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：同样的，如果当前包是 <code>cli</code>，则 yarn 全局 <code>bin</code> 目录中也会进行删除</p>
</blockquote>
<h3 id="通用-script"><a href="#通用-script" class="headerlink" title="通用 script"></a>通用 script</h3><p>每个项目都这样太麻烦了，可否添加一个通用 <code>script</code> 脚本呢？</p>
<p>当然是可以的，通过 <code>%npm_package_name%</code> 我们便能在 <code>srcipt</code> 中访问到项目名</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;link:add&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn link &amp;&amp; yarn link %npm_package_name%&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;link:remove&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn unlink %npm_package_name% &amp;&amp; yarn unlink&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.npmjs.com/misc/scripts#packagejson-vars">https://docs.npmjs.com/misc/scripts#packagejson-vars</a></p>
</blockquote>
<p>以后便可以直接将命令复制到 <code>script</code> 即可直接使用了。</p>
<blockquote>
<p>注：使用 <code>%%</code> 包裹便能在 <code>script</code> 中使用，该方式在 Windows 下生效，Linux 下似乎需要添加前缀 <code>$</code>，不过吾辈并未测试（懒得折腾 Linux 桌面了）。<br>然而，问题并非不存在了，例如本地使用 Windows 构建，然而远程 CI 使用 Linux，那这个脚本就要炸了。。。所以，如果你需要上 CI 的话，还是老实改名字吧。<br>或者也可以使用 <strong>VSCode + WSL</strong>？#笑</p>
</blockquote>

      
    </div>


    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/">33</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ftq</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:54</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="//unpkg.com/animejs@3.1.0/lib/anime.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




<script src="/js/third-party/sakuraPlus.js"></script>
<script src="/js/third-party/fireworks.js"></script>
<script src="/js/third-party/mouse_slide.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"6NuBzi5VSiFfQE2sYbymtv9t-gzGzoHsz","app_key":"stH9SzRt55d1wnwQD7LcoaQR","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyw21b1ST","appkey":"045a89927c13c0e33a82c736b468fe51"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
