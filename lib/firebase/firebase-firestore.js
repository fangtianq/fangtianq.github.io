!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,(function(t){"use strict";try{!function(){function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n,r=e(t),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,e,n,r){return new(n=n||Promise)((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,(s=i?[2&s[0],i.value]:s)[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function u(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}(Te=n=n||{})[Te.DEBUG=0]="DEBUG",Te[Te.VERBOSE=1]="VERBOSE",Te[Te.INFO=2]="INFO",Te[Te.WARN=3]="WARN",Te[Te.ERROR=4]="ERROR",Te[Te.SILENT=5]="SILENT";function c(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=f[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,u(["["+i+"]  "+t.name+":"],n))}}var h={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},l=n.INFO,f=((Ie={})[n.DEBUG]="log",Ie[n.VERBOSE]="log",Ie[n.INFO]="info",Ie[n.WARN]="warn",Ie[n.ERROR]="error",Ie),d=(Object.defineProperty(p.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in n))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),p.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?h[t]:t},Object.defineProperty(p.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),p.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,n.DEBUG],t)),this._logHandler.apply(this,u([this,n.DEBUG],t))},p.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,n.VERBOSE],t)),this._logHandler.apply(this,u([this,n.VERBOSE],t))},p.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,n.INFO],t)),this._logHandler.apply(this,u([this,n.INFO],t))},p.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,n.WARN],t)),this._logHandler.apply(this,u([this,n.WARN],t))},p.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,n.ERROR],t)),this._logHandler.apply(this,u([this,n.ERROR],t))},p);function p(t){this.name=t,this._logLevel=l,this._logHandler=c,this._userLogHandler=null}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var g,v="FirebaseError",m=(o(b,g=Error),b);function b(t,e,n){e=g.call(this,e)||this;return e.code=t,e.customData=n,e.name=v,Object.setPrototypeOf(e,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,w.prototype.create),e}var w=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(T,(function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"}))):"Error",t=this.serviceName+": "+t+" ("+o+").";return new m(o,t,i)},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function _(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A={},N=D||self;function C(){}function k(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),L=0;function O(t,e,n){return t.call.apply(t.bind,arguments)}function P(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?O:P).apply(null,arguments)}function F(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}function q(){return Date.now()}function V(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,(t.prototype.constructor=t).Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function U(){this.j=this.j,this.i=this.i}U.prototype.j=!1,U.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,R)&&t[R]||(t[R]=++L))},U.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var Q,H=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function W(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var X=N.navigator;if(X){X=X.userAgent;if(X){Q=X;break t}}Q=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e,n={};for(e in t)n[e]=t[e];return n}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Z.length;i++)e=Z[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function et(t){return et[" "](t),t}et[" "]=C;var nt,rt=W(Q,"Opera"),it=W(Q,"Trident")||W(Q,"MSIE"),ot=W(Q,"Edge"),st=ot||it,at=W(Q,"Gecko")&&!(W(Q.toLowerCase(),"webkit")&&!W(Q,"Edge"))&&!(W(Q,"Trident")||W(Q,"MSIE"))&&!W(Q,"Edge"),ut=W(Q.toLowerCase(),"webkit")&&!W(Q,"Edge");function ct(){var t=N.document;return t?t.documentMode:void 0}t:{var ht="",lt=(lt=Q,at?/rv:([^\);]+)(\)|;)/.exec(lt):ot?/Edge\/([\d\.]+)/.exec(lt):it?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(lt):ut?/WebKit\/(\S+)/.exec(lt):rt?/(?:Version)[ \/]?(\S+)/.exec(lt):void 0);if(lt&&(ht=lt?lt[1]:""),it){lt=ct();if(null!=lt&&lt>parseFloat(ht)){nt=String(lt);break t}}nt=ht}var ft={};function dt(t){return e=t,n=function(){for(var e=0,n=H(String(nt)).split("."),r=H(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++)for(var s=n[o]||"",a=r[o]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],(0!=s[0].length||0!=a[0].length)&&(e=Y(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||Y(0==s[2].length,0==a[2].length)||Y(s[2],a[2]),s=s[3],a=a[3],0==e););return 0<=e},r=ft,Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=n(e);var e,n,r}var pt=N.document&&it&&(ct()||parseInt(nt,10))||void 0,yt=!it||9<=Number(pt),gt=it&&!dt("9"),vt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",C,e),N.removeEventListener("test",C,e)}catch(t){}return t}();function mt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function bt(t,e){if(mt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{et(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:wt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}mt.prototype.b=function(){this.defaultPrevented=!0},V(bt,mt);var wt={2:"touch",3:"pen",4:"mouse"};bt.prototype.b=function(){bt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),Tt=0;function It(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Tt,this.Y=this.Z=!1}function _t(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function St(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(_t(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function At(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}St.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=At(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new It(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),Ct={};function kt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=qt(r);return e&&e[Et]?e.wa(n,r,x(i)?!!i.capture:!!i,o):xt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=qt(n),t&&t[Et]?t.va(e,n,x(r)?!!r.capture:!!r,i):xt(t,e,n,!1,r,i)}function xt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=x(i)?!!i.capture:!!i;if(s&&!yt)return null;var a,u,c=Mt(t);if(c||(t[Nt]=c=new St(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(a=Pt,r=u=yt?function(t){return a.call(u.src,u.listener,t)}:function(t){if(!(t=a.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)void 0===(i=!vt?s:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Lt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Rt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[Et]?Dt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Lt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Mt(e))?(Dt(n,t),0==n.b&&(n.src=null,e[Nt]=null)):_t(t)))}function Lt(t){return t in Ct?Ct[t]:Ct[t]="on"+t}function Ot(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Rt(t),n.call(r,e)}function Pt(t,e){if(t.Y)return!0;if(yt)return Ot(t,new bt(e,this));if(!e)t:{e=["window","event"];for(var n=N,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ot(t,e=new bt(e,this))}function Mt(t){return(t=t[Nt])instanceof St?t:null}var Ft="__closure_events_fn_"+(1e9*Math.random()>>>0);function qt(t){return"function"==typeof t?t:(t[Ft]||(t[Ft]=function(e){return t.handleEvent(e)}),t[Ft])}function Vt(){U.call(this),this.c=new St(this),(this.J=this).C=null}function Ut(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new mt(e,t):e instanceof mt?e.target=e.target||t:(s=e,tt(e=new mt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Bt(o,r,!0,e)&&s;if(s=Bt(o=e.a=t,r,!0,e)&&s,s=Bt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Bt(o=e.a=n[i],r,!1,e)&&s}function Bt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.Y&&u.capture==n&&(s=u.listener,a=u.ca||u.src,u.Z&&Dt(t.c,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}V(Vt,U),Vt.prototype[Et]=!0,(S=Vt.prototype).addEventListener=function(t,e,n,r){kt(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=x(i)?!!i.capture:!!i,r=qt(r),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=At(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Mt(e))&&(n=e.a[n.toString()],(r=(e=-1)<(e=n?At(n,r,i,o):e)?n[e]:null)&&Rt(r))}(this,t,e,n,r)},S.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.C=null},S.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var jt=N.JSON.stringify;function Gt(){this.b=this.a=null}var Kt,zt=(Qt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Qt((function(){return new Ht}),(function(t){t.reset()})));function Qt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Ht(){this.next=this.b=this.a=null}function Wt(t,e){var n;Kt||(n=N.Promise.resolve(void 0),Kt=function(){n.then(Jt)}),Yt||(Kt(),Yt=!0),Xt.add(t,e)}Gt.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ht.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Yt=!(Ht.prototype.reset=function(){this.next=this.b=this.a=null}),Xt=new Gt;function Jt(){for(var t,e;n=e=void 0,n=null,(e=Xt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){N.setTimeout((function(){throw t}),0)}(t)}var n=zt;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}Yt=!1}function $t(t,e){Vt.call(this),this.b=t||1,this.a=e||N,this.f=M(this.Za,this),this.g=q()}function Zt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function te(t,e,n){if("function"==typeof t)n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}V($t,Vt),(S=$t.prototype).aa=!1,S.M=null,S.Za=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ut(this,"tick"),this.aa&&(Zt(this),this.start())))},S.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},S.G=function(){$t.X.G.call(this),Zt(this),delete this.a};var ee,ne,re,ie=(I(ne=se,re=ee=U),ne.prototype=null===re?Object.create(re):(oe.prototype=re.prototype,new oe),se.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=te((function(){e.a=null,e.c&&(e.c=!1,t(e))}),e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},se.prototype.G=function(){ee.prototype.G.call(this),this.a&&(N.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},se);function oe(){this.constructor=ne}function se(t,e){var n=ee.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function ae(t){U.call(this),this.b=t,this.a={}}V(ae,U);var ue=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ue[0]=n.toString()),n=ue);for(var i=0;i<n.length;i++){var o=kt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Rt(t)}),t),t.a={}}function le(){this.a=!0}function fe(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return jt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ae.prototype.G=function(){ae.X.G.call(this),he(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},le.prototype.info=function(){};var de={},pe=null;function ye(){return pe=pe||new Vt}function ge(t){mt.call(this,de.Fa,t)}function ve(t){var e=ye();Ut(e,new ge(e))}function me(t,e){mt.call(this,de.STAT_EVENT,t),this.stat=e}function be(t){var e=ye();Ut(e,new me(e,t))}function we(t){mt.call(this,de.Ga,t)}function Ee(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return N.setTimeout((function(){t()}),e)}de.Fa="serverreachability",V(ge,mt),de.STAT_EVENT="statevent",V(me,mt),de.Ga="timingevent",V(we,mt);var Te={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ie={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function _e(){}function Se(t){var e;return e=!(e=t.a)?t.a={}:e}function De(){}_e.prototype.a=null;D={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ae(){mt.call(this,"d")}function Ne(){mt.call(this,"c")}function Ce(){}function ke(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new ae(this),this.P=Re,t=st?125:void 0,this.R=new $t(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}V(Ae,mt),V(Ne,mt),V(Ce,_e);var xe=new Ce,Re=45e3,Le={},Oe={};function Pe(t,e,n){t.H=1,t.i=nn(Xe(e)),t.j=n,t.I=!0,Me(t,null)}function Me(t,e){t.u=q(),qe(t),t.l=Xe(t.i);var n,r,i,o,s,a,u=t.l,c=t.S;Array.isArray(c)||(c=[String(c)]),gn(u.b,"t",c),t.D=0,t.a=cr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(M(t.Ca,t,t.a),t.O)),ce(t.J,t.a,"readystatechange",t.Xa),e=t.B?$(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ve(1),n=t.c,r=t.m,i=t.l,o=t.f,s=t.S,a=t.j,n.info((function(){if(n.a)if(a)for(var t="",e=a.split("&"),u=0;u<e.length;u++){var c,h,l=e[u].split("=");1<l.length&&(c=l[0],l=l[1],t=2<=(h=c.split("_")).length&&"type"==h[1]?t+(c+"=")+l+"&":t+(c+"=redacted&"))}else t=null;else t=a;return"XMLHTTP REQ ("+o+") [attempt "+s+"]: "+r+"\n"+i+"\n"+t}))}function Fe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var a=(a=n,o=i=void 0,i=(r=t).D,-1==(o=a.indexOf("\n",i))?Oe:(i=Number(a.substring(i,o)),isNaN(i)?Le:(o+=1)+i>a.length?Oe:(a=a.substr(o,i),r.D=o+i,a)));if(a==Oe){4==e&&(t.h=4,be(14),s=!1),fe(t.c,t.f,null,"[Incomplete Response]");break}if(a==Le){t.h=4,be(15),fe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}fe(t.c,t.f,a,null),Ge(t,a)}4==e&&0==n.length&&(t.h=1,be(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),er(e),e.F=!0,be(11))):(fe(t.c,t.f,n,"[Invalid Chunked Response]"),je(t),Be(t))}function qe(t){t.T=q()+t.P,Ve(t,t.P)}function Ve(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ee(M(t.Va,t),e)}function Ue(t){t.o&&(N.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||ir(t.g,t)}function je(t){Ue(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Zt(t.R),he(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ge(t,e){try{var n,r,i,o,s,a=t.g;if(0!=a.v&&(a.a==t||In(a.b,t)))if(a.I=t.N,!t.C&&In(a.b,t)&&3==a.v){try{var u=a.ka.a.parse(e)}catch(t){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){t:if(!a.j){if(a.a){if(!(a.a.u+3e3<t.u))break t;rr(a),Qn(a)}tr(a),be(18)}}else a.oa=c[1],0<a.oa-a.P&&c[2]<37500&&a.H&&0==a.o&&!a.m&&(a.m=Ee(M(a.Sa,a),6e3));if(Tn(a.b)<=1&&a.ea){try{a.ea()}catch(t){}a.ea=void 0}}else sr(a,11)}else if(!t.C&&a.a!=t||rr(a),!z(e))for(e=u=a.ka.a.parse(e),u=0;u<e.length;u++)c=e[u],a.P=c[0],c=c[1],2==a.v?"c"==c[0]?(a.J=c[1],a.ga=c[2],null!=(r=c[3])&&(a.ha=r,a.c.info("VER="+a.ha)),null!=(o=c[4])&&(a.pa=o,a.c.info("SVER="+a.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,a.D=n,a.c.info("backChannelRequestTimeoutMs_="+n)),n=a,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(W(r,"spdy")||W(r,"quic")||W(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(_n(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,en(n.B,n.A,s))),a.v=3,a.f&&a.f.ta(),a.U&&(a.N=q()-t.u,a.c.info("Handshake RTT: "+a.N+"ms")),i=t,(n=a).la=ur(n,n.C?n.ga:null,n.fa),i.C?(Sn(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Ue(o),qe(o)),n.a=i):Zn(n),0<a.g.length&&Yn(a)):"stop"!=c[0]&&"close"!=c[0]||sr(a,7):3==a.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?sr(a,7):zn(a):"noop"!=c[0]&&a.f&&a.f.sa(c),a.o=0);ve(4)}catch(t){}}function Ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)j(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(k(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];He(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)He(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function He(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=ke.prototype).setTimeout=function(t){this.P=t},S.Xa=function(t){t=t.target;var e=this.F;e&&3==Bn(t)?e.f():this.Ca(t)},S.Ca=function(t){try{if(t==this.a)t:{var e=Bn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ve(8==n||r<=0?3:2),Ue(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,r=this.c,u=this.m,c=this.l,h=this.f,l=this.S,f=e,d=i,r.info((function(){return"XMLHTTP RESP ("+h+") [ attempt "+l+"]: "+u+"\n"+c+"\n"+f+" "+d})),this.b){if(this.U&&!this.C){e:{if(this.a){var s=this.a;if((s=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,be(12),je(this),Be(this);break t}fe(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ge(this,a)}this.I?(Fe(this,e,o),st&&this.b&&3==e&&(ce(this.J,this.R,"tick",this.Wa),this.R.start())):(fe(this.c,this.f,o,null),Ge(this,o)),4==e&&je(this),this.b&&!this.A&&(4==e?ir(this.g,this):(this.b=!1,qe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,be(12)):(this.h=0,be(13)),je(this),Be(this)}}}catch(t){}var u,c,h,l,f,d},S.Wa=function(){var t,e;this.a&&(t=Bn(this.a),e=this.a.$(),this.D<e.length&&(Ue(this),Fe(this,t,e),this.b&&4!=t&&qe(this)))},S.cancel=function(){this.A=!0,je(this)},S.Va=function(){this.o=null;var t,e,n=q();0<=n-this.T?(t=this.c,e=this.l,t.info((function(){return"TIMEOUT: "+e})),2!=this.H&&(ve(3),be(17)),je(this),this.h=2,Be(this)):Ve(this,this.T-n)},(S=ze.prototype).K=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.L=function(){return Qe(this),this.a.concat()},S.get=function(t,e){return He(this.b,t)?this.b[t]:e},S.set=function(t,e){He(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye?(this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,$e(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b,(n=new fn).c=e.c,e.a&&(n.a=new ze(e.a),n.b=e.b),tn(this,n),this.i=t.i):t&&(n=String(t).match(We))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=rn(n[2]||""),$e(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new fn(null,this.a))}function Xe(t){return new Ye(t)}function Je(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){var r,i;e instanceof fn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(dn(r),r.c=null,r.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),gn(this,n,t))}),r)),r.f=i):(n||(e=on(e,hn)),t.b=new fn(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,an,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(on(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,ln)),t.join("")};var an=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,ln=/#/g;function fn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(t){t.a||(t.a=new ze,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function pn(t,e){dn(t),e=vn(t,e),He(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t)))}function yn(t,e){return dn(t),e=vn(t,e),He(t.a.b,e)}function gn(t,e,n){pn(t,e),0<n.length&&(t.c=null,t.a.set(vn(t,e),K(n)),t.b+=n.length)}function vn(t,e){return e=String(e),e=t.f?e.toLowerCase():e}(S=fn.prototype).add=function(t,e){dn(this),this.c=null,t=vn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(t,e){dn(this),this.a.forEach((function(n,r){j(n,(function(n){t.call(e,n,r,this)}),this)}),this)},S.L=function(){dn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.K=function(t){dn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=G(e,this.a.get(vn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},S.set=function(t,e){return dn(this),this.c=null,yn(this,t=vn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var mn=function(t,e){this.b=t,this.a=e};function bn(t){this.g=t||wn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.ia&&N.ia.ya&&N.ia.ya()&&N.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var wn=10;function En(t){return t.b||t.a&&t.a.size>=t.f}function Tn(t){return t.b?1:t.a?t.a.size:0}function In(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=_(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function An(){}function Nn(){this.a=new An}function Cn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bn.prototype.cancel=function(){var t,e;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=_(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},An.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},An.prototype.parse=function(t){return N.JSON.parse(t,void 0)};var kn=N.JSON.parse;function xn(t){Vt.call(this),this.headers=new ze,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Rn,this.D=this.F=!1}V(xn,Vt);var Rn="",Ln=/^https?$/i,On=["POST","PUT"];function Pn(t){return"content-type"==t.toLowerCase()}function Mn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Fn(t),Vn(t)}function Fn(t){t.u||(t.u=!0,Ut(t,"complete"),Ut(t,"error"))}function qn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=Bn(t)||2!=t.W()))if(t.l&&4==Bn(t))te(t.za,0,t);else if(Ut(t,"readystatechange"),4==Bn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}(e=s)||((n=0===o)&&(!(i=String(t.B).match(We)[1]||null)&&N.self&&N.self.location&&(i=(r=N.self.location.protocol).substr(0,r.length-1)),n=!Ln.test(i?i.toLowerCase():"")),e=n);if(e)Ut(t,"complete"),Ut(t,"success");else{t.h=6;try{var a=2<Bn(t)?t.a.statusText:""}catch(o){a=""}t.f=a+" ["+t.W()+"]",Fn(t)}}finally{Vn(t)}}}function Vn(t,e){if(t.a){Un(t);var n=t.a,r=t.s[0]?C:null;t.a=null,t.s=null,e||Ut(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Un(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(N.clearTimeout(t.m),t.m=null)}function Bn(t){return t.a?t.a.readyState:0}function jn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,(function(t,e){i+=e,i+=":",i+=t,i+="\r\n"})),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Kn(t){this.pa=0,this.g=[],this.c=new le,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Gn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Gn("baseRetryDelayMs",5e3,t),this.Ra=Gn("retryDelaySeedMs",1e4,t),this.Ma=Gn("forwardChannelMaxRetries",2,t),this.ma=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new bn(t&&t.concurrentRequestLimit),this.ka=new Nn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function zn(t){var e,n;Hn(t),3==t.v&&(e=t.R++,en(n=Xe(t.B),"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),Jn(t,n),(e=new ke(t,t.c,e,void 0)).H=2,e.i=nn(Xe(n)),n=!1,!(n=N.navigator&&N.navigator.sendBeacon?N.navigator.sendBeacon(e.i.toString(),""):n)&&N.Image&&((new Image).src=e.i,n=!0),n||(e.a=cr(e.g,null),e.a.ba(e.i)),e.u=q(),qe(e)),ar(t)}function Qn(t){t.a&&(er(t),t.a.cancel(),t.a=null)}function Hn(t){Qn(t),t.j&&(N.clearTimeout(t.j),t.j=null),rr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&N.clearTimeout(t.h),t.h=null)}function Wn(t,e){t.g.push(new mn(t.Oa++,e)),3==t.v&&Yn(t)}function Yn(t){En(t.b)||t.h||(t.h=!0,Wt(t.Ba,t),t.u=0)}function Xn(t,e){var n=e?e.f:t.R++,r=Xe(t.B);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.P),Jn(t,r),t.i&&t.l&&jn(r,t.i,t.l),n=new ke(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),_n(t.b,n),Pe(n,r,e)}function Jn(t,e){t.f&&Ke({},(function(t,n){en(e,n,t)}))}function $n(t,e,n){n=Math.min(t.g.length,n);var r=t.f?M(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{!function(t,e,n){var r=n||"";try{Ke(t,(function(t,n){var i=t;x(t)&&(i=jt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Zn(t){t.a||t.j||(t.T=1,Wt(t.Aa,t),t.o=0)}function tr(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Ee(M(t.Aa,t),or(t,t.o)),t.o++,1)}function er(t){null!=t.s&&(N.clearTimeout(t.s),t.s=null)}function nr(t){t.a=new ke(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.H?"0":"1"),en(e,"AID",t.P),Jn(t,e),en(e,"TYPE","xmlhttp"),t.i&&t.l&&jn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=nn(Xe(e)),n.j=null,n.I=!0,Me(n,t)}function rr(t){null!=t.m&&(N.clearTimeout(t.m),t.m=null)}function ir(t,e){var n,r,i,o=null;if(t.a==e){rr(t),er(t),t.a=null;var s=2}else{if(!In(t.b,e))return;o=e.s,Sn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=q()-e.u,n=t.u,Ut(s=ye(),new we(s)),Yn(t)):Zn(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,Tn((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=Ee(M(r.Ba,r,i),or(r,r.u)),r.u++,0))))&&(2!=s||!tr(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:sr(t,5);break;case 4:sr(t,10);break;case 3:sr(t,6);break;default:sr(t,2)}}function or(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function sr(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=M(t.Ya,t),r||(r=new Ye("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Je(r,"https"),nn(r)),n=r.toString(),r=o,o=new le,N.Image?((i=new Image).onload=F(Cn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=F(Cn,o,i,"TestLoadImage: error",!1,r),i.onabort=F(Cn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=F(Cn,o,i,"TestLoadImage: timeout",!1,r),N.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=n):r(!1)):be(2),t.v=0,t.f&&t.f.ra(e),ar(t),Hn(t)}function ar(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,K(t.g),t.g.length=0),t.f.qa())}function ur(t,e,n){var r,i,o,s,a,u=(s=n)instanceof Ye?Xe(s):new Ye(s,void 0);return""!=u.c?(e&&$e(u,e+"."+u.c),Ze(u,u.h)):(a=N.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new Ye(null,void 0),r&&Je(a,r),i&&$e(a,i),o&&Ze(a,o),s&&(a.g=s),u=a),t.V&&J(t.V,(function(t,e){en(u,e,t)})),e=t.A,n=t.na,e&&n&&en(u,e,n),en(u,"VER",t.ha),Jn(t,u),u}function cr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new xn(t.Na)).F=t.C,e}function hr(){}function lr(){if(it&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function fr(t,e){Vt.call(this),this.a=new Kn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new yr(this)}function dr(t){Ae.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){Ne.call(this),this.status=1}function yr(t){this.a=t}(S=xn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Se(this.H):Se(xe),this.a.onreadystatechange=M(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Mn(this,t)}t=n||"";var i,o=new ze(this.headers);r&&Ke(r,(function(t,e){o.set(e,t)})),r=function(t){t:{for(var e=Pn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=N.FormData&&t instanceof N.FormData,0<=B(On,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Un(this),0<this.o&&((this.D=(i=this.a,it&&dt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=M(this.xa,this)):this.m=te(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Mn(this,t)}},S.xa=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ut(this,"timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ut(this,"complete"),Ut(this,"abort"),Vn(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Vn(this,!0)),xn.X.G.call(this)},S.za=function(){this.j||(this.A||this.l||this.g?qn(this):this.Ua())},S.Ua=function(){qn(this)},S.W=function(){try{return 2<Bn(this)?this.a.status:-1}catch(t){return-1}},S.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},S.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),kn(e)}},S.ua=function(){return this.h},S.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(S=Kn.prototype).ha=8,S.v=1,S.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ke(this,this.c,t,void 0),r=this.l;if(this.O&&(r?tt(r=$(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),en(i=Xe(this.B),"RID",t),en(i,"CVER",22),this.A&&en(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&r&&jn(i,this.i,r),_n(this.b,n),this.Ia&&en(i,"TYPE","init"),this.da?(en(i,"$req",e),en(i,"SID","null"),n.U=!0,Pe(n,i,null)):Pe(n,i,e),this.v=2}}else 3==this.v&&(t?Xn(this,t):0==this.g.length||En(this.b)||Xn(this))},S.Aa=function(){var t;this.j=null,nr(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ee(M(this.Ta,this),t))},S.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,be(10),Qn(this),nr(this))},S.Sa=function(){null!=this.m&&(this.m=null,Qn(this),tr(this),be(19))},S.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),be(2)):(this.c.info("Failed to ping google.com"),be(1))},(S=hr.prototype).ta=function(){},S.sa=function(){},S.ra=function(){},S.qa=function(){},S.Ja=function(){},lr.prototype.a=function(t,e){return new fr(t,e)},V(fr,Vt),fr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;be(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ur(t,null,t.fa),Yn(t)},fr.prototype.close=function(){zn(this.a)},fr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Wn(this.a,e)):this.l?((e={}).__data__=jt(t),Wn(this.a,e)):Wn(this.a,t)},fr.prototype.G=function(){this.a.f=null,delete this.f,zn(this.a),delete this.a,fr.X.G.call(this)},V(dr,Ae),V(pr,Ne),V(yr,hr),yr.prototype.ta=function(){Ut(this.a,"a")},yr.prototype.sa=function(t){Ut(this.a,new dr(t))},yr.prototype.ra=function(t){Ut(this.a,new pr)},yr.prototype.qa=function(){Ut(this.a,"b")},lr.prototype.createWebChannel=lr.prototype.a,fr.prototype.send=fr.prototype.h,fr.prototype.open=fr.prototype.g,Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,Ie.COMPLETE="complete",(De.EventType=D).OPEN="a",D.CLOSE="b",D.ERROR="c",D.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,xn.prototype.listenOnce=xn.prototype.wa,xn.prototype.getLastError=xn.prototype.Qa,xn.prototype.getLastErrorCode=xn.prototype.ua,xn.prototype.getStatus=xn.prototype.W,xn.prototype.getResponseJson=xn.prototype.Pa,xn.prototype.getResponseText=xn.prototype.$,xn.prototype.send=xn.prototype.ba;var gr=ye,vr=Te,mr=Ie,br=de,wr=10,Er=11,Tr=De,Ir=xn,_r=(Sr.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Sr.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Sr);function Sr(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}_r.o=-1;var Dr=new d("@firebase/firestore");function Ar(){return Dr.logLevel}function Nr(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];Dr.logLevel<=n.DEBUG&&(e=r.map(xr),Dr.debug.apply(Dr,u(["Firestore (8.3.1): "+t],e)))}function Cr(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];Dr.logLevel<=n.ERROR&&(e=r.map(xr),Dr.error.apply(Dr,u(["Firestore (8.3.1): "+t],e)))}function kr(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];Dr.logLevel<=n.WARN&&(e=r.map(xr),Dr.warn.apply(Dr,u(["Firestore (8.3.1): "+t],e)))}function xr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Rr(t){t="FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw Cr(t),new Error(t)}function Lr(t){t||Rr()}var Or=(Pr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Pr);function Pr(){}function Mr(t,e){return t<e?-1:e<t?1:0}function Fr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function qr(t){return t+"\0"}function Vr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Ur(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Br(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function jr(t){return null==t}function Gr(t){return 0===t&&1/t==-1/0}function Kr(t){return"number"==typeof t&&Number.isInteger(t)&&!Gr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var zr,Qr,Hr,Wr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Yr=(o(si,Hr=Error),si),Ie=(Object.defineProperty(oi.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),oi.prototype.isEqual=function(t){return 0===oi.comparator(this,t)},oi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof oi?t.forEach((function(t){e.push(t)})):e.push(t),this.construct(e)},oi.prototype.limit=function(){return this.offset+this.length},oi.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},oi.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},oi.prototype.firstSegment=function(){return this.segments[this.offset]},oi.prototype.lastSegment=function(){return this.get(this.length-1)},oi.prototype.get=function(t){return this.segments[this.offset+t]},oi.prototype.isEmpty=function(){return 0===this.length},oi.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},oi.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},oi.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},oi),Xr=(o(ii,Qr=Ie),ii.prototype.construct=function(t,e,n){return new ii(t,e,n)},ii.prototype.canonicalString=function(){return this.toArray().join("/")},ii.prototype.toString=function(){return this.canonicalString()},ii.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter((function(t){return 0<t.length})))}return new ii(n)},ii.emptyPath=function(){return new ii([])},ii),Jr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,$r=(o(ri,zr=Ie),ri.prototype.construct=function(t,e,n){return new ri(t,e,n)},ri.isValidIdentifier=function(t){return Jr.test(t)},ri.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!ri.isValidIdentifier(t)?"`"+t+"`":t})).join(".")},ri.prototype.toString=function(){return this.canonicalString()},ri.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},ri.keyField=function(){return new ri(["__name__"])},ri.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Yr(Wr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Yr(Wr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Yr(Wr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ri(e)},ri.emptyPath=function(){return new ri([])},ri),Zr=(ni.fromPath=function(t){return new ni(Xr.fromString(t))},ni.fromName=function(t){return new ni(Xr.fromString(t).popFirst(5))},ni.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ni.prototype.isEqual=function(t){return null!==t&&0===Xr.comparator(this.path,t.path)},ni.prototype.toString=function(){return this.path.toString()},ni.comparator=function(t,e){return Xr.comparator(t.path,e.path)},ni.isDocumentKey=function(t){return t.length%2==0},ni.fromSegments=function(t){return new ni(new Xr(t.slice()))},ni),ti=(ei.fromBase64String=function(t){return new ei(atob(t))},ei.fromUint8Array=function(t){return new ei(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ei.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},ei.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},ei.prototype.approximateByteSize=function(){return 2*this.binaryString.length},ei.prototype.compareTo=function(t){return Mr(this.binaryString,t.binaryString)},ei.prototype.isEqual=function(t){return this.binaryString===t.binaryString},ei);function ei(t){this.binaryString=t}function ni(t){this.path=t}function ri(){return null!==zr&&zr.apply(this,arguments)||this}function ii(){return null!==Qr&&Qr.apply(this,arguments)||this}function oi(t,e,n){void 0===e?e=0:e>t.length&&Rr(),void 0===n?n=t.length-e:n>t.length-e&&Rr(),this.segments=t,this.offset=e,this.len=n}function si(t,e){var n=this;return(n=Hr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}ti.EMPTY_BYTE_STRING=new ti("");var ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ui(t){if(Lr(!!t),"string"!=typeof t)return{seconds:ci(t.seconds),nanos:ci(t.nanos)};var e=0,n=ai.exec(t);Lr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function ci(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function hi(t){return"string"==typeof t?ti.fromBase64String(t):ti.fromUint8Array(t)}var li=(fi.now=function(){return fi.fromMillis(Date.now())},fi.fromDate=function(t){return fi.fromMillis(t.getTime())},fi.fromMillis=function(t){var e=Math.floor(t/1e3);return new fi(e,1e6*(t-1e3*e))},fi.prototype.toDate=function(){return new Date(this.toMillis())},fi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},fi.prototype._compareTo=function(t){return this.seconds===t.seconds?Mr(this.nanoseconds,t.nanoseconds):Mr(this.seconds,t.seconds)},fi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},fi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},fi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},fi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},fi);function fi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Yr(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Yr(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Yr(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Yr(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function di(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function pi(t){t=ui(t.mapValue.fields.__local_write_time__.timestampValue);return new li(t.seconds,t.nanos)}function yi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?di(t)?4:10:Rr()}function gi(t,e){var n,r,i=yi(t);if(i!==yi(e))return!1;switch(i){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return pi(t).isEqual(pi(e));case 3:return function(e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ui(t.timestampValue),e=ui(e.timestampValue);return n.seconds===e.seconds&&n.nanos===e.nanos}(e);case 5:return t.stringValue===e.stringValue;case 6:return r=e,hi(t.bytesValue).isEqual(hi(r.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return n=e,ci((r=t).geoPointValue.latitude)===ci(n.geoPointValue.latitude)&&ci(r.geoPointValue.longitude)===ci(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ci(t.integerValue)===ci(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=ci(t.doubleValue),e=ci(e.doubleValue);return t===e?Gr(t)===Gr(e):isNaN(t)&&isNaN(e)}return!1}(t,e);case 9:return Fr(t.arrayValue.values||[],e.arrayValue.values||[],gi);case 10:return function(){var n,r=t.mapValue.fields||{},i=e.mapValue.fields||{};if(Vr(r)!==Vr(i))return!1;for(n in r)if(r.hasOwnProperty(n)&&(void 0===i[n]||!gi(r[n],i[n])))return!1;return!0}();default:return Rr()}}function vi(t,e){return void 0!==(t.values||[]).find((function(t){return gi(t,e)}))}function mi(t,e){var n,r,i,o=yi(t),s=yi(e);if(o!==s)return Mr(o,s);switch(o){case 0:return 0;case 1:return Mr(t.booleanValue,e.booleanValue);case 2:return r=e,i=ci(t.integerValue||t.doubleValue),r=ci(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return bi(t.timestampValue,e.timestampValue);case 4:return bi(pi(t),pi(e));case 5:return Mr(t.stringValue,e.stringValue);case 6:return function(t,e){t=hi(t),e=hi(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Mr(n[i],r[i]);if(0!==o)return o}return Mr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=Mr(ci(n.latitude),ci(i.latitude)))?r:Mr(ci(n.longitude),ci(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=mi(n[i],r[i]);if(o)return o}return Mr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Mr(r[s],o[s]);if(0!==a)return a;a=mi(n[r[s]],i[o[s]]);if(0!==a)return a}return Mr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Rr()}}function bi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Mr(t,e);var n=ui(t),t=ui(e),e=Mr(n.seconds,t.seconds);return 0!==e?e:Mr(n.nanos,t.nanos)}function wi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var t=ui(t);return"time("+t.seconds+","+t.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?hi(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Zr.fromName(n).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Rr();var n}(t)}function Ei(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ti(t){return t&&"integerValue"in t}function Ii(t){return!!t&&"arrayValue"in t}function _i(t){return t&&"nullValue"in t}function Si(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Di(t){return t&&"mapValue"in t}var Ai,Ni,Ci,d=function(t,e){this.key=t,this.version=e},ki=(o(Mi,Ci=d),Mi.prototype.field=function(t){return this.objectValue.field(t)},Mi.prototype.data=function(){return this.objectValue},Mi.prototype.toProto=function(){return this.objectValue.proto},Mi.prototype.isEqual=function(t){return t instanceof Mi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.objectValue.isEqual(t.objectValue)},Mi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Mi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Mi),xi=(o(Pi,Ni=d),Pi.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Pi.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Pi.prototype.isEqual=function(t){return t instanceof Pi&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Pi),Ri=(o(Oi,Ai=d),Oi.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Oi.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Oi.prototype.isEqual=function(t){return t instanceof Oi&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Oi),Li=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Oi(){return null!==Ai&&Ai.apply(this,arguments)||this}function Pi(t,e,n){var r=this;return(r=Ni.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Mi(t,e,n,r){var i=this;return(i=Ci.call(this,t,e)||this).objectValue=n,i.hasLocalMutations=!!r.hasLocalMutations,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Fi(t,e,n,r,i,o,s){return new Li(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function qi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((function(t){return(t=t).field.canonicalString()+t.op.toString()+wi(t.value)})).join(","),t+="|ob:",t+=e.orderBy.map((function(t){return(t=t).field.canonicalString()+t.dir})).join(","),jr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=po(e.startAt)),e.endAt&&(t+="|ub:",t+=po(e.endAt)),e.h=t),e.h}function Vi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!gi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!vo(t.startAt,e.startAt)&&vo(t.endAt,e.endAt)}function Ui(t){return Zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Bi,ji=(o(Gi,Bi=function(){}),Gi.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Hi(t,e,n):"array-contains"===e?new io(t,n):"in"===e?new oo(t,n):"not-in"===e?new so(t,n):"array-contains-any"===e?new ao(t,n):new Gi(t,e,n)},Gi.l=function(t,e,n){return new("in"===e?Wi:Yi)(t,n)},Gi.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this.m(mi(t,this.value)):null!==t&&yi(this.value)===yi(t)&&this.m(mi(t,this.value))},Gi.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Rr()}},Gi.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},Gi);function Gi(t,e,n){var r=this;return(r=Bi.call(this)||this).field=t,r.op=e,r.value=n,r}var Ki,zi,Qi,Hi=(o($i,Qi=ji),$i.prototype.matches=function(t){t=Zr.comparator(t.key,this.key);return this.m(t)},$i),Wi=(o(Ji,zi=ji),Ji.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},Ji),Yi=(o(Xi,Ki=ji),Xi.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},Xi);function Xi(t,e){var n=this;return(n=Ki.call(this,t,"not-in",e)||this).keys=Zi(0,e),n}function Ji(t,e){var n=this;return(n=zi.call(this,t,"in",e)||this).keys=Zi(0,e),n}function $i(t,e,n){var r=this;return(r=Qi.call(this,t,e,n)||this).key=Zr.fromName(n.referenceValue),r}function Zi(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map((function(t){return Zr.fromName(t.referenceValue)}))}var to,eo,no,ro,io=(o(fo,ro=ji),fo.prototype.matches=function(t){t=t.field(this.field);return Ii(t)&&vi(t.arrayValue,this.value)},fo),oo=(o(lo,no=ji),lo.prototype.matches=function(t){t=t.field(this.field);return null!==t&&vi(this.value.arrayValue,t)},lo),so=(o(ho,eo=ji),ho.prototype.matches=function(t){if(vi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!vi(this.value.arrayValue,t)},ho),ao=(o(co,to=ji),co.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!Ii(t)||!t.arrayValue.values)&&t.arrayValue.values.some((function(t){return vi(e.value.arrayValue,t)}))},co),uo=function(t,e){this.position=t,this.before=e};function co(t,e){return to.call(this,t,"array-contains-any",e)||this}function ho(t,e){return eo.call(this,t,"not-in",e)||this}function lo(t,e){return no.call(this,t,"in",e)||this}function fo(t,e){return ro.call(this,t,"array-contains",e)||this}function po(t){return(t.before?"b":"a")+":"+t.position.map(wi).join(",")}var yo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function go(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?Zr.comparator(Zr.fromName(s.referenceValue),n.key):mi(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function vo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!gi(t.position[n],e.position[n]))return!1;return!0}var mo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function bo(t,e,n,r,i,o,s,a){return new mo(t,e,n,r,i,o,s,a)}function wo(t){return new mo(t)}function Eo(t){return!jr(t.limit)&&"F"===t.limitType}function To(t){return!jr(t.limit)&&"L"===t.limitType}function Io(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function _o(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function So(t){return null!==t.collectionGroup}function Do(t){var e=t;if(null===e.p){e.p=[];var n=_o(e),t=Io(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new yo(n)),e.p.push(new yo($r.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new yo($r.keyField(),n)))}}return e.p}function Ao(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Fi(e.path,e.collectionGroup,Do(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Do(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new yo(o.field,s))}var a=e.endAt?new uo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new uo(e.startAt.position,!e.startAt.before):null;e.T=Fi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function No(t,e,n){return new mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Co(t,e){return Vi(Ao(t),Ao(e))&&t.limitType===e.limitType}function ko(t){return qi(Ao(t))+"|lt:"+t.limitType}function xo(t){return"Query(target="+(e=Ao(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map((function(t){return(t=t).field.canonicalString()+" "+t.op+" "+wi(t.value)})).join(", ")+"]"),jr(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+po(e.startAt)),e.endAt&&(n+=", endAt: "+po(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function Ro(t,e){return n=t,r=e.key.path,(null!==n.collectionGroup?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):Zr.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r))&&function(e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.field(i.field))return}return 1}(e)&&function(e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return;return 1}(e)&&(r=e,(!(e=t).startAt||go(e.startAt,Do(e),r))&&(!e.endAt||!go(e.endAt,Do(e),r)));var n,r}function Lo(t){return function(e,n){for(var r=!1,i=0,o=Do(t);i<o.length;i++){var s=o[i],a=function(t,e,n){var r=t.field.isKeyField()?Zr.comparator(e.key,n.key):function(t,n){var r=e.field(t),t=n.field(t);return null!==r&&null!==t?mi(r,t):Rr()}(t.field,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Rr()}}(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}var Oo=(Bo.fromTimestamp=function(t){return new Bo(t)},Bo.min=function(){return new Bo(new li(0,0))},Bo.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Bo.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Bo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Bo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Bo.prototype.toTimestamp=function(){return this.timestamp},Bo),Po=(Uo.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},Uo.prototype.isEqual=function(t){return Fr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},Uo),Mo=(Vo.empty=function(){return new Vo({mapValue:{}})},Vo.prototype.field=function(t){if(t.isEmpty())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Di(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},Vo.prototype.isEqual=function(t){return gi(this.proto,t.proto)},Vo),Fo=(qo.prototype.set=function(t,e){return this.R(t,e),this},qo.prototype.delete=function(t){return this.R(t,null),this},qo.prototype.R=function(t,e){for(var n=this.A,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===yi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.lastSegment(),e)},qo.prototype.v=function(){var t=this.P($r.emptyPath(),this.A);return null!=t?new Mo(t):this.I},qo.prototype.P=function(t,e){var n=this,r=!1,i=this.I.field(t),o=Di(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){var s;e instanceof Map?null!=(s=n.P(t.child(i),e))&&(o[i]=s,r=!0):null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},qo);function qo(t){void 0===t&&(t=Mo.empty()),this.I=t,this.A=new Map}function Vo(t){this.proto=t}function Uo(t){(this.fields=t).sort($r.comparator)}function Bo(t){this.timestamp=t}function jo(t,e){if(t.V){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gr(e)?"-0":e}}function Go(t){return{integerValue:""+t}}function Ko(t,e){return Kr(e)?Go(e):jo(t,e)}Ie=function(){this._=void 0};function zo(t,e){return t instanceof is?Ti(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Qo,Ho,Wo=(o(Jo,Ho=Ie),Jo),Yo=(o(Xo,Qo=Ie),Xo);function Xo(t){var e=this;return(e=Qo.call(this)||this).elements=t,e}function Jo(){return null!==Ho&&Ho.apply(this,arguments)||this}function $o(t,e){for(var n=as(e),r=0,i=t.elements;r<i.length;r++)!function(t){n.some((function(e){return gi(e,t)}))||n.push(t)}(i[r]);return{arrayValue:{values:n}}}var Zo,ts=(o(es,Zo=Ie),es);function es(t){var e=this;return(e=Zo.call(this)||this).elements=t,e}function ns(t,e){for(var n=as(e),r=0,i=t.elements;r<i.length;r++)!function(t){n=n.filter((function(e){return!gi(e,t)}))}(i[r]);return{arrayValue:{values:n}}}var rs,is=(o(os,rs=Ie),os);function os(t,e){var n=this;return(n=rs.call(this)||this).D=t,n.S=e,n}function ss(t){return ci(t.integerValue||t.doubleValue)}function as(t){return Ii(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function us(t,e){this.version=t,this.transformResults=e}var cs=function(t,e){this.field=t,this.transform=e},hs=(ls.none=function(){return new ls},ls.exists=function(t){return new ls(void 0,t)},ls.updateTime=function(t){return new ls(t)},Object.defineProperty(ls.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),ls.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},ls);function ls(t,e){this.updateTime=t,this.exists=e}function fs(t,e){return void 0!==t.updateTime?e instanceof ki&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ki}d=function(){};function ds(t,e,n){return t instanceof ms?function(t,e,n){if(!fs(t.precondition,e))return e;var r=t.value,n=_s(t.fieldTransforms,n,e),r=Ss(t.fieldTransforms,r,n),e=ys(e);return new ki(t.key,e,r,{hasLocalMutations:!0})}(t,e,n):t instanceof bs?function(t,e,n){if(!fs(t.precondition,e))return e;var r=ys(e),e=Ts(t,e,_s(t.fieldTransforms,n,e));return new ki(t.key,r,e,{hasLocalMutations:!0})}(t,e,n):(e=e,fs((t=t).precondition,e)?new xi(t.key,Oo.min()):e)}function ps(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Fr(n,r,(function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Yo&&e instanceof Yo||t instanceof ts&&e instanceof ts?Fr(t.elements,e.elements,gi):t instanceof is&&e instanceof is?gi(t.S,e.S):t instanceof Wo&&e instanceof Wo)}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function ys(t){return t instanceof ki?t.version:Oo.min()}var gs,vs,ms=(o(Es,vs=d),Es),bs=(o(ws,gs=d),ws);function ws(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=gs.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function Es(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=vs.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function Ts(t,e,n){var r,i,o;return i=t,e=r=e instanceof ki?e.data():Mo.empty(),o=new Fo(e),i.fieldMask.fields.forEach((function(t){var e;t.isEmpty()||(null!==(e=i.data.field(t))?o.set(t,e):o.delete(t))})),r=o.v(),Ss(t.fieldTransforms,r,n)}function Is(t,e,n){var r=[];Lr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof ki&&(a=e.field(o.field)),r.push((o=s,s=a,a=n[i],o instanceof Yo?$o(o,s):o instanceof ts?ns(o,s):a))}return r}function _s(t,e,n){for(var r,i=[],o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=null;n instanceof ki&&(c=n.field(a.field)),i.push((r=c,a=e,c=void 0,(u=u)instanceof Wo?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Yo?$o(u,r):u instanceof ts?ns(u,r):(u=zo(c=u,r),r=ss(u)+ss(c.S),Ti(u)&&Ti(c.S)?Go(r):jo(c.D,r))))}return i}function Ss(t,e,n){for(var r=new Fo(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.v()}function Ds(t){this.count=t}var As,Ns,Cs,ks=(o(Ls,Cs=d),Ls),xs=(o(Rs,Ns=d),Rs);function Rs(t,e){var n=this;return(n=Ns.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Ls(t,e){var n=this;return(n=Cs.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Os(t){switch(t){case Wr.OK:return Rr(),0;case Wr.CANCELLED:case Wr.UNKNOWN:case Wr.DEADLINE_EXCEEDED:case Wr.RESOURCE_EXHAUSTED:case Wr.INTERNAL:case Wr.UNAVAILABLE:case Wr.UNAUTHENTICATED:return;case Wr.INVALID_ARGUMENT:case Wr.NOT_FOUND:case Wr.ALREADY_EXISTS:case Wr.PERMISSION_DENIED:case Wr.FAILED_PRECONDITION:case Wr.ABORTED:case Wr.OUT_OF_RANGE:case Wr.UNIMPLEMENTED:case Wr.DATA_LOSS:return 1;default:return Rr(),0}}function Ps(t){if(void 0===t)return Cr("GRPC error has no .code"),Wr.UNKNOWN;switch(t){case As.OK:return Wr.OK;case As.CANCELLED:return Wr.CANCELLED;case As.UNKNOWN:return Wr.UNKNOWN;case As.DEADLINE_EXCEEDED:return Wr.DEADLINE_EXCEEDED;case As.RESOURCE_EXHAUSTED:return Wr.RESOURCE_EXHAUSTED;case As.INTERNAL:return Wr.INTERNAL;case As.UNAVAILABLE:return Wr.UNAVAILABLE;case As.UNAUTHENTICATED:return Wr.UNAUTHENTICATED;case As.INVALID_ARGUMENT:return Wr.INVALID_ARGUMENT;case As.NOT_FOUND:return Wr.NOT_FOUND;case As.ALREADY_EXISTS:return Wr.ALREADY_EXISTS;case As.PERMISSION_DENIED:return Wr.PERMISSION_DENIED;case As.FAILED_PRECONDITION:return Wr.FAILED_PRECONDITION;case As.ABORTED:return Wr.ABORTED;case As.OUT_OF_RANGE:return Wr.OUT_OF_RANGE;case As.UNIMPLEMENTED:return Wr.UNIMPLEMENTED;case As.DATA_LOSS:return Wr.DATA_LOSS;default:return Rr()}}(Ie=As=As||{})[Ie.OK=0]="OK",Ie[Ie.CANCELLED=1]="CANCELLED",Ie[Ie.UNKNOWN=2]="UNKNOWN",Ie[Ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ie[Ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ie[Ie.NOT_FOUND=5]="NOT_FOUND",Ie[Ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ie[Ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ie[Ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ie[Ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ie[Ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ie[Ie.ABORTED=10]="ABORTED",Ie[Ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ie[Ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ie[Ie.INTERNAL=13]="INTERNAL",Ie[Ie.UNAVAILABLE=14]="UNAVAILABLE",Ie[Ie.DATA_LOSS=15]="DATA_LOSS";var Ms=(Bs.prototype.insert=function(t,e){return new Bs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,qs.BLACK,null,null))},Bs.prototype.remove=function(t){return new Bs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,qs.BLACK,null,null))},Bs.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Bs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Bs.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Bs.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Bs.prototype.minKey=function(){return this.root.minKey()},Bs.prototype.maxKey=function(){return this.root.maxKey()},Bs.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Bs.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},Bs.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},Bs.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Bs.prototype.getIterator=function(){return new Fs(this.root,null,this.comparator,!1)},Bs.prototype.getIteratorFrom=function(t){return new Fs(this.root,t,this.comparator,!1)},Bs.prototype.getReverseIterator=function(){return new Fs(this.root,null,this.comparator,!0)},Bs.prototype.getReverseIteratorFrom=function(t){return new Fs(this.root,t,this.comparator,!0)},Bs),Fs=(Us.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Us.prototype.hasNext=function(){return 0<this.nodeStack.length},Us.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Us),qs=(Vs.prototype.copy=function(t,e,n,r,i){return new Vs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Vs.prototype.isEmpty=function(){return!1},Vs.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Vs.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Vs.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Vs.prototype.minKey=function(){return this.min().key},Vs.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Vs.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},Vs.prototype.removeMin=function(){if(this.left.isEmpty())return Vs.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},Vs.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return Vs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},Vs.prototype.isRed=function(){return this.color},Vs.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},Vs.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},Vs.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},Vs.prototype.rotateLeft=function(){var t=this.copy(null,null,Vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Vs.prototype.rotateRight=function(){var t=this.copy(null,null,Vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Vs.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Vs.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},Vs.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Rr();if(this.right.isRed())throw Rr();var t=this.left.check();if(t!==this.right.check())throw Rr();return t+(this.isRed()?0:1)},Vs);function Vs(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Vs.RED,this.left=null!=r?r:Vs.EMPTY,this.right=null!=i?i:Vs.EMPTY,this.size=this.left.size+1+this.right.size}function Us(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Bs(t,e){this.comparator=t,this.root=e||qs.EMPTY}function js(){this.size=0}qs.EMPTY=null,qs.RED=!0,qs.BLACK=!1,qs.EMPTY=(Object.defineProperty(js.prototype,"key",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(js.prototype,"value",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(js.prototype,"color",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(js.prototype,"left",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),Object.defineProperty(js.prototype,"right",{get:function(){throw Rr()},enumerable:!1,configurable:!0}),js.prototype.copy=function(t,e,n,r,i){return this},js.prototype.insert=function(t,e,n){return new qs(t,e)},js.prototype.remove=function(t,e){return this},js.prototype.isEmpty=function(){return!0},js.prototype.inorderTraversal=function(t){return!1},js.prototype.reverseTraversal=function(t){return!1},js.prototype.minKey=function(){return null},js.prototype.maxKey=function(){return null},js.prototype.isRed=function(){return!1},js.prototype.checkMaxDepth=function(){return!0},js.prototype.check=function(){return 0},new js);var Gs=(Hs.prototype.has=function(t){return null!==this.data.get(t)},Hs.prototype.first=function(){return this.data.minKey()},Hs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Hs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Hs.prototype.indexOf=function(t){return this.data.indexOf(t)},Hs.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},Hs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Hs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Hs.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Hs.prototype.getIterator=function(){return new Ks(this.data.getIterator())},Hs.prototype.getIteratorFrom=function(t){return new Ks(this.data.getIteratorFrom(t))},Hs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Hs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Hs.prototype.isEmpty=function(){return this.data.isEmpty()},Hs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},Hs.prototype.isEqual=function(t){if(!(t instanceof Hs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Hs.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},Hs.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},Hs.prototype.copy=function(t){var e=new Hs(this.comparator);return e.data=t,e},Hs),Ks=(Qs.prototype.getNext=function(){return this.iter.getNext().key},Qs.prototype.hasNext=function(){return this.iter.hasNext()},Qs),zs=new Ms(Zr.comparator);function Qs(t){this.iter=t}function Hs(t){this.comparator=t,this.data=new Ms(this.comparator)}var Ws=new Ms(Zr.comparator);var Ys=new Ms(Zr.comparator);var Xs=new Gs(Zr.comparator);function Js(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Xs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var $s=new Gs(Mr);var Zs=(ca.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,ta.createSynthesizedTargetChangeForCurrentChange(t,e)),new ca(Oo.min(),n,$s,zs,Js())},ca),ta=(ua.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new ua(ti.EMPTY_BYTE_STRING,e,Js(),Js(),Js())},ua),ea=function(t,e,n,r){this.C=t,this.removedTargetIds=e,this.key=n,this.N=r},na=function(t,e){this.targetId=t,this.$=e},ra=function(t,e,n,r){void 0===n&&(n=ti.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ia=(Object.defineProperty(aa.prototype,"current",{get:function(){return this.M},enumerable:!1,configurable:!0}),Object.defineProperty(aa.prototype,"resumeToken",{get:function(){return this.k},enumerable:!1,configurable:!0}),Object.defineProperty(aa.prototype,"B",{get:function(){return 0!==this.F},enumerable:!1,configurable:!0}),Object.defineProperty(aa.prototype,"q",{get:function(){return this.L},enumerable:!1,configurable:!0}),aa.prototype.U=function(t){0<t.approximateByteSize()&&(this.L=!0,this.k=t)},aa.prototype.K=function(){var t=Js(),e=Js(),n=Js();return this.O.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Rr()}})),new ta(this.k,this.M,t,e,n)},aa.prototype.W=function(){this.L=!1,this.O=la()},aa.prototype.j=function(t,e){this.L=!0,this.O=this.O.insert(t,e)},aa.prototype.G=function(t){this.L=!0,this.O=this.O.remove(t)},aa.prototype.H=function(){this.F+=1},aa.prototype.J=function(){--this.F},aa.prototype.Y=function(){this.L=!0,this.M=!0},aa),oa=(sa.prototype.st=function(t){for(var e=0,n=t.C;e<n.length;e++){var r=n[e];t.N instanceof ki?this.it(r,t.N):t.N instanceof xi&&this.rt(r,t.key,t.N)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.rt(r,t.key,t.N)},sa.prototype.ot=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ct(n);switch(t.state){case 0:e.at(n)&&r.U(t.resumeToken);break;case 1:r.J(),r.B||r.W(),r.U(t.resumeToken);break;case 2:r.J(),r.B||e.removeTarget(n);break;case 3:e.at(n)&&(r.Y(),r.U(t.resumeToken));break;case 4:e.at(n)&&(e.ut(n),r.U(t.resumeToken));break;default:Rr()}}))},sa.prototype.forEachTarget=function(t,e){var n=this;0<t.targetIds.length?t.targetIds.forEach(e):this.Z.forEach((function(t,r){n.at(r)&&e(r)}))},sa.prototype.ht=function(t){var e=t.targetId,n=t.$.count,t=this.lt(e);t&&(Ui(t=t.target)?0===n?(t=new Zr(t.path),this.rt(e,t,new xi(t,Oo.min()))):Lr(1===n):this.ft(e)!==n&&(this.ut(e),this.nt=this.nt.add(e)))},sa.prototype.dt=function(t){var e=this,n=new Map;this.Z.forEach((function(r,i){var o=e.lt(i);o&&(r.current&&Ui(o.target)&&(o=new Zr(o.target.path),null!==e.tt.get(o)||e.wt(i,o)||e.rt(i,o,new xi(o,t))),r.q&&(n.set(i,r.K()),r.W()))}));var r=Js();this.et.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){t=e.lt(t);return!t||2===t.purpose||(i=!1)})),i&&(r=r.add(t))}));var i=new Zs(t,n,this.nt,this.tt,r);return this.tt=zs,this.et=ha(),this.nt=new Gs(Mr),i},sa.prototype.it=function(t,e){var n;this.at(t)&&(n=this.wt(t,e.key)?2:0,this.ct(t).j(e.key,n),this.tt=this.tt.insert(e.key,e),this.et=this.et.insert(e.key,this._t(e.key).add(t)))},sa.prototype.rt=function(t,e,n){var r;this.at(t)&&(r=this.ct(t),this.wt(t,e)?r.j(e,1):r.G(e),this.et=this.et.insert(e,this._t(e).delete(t)),n&&(this.tt=this.tt.insert(e,n)))},sa.prototype.removeTarget=function(t){this.Z.delete(t)},sa.prototype.ft=function(t){var e=this.ct(t).K();return this.X.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},sa.prototype.H=function(t){this.ct(t).H()},sa.prototype.ct=function(t){var e=this.Z.get(t);return e||(e=new ia,this.Z.set(t,e)),e},sa.prototype._t=function(t){var e=this.et.get(t);return e||(e=new Gs(Mr),this.et=this.et.insert(t,e)),e},sa.prototype.at=function(t){var e=null!==this.lt(t);return e||Nr("WatchChangeAggregator","Detected inactive target",t),e},sa.prototype.lt=function(t){var e=this.Z.get(t);return e&&e.B?null:this.X.yt(t)},sa.prototype.ut=function(t){var e=this;this.Z.set(t,new ia),this.X.getRemoteKeysForTarget(t).forEach((function(n){e.rt(t,n,null)}))},sa.prototype.wt=function(t,e){return this.X.getRemoteKeysForTarget(t).has(e)},sa);function sa(t){this.X=t,this.Z=new Map,this.tt=zs,this.et=ha(),this.nt=new Gs(Mr)}function aa(){this.F=0,this.O=la(),this.k=ti.EMPTY_BYTE_STRING,this.M=!1,this.L=!0}function ua(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function ca(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function ha(){return new Ms(Zr.comparator)}function la(){return new Ms(Zr.comparator)}var fa={asc:"ASCENDING",desc:"DESCENDING"},da={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pa=function(t,e){this.databaseId=t,this.V=e};function ya(t,e){return t.V?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ga(t,e){return t.V?e.toBase64():e.toUint8Array()}function va(t){return Lr(!!t),Oo.fromTimestamp((t=ui(t),new li(t.seconds,t.nanos)))}function ma(t,e){return new Xr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function ba(t){t=Xr.fromString(t);return Lr(Va(t)),t}function wa(t,e){return ma(t.databaseId,e.path)}function Ea(t,e){e=ba(e);if(e.get(1)!==t.databaseId.projectId)throw new Yr(Wr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Yr(Wr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Zr(Sa(e))}function Ta(t,e){return ma(t.databaseId,e)}function Ia(t){t=ba(t);return 4===t.length?Xr.emptyPath():Sa(t)}function _a(t){return new Xr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Sa(t){return Lr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function Da(t,e,n){return{name:wa(t,e),fields:n.proto.mapValue.fields}}function Aa(t,e,n){var r=Ea(t,e.name),t=va(e.updateTime),e=new Mo({mapValue:{fields:e.fields}});return new ki(r,t,e,{hasCommittedMutations:!!n})}function Na(t,e){var n,r,i;if(e instanceof ms)n={update:Da(t,e.key,e.value)};else if(e instanceof ks)n={delete:wa(t,e.key)};else if(e instanceof bs)n={update:Da(t,e.key,e.data),updateMask:(i=e.fieldMask,r=[],i.fields.forEach((function(t){return r.push(t.canonicalString())})),{fieldPaths:r})};else{if(!(e instanceof xs))return Rr();n={verify:wa(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map((function(t){var e=t.transform;if(e instanceof Wo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Yo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof ts)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof is)return{fieldPath:t.field.canonicalString(),increment:e.S};throw Rr()}))),e.precondition.isNone||(n.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:(e=t,t=i.updateTime,ya(e,t.toTimestamp()))}:void 0!==i.exists?{exists:i.exists}:Rr()),n}function Ca(t,e){var n=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?hs.updateTime(va(s.updateTime)):void 0!==s.exists?hs.exists(s.exists):hs.none():hs.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n,r=null;"setToServerValue"in e?(Lr("REQUEST_TIME"===e.setToServerValue),r=new Wo):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new Yo(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new ts(n)):"increment"in e?r=new is(t,e.increment):Rr();e=$r.fromServerFormat(e.fieldPath);return new cs(e,r)}(t,e)})):[];if(e.update){e.update.name;var i=Ea(t,e.update.name),o=new Mo({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=(s=e.updateMask.fieldPaths||[],new Po(s.map((function(t){return $r.fromServerFormat(t)}))));return new bs(i,o,s,n,r)}return new ms(i,o,n,r)}if(e.delete){r=Ea(t,e.delete);return new ks(r,n)}if(e.verify){e=Ea(t,e.verify);return new xs(e,n)}return Rr()}function ka(t,e){return{documents:[Ta(t,e.path)]}}function xa(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ta(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ta(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map((function(t){if("=="===t.op){if(Si(t.value))return{unaryFilter:{field:Pa(t.field),op:"IS_NAN"}};if(_i(t.value))return{unaryFilter:{field:Pa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Si(t.value))return{unaryFilter:{field:Pa(t.field),op:"IS_NOT_NAN"}};if(_i(t.value))return{unaryFilter:{field:Pa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Pa(t.field),op:(e=t.op,da[e]),value:t.value}};var e}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map((function(t){return{field:Pa((t=t).field),direction:(t=t.dir,fa[t])}}))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.V||jr(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=La(e.startAt)),e.endAt&&(n.structuredQuery.endAt=La(e.endAt)),n}function Ra(t){var e=Ia(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Lr(1===r),(a=n.from[0]).allDescendants?i=a.collectionId:e=e.child(a.collectionId));var o=[];n.where&&(o=function t(e){return e?void 0!==e.unaryFilter?[qa(e)]:void 0!==e.fieldFilter?[Fa(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Rr():[]}(n.where));var s=[],t=null,r=null,a=null;return bo(e,i,s=n.orderBy?n.orderBy.map((function(t){return new yo(Ma((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})):s,o,t=n.limit?jr(o="object"==typeof(o=n.limit)?o.value:o)?null:o:t,"F",r=n.startAt?Oa(n.startAt):r,a=n.endAt?Oa(n.endAt):a)}function La(t){return{before:t.before,values:t.position}}function Oa(t){var e=!!t.before,t=t.values||[];return new uo(t,e)}function Pa(t){return{fieldPath:t.canonicalString()}}function Ma(t){return $r.fromServerFormat(t.fieldPath)}function Fa(t){return ji.create(Ma(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Rr()}}(),t.fieldFilter.value)}function qa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ma(t.unaryFilter.field);return ji.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Ma(t.unaryFilter.field);return ji.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Ma(t.unaryFilter.field);return ji.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Ma(t.unaryFilter.field);return ji.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Rr()}}function Va(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ua(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ba(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return Ba(e)}function Ba(t){return t+""}function ja(t){var e=t.length;if(Lr(2<=e),2===e)return Lr(""===t.charAt(0)&&""===t.charAt(1)),Xr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Rr(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Rr()}o=s+2}return new Xr(r)}function Ga(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Ka=function(t,e){this.seconds=t,this.nanoseconds=e};Ga.store="owner",Ga.key="owner";function za(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}za.store="mutationQueues",za.keyPath="userId";function Qa(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}Qa.store="mutations",Qa.keyPath="batchId",Qa.userMutationsIndex="userMutationsIndex",Qa.userMutationsKeyPath=["userId","batchId"];var Ha=(Wa.prefixForUser=function(t){return[t]},Wa.prefixForPath=function(t,e){return[t,Ua(e)]},Wa.key=function(t,e,n){return[t,Ua(e),n]},Wa);function Wa(){}Ha.store="documentMutations",Ha.PLACEHOLDER=new Ha;function Ya(t,e){this.path=t,this.readTime=e}function Xa(t,e){this.path=t,this.version=e}var Ja=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ja.store="remoteDocuments",Ja.readTimeIndex="readTimeIndex",Ja.readTimeIndexPath="readTime",Ja.collectionReadTimeIndex="collectionReadTimeIndex",Ja.collectionReadTimeIndexPath=["parentPath","readTime"];function $a(t){this.byteSize=t}$a.store="remoteDocumentGlobal",$a.key="remoteDocumentGlobalKey";function Za(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}Za.store="targets",Za.keyPath="targetId",Za.queryTargetsIndexName="queryTargetsIndex",Za.queryTargetsKeyPath=["canonicalId","targetId"];var tu=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};tu.store="targetDocuments",tu.keyPath=["targetId","path"],tu.documentTargetsIndex="documentTargetsIndex",tu.documentTargetsKeyPath=["path","targetId"];function eu(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}eu.key="targetGlobalKey",eu.store="targetGlobal";function nu(t,e){this.collectionId=t,this.parent=e}nu.store="collectionParents",nu.keyPath=["collectionId","parent"];function ru(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}ru.store="clientMetadata",ru.keyPath="clientId";function iu(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}iu.store="bundles",iu.keyPath="bundleId";function ou(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}ou.store="namedQueries",ou.keyPath="name";var su,au=u(u([],u(u([],u(u([],u(u([],[za.store,Qa.store,Ha.store,Ja.store,Za.store,Ga.store,eu.store,tu.store]),[ru.store])),[$a.store])),[nu.store])),[iu.store,ou.store]),uu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",d=(wu.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},wu.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},wu),cu=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},hu=(bu.prototype.catch=function(t){return this.next(void 0,t)},bu.prototype.next=function(t,e){var n=this;return this.callbackAttached&&Rr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new bu((function(r,i){n.nextCallback=function(e){n.wrapSuccess(t,e).next(r,i)},n.catchCallback=function(t){n.wrapFailure(e,t).next(r,i)}}))},bu.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},bu.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof bu?e:bu.resolve(e)}catch(t){return bu.reject(t)}},bu.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):bu.resolve(e)},bu.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction((function(){return t(e)})):bu.reject(e)},bu.resolve=function(t){return new bu((function(e,n){e(t)}))},bu.reject=function(t){return new bu((function(e,n){n(t)}))},bu.waitFor=function(t){return new bu((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},bu.or=function(t){for(var e=bu.resolve(!1),n=0,r=t;n<r.length;n++)!function(t){e=e.next((function(e){return e?bu.resolve(e):t()}))}(r[n]);return e},bu.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},bu),lu=(mu.open=function(t,e,n,r){try{return new mu(e,t.transaction(r,n))}catch(t){throw new pu(e,t)}},Object.defineProperty(mu.prototype,"Et",{get:function(){return this.gt.promise},enumerable:!1,configurable:!0}),mu.prototype.abort=function(t){t&&this.gt.reject(t),this.aborted||(Nr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},mu.prototype.store=function(t){t=this.transaction.objectStore(t);return new Tu(t)},mu),fu=(vu.delete=function(t){return Nr("SimpleDb","Removing database:",t),_u(window.indexedDB.deleteDatabase(t)).toPromise()},vu.At=function(){if("undefined"==typeof indexedDB)return!1;if(vu.Rt())return!0;var t=y(),e=vu.It(t),n=0<e&&e<10,e=vu.bt(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},vu.Rt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.vt)},vu.Pt=function(t,e){return t.store(e)},vu.It=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},vu.bt=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},vu.prototype.Vt=function(t){return s(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(Nr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){t=t.target.result;e(t)},i.onblocked=function(){r(new pu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){e=e.target.error;"VersionError"===e.name?r(new Yr(Wr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new pu(t,e))},i.onupgradeneeded=function(t){Nr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Tt.St(e,i.transaction,t.oldVersion,n.version).next((function(){Nr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Dt&&(this.db.onversionchange=function(t){return n.Dt(t)}),this.db)]}}))}))},vu.prototype.Ct=function(t){this.Dt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},vu.prototype.runTransaction=function(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s,u;return a(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,u=function(){var e,u,c;return a(this,(function(a){switch(a.label){case 0:++o,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,s.Vt(t)];case 2:return s.db=a.sent(),e=lu.open(s.db,t,i?"readonly":"readwrite",n),u=r(e).catch((function(t){return e.abort(t),hu.reject(t)})).toPromise(),c={},u.catch((function(){})),[4,e.Et];case 3:return[2,(c.value=(a.sent(),u),c)];case 4:return u=a.sent(),c="FirebaseError"!==u.name&&o<3,Nr("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),s.close(),c?[3,5]:[2,{value:Promise.reject(u)}];case 5:return[2]}}))},s=this,c.label=1;case 1:return[5,u()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},vu.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},vu),du=(Object.defineProperty(gu.prototype,"isDone",{get:function(){return this.Nt},enumerable:!1,configurable:!0}),Object.defineProperty(gu.prototype,"Ft",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(gu.prototype,"cursor",{set:function(t){this.xt=t},enumerable:!1,configurable:!0}),gu.prototype.done=function(){this.Nt=!0},gu.prototype.Ot=function(t){this.$t=t},gu.prototype.delete=function(){return _u(this.xt.delete())},gu),pu=(o(yu,su=Yr),yu);function yu(t,e){var n=this;return(n=su.call(this,Wr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function gu(t){this.xt=t,this.Nt=!1,this.$t=null}function vu(t,e,n){this.name=t,this.version=e,this.Tt=n,12.2===vu.It(y())&&Cr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function mu(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.gt=new cu,this.transaction.oncomplete=function(){n.gt.resolve()},this.transaction.onabort=function(){e.error?n.gt.reject(new pu(t,e.error)):n.gt.resolve()},this.transaction.onerror=function(e){e=Du(e.target.error);n.gt.reject(new pu(t,e))}}function bu(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}function wu(){this.onCommittedListeners=[]}function Eu(t){return"IndexedDbTransactionError"===t.name}var Tu=(Iu.prototype.put=function(t,e){t=void 0!==e?(Nr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Nr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return _u(t)},Iu.prototype.add=function(t){return Nr("SimpleDb","ADD",this.store.name,t,t),_u(this.store.add(t))},Iu.prototype.get=function(t){var e=this;return _u(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Nr("SimpleDb","GET",e.store.name,t,n),n}))},Iu.prototype.delete=function(t){return Nr("SimpleDb","DELETE",this.store.name,t),_u(this.store.delete(t))},Iu.prototype.count=function(){return Nr("SimpleDb","COUNT",this.store.name),_u(this.store.count())},Iu.prototype.kt=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.Mt(e,(function(t,e){n.push(e)})).next((function(){return n}))},Iu.prototype.Lt=function(t,e){Nr("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.Bt=!1;e=this.cursor(e);return this.Mt(e,(function(t,e,n){return n.delete()}))},Iu.prototype.qt=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.Mt(n,e)},Iu.prototype.Ut=function(t){var e=this.cursor({});return new hu((function(n,r){e.onerror=function(t){t=Du(t.target.error);r(t)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Iu.prototype.Mt=function(t,e){var n=[];return new hu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i,o=t.target.result;o?(i=new du(o),(t=e(o.primaryKey,o.value,i))instanceof hu&&(t=t.catch((function(t){return i.done(),hu.reject(t)})),n.push(t)),i.isDone?r():null===i.Ft?o.continue():o.continue(i.Ft)):r()}})).next((function(){return hu.waitFor(n)}))},Iu.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Iu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Bt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Iu);function Iu(t){this.store=t}function _u(t){return new hu((function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=Du(t.target.error);n(t)}}))}var Su=!1;function Du(t){var e=fu.It(y());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new Yr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Su||(Su=!0,setTimeout((function(){throw n}),0)),n}}return t}var Au,Nu=(o(Cu,Au=d),Cu);function Cu(t,e){var n=this;return(n=Au.call(this)||this).Qt=t,n.currentSequenceNumber=e,n}function ku(t,e){return fu.Pt(t.Qt,e)}var xu=(Fu.prototype.applyToRemoteDocument=function(t,e,n){for(var r,i,o,s,a,u,c=n.mutationResults,h=0;h<this.mutations.length;h++){var l=this.mutations[h];l.key.isEqual(t)&&(r=l,i=e,o=c[h],l=u=a=s=void 0,e=r instanceof ms?(a=o,u=(s=r).value,l=Is(s.fieldTransforms,i,a.transformResults),u=Ss(s.fieldTransforms,u,l),new ki(s.key,a.version,u,{hasCommittedMutations:!0})):r instanceof bs?function(t,e,n){if(!fs(t.precondition,e))return new Ri(t.key,n.version);e=Ts(t,e,Is(t.fieldTransforms,e,n.transformResults));return new ki(t.key,n.version,e,{hasCommittedMutations:!0})}(r,i,o):new xi(r.key,o.version,{hasCommittedMutations:!0}))}return e},Fu.prototype.applyToLocalView=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(t)&&(e=ds(i,e,this.localWriteTime));for(var i,o=0,s=this.mutations;o<s.length;o++)(i=s[o]).key.isEqual(t)&&(e=ds(i,e,this.localWriteTime));return e},Fu.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},Fu.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Js())},Fu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Fr(this.mutations,t.mutations,ps)&&Fr(this.baseMutations,t.baseMutations,ps)},Fu),Ru=(Mu.from=function(t,e,n){Lr(t.mutations.length===n.length);for(var r=Ys,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Mu(t,e,n,r)},Mu),Lu=(Pu.prototype.withSequenceNumber=function(t){return new Pu(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Pu.prototype.withResumeToken=function(t,e){return new Pu(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Pu.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Pu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Pu),Ou=function(t){this.Kt=t};function Pu(t,e,n,r,i,o,s){void 0===i&&(i=Oo.min()),void 0===o&&(o=Oo.min()),void 0===s&&(s=ti.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Mu(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Fu(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function qu(t,e){if(e.document)return Aa(t.Kt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Zr.fromSegments(e.noDocument.path),r=Gu(e.noDocument.readTime);return new xi(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){n=Zr.fromSegments(e.unknownDocument.path),r=Gu(e.unknownDocument.version);return new Ri(n,r)}return Rr()}function Vu(t,e,n){var r=Uu(n),n=e.key.path.popLast().toArray();if(e instanceof ki){var i={name:wa(o=t.Kt,(s=e).key),fields:s.toProto().mapValue.fields,updateTime:ya(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new Ja(null,null,i,o,r,n)}if(e instanceof xi){var s=e.key.path.toArray(),i=ju(e.version),o=e.hasCommittedMutations;return new Ja(null,new Ya(s,i),null,o,r,n)}if(e instanceof Ri){o=e.key.path.toArray(),e=ju(e.version);return new Ja(new Xa(o,e),null,null,!0,r,n)}return Rr()}function Uu(t){t=t.toTimestamp();return[t.seconds,t.nanoseconds]}function Bu(t){t=new li(t[0],t[1]);return Oo.fromTimestamp(t)}function ju(t){t=t.toTimestamp();return new Ka(t.seconds,t.nanoseconds)}function Gu(t){t=new li(t.seconds,t.nanoseconds);return Oo.fromTimestamp(t)}function Ku(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ca(t.Kt,e)})),r=0;r<e.mutations.length-1;++r){var i,o=e.mutations[r];r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(i=e.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,e.mutations.splice(r+1,1),++r)}var s=e.mutations.map((function(e){return Ca(t.Kt,e)})),a=li.fromMillis(e.localWriteTimeMs);return new xu(e.batchId,a,n,s)}function zu(t){var e=Gu(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Gu(t.lastLimboFreeSnapshotVersion):Oo.min(),r=void 0!==t.query.documents?(Lr(1===(r=t.query).documents.length),Ao(wo(Ia(r.documents[0])))):Ao(Ra(t.query));return new Lu(r,t.targetId,0,t.lastListenSequenceNumber,e,n,ti.fromBase64String(t.resumeToken))}function Qu(t,e){var n=ju(e.snapshotVersion),r=ju(e.lastLimboFreeSnapshotVersion),i=(Ui(e.target)?ka:xa)(t.Kt,e.target),t=e.resumeToken.toBase64();return new Za(e.targetId,qi(e.target),n,t,e.sequenceNumber,r,i)}function Hu(t){var e=Ra({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?No(e,e.limit,"L"):e}var Wu=(Yu.prototype.getBundleMetadata=function(t,e){return Xu(t).get(e).next((function(t){if(t)return{id:(t=t).bundleId,createTime:Gu(t.createTime),version:t.version}}))},Yu.prototype.saveBundleMetadata=function(t,e){return Xu(t).put({bundleId:(e=e).id,createTime:ju(va(e.createTime)),version:e.version})},Yu.prototype.getNamedQuery=function(t,e){return Ju(t).get(e).next((function(t){if(t)return{name:(t=t).name,query:Hu(t.bundledQuery),readTime:Gu(t.readTime)}}))},Yu.prototype.saveNamedQuery=function(t,e){return Ju(t).put({name:(e=e).name,readTime:ju(va(e.readTime)),bundledQuery:e.bundledQuery})},Yu);function Yu(){}function Xu(t){return ku(t,iu.store)}function Ju(t){return ku(t,ou.store)}var $u=(rc.prototype.addToCollectionParentIndex=function(t,e){return this.Wt.add(e),hu.resolve()},rc.prototype.getCollectionParents=function(t,e){return hu.resolve(this.Wt.getEntries(e))},rc),Zu=(nc.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Gs(Xr.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},nc.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},nc.prototype.getEntries=function(t){return(this.index[t]||new Gs(Xr.comparator)).toArray()},nc),tc=(ec.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.jt.has(e))return hu.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.jt.add(e)}));i={collectionId:r,parent:Ua(i)};return ic(t).put(i)},ec.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[qr(e),""],!1,!0);return ic(t).kt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ja(o.parent))}return n}))},ec);function ec(){this.jt=new Zu}function nc(){this.index={}}function rc(){this.Wt=new Zu}function ic(t){return ku(t,nu.store)}var oc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},sc=(ac.withCacheSize=function(t){return new ac(t,ac.DEFAULT_COLLECTION_PERCENTILE,ac.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},ac);function ac(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function uc(t,e,n){var r=t.store(Qa.store),i=t.store(Ha.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.qt({range:t},(function(t,e,n){return s++,n.delete()}));o.push(t.next((function(){Lr(1===s)})));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=Ha.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return hu.waitFor(o).next((function(){return a}))}function cc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Rr();e=t.noDocument}return JSON.stringify(e).length}sc.DEFAULT_COLLECTION_PERCENTILE=10,sc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sc.DEFAULT=new sc(41943040,sc.DEFAULT_COLLECTION_PERCENTILE,sc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sc.DISABLED=new sc(-1,0,0);var hc=(lc.Ht=function(t,e,n,r){return Lr(""!==t.uid),new lc(t.isAuthenticated()?t.uid:"",e,n,r)},lc.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dc(t).qt({index:Qa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},lc.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=pc(t),s=dc(t);return s.add({}).next((function(a){Lr("number"==typeof a);for(var u,c,h,l,f,d=new xu(a,e,n,r),p=(u=i.D,c=i.userId,l=(h=d).baseMutations.map((function(t){return Na(u.Kt,t)})),f=h.mutations.map((function(t){return Na(u.Kt,t)})),new Qa(c,h.batchId,h.localWriteTime.toMillis(),l,f)),y=[],g=new Gs((function(t,e){return Mr(t.canonicalString(),e.canonicalString())})),v=0,m=r;v<m.length;v++){var b=m[v],w=Ha.key(i.userId,b.key.path,a),g=g.add(b.key.path.popLast());y.push(s.put(p)),y.push(o.put(w,Ha.PLACEHOLDER))}return g.forEach((function(e){y.push(i.Gt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.zt[a]=d.keys()})),hu.waitFor(y).next((function(){return d}))}))},lc.prototype.lookupMutationBatch=function(t,e){var n=this;return dc(t).get(e).next((function(t){return t?(Lr(t.userId===n.userId),Ku(n.D,t)):null}))},lc.prototype.Jt=function(t,e){var n=this;return this.zt[e]?hu.resolve(this.zt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){t=t.keys();return n.zt[e]=t}return null}))},lc.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,e=IDBKeyRange.lowerBound([this.userId,r]),i=null;return dc(t).qt({index:Qa.userMutationsIndex,range:e},(function(t,e,o){e.userId===n.userId&&(Lr(e.batchId>=r),i=Ku(n.D,e)),o.done()})).next((function(){return i}))},lc.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return dc(t).qt({index:Qa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},lc.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return dc(t).kt(Qa.userMutationsIndex,n).next((function(t){return t.map((function(t){return Ku(e.D,t)}))}))},lc.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ha.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(r),i=[];return pc(t).qt({range:r},(function(r,o,s){var a=r[0],u=r[1],r=r[2],u=ja(u);if(a===n.userId&&e.path.isEqual(u))return dc(t).get(r).next((function(t){if(!t)throw Rr();Lr(t.userId===n.userId),i.push(Ku(n.D,t))}));s.done()})).next((function(){return i}))},lc.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Gs(Mr),i=[];return e.forEach((function(e){var o=Ha.prefixForPath(n.userId,e.path),o=IDBKeyRange.lowerBound(o),o=pc(t).qt({range:o},(function(t,i,o){var s=t[0],a=t[1],t=t[2],a=ja(a);s===n.userId&&e.path.isEqual(a)?r=r.add(t):o.done()}));i.push(o)})),hu.waitFor(i).next((function(){return n.Yt(t,r)}))},lc.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,e=Ha.prefixForPath(this.userId,r),e=IDBKeyRange.lowerBound(e),o=new Gs(Mr);return pc(t).qt({range:e},(function(t,e,s){var a=t[0],u=t[1],t=t[2],u=ja(u);a===n.userId&&r.isPrefixOf(u)?u.length===i&&(o=o.add(t)):s.done()})).next((function(){return n.Yt(t,o)}))},lc.prototype.Yt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(dc(t).get(e).next((function(t){if(null===t)throw Rr();Lr(t.userId===n.userId),r.push(Ku(n.D,t))})))})),hu.waitFor(i).next((function(){return r}))},lc.prototype.removeMutationBatch=function(t,e){var n=this;return uc(t.Qt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Xt(e.batchId)})),hu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},lc.prototype.Xt=function(t){delete this.zt[t]},lc.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return hu.resolve();var n=IDBKeyRange.lowerBound(Ha.prefixForUser(e.userId)),r=[];return pc(t).qt({range:n},(function(t,n,i){t[0]===e.userId?(t=ja(t[1]),r.push(t)):i.done()})).next((function(){Lr(0===r.length)}))}))},lc.prototype.containsKey=function(t,e){return fc(t,this.userId,e)},lc.prototype.Zt=function(t){var e=this;return yc(t).get(this.userId).next((function(t){return t||new za(e.userId,-1,"")}))},lc);function lc(t,e,n,r){this.userId=t,this.D=e,this.Gt=n,this.referenceDelegate=r,this.zt={}}function fc(t,e,n){var n=Ha.prefixForPath(e,n.path),r=n[1],n=IDBKeyRange.lowerBound(n),i=!1;return pc(t).qt({range:n,Bt:!0},(function(t,n,o){var s=t[0],a=t[1];t[2],s===e&&a===r&&(i=!0),o.done()})).next((function(){return i}))}function dc(t){return ku(t,Qa.store)}function pc(t){return ku(t,Ha.store)}function yc(t){return ku(t,za.store)}var gc=(bc.prototype.next=function(){return this.te+=2,this.te},bc.ee=function(){return new bc(0)},bc.ne=function(){return new bc(-1)},bc),vc=(mc.prototype.allocateTargetId=function(t){var e=this;return this.se(t).next((function(n){var r=new gc(n.highestTargetId);return n.highestTargetId=r.next(),e.ie(t,n).next((function(){return n.highestTargetId}))}))},mc.prototype.getLastRemoteSnapshotVersion=function(t){return this.se(t).next((function(t){return Oo.fromTimestamp(new li(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},mc.prototype.getHighestSequenceNumber=function(t){return this.se(t).next((function(t){return t.highestListenSequenceNumber}))},mc.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.se(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.ie(t,i)}))},mc.prototype.addTargetData=function(t,e){var n=this;return this.re(t,e).next((function(){return n.se(t).next((function(r){return r.targetCount+=1,n.oe(e,r),n.ie(t,r)}))}))},mc.prototype.updateTargetData=function(t,e){return this.re(t,e)},mc.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return wc(t).delete(e.targetId)})).next((function(){return n.se(t)})).next((function(e){return Lr(0<e.targetCount),--e.targetCount,n.ie(t,e)}))},mc.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return wc(t).qt((function(s,a){a=zu(a);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.removeTargetData(t,a)))})).next((function(){return hu.waitFor(o)})).next((function(){return i}))},mc.prototype.forEachTarget=function(t,e){return wc(t).qt((function(t,n){n=zu(n);e(n)}))},mc.prototype.se=function(t){return Ec(t).get(eu.key).next((function(t){return Lr(null!==t),t}))},mc.prototype.ie=function(t,e){return Ec(t).put(eu.key,e)},mc.prototype.re=function(t,e){return wc(t).put(Qu(this.D,e))},mc.prototype.oe=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},mc.prototype.getTargetCount=function(t){return this.se(t).next((function(t){return t.targetCount}))},mc.prototype.getTargetData=function(t,e){var n=qi(e),n=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),r=null;return wc(t).qt({range:n,index:Za.queryTargetsIndexName},(function(t,n,i){n=zu(n);Vi(e,n.target)&&(r=n,i.done())})).next((function(){return r}))},mc.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Tc(t);return e.forEach((function(e){var s=Ua(e.path);i.push(o.put(new tu(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),hu.waitFor(i)},mc.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Tc(t);return hu.forEach(e,(function(e){var o=Ua(e.path);return hu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},mc.prototype.removeMatchingKeysForTargetId=function(t,e){t=Tc(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},mc.prototype.getMatchingKeysForTargetId=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Tc(t),n=Js();return t.qt({range:e,Bt:!0},(function(t,e,r){t=ja(t[1]),t=new Zr(t);n=n.add(t)})).next((function(){return n}))},mc.prototype.containsKey=function(t,e){var e=Ua(e.path),e=IDBKeyRange.bound([e],[qr(e)],!1,!0),n=0;return Tc(t).qt({index:tu.documentTargetsIndex,Bt:!0,range:e},(function(t,e,r){var i=t[0];t[1],0!==i&&(n++,r.done())})).next((function(){return 0<n}))},mc.prototype.yt=function(t,e){return wc(t).get(e).next((function(t){return t?zu(t):null}))},mc);function mc(t,e){this.referenceDelegate=t,this.D=e}function bc(t){this.te=t}function wc(t){return ku(t,Za.store)}function Ec(t){return ku(t,eu.store)}function Tc(t){return ku(t,tu.store)}function Ic(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){if(t.code!==Wr.FAILED_PRECONDITION||t.message!==uu)throw t;return Nr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function _c(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=Mr(n,t);return 0===t?Mr(r,e):t}var Sc=(Rc.prototype.ue=function(){return++this.ae},Rc.prototype.he=function(t){var e=[t,this.ue()];this.buffer.size<this.ce?this.buffer=this.buffer.add(e):_c(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(Rc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Rc),Dc=(xc.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.de(t)},xc.prototype.stop=function(){this.fe&&(this.fe.cancel(),this.fe=null)},Object.defineProperty(xc.prototype,"started",{get:function(){return null!==this.fe},enumerable:!1,configurable:!0}),xc.prototype.de=function(t){var e=this,n=this.le?3e5:6e4;Nr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.fe=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return s(e,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:this.fe=null,this.le=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Eu(e=n.sent())?(Nr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ic(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.de(t)];case 8:return n.sent(),[2]}}))}))}))},xc),Ac=(kc.prototype.calculateTargetCount=function(t,e){return this.we._e(t).next((function(t){return Math.floor(e/100*t)}))},kc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return hu.resolve(_r.o);var r=new Sc(e);return this.we.forEachTarget(t,(function(t){return r.he(t.sequenceNumber)})).next((function(){return n.we.me(t,(function(t){return r.he(t)}))})).next((function(){return r.maxValue}))},kc.prototype.removeTargets=function(t,e,n){return this.we.removeTargets(t,e,n)},kc.prototype.removeOrphanedDocuments=function(t,e){return this.we.removeOrphanedDocuments(t,e)},kc.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Nr("LruGarbageCollector","Garbage collection skipped; disabled"),hu.resolve(oc)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Nr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),oc):n.ye(t,e)}))},kc.prototype.getCacheSize=function(t){return this.we.getCacheSize(t)},kc.prototype.ye=function(t,e){var r,i,o,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return i=e>h.params.maximumSequenceNumbersToCollect?(Nr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),h.params.maximumSequenceNumbersToCollect):e,s=Date.now(),h.nthSequenceNumber(t,i)})).next((function(n){return r=n,a=Date.now(),h.removeTargets(t,r,e)})).next((function(e){return o=e,u=Date.now(),h.removeOrphanedDocuments(t,r)})).next((function(t){return c=Date.now(),Ar()<=n.DEBUG&&Nr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),hu.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})}))},kc),Nc=(Cc.prototype._e=function(t){var e=this.ge(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},Cc.prototype.ge=function(t){var e=0;return this.me(t,(function(t){e++})).next((function(){return e}))},Cc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},Cc.prototype.me=function(t,e){return this.pe(t,(function(t,n){return e(n)}))},Cc.prototype.addReference=function(t,e,n){return Lc(t,n)},Cc.prototype.removeReference=function(t,e,n){return Lc(t,n)},Cc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},Cc.prototype.markPotentiallyOrphaned=Lc,Cc.prototype.Ee=function(t,e){return r=e,i=!1,yc(n=t).Ut((function(t){return fc(n,t,r).next((function(t){return t&&(i=!0),hu.resolve(!t)}))})).next((function(){return i}));var n,r,i},Cc.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.pe(t,(function(s,a){a<=e&&(a=n.Ee(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Tc(t).delete([0,Ua(s.path)])}))})),i.push(a))})).next((function(){return hu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},Cc.prototype.removeTarget=function(t,e){e=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,e)},Cc.prototype.updateLimboDocument=Lc,Cc.prototype.pe=function(t,e){var n,t=Tc(t),r=_r.o;return t.qt({index:tu.documentTargetsIndex},(function(t,i){var o=t[0],t=(t[1],i.path),i=i.sequenceNumber;0===o?(r!==_r.o&&e(new Zr(ja(n)),r),r=i,n=t):r=_r.o})).next((function(){r!==_r.o&&e(new Zr(ja(n)),r)}))},Cc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Cc);function Cc(t,e){this.db=t,this.garbageCollector=new Ac(this,e)}function kc(t,e){this.we=t,this.params=e}function xc(t,e){this.garbageCollector=t,this.asyncQueue=e,this.le=!1,this.fe=null}function Rc(t){this.ce=t,this.buffer=new Gs(_c),this.ae=0}function Lc(t,e){return Tc(t).put((t=t.currentSequenceNumber,new tu(0,Ua(e.path),t)))}var Oc,Pc=(Bc.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},Bc.prototype.has=function(t){return void 0!==this.get(t)},Bc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Bc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Bc.prototype.forEach=function(t){Ur(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],o=o[1];t(s,o)}}))},Bc.prototype.isEmpty=function(){return Br(this.inner)},Bc),Ie=(Uc.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:Oo.min()},Uc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{maybeDocument:t,readTime:e})},Uc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{maybeDocument:null,readTime:e})},Uc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?hu.resolve(n.maybeDocument):this.getFromCache(t,e)},Uc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Uc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Uc.prototype.assertNotApplied=function(){},Uc),Mc=(Vc.prototype.addEntry=function(t,e,n){return Gc(t).put(Kc(e),n)},Vc.prototype.removeEntry=function(t,e){t=Gc(t),e=Kc(e);return t.delete(e)},Vc.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Te(t,r)}))},Vc.prototype.getEntry=function(t,e){var n=this;return Gc(t).get(Kc(e)).next((function(t){return n.Ie(t)}))},Vc.prototype.Ae=function(t,e){var n=this;return Gc(t).get(Kc(e)).next((function(t){var e=n.Ie(t);return e?{maybeDocument:e,size:cc(t)}:null}))},Vc.prototype.getEntries=function(t,e){var n=this,r=zs;return this.Re(t,e,(function(t,e){e=n.Ie(e);r=r.insert(t,e)})).next((function(){return r}))},Vc.prototype.be=function(t,e){var n=this,r=zs,i=new Ms(Zr.comparator);return this.Re(t,e,(function(t,e){var o=n.Ie(e);i=o?(r=r.insert(t,o),i.insert(t,cc(e))):(r=r.insert(t,null),i.insert(t,0))})).next((function(){return{ve:r,Pe:i}}))},Vc.prototype.Re=function(t,e,n){if(e.isEmpty())return hu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Gc(t).qt({range:r},(function(t,e,r){for(var s=Zr.fromSegments(t);o&&Zr.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ot(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},Vc.prototype.getDocumentsMatchingQuery=function(t,e,n){var r,i=this,o=Ws,s=e.path.length+1,a={};return n.isEqual(Oo.min())?(r=e.path.toArray(),a.range=IDBKeyRange.lowerBound(r)):(r=e.path.toArray(),n=Uu(n),a.range=IDBKeyRange.lowerBound([r,n],!0),a.index=Ja.collectionReadTimeIndex),Gc(t).qt(a,(function(t,n,r){t.length===s&&(n=qu(i.D,n),e.path.isPrefixOf(n.key.path)?n instanceof ki&&Ro(e,n)&&(o=o.insert(n.key,n)):r.done())})).next((function(){return o}))},Vc.prototype.newChangeBuffer=function(t){return new Fc(this,!!t&&t.trackRemovals)},Vc.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},Vc.prototype.getMetadata=function(t){return jc(t).get($a.key).next((function(t){return Lr(!!t),t}))},Vc.prototype.Te=function(t,e){return jc(t).put($a.key,e)},Vc.prototype.Ie=function(t){if(t){t=qu(this.D,t);return t instanceof xi&&t.version.isEqual(Oo.min())?null:t}return null},Vc),Fc=(o(qc,Oc=Ie),qc.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Gs((function(t,e){return Mr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a,u=e.Se.get(o);s.maybeDocument?(a=Vu(e.Ve.D,s.maybeDocument,e.getReadTime(o)),i=i.add(o.path.popLast()),s=cc(a),r+=s-u,n.push(e.Ve.addEntry(t,o,a))):(r-=u,e.trackRemovals?(u=Vu(e.Ve.D,new xi(o,Oo.min()),e.getReadTime(o)),n.push(e.Ve.addEntry(t,o,u))):n.push(e.Ve.removeEntry(t,o)))})),i.forEach((function(r){n.push(e.Ve.Gt.addToCollectionParentIndex(t,r))})),n.push(this.Ve.updateMetadata(t,r)),hu.waitFor(n)},qc.prototype.getFromCache=function(t,e){var n=this;return this.Ve.Ae(t,e).next((function(t){return null===t?(n.Se.set(e,0),null):(n.Se.set(e,t.size),t.maybeDocument)}))},qc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ve.be(t,e).next((function(t){var e=t.ve;return t.Pe.forEach((function(t,e){n.Se.set(t,e)})),e}))},qc);function qc(t,e){var n=this;return(n=Oc.call(this)||this).Ve=t,n.trackRemovals=e,n.Se=new Pc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),n}function Vc(t,e){this.D=t,this.Gt=e}function Uc(){this.changes=new Pc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}function Bc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function jc(t){return ku(t,$a.store)}function Gc(t){return ku(t,Ja.store)}function Kc(t){return t.path.toArray()}var zc=(Qc.prototype.St=function(t,e,n,r){var i=this;Lr(n<r&&0<=n&&r<=11);var o=new lu("createOrUpgrade",e);n<1&&1<=r&&(t.createObjectStore(Ga.store),(s=t).createObjectStore(za.store,{keyPath:za.keyPath}),s.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Ha.store),Hc(t),t.createObjectStore(Ja.store));var s,a=hu.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore(tu.store),s.deleteObjectStore(Za.store),s.deleteObjectStore(eu.store),Hc(t)),a=a.next((function(){return t=o.store(eu.store),e=new eu(0,0,Oo.min().toTimestamp(),0),t.put(eu.key,e);var t,e}))),n<4&&4<=r&&(a=(a=0!==n?a.next((function(){return e=t,(n=o).store(Qa.store).kt().next((function(t){e.deleteObjectStore(Qa.store),e.createObjectStore(Qa.store,{keyPath:Qa.keyPath,autoIncrement:!0}).createIndex(Qa.userMutationsIndex,Qa.userMutationsKeyPath,{unique:!0});var r=n.store(Qa.store),t=t.map((function(t){return r.put(t)}));return hu.waitFor(t)}));var e,n})):a).next((function(){t.createObjectStore(ru.store,{keyPath:ru.keyPath})}))),n<5&&5<=r&&(a=a.next((function(){return i.De(o)}))),n<6&&6<=r&&(a=a.next((function(){return t.createObjectStore($a.store),i.Ce(o)}))),n<7&&7<=r&&(a=a.next((function(){return i.xe(o)}))),n<8&&8<=r&&(a=a.next((function(){return i.Ne(t,o)}))),n<9&&9<=r&&(a=a.next((function(){var n;(n=t).objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(Ja.store)).createIndex(Ja.readTimeIndex,Ja.readTimeIndexPath,{unique:!1}),n.createIndex(Ja.collectionReadTimeIndex,Ja.collectionReadTimeIndexPath,{unique:!1})}))),n<10&&10<=r&&(a=a.next((function(){return i.$e(o)}))),a=n<11&&11<=r?a.next((function(){t.createObjectStore(iu.store,{keyPath:iu.keyPath}),t.createObjectStore(ou.store,{keyPath:ou.keyPath})})):a},Qc.prototype.Ce=function(t){var e=0;return t.store(Ja.store).qt((function(t,n){e+=cc(n)})).next((function(){var n=new $a(e);return t.store($a.store).put($a.key,n)}))},Qc.prototype.De=function(t){var e=this,n=t.store(za.store),r=t.store(Qa.store);return n.kt().next((function(n){return hu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.kt(Qa.userMutationsIndex,i).next((function(r){return hu.forEach(r,(function(r){Lr(r.userId===n.userId);r=Ku(e.D,r);return uc(t,n.userId,r).next((function(){}))}))}))}))}))},Qc.prototype.xe=function(t){var e=t.store(tu.store),n=t.store(Ja.store);return t.store(eu.store).get(eu.key).next((function(t){var r=[];return n.qt((function(n,i){var o=new Xr(n),n=[0,Ua(o)];r.push(e.get(n).next((function(n){return n?hu.resolve():e.put(new tu(0,Ua(o),t.highestListenSequenceNumber))})))})).next((function(){return hu.waitFor(r)}))}))},Qc.prototype.Ne=function(t,e){t.createObjectStore(nu.store,{keyPath:nu.keyPath});function n(t){if(i.add(t)){var e=t.lastSegment(),t=t.popLast();return r.put({collectionId:e,parent:Ua(t)})}}var r=e.store(nu.store),i=new Zu;return e.store(Ja.store).qt({Bt:!0},(function(t,e){t=new Xr(t);return n(t.popLast())})).next((function(){return e.store(Ha.store).qt({Bt:!0},(function(t,e){t[0];var r=t[1],r=(t[2],ja(r));return n(r.popLast())}))}))},Qc.prototype.$e=function(t){var e=this,n=t.store(Za.store);return n.qt((function(t,r){r=zu(r),r=Qu(e.D,r);return n.put(r)}))},Qc);function Qc(t){this.D=t}function Hc(t){t.createObjectStore(tu.store,{keyPath:tu.keyPath}).createIndex(tu.documentTargetsIndex,tu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Za.store,{keyPath:Za.keyPath}).createIndex(Za.queryTargetsIndexName,Za.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(eu.store)}var Wc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Yc=(Xc.prototype.start=function(){var t=this;return this.Ye().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Yr(Wr.FAILED_PRECONDITION,Wc);return t.Xe(),t.Ze(),t.tn(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.Ge.getHighestSequenceNumber(e)}))})).then((function(e){t.Me=new _r(e,t.Oe)})).then((function(){t.Le=!0})).catch((function(e){return t.je&&t.je.close(),Promise.reject(e)}))},Xc.prototype.en=function(t){var e=this;return this.Ke=function(n){return s(e,void 0,void 0,(function(){return a(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},Xc.prototype.setDatabaseDeletedListener=function(t){var e=this;this.je.Ct((function(n){return s(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},Xc.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Fe.enqueueAndForget((function(){return s(e,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.started?[4,this.Ye()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},Xc.prototype.Ye=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return $c(e).put(new ru(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.nn(e).next((function(e){e||(t.isPrimary=!1,t.Fe.enqueueRetryable((function(){return t.Ke(!1)})))}))})).next((function(){return t.sn(e)})).next((function(n){return t.isPrimary&&!n?t.rn(e).next((function(){return!1})):!!n&&t.on(e).next((function(){return!0}))}))})).catch((function(e){if(Eu(e))return Nr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Nr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Fe.enqueueRetryable((function(){return t.Ke(e)})),t.isPrimary=e}))},Xc.prototype.nn=function(t){var e=this;return Jc(t).get(Ga.key).next((function(t){return hu.resolve(e.cn(t))}))},Xc.prototype.an=function(t){return $c(t).delete(this.clientId)},Xc.prototype.un=function(){return s(this,void 0,void 0,(function(){var t,e,n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.hn(this.Qe,18e5)?[3,2]:(this.Qe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=ku(t,ru.store);return e.kt().next((function(t){var n=i.ln(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return hu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Je)for(e=0,n=t;e<n.length;e++)r=n[e],this.Je.removeItem(this.fn(r.clientId));o.label=2;case 2:return[2]}}))}))},Xc.prototype.tn=function(){var t=this;this.Ue=this.Fe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.Ye().then((function(){return t.un()})).then((function(){return t.tn()}))}))},Xc.prototype.cn=function(t){return!!t&&t.ownerId===this.clientId},Xc.prototype.sn=function(t){var e=this;return this.ke?hu.resolve(!0):Jc(t).get(Ga.key).next((function(n){if(null!==n&&e.hn(n.leaseTimestampMs,5e3)&&!e.dn(n.ownerId)){if(e.cn(n)&&e.networkEnabled)return!0;if(!e.cn(n)){if(!n.allowTabSynchronization)throw new Yr(Wr.FAILED_PRECONDITION,Wc);return!1}}return!(!e.networkEnabled||!e.inForeground)||$c(t).kt().next((function(t){return void 0===e.ln(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,t=e.networkEnabled===t.networkEnabled;if(n||r&&t)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Nr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},Xc.prototype.shutdown=function(){return s(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){switch(e.label){case 0:return this.Le=!1,this.wn(),this.Ue&&(this.Ue.cancel(),this.Ue=null),this._n(),this.mn(),[4,this.je.runTransaction("shutdown","readwrite",[Ga.store,ru.store],(function(e){var n=new Nu(e,_r.o);return t.rn(n).next((function(){return t.an(n)}))}))];case 1:return e.sent(),this.je.close(),this.yn(),[2]}}))}))},Xc.prototype.ln=function(t,e){var n=this;return t.filter((function(t){return n.hn(t.updateTimeMs,e)&&!n.dn(t.clientId)}))},Xc.prototype.gn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return $c(e).kt().next((function(e){return t.ln(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(Xc.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),Xc.prototype.getMutationQueue=function(t){return hc.Ht(t,this.D,this.Gt,this.referenceDelegate)},Xc.prototype.getTargetCache=function(){return this.Ge},Xc.prototype.getRemoteDocumentCache=function(){return this.ze},Xc.prototype.getIndexManager=function(){return this.Gt},Xc.prototype.getBundleCache=function(){return this.He},Xc.prototype.runTransaction=function(t,e,n){var r=this;Nr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.je.runTransaction(t,o,au,(function(o){return i=new Nu(o,r.Me?r.Me.next():_r.o),"readwrite-primary"===e?r.nn(i).next((function(t){return!!t||r.sn(i)})).next((function(e){if(!e)throw Cr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Fe.enqueueRetryable((function(){return r.Ke(!1)})),new Yr(Wr.FAILED_PRECONDITION,uu);return n(i)})).next((function(t){return r.on(i).next((function(){return t}))})):r.pn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},Xc.prototype.pn=function(t){var e=this;return Jc(t).get(Ga.key).next((function(t){if(null!==t&&e.hn(t.leaseTimestampMs,5e3)&&!e.dn(t.ownerId)&&!e.cn(t)&&!(e.ke||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Yr(Wr.FAILED_PRECONDITION,Wc)}))},Xc.prototype.on=function(t){var e=new Ga(this.clientId,this.allowTabSynchronization,Date.now());return Jc(t).put(Ga.key,e)},Xc.At=function(){return fu.At()},Xc.prototype.rn=function(t){var e=this,n=Jc(t);return n.get(Ga.key).next((function(t){return e.cn(t)?(Nr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ga.key)):hu.resolve()}))},Xc.prototype.hn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Cr("Detected an update time that is in the future: "+t+" > "+n),1))},Xc.prototype.Xe=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=function(){t.Fe.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.Ye()}))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)},Xc.prototype._n=function(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)},Xc.prototype.Ze=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Be=function(){e.wn(),e.Fe.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Be))},Xc.prototype.mn=function(){this.Be&&(this.window.removeEventListener("unload",this.Be),this.Be=null)},Xc.prototype.dn=function(t){try{var e=null!==(null===(e=this.Je)||void 0===e?void 0:e.getItem(this.fn(t)));return Nr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Cr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Xc.prototype.wn=function(){if(this.Je)try{this.Je.setItem(this.fn(this.clientId),String(Date.now()))}catch(t){Cr("Failed to set zombie client id.",t)}},Xc.prototype.yn=function(){if(this.Je)try{this.Je.removeItem(this.fn(this.clientId))}catch(t){}},Xc.prototype.fn=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Xc);function Xc(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fe=i,this.window=o,this.document=s,this.Oe=u,this.ke=c,this.Me=null,this.Le=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Be=null,this.inForeground=!1,this.qe=null,this.Ue=null,this.Qe=Number.NEGATIVE_INFINITY,this.Ke=function(t){return Promise.resolve()},!Xc.At())throw new Yr(Wr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Nc(this,r),this.We=e+"main",this.D=new Ou(a),this.je=new fu(this.We,11,new zc(this.D)),this.Ge=new vc(this.referenceDelegate,this.D),this.Gt=new tc,this.ze=(e=this.D,a=this.Gt,new Mc(e,a)),this.He=new Wu,this.window&&this.window.localStorage?this.Je=this.window.localStorage:(this.Je=null,!1===c&&Cr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Jc(t){return ku(t,Ga.store)}function $c(t){return ku(t,ru.store)}function Zc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function th(t,e){this.progress=t,this.En=e}var eh=(uh.prototype.In=function(t,e){var n=this;return this.Tn.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.An(t,e,r)}))},uh.prototype.An=function(t,e,n){return this.ze.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},uh.prototype.Rn=function(t,e,n){var r=zs;return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},uh.prototype.bn=function(t,e){var n=this;return this.ze.getEntries(t,e).next((function(e){return n.vn(t,e)}))},uh.prototype.vn=function(t,e){var n=this;return this.Tn.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var r=n.Rn(t,e,r),i=zs;return r.forEach((function(t,e){e=e||new xi(t,Oo.min()),i=i.insert(t,e)})),i}))},uh.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Zr.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Pn(t,e.path):So(e)?this.Vn(t,e,n):this.Sn(t,e,n);var r},uh.prototype.Pn=function(t,e){return this.In(t,new Zr(e)).next((function(t){var e=Ws;return e=t instanceof ki?e.insert(t.key,t):e}))},uh.prototype.Vn=function(t,e,n){var r=this,i=e.collectionGroup,o=Ws;return this.Gt.getCollectionParents(t,i).next((function(s){return hu.forEach(s,(function(s){var a,a=(a=e,s=s.child(i),new mo(s,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.Sn(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},uh.prototype.Sn=function(t,e,n){var r,i,o=this;return this.ze.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.Tn.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Dn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,u=ds(u,r.get(c),o.localWriteTime);r=u instanceof ki?r.insert(c,u):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Ro(e,n)||(r=r.remove(t))})),r}))},uh.prototype.Dn=function(t,e,n){for(var r=Js(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof bs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.ze.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof ki&&(c=c.insert(t,e))})),c}))},uh),nh=(ah.Nn=function(t,e){for(var n=Js(),r=Js(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new ah(t,e.fromCache,n,r)},ah),rh=(sh.prototype.$n=function(t){this.Fn=t},sh.prototype.getDocumentsMatchingQuery=function(t,e,r,i){var o=this;return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||r.isEqual(Oo.min())?this.On(t,e):this.Fn.bn(t,i).next((function(s){var a=o.kn(e,s);return(Eo(e)||To(e))&&o.Mn(e.limitType,a,i,r)?o.On(t,e):(Ar()<=n.DEBUG&&Nr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),xo(e)),o.Fn.getDocumentsMatchingQuery(t,e,r).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},sh.prototype.kn=function(t,e){var n=new Gs(Lo(t));return e.forEach((function(e,r){r instanceof ki&&Ro(t,r)&&(n=n.add(r))})),n},sh.prototype.Mn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},sh.prototype.On=function(t,e){return Ar()<=n.DEBUG&&Nr("QueryEngine","Using full collection scan to execute query:",xo(e)),this.Fn.getDocumentsMatchingQuery(t,e,Oo.min())},sh),ih=(oh.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Bn)}))},oh);function oh(t,e,n,r){this.persistence=t,this.Ln=e,this.D=r,this.Bn=new Ms(Mr),this.qn=new Pc(qi,Vi),this.Un=Oo.min(),this.Tn=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.Ge=t.getTargetCache(),this.Kn=new eh(this.Qn,this.Tn,this.persistence.getIndexManager()),this.He=t.getBundleCache(),this.Ln.$n(this.Kn)}function sh(){}function ah(t,e,n,r){this.targetId=t,this.fromCache=e,this.Cn=n,this.xn=r}function uh(t,e,n){this.ze=t,this.Tn=e,this.Gt=n}function ch(t,e,n,r){return new ih(t,e,n,r)}function hh(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(s){switch(s.label){case 0:return r=(n=t).Tn,i=n.Kn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.Tn.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new eh(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Js(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)var f=l[h],s=s.add(f.key)}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var g=0,v=y.mutations;g<v.length;g++){var m=v[g];s=s.add(m.key)}}return i.bn(t,s).next((function(t){return{Wn:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n.Tn=r,n.Kn=i,n.Ln.$n(n.Kn),o)]}}))}))}function lh(t,e){var n=t;return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,a,u,c,h=e.batch.keys(),l=n.Qn.newChangeBuffer({trackRemovals:!0});return r=n,i=t,s=l,a=(o=e).batch,u=a.keys(),c=hu.resolve(),u.forEach((function(t){c=c.next((function(){return s.getEntry(i,t)})).next((function(e){var n=e,e=o.docVersions.get(t);Lr(null!==e),(!n||n.version.compareTo(e)<0)&&(n=a.applyToRemoteDocument(t,n,o))&&s.addEntry(n,o.commitVersion)}))})),c.next((function(){return r.Tn.removeMutationBatch(i,a)})).next((function(){return l.apply(t)})).next((function(){return n.Tn.performConsistencyCheck(t)})).next((function(){return n.Kn.bn(t,h)}))}))}function fh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.Ge.getLastRemoteSnapshotVersion(t)}))}function dh(t,e){var n=t,r=e.snapshotVersion,i=n.Bn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.Bn;var s=[];e.targetChanges.forEach((function(e,o){var a,u,c,h=i.get(o);h&&(s.push(n.Ge.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.Ge.addMatchingKeys(t,e.addedDocuments,o)}))),0<(c=e.resumeToken).approximateByteSize()&&(a=h.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber),i=i.insert(o,a),u=h,c=e,Lr(0<(h=a).resumeToken.approximateByteSize()),(0===u.resumeToken.approximateByteSize()||3e8<=h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()||0<c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size)&&s.push(n.Ge.updateTargetData(t,a))))}));var a,u=zs;return e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(ph(t,o,e.documentUpdates,r,void 0).next((function(t){u=t}))),r.isEqual(Oo.min())||(a=n.Ge.getLastRemoteSnapshotVersion(t).next((function(e){return n.Ge.setTargetsMetadata(t,t.currentSequenceNumber,r)})),s.push(a)),hu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Kn.vn(t,u)}))})).then((function(t){return n.Bn=i,t}))}function ph(t,e,n,r,i){var o=Js();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=zs;return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s instanceof xi&&s.version.isEqual(Oo.min())?(e.removeEntry(n,u),o=o.insert(n,s)):null==a||0<s.version.compareTo(a.version)||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Nr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function yh(t,e){var n=t;return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.Ge.getTargetData(t,e).next((function(i){return i?(r=i,hu.resolve(r)):n.Ge.allocateTargetId(t).next((function(i){return r=new Lu(e,i,0,t.currentSequenceNumber),n.Ge.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Bn.get(t.targetId);return(null===r||0<t.snapshotVersion.compareTo(r.snapshotVersion))&&(n.Bn=n.Bn.insert(t.targetId,t),n.qn.set(e,t.targetId)),t}))}function gh(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o;return a(this,(function(s){switch(s.label){case 0:i=(r=t).Bn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!Eu(o=s.sent()))throw o;return Nr("LocalStore","Failed to update sequence numbers for target "+e+": "+o),[3,5];case 5:return r.Bn=r.Bn.remove(e),r.qn.delete(i.target),[2]}}))}))}function vh(t,e,n){var r=t,i=Oo.min(),o=Js();return r.persistence.runTransaction("Execute query","readonly",(function(t){return s=r,a=t,u=Ao(e),(void 0!==(s=(c=s).qn.get(u))?hu.resolve(c.Bn.get(s)):c.Ge.getTargetData(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ge.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Ln.getDocumentsMatchingQuery(t,e,n?i:Oo.min(),n?o:Js())})).next((function(t){return{documents:t,jn:o}}));var s,a,u,c}))}function mh(t,e){var n=t,r=n.Ge,t=n.Bn.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.yt(t,e).next((function(t){return t?t.target:null}))}))}function bh(t){var e=t;return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.Qn,r=t,t=e.Un,i=n,o=zs,s=Uu(t),t=Gc(r),r=IDBKeyRange.lowerBound(s,!0),t.qt({index:Ja.readTimeIndex,range:r},(function(t,e){var n=qu(i.D,e);o=o.insert(n.key,n),s=e.readTime})).next((function(){return{En:o,readTime:Bu(s)}}));var n,r,i,o,s})).then((function(t){var n=t.En,t=t.readTime;return e.Un=t,n}))}function wh(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){return[2,(e=t).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return t=Gc(t),e=Oo.min(),t.qt({index:Ja.readTimeIndex,reverse:!0},(function(t,n,r){n.readTime&&(e=Bu(n.readTime)),r.done()})).next((function(){return e}));var e})).then((function(t){e.Un=t}))]}))}))}var Eh,Th,Ih=(Kh.prototype.getBundleMetadata=function(t,e){return hu.resolve(this.Jn.get(e))},Kh.prototype.saveBundleMetadata=function(t,e){return this.Jn.set(e.id,{id:e.id,version:e.version,createTime:va(e.createTime)}),hu.resolve()},Kh.prototype.getNamedQuery=function(t,e){return hu.resolve(this.Yn.get(e))},Kh.prototype.saveNamedQuery=function(t,e){return this.Yn.set(e.name,{name:(e=e).name,query:Hu(e.bundledQuery),readTime:va(e.readTime)}),hu.resolve()},Kh),_h=(Gh.prototype.isEmpty=function(){return this.Xn.isEmpty()},Gh.prototype.addReference=function(t,e){e=new Sh(t,e);this.Xn=this.Xn.add(e),this.ts=this.ts.add(e)},Gh.prototype.ns=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},Gh.prototype.removeReference=function(t,e){this.ss(new Sh(t,e))},Gh.prototype.rs=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},Gh.prototype.os=function(t){var e=this,n=new Zr(new Xr([])),r=new Sh(n,t),t=new Sh(n,t+1),i=[];return this.ts.forEachInRange([r,t],(function(t){e.ss(t),i.push(t.key)})),i},Gh.prototype.cs=function(){var t=this;this.Xn.forEach((function(e){return t.ss(e)}))},Gh.prototype.ss=function(t){this.Xn=this.Xn.delete(t),this.ts=this.ts.delete(t)},Gh.prototype.us=function(t){var e=new Zr(new Xr([])),n=new Sh(e,t),t=new Sh(e,t+1),r=Js();return this.ts.forEachInRange([n,t],(function(t){r=r.add(t.key)})),r},Gh.prototype.containsKey=function(t){var e=new Sh(t,0),e=this.Xn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},Gh),Sh=(jh.Zn=function(t,e){return Zr.comparator(t.key,e.key)||Mr(t.hs,e.hs)},jh.es=function(t,e){return Mr(t.hs,e.hs)||Zr.comparator(t.key,e.key)},jh),Dh=(Bh.prototype.checkEmpty=function(t){return hu.resolve(0===this.Tn.length)},Bh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ls;this.ls++,0<this.Tn.length&&this.Tn[this.Tn.length-1];n=new xu(i,e,n,r);this.Tn.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.fs=this.fs.add(new Sh(a.key,i)),this.Gt.addToCollectionParentIndex(t,a.key.path.popLast())}return hu.resolve(n)},Bh.prototype.lookupMutationBatch=function(t,e){return hu.resolve(this.ds(e))},Bh.prototype.getNextMutationBatchAfterBatchId=function(t,e){e+=1,e=this.ws(e),e=e<0?0:e;return hu.resolve(this.Tn.length>e?this.Tn[e]:null)},Bh.prototype.getHighestUnacknowledgedBatchId=function(){return hu.resolve(0===this.Tn.length?-1:this.ls-1)},Bh.prototype.getAllMutationBatches=function(t){return hu.resolve(this.Tn.slice())},Bh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Sh(e,0),e=new Sh(e,Number.POSITIVE_INFINITY),i=[];return this.fs.forEachInRange([r,e],(function(t){t=n.ds(t.hs);i.push(t)})),hu.resolve(i)},Bh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Gs(Mr);return e.forEach((function(t){var e=new Sh(t,0),t=new Sh(t,Number.POSITIVE_INFINITY);n.fs.forEachInRange([e,t],(function(t){r=r.add(t.hs)}))})),hu.resolve(this._s(r))},Bh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;Zr.isDocumentKey(e)||(e=e.child(""));var e=new Sh(new Zr(e),0),i=new Gs(Mr);return this.fs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.hs)),!0)}),e),hu.resolve(this._s(i))},Bh.prototype._s=function(t){var e=this,n=[];return t.forEach((function(t){t=e.ds(t);null!==t&&n.push(t)})),n},Bh.prototype.removeMutationBatch=function(t,e){var n=this;Lr(0===this.ys(e.batchId,"removed")),this.Tn.shift();var r=this.fs;return hu.forEach(e.mutations,(function(i){var o=new Sh(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.fs=r}))},Bh.prototype.Xt=function(t){},Bh.prototype.containsKey=function(t,e){var n=new Sh(e,0),n=this.fs.firstAfterOrEqual(n);return hu.resolve(e.isEqual(n&&n.key))},Bh.prototype.performConsistencyCheck=function(t){return this.Tn.length,hu.resolve()},Bh.prototype.ys=function(t,e){return this.ws(t)},Bh.prototype.ws=function(t){return 0===this.Tn.length?0:t-this.Tn[0].batchId},Bh.prototype.ds=function(t){t=this.ws(t);return t<0||t>=this.Tn.length?null:this.Tn[t]},Bh),Ah=(Uh.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.gs(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:i,readTime:n}),this.size+=i-o,this.Gt.addToCollectionParentIndex(t,r.path.popLast())},Uh.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Uh.prototype.getEntry=function(t,e){e=this.docs.get(e);return hu.resolve(e?e.maybeDocument:null)},Uh.prototype.getEntries=function(t,e){var n=this,r=zs;return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),hu.resolve(r)},Uh.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ws,i=new Zr(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.maybeDocument,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||s instanceof ki&&Ro(e,s)&&(r=r.insert(s.key,s))}return hu.resolve(r)},Uh.prototype.ps=function(t,e){return hu.forEach(this.docs,(function(t){return e(t)}))},Uh.prototype.newChangeBuffer=function(t){return new Nh(this)},Uh.prototype.getSize=function(t){return hu.resolve(this.size)},Uh),Nh=(o(Vh,Th=Ie),Vh.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i&&i.maybeDocument?n.push(e.Ve.addEntry(t,i.maybeDocument,e.getReadTime(r))):e.Ve.removeEntry(r)})),hu.waitFor(n)},Vh.prototype.getFromCache=function(t,e){return this.Ve.getEntry(t,e)},Vh.prototype.getAllFromCache=function(t,e){return this.Ve.getEntries(t,e)},Vh),Ch=(qh.prototype.forEachTarget=function(t,e){return this.Es.forEach((function(t,n){return e(n)})),hu.resolve()},qh.prototype.getLastRemoteSnapshotVersion=function(t){return hu.resolve(this.lastRemoteSnapshotVersion)},qh.prototype.getHighestSequenceNumber=function(t){return hu.resolve(this.Ts)},qh.prototype.allocateTargetId=function(t){return this.highestTargetId=this.As.next(),hu.resolve(this.highestTargetId)},qh.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ts&&(this.Ts=e),hu.resolve()},qh.prototype.re=function(t){this.Es.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.As=new gc(e),this.highestTargetId=e),t.sequenceNumber>this.Ts&&(this.Ts=t.sequenceNumber)},qh.prototype.addTargetData=function(t,e){return this.re(e),this.targetCount+=1,hu.resolve()},qh.prototype.updateTargetData=function(t,e){return this.re(e),hu.resolve()},qh.prototype.removeTargetData=function(t,e){return this.Es.delete(e.target),this.Is.os(e.targetId),--this.targetCount,hu.resolve()},qh.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.Es.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.Es.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),hu.waitFor(o).next((function(){return i}))},qh.prototype.getTargetCount=function(t){return hu.resolve(this.targetCount)},qh.prototype.getTargetData=function(t,e){e=this.Es.get(e)||null;return hu.resolve(e)},qh.prototype.addMatchingKeys=function(t,e,n){return this.Is.ns(e,n),hu.resolve()},qh.prototype.removeMatchingKeys=function(t,e,n){this.Is.rs(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),hu.waitFor(i)},qh.prototype.removeMatchingKeysForTargetId=function(t,e){return this.Is.os(e),hu.resolve()},qh.prototype.getMatchingKeysForTargetId=function(t,e){e=this.Is.us(e);return hu.resolve(e)},qh.prototype.containsKey=function(t,e){return hu.resolve(this.Is.containsKey(e))},qh),kh=(Fh.prototype.start=function(){return Promise.resolve()},Fh.prototype.shutdown=function(){return this.Le=!1,Promise.resolve()},Object.defineProperty(Fh.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),Fh.prototype.setDatabaseDeletedListener=function(){},Fh.prototype.setNetworkEnabled=function(){},Fh.prototype.getIndexManager=function(){return this.Gt},Fh.prototype.getMutationQueue=function(t){var e=this.Rs[t.toKey()];return e||(e=new Dh(this.Gt,this.referenceDelegate),this.Rs[t.toKey()]=e),e},Fh.prototype.getTargetCache=function(){return this.Ge},Fh.prototype.getRemoteDocumentCache=function(){return this.ze},Fh.prototype.getBundleCache=function(){return this.He},Fh.prototype.runTransaction=function(t,e,n){var r=this;Nr("MemoryPersistence","Starting transaction:",t);var i=new xh(this.Me.next());return this.referenceDelegate.vs(),n(i).next((function(t){return r.referenceDelegate.Ps(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},Fh.prototype.Vs=function(t,e){return hu.or(Object.values(this.Rs).map((function(n){return function(){return n.containsKey(t,e)}})))},Fh),xh=(o(Mh,Eh=d),Mh),Rh=(Ph.Cs=function(t){return new Ph(t)},Object.defineProperty(Ph.prototype,"xs",{get:function(){if(this.Ds)return this.Ds;throw Rr()},enumerable:!1,configurable:!0}),Ph.prototype.addReference=function(t,e,n){return this.Ss.addReference(n,e),this.xs.delete(n.toString()),hu.resolve()},Ph.prototype.removeReference=function(t,e,n){return this.Ss.removeReference(n,e),this.xs.add(n.toString()),hu.resolve()},Ph.prototype.markPotentiallyOrphaned=function(t,e){return this.xs.add(e.toString()),hu.resolve()},Ph.prototype.removeTarget=function(t,e){var n=this;this.Ss.os(e.targetId).forEach((function(t){return n.xs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.xs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},Ph.prototype.vs=function(){this.Ds=new Set},Ph.prototype.Ps=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return hu.forEach(this.xs,(function(r){var i=Zr.fromPath(r);return e.Ns(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Ds=null,n.apply(t)}))},Ph.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ns(t,e).next((function(t){t?n.xs.delete(e.toString()):n.xs.add(e.toString())}))},Ph.prototype.bs=function(t){return 0},Ph.prototype.Ns=function(t,e){var n=this;return hu.or([function(){return hu.resolve(n.Ss.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Vs(t,e)}])},Ph),Lh=(Oh.prototype.isAuthenticated=function(){return null!=this.uid},Oh.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Oh.prototype.isEqual=function(t){return t.uid===this.uid},Oh);function Oh(t){this.uid=t}function Ph(t){this.persistence=t,this.Ss=new _h,this.Ds=null}function Mh(t){var e=this;return(e=Eh.call(this)||this).currentSequenceNumber=t,e}function Fh(t,e){var n=this;this.Rs={},this.Me=new _r(0),this.Le=!1,this.Le=!0,this.referenceDelegate=t(this),this.Ge=new Ch(this),this.Gt=new $u,this.ze=(t=this.Gt,new Ah(t,(function(t){return n.referenceDelegate.bs(t)}))),this.D=new Ou(e),this.He=new Ih(this.D)}function qh(t){this.persistence=t,this.Es=new Pc(qi,Vi),this.lastRemoteSnapshotVersion=Oo.min(),this.highestTargetId=0,this.Ts=0,this.Is=new _h,this.targetCount=0,this.As=gc.ee()}function Vh(t){var e=this;return(e=Th.call(this)||this).Ve=t,e}function Uh(t,e){this.Gt=t,this.gs=e,this.docs=new Ms(Zr.comparator),this.size=0}function Bh(t,e){this.Gt=t,this.referenceDelegate=e,this.Tn=[],this.ls=1,this.fs=new Gs(Sh.Zn)}function jh(t,e){this.key=t,this.hs=e}function Gh(){this.Xn=new Gs(Sh.Zn),this.ts=new Gs(Sh.es)}function Kh(t){this.D=t,this.Jn=new Map,this.Yn=new Map}function zh(t,e){return"firestore_clients_"+t+"_"+e}function Qh(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(n+="_"+e.uid),n}function Hh(t,e){return"firestore_targets_"+t+"_"+e}Lh.UNAUTHENTICATED=new Lh(null),Lh.GOOGLE_CREDENTIALS=new Lh("google-credentials-uid"),Lh.FIRST_PARTY=new Lh("first-party-uid");var Wh,Yh=(ml.$s=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Yr(i.error.code,i.error.message)),o?new ml(t,e,i.state,r):(Cr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},ml.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},ml),Xh=(vl.$s=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new Yr(r.error.code,r.error.message)),i?new vl(t,r.state,n):(Cr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},vl.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},vl),Jh=(gl.$s=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=$s,o=0;r&&o<n.activeTargetIds.length;++o)r=Kr(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new gl(t,i):(Cr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},gl),$h=(yl.$s=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new yl(e.clientId,e.onlineState):(Cr("SharedClientState","Failed to parse online state: "+t),null)},yl),Zh=(pl.prototype.Os=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},pl.prototype.ks=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},pl.prototype.Fs=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},pl),tl=(dl.At=function(t){return!(!t||!t.localStorage)},dl.prototype.start=function(){return s(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,u,c,h,l=this;return a(this,(function(a){switch(a.label){case 0:return[4,this.syncEngine.gn()];case 1:for(o=a.sent(),t=0,e=o;t<e.length;t++)(n=e[t])!==this.Ms&&(r=this.getItem(zh(this.persistenceKey,n)))&&(i=Jh.$s(n,r))&&(this.qs=this.qs.insert(i.clientId,i));for(this.Js(),(o=this.storage.getItem(this.zs))&&(s=this.Ys(o))&&this.Xs(s),u=0,c=this.Us;u<c.length;u++)h=c[u],this.Bs(h);return this.Us=[],this.window.addEventListener("unload",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},dl.prototype.writeSequenceNumber=function(t){this.setItem(this.Ks,JSON.stringify(t))},dl.prototype.getAllActiveQueryTargets=function(){return this.Zs(this.qs)},dl.prototype.isActiveQueryTarget=function(t){var e=!1;return this.qs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},dl.prototype.addPendingMutation=function(t){this.ti(t,"pending")},dl.prototype.updateMutationState=function(t,e,n){this.ti(t,e,n),this.ei(t)},dl.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem(Hh(this.persistenceKey,t)))||(e=Xh.$s(t,e))&&(n=e.state)),this.ni.Os(t),this.Js(),n},dl.prototype.removeLocalQueryTarget=function(t){this.ni.ks(t),this.Js()},dl.prototype.isLocalQueryTarget=function(t){return this.ni.activeTargetIds.has(t)},dl.prototype.clearQueryState=function(t){this.removeItem(Hh(this.persistenceKey,t))},dl.prototype.updateQueryState=function(t,e,n){this.si(t,e,n)},dl.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.ei(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},dl.prototype.setOnlineState=function(t){this.ii(t)},dl.prototype.notifyBundleLoaded=function(){this.ri()},dl.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.Ls),this.removeItem(this.Qs),this.started=!1)},dl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Nr("SharedClientState","READ",t,e),e},dl.prototype.setItem=function(t,e){Nr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},dl.prototype.removeItem=function(t){Nr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},dl.prototype.Bs=function(t){var e=this,n=t;n.storageArea===this.storage&&(Nr("SharedClientState","EVENT",n.key,n.newValue),n.key!==this.Qs?this.Fe.enqueueRetryable((function(){return s(e,void 0,void 0,(function(){var t,e,r,i;return a(this,(function(o){if(this.started){if(null!==n.key)if(this.Ws.test(n.key)){if(null==n.newValue)return t=this.oi(n.key),[2,this.ci(t,null)];if(t=this.ai(n.key,n.newValue))return[2,this.ci(t.clientId,t)]}else if(this.js.test(n.key)){if(null!==n.newValue&&(e=this.ui(n.key,n.newValue)))return[2,this.hi(e)]}else if(this.Gs.test(n.key)){if(null!==n.newValue&&(r=this.li(n.key,n.newValue)))return[2,this.fi(r)]}else if(n.key===this.zs){if(null!==n.newValue&&(i=this.Ys(n.newValue)))return[2,this.Xs(i)]}else if(n.key===this.Ks)(i=function(t){var e=_r.o;if(null!=t)try{var n=JSON.parse(t);Lr("number"==typeof n),e=n}catch(t){Cr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==_r.o&&this.sequenceNumberHandler(i);else if(n.key===this.Hs)return[2,this.syncEngine.di()]}else this.Us.push(n);return[2]}))}))})):Cr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(dl.prototype,"ni",{get:function(){return this.qs.get(this.Ms)},enumerable:!1,configurable:!0}),dl.prototype.Js=function(){this.setItem(this.Qs,this.ni.Fs())},dl.prototype.ti=function(t,e,n){n=new Yh(this.currentUser,t,e,n),t=Qh(this.persistenceKey,this.currentUser,t);this.setItem(t,n.Fs())},dl.prototype.ei=function(t){t=Qh(this.persistenceKey,this.currentUser,t);this.removeItem(t)},dl.prototype.ii=function(t){t={clientId:this.Ms,onlineState:t};this.storage.setItem(this.zs,JSON.stringify(t))},dl.prototype.si=function(t,e,n){var r=Hh(this.persistenceKey,t),n=new Xh(t,e,n);this.setItem(r,n.Fs())},dl.prototype.ri=function(){this.setItem(this.Hs,"value-not-used")},dl.prototype.oi=function(t){t=this.Ws.exec(t);return t?t[1]:null},dl.prototype.ai=function(t,e){t=this.oi(t);return Jh.$s(t,e)},dl.prototype.ui=function(t,e){var n=this.js.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Yh.$s(new Lh(n),t,e)},dl.prototype.li=function(t,e){t=this.Gs.exec(t),t=Number(t[1]);return Xh.$s(t,e)},dl.prototype.Ys=function(t){return $h.$s(t)},dl.prototype.hi=function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.wi(t.batchId,t.state,t.error)]:(Nr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},dl.prototype.fi=function(t){return this.syncEngine._i(t.targetId,t.state,t.error)},dl.prototype.ci=function(t,e){var n=this,r=e?this.qs.insert(t,e):this.qs.remove(t),i=this.Zs(this.qs),o=this.Zs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.mi(s,a).then((function(){n.qs=r}))},dl.prototype.Xs=function(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},dl.prototype.Zs=function(t){var e=$s;return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},dl),el=(fl.prototype.addPendingMutation=function(t){},fl.prototype.updateMutationState=function(t,e,n){},fl.prototype.addLocalQueryTarget=function(t){return this.yi.Os(t),this.gi[t]||"not-current"},fl.prototype.updateQueryState=function(t,e,n){this.gi[t]=e},fl.prototype.removeLocalQueryTarget=function(t){this.yi.ks(t)},fl.prototype.isLocalQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},fl.prototype.clearQueryState=function(t){delete this.gi[t]},fl.prototype.getAllActiveQueryTargets=function(){return this.yi.activeTargetIds},fl.prototype.isActiveQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},fl.prototype.start=function(){return this.yi=new Zh,Promise.resolve()},fl.prototype.handleUserChange=function(t,e,n){},fl.prototype.setOnlineState=function(t){},fl.prototype.shutdown=function(){},fl.prototype.writeSequenceNumber=function(t){},fl.prototype.notifyBundleLoaded=function(){},fl),nl=(ll.prototype.pi=function(t){},ll.prototype.shutdown=function(){},ll),rl=(hl.prototype.pi=function(t){this.Ri.push(t)},hl.prototype.shutdown=function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ii)},hl.prototype.bi=function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ii)},hl.prototype.Ti=function(){Nr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(0)},hl.prototype.Ai=function(){Nr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(1)},hl.At=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},hl),il={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ol=(cl.prototype.Vi=function(t){this.Si=t},cl.prototype.Di=function(t){this.Ci=t},cl.prototype.onMessage=function(t){this.xi=t},cl.prototype.close=function(){this.Pi()},cl.prototype.send=function(t){this.vi(t)},cl.prototype.Ni=function(){this.Si()},cl.prototype.$i=function(t){this.Ci(t)},cl.prototype.Fi=function(t){this.xi(t)},cl),sl=(ul.prototype.Mi=function(t,e,n,r){var i=this.Li(t,e);Nr("RestConnection","Sending: ",i,n);e={};return this.Bi(e,r),this.qi(t,i,e,n).then((function(t){return Nr("RestConnection","Received: ",t),t}),(function(e){throw kr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},ul.prototype.Ui=function(t,e,n,r){return this.Mi(t,e,n,r)},ul.prototype.Bi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.1",t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},ul.prototype.Li=function(t,e){t=il[t];return this.Oi+"/v1/"+e+":"+t},o(al,Wh=ul),al.prototype.qi=function(t,e,n,r){return new Promise((function(i,o){var s=new Ir;s.listenOnce(mr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case vr.NO_ERROR:var e=s.getResponseJson();Nr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case vr.TIMEOUT:Nr("Connection",'RPC "'+t+'" timed out'),o(new Yr(Wr.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var n=s.getStatus();Nr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),0<n?(e=s.getResponseJson().error)&&e.status&&e.message?(n=e.status.toLowerCase().replace(/_/g,"-"),n=0<=Object.values(Wr).indexOf(n)?n:Wr.UNKNOWN,o(new Yr(n,e.message))):o(new Yr(Wr.UNKNOWN,"Server responded with status "+s.getStatus())):o(new Yr(Wr.UNAVAILABLE,"Connection failed."));break;default:Rr()}}finally{Nr("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},al.prototype.Qi=function(t,e){var n,r=[this.Oi,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new lr,o=gr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Bi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=y().indexOf("Electron/")||(0<=(n=y()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=y().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Nr("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new ol({vi:function(t){u?Nr("Connection","Not sending because WebChannel is closed:",t):(a||(Nr("Connection","Opening WebChannel transport."),s.open(),a=!0),Nr("Connection","WebChannel sending:",t),s.send(t))},Pi:function(){return s.close()}}),t=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return t(s,Tr.EventType.OPEN,(function(){u||Nr("Connection","WebChannel transport opened.")})),t(s,Tr.EventType.CLOSE,(function(){u||(u=!0,Nr("Connection","WebChannel transport closed"),c.$i())})),t(s,Tr.EventType.ERROR,(function(t){u||(u=!0,kr("Connection","WebChannel transport errored:",t),c.$i(new Yr(Wr.UNAVAILABLE,"The operation could not be completed")))})),t(s,Tr.EventType.MESSAGE,(function(t){var e,n,r,i;u||(Lr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Nr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=As[r];if(void 0!==t)return Ps(t)}(),i=n.message,void 0===t&&(t=Wr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.$i(new Yr(t,i)),s.close()):(Nr("Connection","WebChannel received:",e),c.Fi(e)))})),t(o,br.STAT_EVENT,(function(t){t.stat===wr?Nr("Connection","Detected buffering proxy"):t.stat===Er&&Nr("Connection","Detected no buffering proxy")})),setTimeout((function(){c.Ni()}),0),c},al);function al(t){var e=this;return(e=Wh.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e}function ul(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Oi=e+"://"+t.host,this.ki="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function cl(t){this.vi=t.vi,this.Pi=t.Pi}function hl(){var t=this;this.Ei=function(){return t.Ti()},this.Ii=function(){return t.Ai()},this.Ri=[],this.bi()}function ll(){}function fl(){this.yi=new Zh,this.gi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function dl(t,e,n,r,i){this.window=t,this.Fe=e,this.persistenceKey=n,this.Ms=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ls=this.Bs.bind(this),this.qs=new Ms(Mr),this.started=!1,this.Us=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=zh(this.persistenceKey,this.Ms),this.Ks="firestore_sequence_number_"+this.persistenceKey,this.qs=this.qs.insert(this.Ms,new Zh),this.Ws=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.js=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.Gs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.zs="firestore_online_state_"+this.persistenceKey,this.Hs="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.Ls)}function pl(){this.activeTargetIds=$s}function yl(t,e){this.clientId=t,this.onlineState=e}function gl(t,e){this.clientId=t,this.activeTargetIds=e}function vl(t,e,n){this.targetId=t,this.state=e,this.error=n}function ml(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function bl(){return"undefined"!=typeof window?window:null}function wl(){return"undefined"!=typeof document?document:null}function El(t){return new pa(t,!0)}function Tl(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.qr=[],this.Ur=new Map,this.Qr=new Set,this.Kr=[],this.Wr=i,this.Wr.pi((function(t){n.enqueueAndForget((function(){return s(o,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return zl(this)?(Nr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(e=t).Qr.add(4),[4,ql(e)];case 1:return n.sent(),e.jr.set("Unknown"),e.Qr.delete(4),[4,Fl(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.jr=new kl(n,r)}var Il,_l,Sl,Dl=(Ml.prototype.reset=function(){this.Gi=0},Ml.prototype.Ji=function(){this.Gi=this.ji},Ml.prototype.Yi=function(t){var e=this;this.cancel();var n=Math.floor(this.Gi+this.Xi()),r=Math.max(0,Date.now()-this.Hi),i=Math.max(0,n-r);0<i&&Nr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Gi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zi=this.Fe.enqueueAfterDelay(this.timerId,i,(function(){return e.Hi=Date.now(),t()})),this.Gi*=this.Wi,this.Gi<this.Ki&&(this.Gi=this.Ki),this.Gi>this.ji&&(this.Gi=this.ji)},Ml.prototype.Zi=function(){null!==this.zi&&(this.zi.skipDelay(),this.zi=null)},Ml.prototype.cancel=function(){null!==this.zi&&(this.zi.cancel(),this.zi=null)},Ml.prototype.Xi=function(){return(Math.random()-.5)*this.Gi},Ml),Ie=(Pl.prototype.cr=function(){return 1===this.state||2===this.state||4===this.state},Pl.prototype.ar=function(){return 2===this.state},Pl.prototype.start=function(){3!==this.state?this.auth():this.ur()},Pl.prototype.stop=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.cr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},Pl.prototype.hr=function(){this.state=0,this.rr.reset()},Pl.prototype.lr=function(){var t=this;this.ar()&&null===this.ir&&(this.ir=this.Fe.enqueueAfterDelay(this.tr,6e4,(function(){return t.dr()})))},Pl.prototype.wr=function(t){this._r(),this.stream.send(t)},Pl.prototype.dr=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return this.ar()?[2,this.close(0)]:[2]}))}))},Pl.prototype._r=function(){this.ir&&(this.ir.cancel(),this.ir=null)},Pl.prototype.close=function(t,e){return s(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==t?this.rr.reset():e&&e.code===Wr.RESOURCE_EXHAUSTED?(Cr(e.toString()),Cr("Using maximum backoff delay to prevent overloading the backend."),this.rr.Ji()):e&&e.code===Wr.UNAUTHENTICATED&&this.nr.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Di(e)];case 1:return n.sent(),[2]}}))}))},Pl.prototype.mr=function(){},Pl.prototype.auth=function(){var t=this;this.state=1;var e=this.yr(this.sr),n=this.sr;this.nr.getToken().then((function(e){t.sr===n&&t.gr(e)}),(function(n){e((function(){var e=new Yr(Wr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.pr(e)}))}))},Pl.prototype.gr=function(t){var e=this,n=this.yr(this.sr);this.stream=this.Er(t),this.stream.Vi((function(){n((function(){return e.state=2,e.listener.Vi()}))})),this.stream.Di((function(t){n((function(){return e.pr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},Pl.prototype.ur=function(){var t=this;this.state=4,this.rr.Yi((function(){return s(t,void 0,void 0,(function(){return a(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},Pl.prototype.pr=function(t){return Nr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Pl.prototype.yr=function(t){var e=this;return function(n){e.Fe.enqueueAndForget((function(){return e.sr===t?n():(Nr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},Pl),Al=(o(Ol,Sl=Ie),Ol.prototype.Er=function(t){return this.er.Qi("Listen",t)},Ol.prototype.onMessage=function(t){this.rr.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Rr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.V?(Lr(void 0===s||"string"==typeof s),ti.fromBase64String(s||"")):(Lr(void 0===s||s instanceof Uint8Array),ti.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Wr.UNKNOWN:Ps(c.code),new Yr(u,c.message||"")),s=new ra(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=Ea(t,n.document.name),i=va(n.document.updateTime),a=new Mo({mapValue:{fields:n.document.fields}}),u=(o=new ki(r,i,a,{}),n.targetIds||[]),c=n.removedTargetIds||[];s=new ea(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=Ea(t,n.document),i=n.readTime?va(n.readTime):Oo.min(),a=new xi(r,i),o=n.removedTargetIds||[],s=new ea([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=Ea(t,n.document),i=n.removedTargetIds||[],s=new ea([],i,r,null);else{if(!("filter"in e))return Rr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new Ds(n),i=e.targetId,s=new na(i,r)}return s}(this.D,t),t=function(t){if(!("targetChange"in t))return Oo.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?va(t.readTime):Oo.min()}(t);return this.listener.Tr(e,t)},Ol.prototype.Ir=function(t){var e,n,r,i={};i.database=_a(this.D),i.addTarget=(e=this.D,(r=Ui(r=(n=t).target)?{documents:ka(e,r)}:{query:xa(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=ga(e,n.resumeToken):0<n.snapshotVersion.compareTo(Oo.min())&&(r.readTime=ya(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.D,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Rr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.wr(i)},Ol.prototype.Ar=function(t){var e={};e.database=_a(this.D),e.removeTarget=t,this.wr(e)},Ol),Nl=(o(Ll,_l=Ie),Object.defineProperty(Ll.prototype,"br",{get:function(){return this.Rr},enumerable:!1,configurable:!0}),Ll.prototype.start=function(){this.Rr=!1,this.lastStreamToken=void 0,_l.prototype.start.call(this)},Ll.prototype.mr=function(){this.Rr&&this.vr([])},Ll.prototype.Er=function(t){return this.er.Qi("Write",t)},Ll.prototype.onMessage=function(t){if(Lr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Lr(void 0!==r),n.map((function(t){return n=r,(t=(e=t).updateTime?va(e.updateTime):va(n)).isEqual(Oo.min())&&(t=va(n)),new us(t,e.transformResults||[]);var e,n}))):[]),n=va(t.commitTime);return this.listener.Pr(n,e)}var n,r;return Lr(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()},Ll.prototype.Sr=function(){var t={};t.database=_a(this.D),this.wr(t)},Ll.prototype.vr=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map((function(t){return Na(e.D,t)}))};this.wr(t)},Ll),Cl=(o(Rl,Il=function(){}),Rl.prototype.Cr=function(){if(this.Dr)throw new Yr(Wr.FAILED_PRECONDITION,"The client has already been terminated.")},Rl.prototype.Mi=function(t,e,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.er.Mi(t,e,n,i)})).catch((function(t){throw t.code===Wr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},Rl.prototype.Ui=function(t,e,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.er.Ui(t,e,n,i)})).catch((function(t){throw t.code===Wr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},Rl.prototype.terminate=function(){this.Dr=!1},Rl),kl=(xl.prototype.Or=function(){var t=this;0===this.Nr&&(this.kr("Unknown"),this.$r=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.$r=null,t.Mr("Backend didn't respond within 10 seconds."),t.kr("Offline"),Promise.resolve()})))},xl.prototype.Lr=function(t){"Online"===this.state?this.kr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: "+t.toString()),this.kr("Offline")))},xl.prototype.set=function(t){this.Br(),this.Nr=0,"Online"===t&&(this.Fr=!1),this.kr(t)},xl.prototype.kr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},xl.prototype.Mr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fr?(Cr(t),this.Fr=!1):Nr("OnlineStateTracker",t)},xl.prototype.Br=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},xl);function xl(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.$r=null,this.Fr=!0}function Rl(t,e,n){var r=this;return(r=Il.call(this)||this).credentials=t,r.er=e,r.D=n,r.Dr=!1,r}function Ll(t,e,n,r,i){var o=this;return(o=_l.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).D=r,o.Rr=!1,o}function Ol(t,e,n,r,i){var o=this;return(o=Sl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).D=r,o}function Pl(t,e,n,r,i,o){this.Fe=t,this.tr=n,this.er=r,this.nr=i,this.listener=o,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new Dl(t,e)}function Ml(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Fe=t,this.timerId=e,this.Ki=n,this.Wi=r,this.ji=i,this.Gi=0,this.zi=null,this.Hi=Date.now(),this.reset()}function Fl(t){return s(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:if(!zl(t))return[3,4];e=0,n=t.Kr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function ql(t){return s(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:e=0,n=t.Kr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Vl(t,e){t.Ur.has(e.targetId)||(t.Ur.set(e.targetId,e),Kl(t)?Gl(t):tf(t).ar()&&Bl(t,e))}function Ul(t,e){var n=t,t=tf(n);n.Ur.delete(e),t.ar()&&jl(n,e),0===n.Ur.size&&(t.ar()?t.lr():zl(n)&&n.jr.set("Unknown"))}function Bl(t,e){t.Gr.H(e.targetId),tf(t).Ir(e)}function jl(t,e){t.Gr.H(e),tf(t).Ar(e)}function Gl(t){t.Gr=new oa({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},yt:function(e){return t.Ur.get(e)||null}}),tf(t).start(),t.jr.Or()}function Kl(t){return zl(t)&&!tf(t).cr()&&0<t.Ur.size}function zl(t){return 0===t.Qr.size}function Ql(t){t.Gr=void 0}function Hl(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:if(t.jr.set("Online"),!(e instanceof ra&&2===e.state&&e.cause))return[3,6];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Ur.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Ur.delete(o),t.Gr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return o.sent(),[3,5];case 3:return r=o.sent(),Nr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Wl(t,r)];case 4:return o.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof ea?t.Gr.st(e):e instanceof na?t.Gr.ht(e):t.Gr.ot(e),n.isEqual(Oo.min()))return[3,13];o.label=7;case 7:return o.trys.push([7,11,,13]),[4,fh(t.localStore)];case 8:return i=o.sent(),0<=n.compareTo(i)?[4,(c=n,(h=(u=t).Gr.dt(c)).targetChanges.forEach((function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=u.Ur.get(e))&&u.Ur.set(e,n.withResumeToken(t.resumeToken,c)))})),h.targetMismatches.forEach((function(t){var e=u.Ur.get(t);e&&(u.Ur.set(t,e.withResumeToken(ti.EMPTY_BYTE_STRING,e.snapshotVersion)),jl(u,t),e=new Lu(e.target,t,1,e.sequenceNumber),Bl(u,e))})),u.remoteSyncer.applyRemoteEvent(h))]:[3,10];case 9:o.sent(),o.label=10;case 10:return[3,13];case 11:return Nr("RemoteStore","Failed to raise snapshot:",i=o.sent()),[4,Wl(t,i)];case 12:return o.sent(),[3,13];case 13:return[2]}var u,c,h}))}))}function Wl(t,e,n){return s(this,void 0,void 0,(function(){var r=this;return a(this,(function(i){switch(i.label){case 0:if(!Eu(e))throw e;return t.Qr.add(1),[4,ql(t)];case 1:return i.sent(),t.jr.set("Offline"),n=n||function(){return fh(t.localStore)},t.asyncQueue.enqueueRetryable((function(){return s(r,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return Nr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Qr.delete(1),[4,Fl(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Yl(t,e){return e().catch((function(n){return Wl(t,n,e)}))}function Xl(t){return s(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){switch(o.label){case 0:n=ef(e=t),r=0<e.qr.length?e.qr[e.qr.length-1].batchId:-1,o.label=1;case 1:if(!(zl(e)&&e.qr.length<10))return[3,7];o.label=2;case 2:return o.trys.push([2,4,,6]),[4,(s=e.localStore,a=r,(u=s).persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===a&&(a=-1),u.Tn.getNextMutationBatchAfterBatchId(t,a)})))];case 3:return null===(i=o.sent())?(0===e.qr.length&&n.lr(),[3,7]):(r=i.batchId,function(t,e){t.qr.push(e);t=ef(t);t.ar()&&t.br&&t.vr(e.mutations)}(e,i),[3,6]);case 4:return i=o.sent(),[4,Wl(e,i)];case 5:return o.sent(),[3,6];case 6:return[3,1];case 7:return Jl(e)&&$l(e),[2]}var s,a,u}))}))}function Jl(t){return zl(t)&&!ef(t).cr()&&0<t.qr.length}function $l(t){ef(t).start()}function Zl(t,e){return s(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return n=t,e?(n.Qr.delete(2),[4,Fl(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Qr.add(2),[4,ql(n)]);case 3:r.sent(),n.jr.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function tf(t){var e,n,r,i=this;return t.zr||(t.zr=(e=t.datastore,n=t.asyncQueue,r={Vi:function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){return t.Ur.forEach((function(e,n){Bl(t,e)})),[2]}))}))}.bind(null,t),Di:function(t,e){return s(this,void 0,void 0,(function(){return a(this,(function(n){return Ql(t),Kl(t)?(t.jr.Lr(e),Gl(t)):t.jr.set("Unknown"),[2]}))}))}.bind(null,t),Tr:Hl.bind(null,t)},e.Cr(),new Al(n,e.er,e.credentials,e.D,r)),t.Kr.push((function(e){return s(i,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e?(t.zr.hr(),Kl(t)?Gl(t):t.jr.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.zr.stop()];case 2:n.sent(),Ql(t),n.label=3;case 3:return[2]}}))}))}))),t.zr}function ef(t){var e,n,r,i=this;return t.Hr||(t.Hr=(e=t.datastore,n=t.asyncQueue,r={Vi:function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){return ef(t).Sr(),[2]}))}))}.bind(null,t),Di:function(t,e){return s(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e&&ef(t).br?[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return Os(r=e.code)&&r!==Wr.ABORTED?(n=t.qr.shift(),ef(t).hr(),[4,Yl(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Xl(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Jl(t)&&$l(t),[2]}}))}))}.bind(null,t),Vr:function(t){return s(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){for(e=ef(t),n=0,r=t.qr;n<r.length;n++)i=r[n],e.vr(i.mutations);return[2]}))}))}.bind(null,t),Pr:function(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return r=t.qr.shift(),i=Ru.from(r,e,n),[4,Yl(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Xl(t)];case 2:return o.sent(),[2]}}))}))}.bind(null,t)},e.Cr(),new Nl(n,e.er,e.credentials,e.D,r)),t.Kr.push((function(e){return s(i,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e?(t.Hr.hr(),[4,Xl(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Hr.stop()];case 3:n.sent(),0<t.qr.length&&(Nr("RemoteStore","Stopping write stream with "+t.qr.length+" pending writes"),t.qr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Hr}var nf=(rf.createAndSchedule=function(t,e,n,r,i){i=new rf(t,e,Date.now()+n,r,i);return i.start(n),i},rf.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},rf.prototype.skipDelay=function(){return this.handleDelayElapsed()},rf.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Yr(Wr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},rf.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},rf.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},rf);function rf(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new cu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}function of(t,e){if(Cr("AsyncQueue",e+": "+t),Eu(t))return new Yr(Wr.UNAVAILABLE,e+": "+t);throw t}function sf(){this.queries=new Pc(ko,Co),this.onlineState="Unknown",this.Zr=new Set}var af=(df.emptySet=function(t){return new df(t.comparator)},df.prototype.has=function(t){return null!=this.keyedMap.get(t)},df.prototype.get=function(t){return this.keyedMap.get(t)},df.prototype.first=function(){return this.sortedSet.minKey()},df.prototype.last=function(){return this.sortedSet.maxKey()},df.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},df.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(df.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),df.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},df.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},df.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},df.prototype.isEqual=function(t){if(!(t instanceof df))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},df.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},df.prototype.copy=function(t,e){var n=new df;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},df),uf=(ff.prototype.track=function(t){var e=t.doc.key,n=this.Jr.get(e);!n||0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):Rr()},ff.prototype.Yr=function(){var t=[];return this.Jr.inorderTraversal((function(e,n){t.push(n)})),t},ff),cf=(lf.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:0,doc:t})})),new lf(t,e,af.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(lf.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),lf.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Co(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},lf),hf=function(){this.Xr=void 0,this.listeners=[]};function lf(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function ff(){this.Jr=new Ms(Zr.comparator)}function df(t){this.comparator=t?function(e,n){return t(e,n)||Zr.comparator(e.key,n.key)}:function(t,e){return Zr.comparator(t.key,e.key)},this.keyedMap=Ws,this.sortedSet=new Ms(this.comparator)}function pf(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:if(n=t,r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new hf),!i)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Xr=a.sent(),[3,4];case 3:return s=a.sent(),s=of(s,"Initialization of query '"+xo(e.query)+"' failed"),[2,void e.onError(s)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.eo(n.onlineState),o.Xr&&e.no(o.Xr)&&gf(n),[2]}}))}))}function yf(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){return n=t,r=e.query,i=!1,(o=n.queries.get(r))&&0<=(s=o.listeners.indexOf(e))&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function gf(t){t.Zr.forEach((function(t){t.next()}))}var vf=(_f.prototype.no=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new cf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.io?this.oo(t)&&(this.so.next(t),o=!0):this.co(t,this.onlineState)&&(this.ao(t),o=!0),this.ro=t,o},_f.prototype.onError=function(t){this.so.error(t)},_f.prototype.eo=function(t){this.onlineState=t;var e=!1;return this.ro&&!this.io&&this.co(this.ro,t)&&(this.ao(this.ro),e=!0),e},_f.prototype.co=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)},_f.prototype.oo=function(t){if(0<t.docChanges.length)return!0;var e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},_f.prototype.ao=function(t){t=cf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)},_f),mf=(If.prototype.ho=function(){return"metadata"in this.payload},If),bf=(Tf.prototype.Gn=function(t){return Ea(this.D,t)},Tf.prototype.zn=function(t){return t.metadata.exists?Aa(this.D,t.document,!1):new xi(this.Gn(t.metadata.name),this.Hn(t.metadata.readTime))},Tf.prototype.Hn=va,Tf),wf=(Ef.prototype.fo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},Ef.prototype.wo=function(t){for(var e=new Map,n=new bf(this.D),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Gn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Js()).add(s);e.set(c,h)}}return e},Ef.prototype.complete=function(){return s(this,void 0,void 0,(function(){var t,e,n,r;return a(this,(function(i){switch(i.label){case 0:return[4,function(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s,u,c,h,l,f,d,p;return a(this,(function(a){switch(a.label){case 0:for(i=t,o=Js(),s=zs,u=Ys,c=0,h=n;c<h.length;c++)l=h[c],f=e.Gn(l.metadata.name),l.document&&(o=o.add(f)),s=s.insert(f,e.zn(l)),u=u.insert(f,e.Hn(l.metadata.readTime));return d=i.Qn.newChangeBuffer({trackRemovals:!0}),[4,yh(i,Ao(wo(Xr.fromString("__bundle__/docs/"+r))))];case 1:return p=a.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return ph(t,d,s,Oo.min(),u).next((function(e){return d.apply(t),e})).next((function(e){return i.Ge.removeMatchingKeysForTargetId(t,p.targetId).next((function(){return i.Ge.addMatchingKeys(t,o,p.targetId)})).next((function(){return i.Kn.vn(t,e)}))}))}))]}}))}))}(this.localStore,new bf(this.D),this.documents,this.lo.id)];case 1:t=i.sent(),e=this.wo(this.documents),n=0,r=this.queries,i.label=2;case 2:return n<r.length?(r=r[n],[4,function(t,e,n){return void 0===n&&(n=Js()),s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return[4,yh(t,Ao(Hu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=t).persistence.runTransaction("Save named query","readwrite",(function(t){var o=va(e.readTime);if(0<=r.snapshotVersion.compareTo(o))return i.He.saveNamedQuery(t,e);o=r.withResumeToken(ti.EMPTY_BYTE_STRING,o);return i.Bn=i.Bn.insert(o.targetId,o),i.Ge.updateTargetData(t,o).next((function(){return i.Ge.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.Ge.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.He.saveNamedQuery(t,e)}))}))]}}))}))}(this.localStore,r,e.get(r.name))]):[3,5];case 3:i.sent(),i.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new th(Object.assign({},this.progress),t))]}}))}))},Ef);function Ef(t,e,n){this.lo=t,this.localStore=e,this.D=n,this.queries=[],this.documents=[],this.progress=Sf(t)}function Tf(t){this.D=t}function If(t,e){this.payload=t,this.byteLength=e}function _f(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}function Sf(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Df=function(t){this.key=t},Af=function(t){this.key=t},Nf=(Object.defineProperty(Lf.prototype,"To",{get:function(){return this._o},enumerable:!1,configurable:!0}),Lf.prototype.Io=function(t,e){var n=this,r=e?e.Ao:new uf,i=(e||this).Eo,o=(e||this).mutatedKeys,s=i,a=!1,u=Eo(this.query)&&i.size===this.query.limit?i.last():null,c=To(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=(l=e instanceof ki?e:null)&&(Ro(n.query,l)?l:null),f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),e=!1;h&&l?h.data().isEqual(l.data())?f!==d&&(r.track({type:3,doc:l}),e=!0):n.Ro(h,l)||(r.track({type:2,doc:l}),e=!0,(u&&0<n.po(l,u)||c&&n.po(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),e=!0):h&&!l&&(r.track({type:1,doc:h}),e=!0,(u||c)&&(a=!0)),e&&(o=l?(s=s.add(l),d?o.add(t):o.delete(t)):(s=s.delete(t),o.delete(t)))})),Eo(this.query)||To(this.query))for(;s.size>this.query.limit;){var h=Eo(this.query)?s.last():s.first(),s=s.delete(h.key),o=o.delete(h.key);r.track({type:1,doc:h})}return{Eo:s,Ao:r,Mn:a,mutatedKeys:o}},Lf.prototype.Ro=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},Lf.prototype.applyChanges=function(t,e,n){var r=this,i=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;var o=t.Ao.Yr();o.sort((function(t,e){return i=t.type,o=e.type,n(i)-n(o)||r.po(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Rr()}}var i,o})),this.bo(n);var s=e?this.vo():[],n=0===this.yo.size&&this.current?1:0,e=n!==this.mo;return this.mo=n,0!==o.length||e?{snapshot:new cf(this.query,t.Eo,i,o,t.mutatedKeys,0==n,e,!1),Po:s}:{Po:s}},Lf.prototype.eo=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new uf,mutatedKeys:this.mutatedKeys,Mn:!1},!1)):{Po:[]}},Lf.prototype.Vo=function(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations},Lf.prototype.bo=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._o=e._o.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e._o=e._o.delete(t)})),this.current=t.current)},Lf.prototype.vo=function(){var t=this;if(!this.current)return[];var e=this.yo;this.yo=Js(),this.Eo.forEach((function(e){t.Vo(e.key)&&(t.yo=t.yo.add(e.key))}));var n=[];return e.forEach((function(e){t.yo.has(e)||n.push(new Af(e))})),this.yo.forEach((function(t){e.has(t)||n.push(new Df(t))})),n},Lf.prototype.So=function(t){this._o=t.jn,this.yo=Js();t=this.Io(t.documents);return this.applyChanges(t,!0)},Lf.prototype.Do=function(){return cf.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)},Lf),Cf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},kf=function(t){this.key=t,this.Co=!1},xf=(Object.defineProperty(Rf.prototype,"isPrimaryClient",{get:function(){return!0===this.Uo},enumerable:!1,configurable:!0}),Rf);function Rf(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.xo={},this.No=new Pc(ko,Co),this.$o=new Map,this.Fo=new Set,this.Oo=new Ms(Zr.comparator),this.ko=new Map,this.Mo=new _h,this.Lo={},this.Bo=new Map,this.qo=gc.ne(),this.onlineState="Unknown",this.Uo=void 0}function Lf(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=Js(),this.mutatedKeys=Js(),this.po=Lo(t),this.Eo=new af(this.po)}function Of(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,u;return a(this,(function(c){switch(c.label){case 0:return t.Qo=function(e,n,r){return function(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o;return a(this,(function(s){switch(s.label){case 0:return(i=e.view.Io(n)).Mn?[4,vh(t.localStore,e.query,!1).then((function(t){t=t.documents;return e.view.Io(t,i)}))]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Kf(t,e.targetId,o.Po),o.snapshot)]}}))}))}(t,e,n,r)},[4,vh(t.localStore,e,!0)];case 1:return o=c.sent(),u=new Nf(e,o.jn),i=u.Io(o.documents),o=ta.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),o=u.applyChanges(i,t.isPrimaryClient,o),Kf(t,n,o.Po),u=new Cf(e,n,u),[2,(t.No.set(e,u),t.$o.has(n)?t.$o.get(n).push(e):t.$o.set(n,[e]),o.snapshot)]}}))}))}function Pf(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:i=Zf(t),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,(c=i.localStore,h=e,f=c,d=li.now(),p=h.reduce((function(t,e){return t.add(e.key)}),Js()),f.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return f.Kn.bn(t,p).next((function(e){l=e;for(var n,r=[],i=0,o=h;i<o.length;i++){var s=o[i],a=(n=s,a=l.get(s.key),function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof ki?e.field(o.field):void 0,s=zo(o.transform,s||null);null!=s&&(n=(null==n?new Fo:n).set(o.field,s))}return n?n.v():null}(n.fieldTransforms,a));null!=a&&r.push(new bs(s.key,a,function t(e){var n=[];return Ur(e.fields||{},(function(e,r){var i=new $r([e]);if(Di(r))if(0===(r=t(r.mapValue).fields).length)n.push(i);else for(var o=0,s=r;o<s.length;o++){var a=s[o];n.push(i.child(a))}else n.push(i)})),new Po(n)}(a.proto.mapValue),hs.exists(!0)))}return f.Tn.addMutationBatch(t,d,r,h)}))})).then((function(t){var e=t.applyToLocalDocumentSet(l);return{batchId:t.batchId,changes:e}})))];case 2:return r=o.sent(),i.sharedClientState.addPendingMutation(r.batchId),s=i,a=r.batchId,u=n,c=(c=(c=s.Lo[s.currentUser.toKey()])||new Ms(Mr)).insert(a,u),s.Lo[s.currentUser.toKey()]=c,[4,Qf(i,r.changes)];case 3:return o.sent(),[4,Xl(i.remoteStore)];case 4:return o.sent(),[3,6];case 5:return i=o.sent(),i=of(i,"Failed to persist write"),n.reject(i),[3,6];case 6:return[2]}var s,a,u,c,h,l,f,d,p}))}))}function Mf(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:n=t,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,dh(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){e=n.ko.get(e);e&&(Lr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.Co=!0:0<t.modifiedDocuments.size?Lr(e.Co):0<t.removedDocuments.size&&(Lr(e.Co),e.Co=!1))})),[4,Qf(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Ic(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Ff(t,e,n){var r,t=t;(t.isPrimaryClient&&0===n||!t.isPrimaryClient&&1===n)&&(r=[],t.No.forEach((function(t,n){n=n.view.eo(e);n.snapshot&&r.push(n.snapshot)})),function(t,e){t.onlineState=e;var n=!1;t.queries.forEach((function(t,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].eo(e)&&(n=!0)})),n&&gf(t)}(t.eventManager,e),r.length&&t.xo.Tr(r),t.onlineState=e,t.isPrimaryClient&&t.sharedClientState.setOnlineState(e))}function qf(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:r=t,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,(s=r.localStore,a=e,(u=s).persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u.Tn.lookupMutationBatch(t,a).next((function(n){return Lr(null!==n),e=n.keys(),u.Tn.removeMutationBatch(t,n)})).next((function(){return u.Tn.performConsistencyCheck(t)})).next((function(){return u.Kn.bn(t,e)}))})))];case 2:return i=o.sent(),Bf(r,e,n),Uf(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Qf(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ic(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}var s,a,u}))}))}function Vf(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:zl((n=t).remoteStore)||Nr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(s=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return s.Tn.getHighestUnacknowledgedBatchId(t)}))];case 2:return-1===(r=o.sent())?[2,void e.resolve()]:((i=n.Bo.get(r)||[]).push(e),n.Bo.set(r,i),[3,4]);case 3:return i=o.sent(),i=of(i,"Initialization of waitForPendingWrites() operation failed"),e.reject(i),[3,4];case 4:return[2]}var s}))}))}function Uf(t,e){(t.Bo.get(e)||[]).forEach((function(t){t.resolve()})),t.Bo.delete(e)}function Bf(t,e,n){var r=t,i=r.Lo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i)}function jf(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.$o.get(e);r<i.length;r++){var o=i[r];t.No.delete(o),n&&t.xo.Ko(o,n)}t.$o.delete(e),t.isPrimaryClient&&t.Mo.os(e).forEach((function(e){t.Mo.containsKey(e)||Gf(t,e)}))}function Gf(t,e){t.Fo.delete(e.path.canonicalString());var n=t.Oo.get(e);null!==n&&(Ul(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.ko.delete(n),zf(t))}function Kf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof Df?(t.Mo.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Oo.get(o)||r.Fo.has(i)||(Nr("SyncEngine","New document in limbo: "+o),r.Fo.add(i),zf(r))):u instanceof Af?(Nr("SyncEngine","Document no longer in limbo: "+u.key),t.Mo.removeReference(u.key,e),t.Mo.containsKey(u.key)||Gf(t,u.key)):Rr()}}function zf(t){for(;0<t.Fo.size&&t.Oo.size<t.maxConcurrentLimboResolutions;){var e=t.Fo.values().next().value;t.Fo.delete(e);var n=new Zr(Xr.fromString(e)),e=t.qo.next();t.ko.set(e,new kf(n)),t.Oo=t.Oo.insert(n,e),Vl(t.remoteStore,new Lu(Ao(wo(n.path)),e,2,_r.o))}}function Qf(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,u;return a(this,(function(c){switch(c.label){case 0:return i=[],o=[],u=[],(r=t).No.isEmpty()?[3,3]:(r.No.forEach((function(t,s){u.push(r.Qo(s,e,n).then((function(t){t&&(r.isPrimaryClient&&r.sharedClientState.updateQueryState(s.targetId,t.fromCache?"not-current":"current"),i.push(t),t=nh.Nn(s.targetId,t),o.push(t))})))})),[4,Promise.all(u)]);case 1:return c.sent(),r.xo.Tr(i),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:n=t,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return hu.forEach(e,(function(e){return hu.forEach(e.Cn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return hu.forEach(e.xn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return a.sent(),[3,4];case 3:if(!Eu(r=a.sent()))throw r;return Nr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)c=o[i],s=c.targetId,c.fromCache||(u=n.Bn.get(s),c=u.snapshotVersion,c=u.withLastLimboFreeSnapshotVersion(c),n.Bn=n.Bn.insert(s,c));return[2]}}))}))}(r.localStore,o)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Hf(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return(n=t).currentUser.isEqual(e)?[3,3]:(Nr("SyncEngine","User change. New user:",e.toKey()),[4,hh(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).Bo.forEach((function(t){t.forEach((function(t){t.reject(new Yr(Wr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Bo.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Qf(n,r.Wn)];case 2:i.sent(),i.label=3;case 3:return[2]}var o}))}))}function Wf(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o;return a(this,(function(s){switch(s.label){case 0:return[4,(a=(i=t).localStore,u=e,h=(c=a).Tn,c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.Jt(t,u).next((function(e){return e?c.Kn.bn(t,e):hu.resolve(null)}))})))];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Xl(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Bf(i,e,r||null),Uf(i,e),i.localStore.Tn.Xt(e)):Rr(),s.label=4;case 4:return[4,Qf(i,o)];case 5:return s.sent(),[3,7];case 6:Nr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}var a,u,c,h}))}))}function Yf(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,h;return a(this,(function(a){switch(a.label){case 0:return $f(n=t),Zf(n),!0!==e||!0===n.Uo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Xf(n,r.toArray())]);case 1:return i=a.sent(),n.Uo=!0,[4,Zl(n.remoteStore,!0)];case 2:for(a.sent(),o=0,s=i;o<s.length;o++)u=s[o],Vl(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.Uo?[3,7]:(c=[],h=Promise.resolve(),n.$o.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return jf(n,e),gh(n.localStore,e,!0)})),Ul(n.remoteStore,e)})),[4,h]);case 4:return a.sent(),[4,Xf(n,c)];case 5:return a.sent(),(l=n).ko.forEach((function(t,e){Ul(l.remoteStore,e)})),l.Mo.cs(),l.ko=new Map,l.Oo=new Ms(Zr.comparator),n.Uo=!1,[4,Zl(n.remoteStore,!1)];case 6:a.sent(),a.label=7;case 7:return[2]}var l}))}))}function Xf(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,u,c,h,l,f,d,p,y;return a(this,(function(g){switch(g.label){case 0:n=t,r=[],i=[],o=0,u=e,g.label=1;case 1:return o<u.length?(c=u[o],h=void 0,(l=n.$o.get(c))&&0!==l.length?[4,yh(n.localStore,Ao(l[0]))]:[3,7]):[3,13];case 2:h=g.sent(),f=0,d=l,g.label=3;case 3:return f<d.length?(p=d[f],p=n.No.get(p),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return[4,vh((n=t).localStore,e.query,!0)];case 1:return r=i.sent(),r=e.view.So(r),[2,(n.isPrimaryClient&&Kf(n,e.targetId,r.Po),r)]}}))}))}(n,p)]):[3,6];case 4:(p=g.sent()).snapshot&&i.push(p.snapshot),g.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,mh(n.localStore,c)];case 8:return y=g.sent(),[4,yh(n.localStore,y)];case 9:return h=g.sent(),[4,Of(n,Jf(y),c,!1)];case 10:g.sent(),g.label=11;case 11:r.push(h),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.xo.Tr(i),r)]}}))}))}function Jf(t){return bo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function $f(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=Mf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.ko.get(e))&&t.Co)return Js().add(t.key);var r=Js();if(!(e=n.$o.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.No.get(s),r=r.unionWith(s.view.To);return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return(r=t).sharedClientState.updateQueryState(e,"rejected",n),s=r.ko.get(e),(i=s&&s.key)?(o=(o=new Ms(Zr.comparator)).insert(i,new xi(i,Oo.min())),s=Js().add(i),s=new Zs(Oo.min(),new Map,new Gs(Mr),o,s),[4,Mf(r,s)]):[3,2];case 1:return a.sent(),r.Oo=r.Oo.remove(i),r.ko.delete(e),zf(r),[3,4];case 2:return[4,gh(r.localStore,e,!1).then((function(){return jf(r,e,n)})).catch(Ic)];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))}.bind(null,t),t.xo.Tr=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].no(s)&&(r=!0);a.Xr=s}}r&&gf(n)}.bind(null,t.eventManager),t.xo.Ko=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function Zf(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:n=t,r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,lh(n.localStore,e)];case 2:return i=o.sent(),Bf(n,r,null),Uf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Qf(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ic(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=qf.bind(null,t),t}function td(t,e,n){var r=t;!function(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=a.sent(),[4,(l=t.localStore,d=l,p=va((f=r).createTime),d.persistence.runTransaction("hasNewerBundle","readonly",(function(t){return d.He.getBundleMetadata(t,f.id)})).then((function(t){return!!t&&0<=t.createTime.compareTo(p)})))];case 2:return a.sent()?[4,e.close()]:[3,4];case 3:return[2,(a.sent(),void n._completeWith({taskState:"Success",documentsLoaded:r.totalDocuments,bytesLoaded:r.totalBytes,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}))];case 4:return n._updateProgress(Sf(r)),i=new wf(r,t.localStore,e.D),[4,e.Wo()];case 5:o=a.sent(),a.label=6;case 6:return o?[4,i.fo(o)]:[3,10];case 7:return(s=a.sent())&&n._updateProgress(s),[4,e.Wo()];case 8:o=a.sent(),a.label=9;case 9:return[3,6];case 10:return[4,i.complete()];case 11:return u=a.sent(),[4,Qf(t,u.En,void 0)];case 12:return a.sent(),[4,(l=t.localStore,c=r,(h=l).persistence.runTransaction("Save bundle","readwrite",(function(t){return h.He.saveBundleMetadata(t,c)})))];case 13:return a.sent(),n._completeWith(u.progress),[3,15];case 14:return kr("SyncEngine","Loading bundle failed with "+(u=a.sent())),n._failWith(u),[3,15];case 15:return[2]}var c,h,l,f,d,p}))}))}(r,e,n).then((function(){r.sharedClientState.notifyBundleLoaded()}))}var ed,nd,rd=(hd.prototype.initialize=function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.D=El(t.databaseInfo.databaseId),this.sharedClientState=this.jo(t),this.persistence=this.Go(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.zo(t),this.localStore=this.Ho(t),[2]}}))}))},hd.prototype.zo=function(t){return null},hd.prototype.Ho=function(t){return ch(this.persistence,new rh,t.initialUser,this.D)},hd.prototype.Go=function(t){return new kh(Rh.Cs,this.D)},hd.prototype.jo=function(t){return new el},hd.prototype.terminate=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},hd),id=(o(cd,nd=rd),cd.prototype.initialize=function(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,nd.prototype.initialize.call(this,t)];case 1:return e.sent(),[4,wh(this.localStore)];case 2:return e.sent(),[4,this.Jo.initialize(this,t)];case 3:return e.sent(),[4,Zf(this.Jo.syncEngine)];case 4:return e.sent(),[4,Xl(this.Jo.remoteStore)];case 5:return e.sent(),[2]}}))}))},cd.prototype.Ho=function(t){return ch(this.persistence,new rh,t.initialUser,this.D)},cd.prototype.zo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Dc(e,t.asyncQueue)},cd.prototype.Go=function(t){var e=Zc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?sc.withCacheSize(this.cacheSizeBytes):sc.DEFAULT;return new Yc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,bl(),wl(),this.D,this.sharedClientState,!!this.forceOwnership)},cd.prototype.jo=function(t){return new el},cd),od=(o(ud,ed=id),ud.prototype.initialize=function(t){return s(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return[4,ed.prototype.initialize.call(this,t)];case 1:return r.sent(),e=this.Jo.syncEngine,this.sharedClientState instanceof tl?(this.sharedClientState.syncEngine={wi:Wf.bind(null,e),_i:function(t,e,n,r){return s(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(a){switch(a.label){case 0:return(i=t).Uo?(Nr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.$o.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,bh(i.localStore)];case 3:return o=a.sent(),s=Zs.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Qf(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,gh(i.localStore,e,!0)];case 6:return a.sent(),jf(i,e,r),[3,8];case 7:Rr(),a.label=8;case 8:return[2]}}))}))}.bind(null,e),mi:function(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o,s,u,c,h,l;return a(this,(function(f){switch(f.label){case 0:if(!(r=$f(t)).Uo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?(o=o[i],r.$o.has(o)?(Nr("SyncEngine","Adding an already active target "+o),[3,5]):[4,mh(r.localStore,o)]):[3,6];case 2:return s=f.sent(),[4,yh(r.localStore,s)];case 3:return u=f.sent(),[4,Of(r,Jf(s),u.targetId,!1)];case 4:f.sent(),Vl(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return a(this,(function(e){switch(e.label){case 0:return r.$o.has(t)?[4,gh(r.localStore,t,!1).then((function(){Ul(r.remoteStore,t),jf(r,t)})).catch(Ic)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?(l=l[h],[5,c(l)]):[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}.bind(null,e),gn:function(t){return t.localStore.persistence.gn()}.bind(null,e),di:function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){return[2,bh((e=t).localStore).then((function(t){return Qf(e,t)}))]}))}))}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[4,this.persistence.en((function(t){return s(n,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,Yf(this.Jo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return r.sent(),[2]}}))}))},ud.prototype.jo=function(t){var e=bl();if(!tl.At(e))throw new Yr(Wr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Zc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new tl(e,t.asyncQueue,n,t.clientId,t.initialUser)},ud),sd=(ad.prototype.initialize=function(t,e){return s(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Ff(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Hf.bind(null,this.syncEngine),[4,Zl(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},ad.prototype.createEventManager=function(t){return new sf},ad.prototype.createDatastore=function(t){var e=El(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new sl(n));return t=t.credentials,new Cl(t,n,e)},ad.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return Ff(e.syncEngine,t,0)},t=new(rl.At()?rl:nl);return new Tl(n,r,i,o,t)},ad.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new xf(t,e,n,r,i,o);return s&&(o.Uo=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},ad.prototype.terminate=function(){return function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=t,Nr("RemoteStore","RemoteStore shutting down."),e.Qr.add(5),[4,ql(e)];case 1:return n.sent(),e.Wr.shutdown(),e.jr.set("Unknown"),[2]}}))}))}(this.remoteStore)},ad);function ad(){}function ud(t,e){var n=this;return(n=ed.call(this,t,e,!1)||this).Jo=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function cd(t,e,n){var r=this;return(r=nd.call(this)||this).Jo=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function hd(){this.synchronizeTabs=!1}function ld(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return s(this,void 0,void 0,(function(){var r;return a(this,(function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]}))}))},cancel:function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return[2]}))}))},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var fd=(Ed.prototype.next=function(t){this.observer.next&&this.Yo(this.observer.next,t)},Ed.prototype.error=function(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Ed.prototype.Xo=function(){this.muted=!0},Ed.prototype.Yo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Ed),dd=(wd.prototype.close=function(){return this.Zo.cancel()},wd.prototype.getMetadata=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){return[2,this.metadata.promise]}))}))},wd.prototype.Wo=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.ec())]}}))}))},wd.prototype.ec=function(){return s(this,void 0,void 0,(function(){var t,e,n;return a(this,(function(r){switch(r.label){case 0:return[4,this.nc()];case 1:return null===(t=r.sent())?[2,null]:(n=this.tc.decode(t),e=Number(n),isNaN(e)&&this.sc("length string ("+n+") is not valid number"),[4,this.ic(e)]);case 2:return n=r.sent(),[2,new mf(JSON.parse(n),t.length+e)]}}))}))},wd.prototype.rc=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},wd.prototype.nc=function(){return s(this,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return this.rc()<0?[4,this.oc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.rc())<0&&this.sc("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},wd.prototype.ic=function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.oc()]:[3,3];case 1:n.sent()&&this.sc("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.tc.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},wd.prototype.sc=function(t){throw this.Zo.cancel(),new Error("Invalid bundle format: "+t)},wd.prototype.oc=function(){return s(this,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return[4,this.Zo.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))},wd),pd=(bd.prototype.lookup=function(t){return s(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Yr(Wr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return r=_a((n=t).D)+"/documents",i={documents:e.map((function(t){return wa(n.D,t)}))},[4,n.Ui("BatchGetDocuments",r,i)];case 1:return i=a.sent(),o=new Map,i.forEach((function(t){var e,t=(e=n.D,"found"in(t=t)?function(t,e){Lr(!!e.found),e.found.name,e.found.updateTime;var n=Ea(t,e.found.name),t=va(e.found.updateTime),e=new Mo({mapValue:{fields:e.found.fields}});return new ki(n,t,e,{})}(e,t):"missing"in t?function(t,e){Lr(!!e.missing),Lr(!!e.readTime);t=Ea(t,e.missing),e=va(e.readTime);return new xi(t,e)}(e,t):Rr());o.set(t.key.toString(),t)})),s=[],[2,(e.forEach((function(t){t=o.get(t.toString());Lr(!!t),s.push(t)})),s)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof xi||t instanceof ki?n.recordVersion(t):Rr()})),e)]}}))}))},bd.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},bd.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},bd.prototype.delete=function(t){this.write(new ks(t,this.precondition(t))),this.writtenDocs.add(t.toString())},bd.prototype.commit=function(){return s(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){n=Zr.fromPath(n);e.mutations.push(new xs(n,e.precondition(n)))})),[4,function(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return r=_a((n=t).D)+"/documents",i={writes:e.map((function(t){return Na(n.D,t)}))},[4,n.Mi("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},bd.prototype.recordVersion=function(t){var e;if(t instanceof ki)e=t.version;else{if(!(t instanceof xi))throw Rr();e=Oo.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Yr(Wr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},bd.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?hs.updateTime(e):hs.none()},bd.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return hs.exists(!0);if(e.isEqual(Oo.min()))throw new Yr(Wr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return hs.updateTime(e)},bd.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},bd.prototype.ensureCommitNotCalled=function(){},bd),yd=(md.prototype.run=function(){this.ac()},md.prototype.ac=function(){var t=this;this.rr.Yi((function(){return s(t,void 0,void 0,(function(){var t,e,n=this;return a(this,(function(r){return t=new pd(this.datastore),(e=this.uc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.hc(t)}))}))})).catch((function(t){n.hc(t)})),[2]}))}))}))},md.prototype.uc=function(t){try{var e=this.updateFunction(t);return!jr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},md.prototype.hc=function(t){var e=this;0<this.cc&&this.lc(t)?(--this.cc,this.asyncQueue.enqueueAndForget((function(){return e.ac(),Promise.resolve()}))):this.deferred.reject(t)},md.prototype.lc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Os(t)},md),gd=(vd.prototype.getConfiguration=function(){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},vd.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},vd.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Yr(Wr.FAILED_PRECONDITION,"The client has already been terminated.")},vd.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new cu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return s(t,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:n.sent(),n.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=n.sent(),t=of(t,"Failed to shutdown persistence"),e.reject(t),[3,6];case 6:return[2]}}))}))})),e.promise},vd);function vd(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Lh.UNAUTHENTICATED,this.clientId=Or.u(),this.credentialListener=function(){},this.receivedInitialUser=new cu,this.credentials.setChangeListener((function(t){Nr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}function md(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.cc=5,this.rr=new Dl(this.asyncQueue,"transaction_retry")}function bd(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function wd(t,e){var n=this;this.Zo=t,this.D=e,this.metadata=new cu,this.buffer=new Uint8Array,this.tc=new TextDecoder("utf-8"),this.ec().then((function(t){t&&t.ho()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}function Ed(t){this.observer=t,this.muted=!1}function Td(t,e){return s(this,void 0,void 0,(function(){var n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Nr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return s(i,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,hh(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Id(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,_d(t)];case 1:return n=i.sent(),Nr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return s(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return(n=t).asyncQueue.verifyOperationInProgress(),Nr("RemoteStore","RemoteStore received new credentials"),r=zl(n),n.Qr.add(3),[4,ql(n)];case 1:return i.sent(),r&&n.jr.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Qr.delete(3),[4,Fl(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function _d(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Nr("FirestoreClient","Using default OfflineComponentProvider"),[4,Td(t,new rd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function Sd(t){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Nr("FirestoreClient","Using default OnlineComponentProvider"),[4,Id(t,new sd)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function Dd(t){return _d(t).then((function(t){return t.persistence}))}function Ad(t){return _d(t).then((function(t){return t.localStore}))}function Nd(t){return Sd(t).then((function(t){return t.remoteStore}))}function Cd(t){return Sd(t).then((function(t){return t.syncEngine}))}function kd(t){return s(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,Sd(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=function(t,e){return s(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(a){switch(a.label){case 0:return n=$f(t),(s=n.No.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do(),[3,4]):[3,1];case 1:return[4,yh(n.localStore,Ao(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.targetId,[4,Of(n,e,r,"current"===s)];case 3:i=a.sent(),n.isPrimaryClient&&Vl(n.remoteStore,o),a.label=4;case 4:return[2,i]}}))}))}.bind(null,e.syncEngine),n.onUnlisten=function(t,e){return s(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return r=(n=t).No.get(e),1<(i=n.$o.get(r.targetId)).length?[2,(n.$o.set(r.targetId,i.filter((function(t){return!Co(t,e)}))),void n.No.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,gh(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Ul(n.remoteStore,r.targetId),jf(n,r.targetId)})).catch(Ic)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return jf(n,r.targetId),[4,gh(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}.bind(null,e.syncEngine),n)]}}))}))}function xd(t,e,n){var r=this;void 0===n&&(n={});var i=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(r,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new fd({next:function(o){e.enqueueAndForget((function(){return yf(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Yr(Wr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Yr(Wr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new vf(wo(n.path),o,{includeMetadataChanges:!0,uo:!0});return pf(t,s)},[4,kd(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function Rd(t,e,n){var r=this;void 0===n&&(n={});var i=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(r,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new fd({next:function(n){e.enqueueAndForget((function(){return yf(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Yr(Wr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new vf(n,o,{includeMetadataChanges:!0,uo:!0});return pf(t,s)},[4,kd(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function Ld(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var Od=function(t,e,n,r,i,o){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},Pd=(Object.defineProperty(zd.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),zd.prototype.isEqual=function(t){return t instanceof zd&&t.projectId===this.projectId&&t.database===this.database},zd),Md=new Map,Fd=(Kd.prototype.getToken=function(){return Promise.resolve(null)},Kd.prototype.invalidateToken=function(){},Kd.prototype.setChangeListener=function(t){(this.changeListener=t)(Lh.UNAUTHENTICATED)},Kd.prototype.removeChangeListener=function(){this.changeListener=null},Kd),qd=(Gd.prototype.getToken=function(){var t=this,e=this.dc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.dc!==e?(Nr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Lr("string"==typeof n.accessToken),new Ld(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},Gd.prototype.invalidateToken=function(){this.forceRefresh=!0},Gd.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},Gd.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.fc),this.fc=null,this.changeListener=null},Gd.prototype.wc=function(){var t=this.auth&&this.auth.getUid();return Lr(null===t||"string"==typeof t),new Lh(t)},Gd),Vd=(Object.defineProperty(jd.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.mc},e=this._c.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),jd),Ud=(Bd.prototype.getToken=function(){return Promise.resolve(new Vd(this._c,this.mc))},Bd.prototype.setChangeListener=function(t){t(Lh.FIRST_PARTY)},Bd.prototype.removeChangeListener=function(){},Bd.prototype.invalidateToken=function(){},Bd);function Bd(t,e){this._c=t,this.mc=e}function jd(t,e){this._c=t,this.mc=e,this.type="FirstParty",this.user=Lh.FIRST_PARTY}function Gd(t){var e=this;this.fc=null,this.currentUser=Lh.UNAUTHENTICATED,this.receivedInitialUser=!1,this.dc=0,this.changeListener=null,this.forceRefresh=!1,this.fc=function(){e.dc++,e.currentUser=e.wc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.dc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.fc):(this.fc(null),t.get().then((function(t){e.auth=t,e.fc&&e.auth.addAuthTokenListener(e.fc)}),(function(){})))}function Kd(){this.changeListener=null}function zd(t,e){this.projectId=t,this.database=e||"(default)"}function Qd(t,e,n){if(!n)throw new Yr(Wr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Hd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Wd(t,e,n,r){if(!0===e&&!0===r)throw new Yr(Wr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Yd(t){if(!Zr.isDocumentKey(t))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Xd(t){if(Zr.isDocumentKey(t))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Jd(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Rr();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?"a custom "+e+" object":"an object"}function $d(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Yr(Wr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=Jd(t);throw new Yr(Wr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function Zd(t,e){if(e<=0)throw new Yr(Wr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var tp,ep=(lp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},lp),np=(Object.defineProperty(hp.prototype,"app",{get:function(){if(!this._app)throw new Yr(Wr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(hp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(hp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),hp.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Yr(Wr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ep(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Fd;switch(t.type){case"gapi":var e=t.client;return Lr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ud(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Yr(Wr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},hp.prototype._getSettings=function(){return this._settings},hp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},hp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},hp.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},hp.prototype._terminate=function(){return(t=Md.get(this))&&(Nr("ComponentProvider","Removing Datastore"),Md.delete(this),t.terminate()),Promise.resolve();var t},hp),rp=function(t){this._delegate=t},ip=(Object.defineProperty(cp.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"parent",{get:function(){return new sp(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),cp.prototype.withConverter=function(t){return new cp(this.firestore,t,this._key)},cp),op=(up.prototype.withConverter=function(t){return new up(this.firestore,t,this._query)},up),sp=(o(ap,tp=op),Object.defineProperty(ap.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(ap.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(ap.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new ip(this.firestore,null,new Zr(t))},enumerable:!1,configurable:!0}),ap.prototype.withConverter=function(t){return new ap(this.firestore,t,this._path)},ap);function ap(t,e,n){var r=this;return(r=tp.call(this,t,e,wo(n))||this).firestore=t,r._path=n,r.type="collection",r}function up(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}function cp(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}function hp(t,e){this._persistenceKey="(lite)",this._settings=new ep({}),this._settingsFrozen=!1,t instanceof Pd?(this._databaseId=t,this._credentials=new Fd):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Yr(Wr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pd(t.options.projectId)}(t),this._credentials=new qd(e))}function lp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Yr(Wr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Yr(Wr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Wd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function fp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof rp&&(t=t._delegate),Qd("collection","path",e),t instanceof np)return Xd(n=Xr.fromString.apply(Xr,u([e],r))),new sp(t,null,n);if(!(t instanceof ip||t instanceof sp))throw new Yr(Wr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Xd(n=Xr.fromString.apply(Xr,u([t.path],r)).child(Xr.fromString(e))),new sp(t.firestore,null,n)}function dp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof rp&&(t=t._delegate),Qd("doc","path",e=1===arguments.length?Or.u():e),t instanceof np)return Yd(n=Xr.fromString.apply(Xr,u([e],r))),new ip(t,null,new Zr(n));if(!(t instanceof ip||t instanceof sp))throw new Yr(Wr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Yd(n=t._path.child(Xr.fromString.apply(Xr,u([e],r)))),new ip(t.firestore,t instanceof sp?t._converter:null,new Zr(n))}function pp(t,e){return t instanceof rp&&(t=t._delegate),e instanceof rp&&(e=e._delegate),(t instanceof ip||t instanceof sp)&&(e instanceof ip||e instanceof sp)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function yp(t,e){return t instanceof rp&&(t=t._delegate),e instanceof rp&&(e=e._delegate),t instanceof op&&e instanceof op&&t.firestore===e.firestore&&Co(t._query,e._query)&&t._converter===e._converter}var gp=(Object.defineProperty(vp.prototype,"isShuttingDown",{get:function(){return this.Ec},enumerable:!1,configurable:!0}),vp.prototype.enqueueAndForget=function(t){this.enqueue(t)},vp.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.vc(),this.Pc(t)},vp.prototype.enterRestrictedMode=function(){var t;this.Ec||(this.Ec=!0,(t=wl())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc))},vp.prototype.enqueue=function(t){return this.vc(),this.Ec?new Promise((function(t){})):this.Pc(t)},vp.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.gc.push(t),e.Vc()}))},vp.prototype.Vc=function(){return s(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(0===this.gc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.gc[0]()];case 2:return n.sent(),this.gc.shift(),this.rr.reset(),[3,4];case 3:if(!Eu(t=n.sent()))throw t;return Nr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:0<this.gc.length&&this.rr.Yi((function(){return e.Vc()})),n.label=5;case 5:return[2]}}))}))},vp.prototype.Pc=function(t){var e=this,n=this.yc.then((function(){return e.Ac=!0,t().catch((function(t){throw e.Ic=t,e.Ac=!1,Cr("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",r=n.stack?n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack:r)),t;var n,r})).then((function(t){return e.Ac=!1,t}))}));return this.yc=n},vp.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.vc(),-1<this.Rc.indexOf(t)&&(e=0);n=nf.createAndSchedule(this,t,e,n,(function(t){return r.Sc(t)}));return this.Tc.push(n),n},vp.prototype.vc=function(){this.Ic&&Rr()},vp.prototype.verifyOperationInProgress=function(){},vp.prototype.Dc=function(){return s(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,t=this.yc];case 1:e.sent(),e.label=2;case 2:if(t!==this.yc)return[3,0];e.label=3;case 3:return[2]}}))}))},vp.prototype.Cc=function(t){for(var e=0,n=this.Tc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},vp.prototype.xc=function(t){var e=this;return this.Dc().then((function(){e.Tc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.Tc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Dc()}))},vp.prototype.Nc=function(t){this.Rc.push(t)},vp.prototype.Sc=function(t){t=this.Tc.indexOf(t);this.Tc.splice(t,1)},vp);function vp(){var t=this;this.yc=Promise.resolve(),this.gc=[],this.Ec=!1,this.Tc=[],this.Ic=null,this.Ac=!1,this.Rc=[],this.rr=new Dl(this,"async_queue_retry"),this.bc=function(){var e=wl();e&&Nr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.rr.Zi()};var e=wl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}function mp(t){return function(){if("object"==typeof t&&null!==t)for(var e=t,n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return 1}}()}var bp,wp=(Ip.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Ip.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Ip.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Ip.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Ip.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Ip.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Ip),Ep=(o(Tp,bp=np),Tp.prototype._terminate=function(){return this._firestoreClient||Sp(this),this._firestoreClient.terminate()},Tp);function Tp(t,e){var n=this;return(n=bp.call(this,t,e)||this)._queue=new gp,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Ip(){this._progressObserver={},this._taskCompletionResolver=new cu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function _p(t){return t._firestoreClient||Sp(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Sp(t){var e,n,r=t._freezeSettings(),r=(e=t._databaseId,n=t._persistenceKey,new Od(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t._firestoreClient=new gd(t._credentials,t._queue,r)}function Dp(t,e,n){var r=this,i=new cu;return t.asyncQueue.enqueue((function(){return s(r,void 0,void 0,(function(){var r;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Td(t,n)];case 1:return o.sent(),[4,Id(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!("FirebaseError"===(s=r=o.sent()).name?s.code===Wr.FAILED_PRECONDITION||s.code===Wr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}var s}))}))})).then((function(){return i.promise}))}function Ap(t){if(t._initialized||t._terminated)throw new Yr(Wr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Np=(Vp.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},Vp),Cp=(qp.fromBase64String=function(t){try{return new qp(ti.fromBase64String(t))}catch(t){throw new Yr(Wr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},qp.fromUint8Array=function(t){return new qp(ti.fromUint8Array(t))},qp.prototype.toBase64=function(){return this._byteString.toBase64()},qp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},qp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},qp.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},qp),kp=function(t){this._methodName=t},xp=(Object.defineProperty(Fp.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(Fp.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),Fp.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Fp.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},Fp.prototype._compareTo=function(t){return Mr(this._lat,t._lat)||Mr(this._long,t._long)},Fp),Rp=/^__.*__$/,Lp=(Mp.prototype.toMutation=function(t,e){return null!==this.fieldMask?new bs(t,this.data,this.fieldMask,e,this.fieldTransforms):new ms(t,this.data,e,this.fieldTransforms)},Mp),Op=(Pp.prototype.toMutation=function(t,e){return new bs(t,this.data,this.fieldMask,e,this.fieldTransforms)},Pp);function Pp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Mp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Fp(t,e){if(!isFinite(t)||t<-90||90<t)throw new Yr(Wr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Yr(Wr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function qp(t){this._byteString=t}function Vp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $r(t)}function Up(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Rr()}}var Bp=(Object.defineProperty(Kp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Kp.prototype,"Fc",{get:function(){return this.settings.Fc},enumerable:!1,configurable:!0}),Kp.prototype.Oc=function(t){return new Kp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.D,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Kp.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.Oc({path:e,Mc:!1});return e.Lc(t),e},Kp.prototype.Bc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.Oc({path:t,Mc:!1});return t.$c(),t},Kp.prototype.qc=function(t){return this.Oc({path:void 0,Mc:!0})},Kp.prototype.Uc=function(t){return by(t,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Kc)},Kp.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},Kp.prototype.$c=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Lc(this.path.get(t))},Kp.prototype.Lc=function(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(Up(this.Fc)&&Rp.test(t))throw this.Uc('Document fields cannot begin and end with "__"')},Kp),jp=(Gp.prototype.Wc=function(t,e,n,r){return void 0===r&&(r=!1),new Bp({Fc:t,methodName:e,Kc:n,path:$r.emptyPath(),Mc:!1,Qc:r},this.databaseId,this.D,this.ignoreUndefinedProperties)},Gp);function Gp(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.D=n||El(t)}function Kp(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.D=n,this.ignoreUndefinedProperties=r,void 0===i&&this.$c(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function zp(t){var e=t._freezeSettings(),n=El(t._databaseId);return new jp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Qp(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Wc(o.merge||o.mergeFields?2:0,e,n,i);yy("Data must be an object, but it was:",s,r);var a,u,r=dy(r,s);if(o.merge)a=new Po(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=gy(e,l[h],n);if(!s.contains(f))throw new Yr(Wr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");wy(c,f)||c.push(f)}a=new Po(c),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Lp(new Mo(r),a,u)}var Hp,Wp=(o(Yp,Hp=kp),Yp.prototype._toFieldTransform=function(t){if(2!==t.Fc)throw 1===t.Fc?t.Uc(this._methodName+"() can only appear at the top level of your update data"):t.Uc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},Yp.prototype.isEqual=function(t){return t instanceof Yp},Yp);function Yp(){return null!==Hp&&Hp.apply(this,arguments)||this}function Xp(t,e,n){return new Bp({Fc:3,Kc:e.settings.Kc,methodName:t._methodName,Mc:n},e.databaseId,e.D,e.ignoreUndefinedProperties)}var Jp,$p,Zp,ty,ey=(o(uy,ty=kp),uy.prototype._toFieldTransform=function(t){return new cs(t.path,new Wo)},uy.prototype.isEqual=function(t){return t instanceof uy},uy),ny=(o(ay,Zp=kp),ay.prototype._toFieldTransform=function(t){var e=Xp(this,t,!0),n=this.jc.map((function(t){return fy(t,e)})),n=new Yo(n);return new cs(t.path,n)},ay.prototype.isEqual=function(t){return this===t},ay),ry=(o(sy,$p=kp),sy.prototype._toFieldTransform=function(t){var e=Xp(this,t,!0),n=this.jc.map((function(t){return fy(t,e)})),n=new ts(n);return new cs(t.path,n)},sy.prototype.isEqual=function(t){return this===t},sy),iy=(o(oy,Jp=kp),oy.prototype._toFieldTransform=function(t){var e=new is(t.D,Ko(t.D,this.Gc));return new cs(t.path,e)},oy.prototype.isEqual=function(t){return this===t},oy);function oy(t,e){var n=this;return(n=Jp.call(this,t)||this).Gc=e,n}function sy(t,e){var n=this;return(n=$p.call(this,t)||this).jc=e,n}function ay(t,e){var n=this;return(n=Zp.call(this,t)||this).jc=e,n}function uy(){return null!==ty&&ty.apply(this,arguments)||this}function cy(t,e,n,r){var i=t.Wc(1,e,n);yy("Data must be an object, but it was:",i,r);var o=[],s=new Fo;Ur(r,(function(t,r){var a=my(e,t,n);r instanceof rp&&(r=r._delegate);t=i.Bc(a);r instanceof Wp?o.push(a):null!=(t=fy(r,t))&&(o.push(a),s.set(a,t))}));r=new Po(o);return new Op(s.v(),r,i.fieldTransforms)}function hy(t,e,n,r,i,o){var s=t.Wc(1,e,n),a=[gy(e,r,n)],u=[i];if(o.length%2!=0)throw new Yr(Wr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(gy(e,o[c])),u.push(o[c+1]);for(var h,l,f,d=[],p=new Fo,y=a.length-1;0<=y;--y)wy(d,a[y])||(h=a[y],(l=u[y])instanceof rp&&(l=l._delegate),f=s.Bc(h),l instanceof Wp?d.push(h):null!=(f=fy(l,f))&&(d.push(h),p.set(h,f)));i=new Po(d);return new Op(p.v(),i,s.fieldTransforms)}function ly(t,e,n,r){return void 0===r&&(r=!1),fy(n,t.Wc(r?4:3,e))}function fy(t,e){if(py(t=t instanceof rp?t._delegate:t))return yy("Unsupported field value:",e,t),dy(t,e);if(t instanceof kp)return function(t,e){if(!Up(e.Fc))throw e.Uc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Uc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Mc&&4!==e.Fc)throw e.Uc("Nested arrays are not supported");return function(e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=fy(o[i],e.qc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(e)}return function(t,e){if(null===(t=t instanceof rp?t._delegate:t))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ko(e.D,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=li.fromDate(t);return{timestampValue:ya(e.D,n)}}if(t instanceof li)return n=new li(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ya(e.D,n)};if(t instanceof xp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Cp)return{bytesValue:ga(e.D,t._byteString)};if(t instanceof ip){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Uc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ma(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc("Unsupported field value: "+Jd(t))}(t,e)}function dy(t,e){var n={};return Br(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):Ur(t,(function(t,r){r=fy(r,e.kc(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}function py(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof li||t instanceof xp||t instanceof Cp||t instanceof ip||t instanceof kp)}function yy(t,e,n){if(!py(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=Jd(n);throw"an object"===n?e.Uc(t+" a custom object"):e.Uc(t+" "+n)}var r}function gy(t,e,n){if((e=e instanceof rp?e._delegate:e)instanceof Np)return e._internalPath;if("string"==typeof e)return my(t,e);throw by("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var vy=new RegExp("[~\\*/\\[\\]]");function my(t,e,n){if(0<=e.search(vy))throw by("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Np.bind.apply(Np,u([void 0],e.split(".")))))._internalPath}catch(r){throw by("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function by(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Yr(Wr.INVALID_ARGUMENT,(e+=". ")+t+n)}function wy(t,e){return t.some((function(t){return t.isEqual(e)}))}var Ey,Ty=(Object.defineProperty(Sy.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Sy.prototype,"ref",{get:function(){return new ip(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Sy.prototype.exists=function(){return null!==this._document},Sy.prototype.data=function(){if(this._document){if(this._converter){var t=new Iy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.toProto())}},Sy.prototype.get=function(t){if(this._document){t=this._document.data().field(Dy("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},Sy),Iy=(o(_y,Ey=Ty),_y.prototype.data=function(){return Ey.prototype.data.call(this)},_y);function _y(){return null!==Ey&&Ey.apply(this,arguments)||this}function Sy(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Dy(t,e){return"string"==typeof e?my(t,e):(e instanceof rp?e._delegate:e)._internalPath}var Ay,Ny,Cy=(My.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},My),ky=(o(Py,Ny=Ty),Py.prototype.exists=function(){return Ny.prototype.exists.call(this)},Py.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new xy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.toProto(),t.serverTimestamps)}},Py.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data().field(Dy("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},Py),xy=(o(Oy,Ay=ky),Oy.prototype.data=function(t){return void 0===t&&(t={}),Ay.prototype.data.call(this,t)},Oy),Ry=(Object.defineProperty(Ly.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(Ly.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Ly.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Ly.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new xy(n._firestore,n._userDataWriter,r.key,r,new Cy(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},Ly.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Yr(Wr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new xy(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Cy(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new xy(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Cy(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Rr()}}(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},Ly);function Ly(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Cy(r.hasPendingWrites,r.fromCache),this.query=n}function Oy(){return null!==Ay&&Ay.apply(this,arguments)||this}function Py(t,e,n,r,i,o){var s=this;return(s=Ny.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function My(t,e){this.hasPendingWrites=t,this.fromCache=e}function Fy(t,e){return t instanceof ky&&e instanceof ky?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ry&&e instanceof Ry&&t._firestore===e._firestore&&yp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function qy(t){if(To(t)&&0===t.explicitOrderBy.length)throw new Yr(Wr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}d=function(){};function Vy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Uy,By,jy,Gy,Ky,zy=(o(tg,Ky=d),tg.prototype._apply=function(t){var e=zp(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){rg(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(ng(n,t,c))}h={arrayValue:{values:s}}}else h=ng(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||rg(o,i),h=ly(e,"where",o,"in"===i||"not-in"===i);var h=ji.create(r,i,h);return function(t,e){if(e.g()){var n=_o(t);if(null!==n&&!n.isEqual(e.field))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=Io(t);null!==n&&ig(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Yr(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Yr(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new op(t.firestore,t._converter,(t=t._query,e=t.filters.concat([e]),new mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},tg),Qy=(o(Zy,Gy=d),Zy.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new yo(e,n);return e=r,null!==Io(n=t)||null!==(t=_o(n))&&ig(0,t,e.field),r}(t._query,this.zc,this.Yc);return new op(t.firestore,t._converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new mo(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},Zy),Hy=(o($y,jy=d),$y.prototype._apply=function(t){return new op(t.firestore,t._converter,No(t._query,this.Xc,this.Zc))},$y),Wy=(o(Jy,By=d),Jy.prototype._apply=function(t){var e=eg(t,this.type,this.ta,this.ea);return new op(t.firestore,t._converter,(t=t._query,e=e,new mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Jy),Yy=(o(Xy,Uy=d),Xy.prototype._apply=function(t){var e=eg(t,this.type,this.ta,this.ea);return new op(t.firestore,t._converter,(t=t._query,e=e,new mo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Xy);function Xy(t,e,n){var r=this;return(r=Uy.call(this)||this).type=t,r.ta=e,r.ea=n,r}function Jy(t,e,n){var r=this;return(r=By.call(this)||this).type=t,r.ta=e,r.ea=n,r}function $y(t,e,n){var r=this;return(r=jy.call(this)||this).type=t,r.Xc=e,r.Zc=n,r}function Zy(t,e){var n=this;return(n=Gy.call(this)||this).zc=t,n.Yc=e,n.type="orderBy",n}function tg(t,e,n){var r=this;return(r=Ky.call(this)||this).zc=t,r.Hc=e,r.Jc=n,r.type="where",r}function eg(t,e,n,r){if(n[0]instanceof rp&&(n[0]=n[0]._delegate),n[0]instanceof Ty)return function(t,n,r,i){if(!r)throw new Yr(Wr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+e+"().");for(var o=[],s=0,a=Do(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ei(n,r.key));else{var c=r.field(u.field);if(di(c))throw new Yr(Wr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){u=u.field.canonicalString();throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}o.push(c)}}return new uo(o,i)}(t._query,t.firestore._databaseId,n[0]._document,r);var i=zp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Yr(Wr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!So(t)&&-1!==c.indexOf("/"))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Xr.fromString(c));if(!Zr.isDocumentKey(h))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Zr(h);a.push(Ei(e,h))}else{c=ly(n,r,c);a.push(c)}}return new uo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function ng(t,e,n){if("string"==typeof(n=n instanceof rp?n._delegate:n)){if(""===n)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!So(e)&&-1!==n.indexOf("/"))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(Xr.fromString(n));if(!Zr.isDocumentKey(e))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return Ei(t,new Zr(e))}if(n instanceof ip)return Ei(t,n._key);throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Jd(n)+".")}function rg(t,e){if(!Array.isArray(t)||0===t.length)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function ig(t,e,n){if(!n.isEqual(e))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}og.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),yi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ci(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(hi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Rr()}},og.prototype.convertObject=function(t,e){var n=this,r={};return Ur(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},og.prototype.convertGeoPoint=function(t){return new xp(ci(t.latitude),ci(t.longitude))},og.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},og.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return di(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(pi(t));default:return null}},og.prototype.convertTimestamp=function(t){t=ui(t);return new li(t.seconds,t.nanos)},og.prototype.convertDocumentKey=function(t,e){var n=Xr.fromString(t);Lr(Va(n));t=new Pd(n.get(1),n.get(3)),n=new Zr(n.popFirst(5));return t.isEqual(e)||Cr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},Ie=og;function og(){}function sg(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ag,ug=(o(lg,ag=Ie),lg.prototype.convertBytes=function(t){return new Cp(t)},lg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new ip(this.firestore,null,t)},lg),cg=(hg.prototype.set=function(t,e,n){this._verifyNotCommitted();t=fg(t,this._firestore),e=sg(t._converter,e,n),n=Qp(this._dataReader,"WriteBatch.set",t._key,e,null!==t._converter,n);return this._mutations.push(n.toMutation(t._key,hs.none())),this},hg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=fg(t,this._firestore),e="string"==typeof(e=e instanceof rp?e._delegate:e)||e instanceof Np?hy(this._dataReader,"WriteBatch.update",t._key,e,n,r):cy(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,hs.exists(!0))),this},hg.prototype.delete=function(t){this._verifyNotCommitted();t=fg(t,this._firestore);return this._mutations=this._mutations.concat(new ks(t._key,hs.none())),this},hg.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},hg.prototype._verifyNotCommitted=function(){if(this._committed)throw new Yr(Wr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},hg);function hg(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=zp(t)}function lg(t){var e=this;return(e=ag.call(this)||this).firestore=t,e}function fg(t,e){if((t=t instanceof rp?t._delegate:t).firestore!==e)throw new Yr(Wr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var dg,pg=(o(yg,dg=Ie),yg.prototype.convertBytes=function(t){return new Cp(t)},yg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new ip(this.firestore,null,t)},yg);function yg(t){var e=this;return(e=dg.call(this)||this).firestore=t,e}function gg(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=$d(t,ip);var o=$d(t.firestore,Ep),s=zp(o);return mg(o,[("string"==typeof(e=e instanceof rp?e._delegate:e)||e instanceof Np?hy(s,"updateDoc",t._key,e,n,r):cy(s,"updateDoc",t._key,e)).toMutation(t._key,hs.exists(!0))])}function vg(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t instanceof rp&&(t=t._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof e[i]||mp(e[i])||(r=e[i],i++);var o,u,c,h,l,f,d={includeMetadataChanges:r.includeMetadataChanges};return mp(e[i])&&(o=e[i],e[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),e[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),e[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),t instanceof ip?(c=$d(t.firestore,Ep),h=wo(t._key.path),f={next:function(n){e[i]&&e[i](bg(c,t,n))},error:e[i+1],complete:e[i+2]}):(u=$d(t,op),c=$d(u.firestore,Ep),h=u._query,l=new pg(c),f={next:function(t){e[i]&&e[i](new Ry(c,l,u,t))},error:e[i+1],complete:e[i+2]},qy(t._query)),function(t,e,n){var r=this,i=new fd(f),o=new vf(e,i,n);return t.asyncQueue.enqueueAndForget((function(){return s(r,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=pf,[4,kd(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){i.Xo(),t.asyncQueue.enqueueAndForget((function(){return s(r,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=yf,[4,kd(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(_p(c),h,d)}function mg(t,e){return function(t,e){var n=this,r=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n=Pf,[4,Cd(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(_p(t),e)}function bg(t,e,n){var r=n.docs.get(e._key),i=new pg(t);return new ky(t,i,e._key,r,new Cy(n.hasPendingWrites,n.fromCache),e._converter)}var wg,Eg=(Ig.prototype.get=function(t){var e=this,n=fg(t,this._firestore),r=new ug(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Rr();t=t[0];if(t instanceof xi)return new Ty(e._firestore,r,n._key,null,n._converter);if(t instanceof ki)return new Ty(e._firestore,r,t.key,t,n._converter);throw Rr()}))},Ig.prototype.set=function(t,e,n){t=fg(t,this._firestore),e=sg(t._converter,e,n),n=Qp(this._dataReader,"Transaction.set",t._key,e,null!==t._converter,n);return this._transaction.set(t._key,n),this},Ig.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=fg(t,this._firestore),e="string"==typeof(e=e instanceof rp?e._delegate:e)||e instanceof Np?hy(this._dataReader,"Transaction.update",t._key,e,n,r):cy(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Ig.prototype.delete=function(t){t=fg(t,this._firestore);return this._transaction.delete(t._key),this},o(Tg,wg=Ig),Tg.prototype.get=function(t){var e=this,n=fg(t,this._firestore),r=new pg(this._firestore);return wg.prototype.get.call(this,t).then((function(t){return new ky(e._firestore,r,n._key,t._document,new Cy(!1,!1),n._converter)}))},Tg);function Tg(t,e){var n=this;return(n=wg.call(this,t,e)||this)._firestore=t,n}function Ig(t,e){this._firestore=t,this._transaction=e,this._dataReader=zp(t)}function _g(){if("undefined"==typeof Uint8Array)throw new Yr(Wr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Sg(){if("undefined"==typeof atob)throw new Yr(Wr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Dg,Ag,Ng,Cg=(o(Mg,Ng=rp),Mg.fromBase64String=function(t){return Sg(),new Mg(Cp.fromBase64String(t))},Mg.fromUint8Array=function(t){return _g(),new Mg(Cp.fromUint8Array(t))},Mg.prototype.toBase64=function(){return Sg(),this._delegate.toBase64()},Mg.prototype.toUint8Array=function(){return _g(),this._delegate.toUint8Array()},Mg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},Mg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Mg),kg=(Pg.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Ap(t=$d(t,Ep));var n=_p(t),r=t._freezeSettings(),t=new sd;return Dp(n,t,new id(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},Pg.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Ap(t=$d(t,Ep));var e=_p(t),n=t._freezeSettings(),t=new sd;return Dp(e,t,new od(t,n.cacheSizeBytes))}(t._delegate)},Pg.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Yr(Wr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new cu;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return s(e,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return fu.At()?(e=t+"main",[4,fu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Zc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},Pg),xg=(o(Og,Ag=rp),Object.defineProperty(Og.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Og.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},Og.prototype.useEmulator=function(t,e){var n,r;n=this._delegate,r=t,t=e,"firestore.googleapis.com"!==(e=(n=$d(n,np))._getSettings()).host&&e.host!==r&&kr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},Og.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return s(e,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,Dd(t)];case 1:return e=r.sent(),[4,Nd(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),(i=n).Qr.delete(0),Fl(i))]}var i}))}))}))}(_p($d(this._delegate,Ep)))},Og.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return s(e,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,Dd(t)];case 1:return e=r.sent(),[4,Nd(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return s(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(e=t).Qr.add(0),[4,ql(e)];case 1:return n.sent(),e.jr.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(_p($d(this._delegate,Ep)))},Og.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Wd("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.na.enableMultiTabIndexedDbPersistence(this):this.na.enableIndexedDbPersistence(this,n)},Og.prototype.clearPersistence=function(){return this.na.clearIndexedDbPersistence(this)},Og.prototype.terminate=function(){return this.sa&&(this.sa._removeServiceInstance("firestore"),this.sa._removeServiceInstance("firestore-exp")),this._delegate._delete()},Og.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(e,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return e=Vf,[4,Cd(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(_p($d(this._delegate,Ep)))},Og.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(t,e){var n=this,r=new fd(e);return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=function(t,e){t.Zr.add(e),e.next()},[4,kd(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Xo(),t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=function(t,e){t.Zr.delete(e)},[4,kd(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(_p($d(e,Ep)),mp(t)?t:{next:t});var e},Object.defineProperty(Og.prototype,"app",{get:function(){if(!this.sa)throw new Yr(Wr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.sa},enumerable:!1,configurable:!0}),Og.prototype.collection=function(t){try{return new cv(this,fp(this._delegate,t))}catch(t){throw Yg(t,"collection()","Firestore.collection()")}},Og.prototype.doc=function(t){try{return new Hg(this,dp(this._delegate,t))}catch(t){throw Yg(t,"doc()","Firestore.doc()")}},Og.prototype.collectionGroup=function(t){try{return new sv(this,function(t,e){if(t=$d(t,np),Qd("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Yr(Wr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new op(t,null,(e=e,new mo(Xr.emptyPath(),e)))}(this._delegate,t))}catch(t){throw Yg(t,"collectionGroup()","Firestore.collectionGroup()")}},Og.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,r=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return[4,Sd(t).then((function(t){return t.datastore}))];case 1:return n=i.sent(),new yd(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(_p(e=this._delegate),(function(r){return r=new Eg(e,r),t(new Ug(n,r))}))},Og.prototype.batch=function(){var t=this;return _p(this._delegate),new Bg(new cg(this._delegate,(function(e){return mg(t._delegate,e)})))},Og.prototype.loadBundle=function(t){throw new Yr(Wr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},Og.prototype.namedQuery=function(t){throw new Yr(Wr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},Og),Rg=(o(Lg,Dg=Ie),Lg.prototype.convertBytes=function(t){return new Cg(new Cp(t))},Lg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return Hg.ia(t,this.firestore,null)},Lg);function Lg(t){var e=this;return(e=Dg.call(this)||this).firestore=t,e}function Og(t,e,n){var r=this;return(r=Ag.call(this,e)||this).na=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof Pd||(r.sa=t),r}function Pg(){}function Mg(){return null!==Ng&&Ng.apply(this,arguments)||this}var Fg,qg,Vg,Ug=(o(zg,Vg=rp),zg.prototype.get=function(t){var e=this,n=gv(t);return this._delegate.get(n).then((function(t){return new iv(e._firestore,new ky(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},zg.prototype.set=function(t,e,n){t=gv(t);return n?(Hd("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},zg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=gv(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,u([o,e,n],r)),this},zg.prototype.delete=function(t){t=gv(t);return this._delegate.delete(t),this},zg),Bg=(o(Kg,qg=rp),Kg.prototype.set=function(t,e,n){t=gv(t);return n?(Hd("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Kg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=gv(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,u([o,e,n],r)),this},Kg.prototype.delete=function(t){t=gv(t);return this._delegate.delete(t),this},Kg.prototype.commit=function(){return this._delegate.commit()},Kg),jg=(o(Gg,Fg=rp),Gg.prototype.fromFirestore=function(t,e){t=new xy(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new ov(this._firestore,t),null!=e?e:{})},Gg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},Gg.ra=function(t,e){var n=Gg.oa,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new Gg(t,new Rg(t),e),r.set(e,n)),n},Gg);function Gg(t,e,n){var r=this;return(r=Fg.call(this,n)||this)._firestore=t,r._userDataWriter=e,r}function Kg(){return null!==qg&&qg.apply(this,arguments)||this}function zg(t,e){var n=this;return(n=Vg.call(this,e)||this)._firestore=t,n._userDataWriter=new Rg(t),n}jg.oa=new WeakMap;var Qg,Hg=(o(Wg,Qg=rp),Wg.ca=function(t,e,n){if(t.length%2!=0)throw new Yr(Wr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new Wg(e,new ip(e._delegate,n,new Zr(t)))},Wg.ia=function(t,e,n){return new Wg(e,new ip(e._delegate,n,t))},Object.defineProperty(Wg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"parent",{get:function(){return new cv(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Wg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Wg.prototype.collection=function(t){try{return new cv(this.firestore,fp(this._delegate,t))}catch(t){throw Yg(t,"collection()","DocumentReference.collection()")}},Wg.prototype.isEqual=function(t){return(t=t instanceof rp?t._delegate:t)instanceof ip&&pp(this._delegate,t)},Wg.prototype.set=function(t,e){e=Hd("DocumentReference.set",e);try{return function(t,e,n){t=$d(t,ip);var r=$d(t.firestore,Ep),e=sg(t._converter,e,n);return mg(r,[Qp(zp(r),"setDoc",t._key,e,null!==t._converter,n).toMutation(t._key,hs.none())])}(this._delegate,t,e)}catch(t){throw Yg(t,"setDoc()","DocumentReference.set()")}},Wg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?gg(this._delegate,t):gg.apply(void 0,u([this._delegate,t,e],n))}catch(t){throw Yg(t,"updateDoc()","DocumentReference.update()")}},Wg.prototype.delete=function(){return mg($d((t=this._delegate).firestore,Ep),[new ks(t._key,hs.none())]);var t},Wg.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Xg(e),i=Jg(e,(function(e){return new iv(t.firestore,new ky(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return vg(this._delegate,r,i)},Wg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=$d(t,ip);var e=$d(t.firestore,Ep),n=_p(e),r=new pg(e);return function(t,e){var n=this,r=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return s(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,(s=e,(a=t).persistence.runTransaction("read document","readonly",(function(t){return a.Kn.In(t,s)})))];case 1:return(i=o.sent())instanceof ki?n.resolve(i):i instanceof xi?n.resolve(null):n.reject(new Yr(Wr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=of(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}var s,a}))}))},[4,Ad(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new ky(e,r,t._key,n,new Cy(n instanceof ki&&n.hasLocalMutations,!0),t._converter)}))}:"server"===(null==t?void 0:t.source)?function(t){t=$d(t,ip);var e=$d(t.firestore,Ep);return xd(_p(e),t._key,{source:"server"}).then((function(n){return bg(e,t,n)}))}:function(t){t=$d(t,ip);var e=$d(t.firestore,Ep);return xd(_p(e),t._key).then((function(n){return bg(e,t,n)}))})(this._delegate).then((function(t){return new iv(e.firestore,new ky(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},Wg.prototype.withConverter=function(t){return new Wg(this.firestore,t?this._delegate.withConverter(jg.ra(this.firestore,t)):this._delegate.withConverter(null))},Wg);function Wg(t,e){var n=this;return(n=Qg.call(this,e)||this).firestore=t,n._userDataWriter=new Rg(t),n}function Yg(t,e,n){return t.message=t.message.replace(e,n),t}function Xg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!mp(r))return r}return{}}function Jg(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=mp(t[0])?t[0]:mp(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var $g,Zg,tv,ev,nv,rv,iv=(o(yv,rv=rp),Object.defineProperty(yv.prototype,"ref",{get:function(){return new Hg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(yv.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(yv.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(yv.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),yv.prototype.data=function(t){return this._delegate.data(t)},yv.prototype.get=function(t,e){return this._delegate.get(t,e)},yv.prototype.isEqual=function(t){return Fy(this._delegate,t._delegate)},yv),ov=(o(pv,nv=iv),pv.prototype.data=function(t){return this._delegate.data(t)},pv),sv=(o(dv,ev=rp),dv.prototype.where=function(t,e,n){try{return new dv(this.firestore,Vy(this._delegate,(r=n,i=e,o=Dy("where",t),new zy(o,i,r))))}catch(t){throw Yg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},dv.prototype.orderBy=function(t,e){try{return new dv(this.firestore,Vy(this._delegate,(n=void 0===e?"asc":e,r=Dy("orderBy",t),new Qy(r,n))))}catch(t){throw Yg(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},dv.prototype.limit=function(t){try{return new dv(this.firestore,Vy(this._delegate,(Zd("limit",e=t),new Hy("limit",e,"F"))))}catch(t){throw Yg(t,"limit()","Query.limit()")}var e},dv.prototype.limitToLast=function(t){try{return new dv(this.firestore,Vy(this._delegate,(Zd("limitToLast",e=t),new Hy("limitToLast",e,"L"))))}catch(t){throw Yg(t,"limitToLast()","Query.limitToLast()")}var e},dv.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new dv(this.firestore,Vy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wy("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Yg(t,"startAt()","Query.startAt()")}},dv.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new dv(this.firestore,Vy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wy("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Yg(t,"startAfter()","Query.startAfter()")}},dv.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new dv(this.firestore,Vy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Yy("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Yg(t,"endBefore()","Query.endBefore()")}},dv.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new dv(this.firestore,Vy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Yy("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Yg(t,"endAt()","Query.endAt()")}},dv.prototype.isEqual=function(t){return yp(this._delegate,t._delegate)},dv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=$d(t,op);var e=$d(t.firestore,Ep),n=_p(e),r=new pg(e);return function(t,e){var n=this,r=new cu;return t.asyncQueue.enqueueAndForget((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return s(this,void 0,void 0,(function(){var r,i,o;return a(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,vh(t,e,!0)];case 1:return o=s.sent(),r=new Nf(e,o.jn),i=r.Io(o.documents),i=r.applyChanges(i,!1),n.resolve(i.snapshot),[3,3];case 2:return i=s.sent(),o=of(i,"Failed to execute query '"+e+" against cache"),n.reject(o),[3,3];case 3:return[2]}}))}))},[4,Ad(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Ry(e,r,t,n)}))}:"server"===(null==t?void 0:t.source)?function(t){t=$d(t,op);var e=$d(t.firestore,Ep),n=_p(e),r=new pg(e);return Rd(n,t._query,{source:"server"}).then((function(n){return new Ry(e,r,t,n)}))}:function(t){t=$d(t,op);var e=$d(t.firestore,Ep),n=_p(e),r=new pg(e);return qy(t._query),Rd(n,t._query).then((function(n){return new Ry(e,r,t,n)}))})(this._delegate).then((function(t){return new uv(e.firestore,new Ry(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},dv.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Xg(e),i=Jg(e,(function(e){return new uv(t.firestore,new Ry(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return vg(this._delegate,r,i)},dv.prototype.withConverter=function(t){return new dv(this.firestore,t?this._delegate.withConverter(jg.ra(this.firestore,t)):this._delegate.withConverter(null))},dv),av=(o(fv,tv=rp),Object.defineProperty(fv.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"doc",{get:function(){return new ov(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(fv.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),fv),uv=(o(lv,Zg=rp),Object.defineProperty(lv.prototype,"query",{get:function(){return new sv(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new ov(t._firestore,e)}))},enumerable:!1,configurable:!0}),lv.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new av(e._firestore,t)}))},lv.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new ov(n._firestore,r))}))},lv.prototype.isEqual=function(t){return Fy(this._delegate,t._delegate)},lv),cv=(o(hv,$g=sv),Object.defineProperty(hv.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(hv.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(hv.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Hg(this.firestore,t):null},enumerable:!1,configurable:!0}),hv.prototype.doc=function(t){try{return new Hg(this.firestore,void 0===t?dp(this._delegate):dp(this._delegate,t))}catch(t){throw Yg(t,"doc()","CollectionReference.doc()")}},hv.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=$d(e.firestore,Ep),r=dp(e),n=sg(e._converter,n),mg(t,[Qp(zp(e.firestore),"addDoc",r._key,n,null!==e._converter,{}).toMutation(r._key,hs.exists(!1))]).then((function(){return r})).then((function(t){return new Hg(i.firestore,t)}))},hv.prototype.isEqual=function(t){return pp(this._delegate,t._delegate)},hv.prototype.withConverter=function(t){return new hv(this.firestore,t?this._delegate.withConverter(jg.ra(this.firestore,t)):this._delegate.withConverter(null))},hv);function hv(t,e){var n=this;return(n=$g.call(this,t,e)||this).firestore=t,n._delegate=e,n}function lv(t,e){var n=this;return(n=Zg.call(this,e)||this)._firestore=t,n}function fv(t,e){var n=this;return(n=tv.call(this,e)||this)._firestore=t,n}function dv(t,e){var n=this;return(n=ev.call(this,e)||this).firestore=t,n._userDataWriter=new Rg(t),n}function pv(){return null!==nv&&nv.apply(this,arguments)||this}function yv(t,e){var n=this;return(n=rv.call(this,e)||this)._firestore=t,n}function gv(t){return $d(t=t instanceof rp?t._delegate:t,ip)}var vv,mv,d=(o(wv,mv=rp),wv.documentId=function(){return new wv($r.keyField().canonicalString())},wv.prototype.isEqual=function(t){return(t=t instanceof rp?t._delegate:t)instanceof Np&&this._delegate._internalPath.isEqual(t._internalPath)},wv),Ie=(o(bv,vv=rp),bv.serverTimestamp=function(){var t=new ey("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new bv(t)},bv.delete=function(){var t=new Wp("deleteField");return t._methodName="FieldValue.delete",new bv(t)},bv.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ny("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new bv(n)},bv.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ry("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new bv(n)},bv.increment=function(t){t=new iy("increment",t);return t._methodName="FieldValue.increment",new bv(t)},bv.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},bv);function bv(){return null!==vv&&vv.apply(this,arguments)||this}function wv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return mv.call(this,new(Np.bind.apply(Np,u([void 0],t))))||this}function Ev(t){return e=this._delegate,n=t,r=_p(e=$d(e,Ep)),t=new wp,function(t,e,r){var i,o=this,u=(i=n,e=El(e),i=function(t){if(t instanceof Uint8Array)return ld(t,void 0);if(t instanceof ArrayBuffer)return ld(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof i?(new TextEncoder).encode(i):i),new dd(i,e));t.asyncQueue.enqueueAndForget((function(){return s(o,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=td,[4,Cd(t)];case 1:return e.apply(void 0,[n.sent(),u,r]),[2]}}))}))}))}(r,e._databaseId,t),t;var e,n,r}function Tv(t){var e=this,n=this._delegate,t=t;return function(t,e){var n=this;return t.asyncQueue.enqueue((function(){return s(n,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return n=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",(function(t){return n.He.getNamedQuery(t,e)}))},[4,Ad(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}}))}))}))}(_p(n=$d(n,Ep)),t).then((function(t){return t?new op(n,null,t.query):null})).then((function(t){return t?new sv(e,t):null}))}var Iv=(_v.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},_v.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},_v.prototype.setServiceProps=function(t){return this.serviceProps=t,this},_v);function _v(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Sv,Dv,Av={Firestore:xg,GeoPoint:xp,Timestamp:li,Blob:Cg,Transaction:Ug,WriteBatch:Bg,DocumentReference:Hg,DocumentSnapshot:iv,Query:sv,QueryDocumentSnapshot:ov,QuerySnapshot:uv,CollectionReference:cv,FieldPath:d,FieldValue:Ie,setLogLevel:function(t){Dr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(Sv=r.default).INTERNAL.registerComponent(new Iv("firestore",(function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new xg(e,new Ep(e,t),new kg)}),"PUBLIC").setServiceProps(Object.assign({},Av))),Sv.registerVersion("@firebase/firestore","2.2.1"),(Dv=xg).prototype.loadBundle=Ev,Dv.prototype.namedQuery=Tv}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}));